import{g as k,b8 as T,d as O,w as E,a as H,o as C,k as u,y as l,h as F,i as t,a7 as w,q as A,a_ as $}from"./main-DgBHKuti.js";import{f as B}from"./franchise-D70twOXJ.js";import{u as q}from"./users-DLL6e0Fl.js";import{_ as P,V as _}from"./VDialog-ezJwpJqC.js";import{u as R}from"./useValidationRules-Bd5D7Ytp.js";import{u as N}from"./tasksValidation-D8XQN3X3.js";import{V as h,f as x,g as L}from"./VCard-DVi6PJvG.js";import{V as I}from"./VDivider-BxPq45VT.js";import{V as M}from"./VForm-CVDY5Y_H.js";import{V as K,a as f}from"./VRow-DGHOvSAD.js";import{V as D}from"./VTextField-BE7e03Iq.js";import{V as z}from"./VTextarea-BIzeImqm.js";import{V as S}from"./VSelect-Cvwflwlf.js";import{V as G}from"./VSpacer-BI04G-8-.js";const ne=()=>{const v=k([]),V=k([]),y=k(!1),n=k(null),b=async()=>{var e,r;try{y.value=!0,n.value=null;const o=await B.getFranchisees();o.success&&((e=o.data)!=null&&e.data)?v.value=o.data.data.map(d=>({id:d.id,name:d.name,email:d.email,role:"franchisee",status:d.status})):v.value=[]}catch(o){console.error("Failed to fetch franchisees:",o),n.value=((r=o==null?void 0:o.data)==null?void 0:r.message)||"Failed to fetch franchisees",v.value=[]}finally{y.value=!1}},m=async()=>{var e;try{y.value=!0,n.value=null;const r=await q.getBrokers();if(r.success&&r.data){const o=Array.isArray(r.data)?r.data:r.data.data||[];V.value=o.map(d=>({id:d.id,name:d.name,email:d.email,role:"broker",status:d.status}))}else V.value=[]}catch(r){console.error("Failed to fetch brokers:",r),n.value=((e=r==null?void 0:r.data)==null?void 0:e.message)||"Failed to fetch brokers",V.value=[]}finally{y.value=!1}},U=e=>(e==="franchisee"?v.value:V.value).filter(o=>o.status==="active").map(o=>({title:`${o.name} (${o.email})`,value:o.id,subtitle:o.role})),c=(e,r)=>{const d=(r==="franchisee"?v.value:V.value).find(p=>p.id===e);return d?d.name:"Unknown User"},g=async(e="both")=>{(e==="franchisee"||e==="both")&&await b(),(e==="broker"||e==="both")&&await m()};return{franchisees:T(v),brokers:T(V),loading:T(y),error:T(n),fetchFranchisees:b,fetchBrokers:m,getUsersForSelect:U,getUserNameById:c,initializeUsers:g}},Y=["Onboarding","Training","Compliance","Maintenance","Marketing","Operations","Finance","Support","Other"],j=[{title:"Low",value:"low"},{title:"Medium",value:"medium"},{title:"High",value:"high"},{title:"Urgent",value:"urgent"}],J=[{title:"Pending",value:"pending"},{title:"On Hold",value:"on_hold"},{title:"Cancelled",value:"cancelled"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],me=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Assigned To",key:"assignedTo"},{title:"Unit",key:"unitName"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],pe=O({__name:"EditTaskDialog",props:{isDialogVisible:{type:Boolean},task:{},userOptions:{},usersLoading:{type:Boolean,default:!1}},emits:["update:isDialogVisible","task-updated"],setup(v,{emit:V}){const y=v,n=V,b=k(),{backendErrors:m,setBackendErrors:U,clearError:c}=R(),g=N(),e=k(null),r=k(!1);E(()=>y.task,p=>{p&&(e.value={...p})},{immediate:!0});const o=async()=>{var a;if(!e.value)return;const{valid:p}=await b.value.validate();if(p)try{r.value=!0;const i=await $(`/v1/franchisor/tasks/${e.value.id}`,{method:"PUT",body:{title:e.value.title,description:e.value.description,category:e.value.category,priority:e.value.priority,status:e.value.status,due_date:e.value.dueDate,estimated_hours:e.value.estimatedHours,actual_hours:e.value.actualHours}});if(i.success){const s={id:i.data.id,title:i.data.title,description:i.data.description,category:i.data.type||"other",assignedTo:((a=i.data.assigned_to)==null?void 0:a.name)||e.value.assignedTo,startDate:i.data.started_at?new Date(i.data.started_at).toISOString().split("T")[0]:e.value.startDate,dueDate:i.data.due_date?new Date(i.data.due_date).toISOString().split("T")[0]:e.value.dueDate,priority:i.data.priority||e.value.priority,status:i.data.status||e.value.status,estimatedHours:i.data.estimated_hours||e.value.estimatedHours,actualHours:i.data.actual_hours||e.value.actualHours};n("task-updated",s),n("update:isDialogVisible",!1)}else console.error("Failed to update task:",i)}catch(i){console.error("Error updating task:",i),U(i)}finally{r.value=!1}},d=()=>{n("update:isDialogVisible",!1)};return(p,a)=>{const i=P;return C(),H(_,{"model-value":p.isDialogVisible,"max-width":"600",persistent:"","onUpdate:modelValue":a[17]||(a[17]=s=>n("update:isDialogVisible",s))},{default:u(()=>[l(i,{onClick:d}),l(h,{title:"Edit Task"},{default:u(()=>[l(I),t(e)?(C(),H(x,{key:0,class:"pa-6"},{default:u(()=>[l(M,{ref_key:"formRef",ref:b},{default:u(()=>[l(K,null,{default:u(()=>[l(f,{cols:"12"},{default:u(()=>[l(D,{modelValue:t(e).title,"onUpdate:modelValue":a[0]||(a[0]=s=>t(e).title=s),label:"Task Title",placeholder:"Enter task title",rules:t(g).title,"error-messages":t(m).title,onInput:a[1]||(a[1]=s=>t(c)("title")),required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),l(f,{cols:"12"},{default:u(()=>[l(z,{modelValue:t(e).description,"onUpdate:modelValue":a[2]||(a[2]=s=>t(e).description=s),label:"Description",placeholder:"Enter task description",rows:"3",rules:t(g).description,"error-messages":t(m).description,onInput:a[3]||(a[3]=s=>t(c)("description")),required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),l(f,{cols:"12",md:"6"},{default:u(()=>[l(S,{modelValue:t(e).category,"onUpdate:modelValue":[a[4]||(a[4]=s=>t(e).category=s),a[5]||(a[5]=s=>t(c)("category"))],label:"Category",placeholder:"Select category",items:t(Y),rules:t(g).category,"error-messages":t(m).category,required:""},null,8,["modelValue","items","rules","error-messages"])]),_:1}),l(f,{cols:"12",md:"6"},{default:u(()=>[l(S,{modelValue:t(e).assignedTo,"onUpdate:modelValue":a[6]||(a[6]=s=>t(e).assignedTo=s),label:"Assigned To",placeholder:"Select user",items:p.userOptions,loading:p.usersLoading,"item-title":"title","item-value":"value",required:""},null,8,["modelValue","items","loading"])]),_:1}),l(f,{cols:"12",md:"6"},{default:u(()=>[l(D,{modelValue:t(e).startDate,"onUpdate:modelValue":a[7]||(a[7]=s=>t(e).startDate=s),label:"Start Date",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(f,{cols:"12",md:"6"},{default:u(()=>[l(D,{modelValue:t(e).dueDate,"onUpdate:modelValue":a[8]||(a[8]=s=>t(e).dueDate=s),label:"Due Date",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(f,{cols:"12",md:"6"},{default:u(()=>[l(S,{modelValue:t(e).priority,"onUpdate:modelValue":[a[9]||(a[9]=s=>t(e).priority=s),a[10]||(a[10]=s=>t(c)("priority"))],label:"Priority",items:t(j),rules:t(g).priority,"error-messages":t(m).priority,required:""},null,8,["modelValue","items","rules","error-messages"])]),_:1}),l(f,{cols:"12",md:"6"},{default:u(()=>[l(S,{modelValue:t(e).status,"onUpdate:modelValue":[a[11]||(a[11]=s=>t(e).status=s),a[12]||(a[12]=s=>t(c)("status"))],label:"Status",items:t(J),rules:t(g).status,"error-messages":t(m).status,required:""},null,8,["modelValue","items","rules","error-messages"])]),_:1}),l(f,{cols:"12",md:"6"},{default:u(()=>[l(D,{modelValue:t(e).estimatedHours,"onUpdate:modelValue":a[13]||(a[13]=s=>t(e).estimatedHours=s),label:"Estimated Hours",type:"number",min:"0",rules:t(g).estimatedHours,"error-messages":t(m).estimatedHours,onInput:a[14]||(a[14]=s=>t(c)("estimatedHours"))},null,8,["modelValue","rules","error-messages"])]),_:1}),l(f,{cols:"12",md:"6"},{default:u(()=>[l(D,{modelValue:t(e).actualHours,"onUpdate:modelValue":a[15]||(a[15]=s=>t(e).actualHours=s),label:"Actual Hours",type:"number",min:"0",rules:t(g).actualHours,"error-messages":t(m).actualHours,onInput:a[16]||(a[16]=s=>t(c)("actualHours"))},null,8,["modelValue","rules","error-messages"])]),_:1})]),_:1})]),_:1},512)]),_:1})):F("",!0),l(I),l(L,{class:"pa-6"},{default:u(()=>[l(G),l(w,{color:"secondary",variant:"tonal",onClick:d},{default:u(()=>a[18]||(a[18]=[A(" Cancel ")])),_:1,__:[18]}),l(w,{color:"primary",loading:t(r),onClick:o},{default:u(()=>a[19]||(a[19]=[A(" Save Changes ")])),_:1,__:[19]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{j as P,J as S,me as T,pe as _,Y as a,ne as u};
