import{L as ee,K as ne,a$ as Ee,M as ie,y as e,ax as ke,a7 as z,ag as Me,bL as Le,O as R,I as We,al as Oe,bR as je,av as N,bM as Ge,R as Z,ah as Ye,P as He,n as Ve,S as Ke,bN as Je,bb as Qe,bS as Xe,bT as he,az as Ze,bi as et,bO as tt,bG as at,F as ue,d as _e,g as I,w as me,a as P,o as V,k as a,l as r,h as ce,i as t,q as x,t as _,aI as H,e as lt,E as st,c as Q,bf as ae,r as we,b7 as Ue}from"./main-CjIXzPPN.js";import{f as nt}from"./formatters-aoHiJebZ.js";import{_ as it}from"./AppDateTimePicker.vue_vue_type_style_index_0_lang-BDPsEo5g.js";import{_ as ot}from"./AppTextarea.vue_vue_type_script_setup_true_lang-5yoA5HPC.js";import{_ as rt}from"./AppSelect.vue_vue_type_script_setup_true_lang-cQft3JvN.js";import{_ as dt}from"./AppTextField.vue_vue_type_script_setup_true_lang-FOohyJD1.js";import{r as ut}from"./validators-BHkKs9Dp.js";import{f as se}from"./franchise-MFk-mefb.js";import{u as mt,a as ct}from"./useSaudiProvinces-BcU2aLXR.js";import{u as Re,a as Ae}from"./useValidationRules-DsE3OatZ.js";import{c as pt,b as te,V as W,d as pe,f as E,g as xe,a as Ce}from"./VCard-DsOmZPOW.js";import{V as ve}from"./VAlert-CMlcx-BG.js";import{V as fe,m as vt,a as oe,b as ft}from"./VWindowItem-BdCJ1UA1.js";import{V as Pe,m as yt}from"./VSheet-CVxM8luu.js";import{V as re}from"./VDivider-BfvNl_GQ.js";import{V as ye}from"./VForm-DPrjrYwI.js";import{V as X,a as U}from"./VRow-B0XS-9G3.js";import{V as ze}from"./VSpacer-DrBLALgl.js";import{V as $e,_ as bt}from"./VDialog-BlQRpNKw.js";import{V as Fe}from"./VSelect-CWIiyd9K.js";import{a as Ie,V as gt}from"./VTabs-DFegxh19.js";import{S as Vt}from"./saudi-riyal-C8sV6kbv.js";import{V as le}from"./VSkeletonLoader-BEqlC0Px.js";import{V as de}from"./VChip-D1-opBSv.js";import{V as _t}from"./VDataTable-DO7HlNoc.js";import{V as xt}from"./VPagination-vxjArAbQ.js";import{V as De}from"./VTooltip-CxctuGEH.js";import"./VField-7cD6L6AZ.js";import"./form-DXdjKGLJ.js";import"./VInput-DDH1Obwe.js";import"./VTextarea-BHBNueOx.js";import"./VTextField-CEXpIXUU.js";import"./api-router-DKaNRiO8.js";import"./VList-BV1EJSa7.js";import"./VMenu-B3fHBqmF.js";import"./VCheckboxBtn-BZ4R0aQx.js";import"./VSelectionControl-Dnu967dS.js";import"./VSlideGroup-CSE86Unr.js";import"./VTable-8wf8FgSW.js";const Se=Symbol.for("vuetify:v-stepper"),qe=ee({color:String,disabled:{type:[Boolean,String],default:!1},prevText:{type:String,default:"$vuetify.stepper.prev"},nextText:{type:String,default:"$vuetify.stepper.next"}},"VStepperActions"),St=ne()({name:"VStepperActions",props:qe(),emits:{"click:prev":()=>!0,"click:next":()=>!0},setup(n,$){let{emit:d,slots:m}=$;const{t:p}=Ee();function f(){d("click:prev")}function k(){d("click:next")}return ie(()=>{const g={onClick:f},b={onClick:k};return e("div",{class:"v-stepper-actions"},[e(ke,{defaults:{VBtn:{disabled:["prev",!0].includes(n.disabled),text:p(n.prevText),variant:"text"}}},{default:()=>{var c;return[((c=m.prev)==null?void 0:c.call(m,{props:g}))??e(z,g,null)]}}),e(ke,{defaults:{VBtn:{color:n.color,disabled:["next",!0].includes(n.disabled),text:p(n.nextText),variant:"tonal"}}},{default:()=>{var c;return[((c=m.next)==null?void 0:c.call(m,{props:b}))??e(z,b,null)]}})])}),{}}}),Te=pt("v-stepper-header"),kt=ee({color:String,title:String,subtitle:String,complete:Boolean,completeIcon:{type:Z,default:"$complete"},editable:Boolean,editIcon:{type:Z,default:"$edit"},error:Boolean,errorIcon:{type:Z,default:"$error"},icon:Z,ripple:{type:[Boolean,Object],default:!0},rules:{type:Array,default:()=>[]}},"StepperItem"),ht=ee({...kt(),...Ge()},"VStepperItem"),be=ne()({name:"VStepperItem",directives:{Ripple:Me},props:ht(),emits:{"group:selected":n=>!0},setup(n,$){let{slots:d}=$;const m=Le(n,Se,!0),p=R(()=>(m==null?void 0:m.value.value)??n.value),f=R(()=>n.rules.every(o=>o()===!0)),k=R(()=>!n.disabled&&n.editable),g=R(()=>!n.disabled&&n.editable),b=R(()=>n.error||!f.value),c=R(()=>n.complete||n.rules.length>0&&f.value),C=R(()=>b.value?n.errorIcon:c.value?n.completeIcon:m.isSelected.value&&n.editable?n.editIcon:n.icon),w=R(()=>({canEdit:g.value,hasError:b.value,hasCompleted:c.value,title:n.title,subtitle:n.subtitle,step:p.value,value:n.value}));return ie(()=>{var q,O,G;const o=(!m||m.isSelected.value||c.value||g.value)&&!b.value&&!n.disabled,D=!!(n.title!=null||d.title),S=!!(n.subtitle!=null||d.subtitle);function M(){m==null||m.toggle()}return We(e("button",{class:["v-stepper-item",{"v-stepper-item--complete":c.value,"v-stepper-item--disabled":n.disabled,"v-stepper-item--error":b.value},m==null?void 0:m.selectedClass.value],disabled:!n.editable,type:"button",onClick:M},[k.value&&je(!0,"v-stepper-item"),e(te,{key:"stepper-avatar",class:"v-stepper-item__avatar",color:o?n.color:void 0,size:24},{default:()=>{var F;return[((F=d.icon)==null?void 0:F.call(d,w.value))??(C.value?e(N,{icon:C.value},null):p.value)]}}),e("div",{class:"v-stepper-item__content"},[D&&e("div",{key:"title",class:"v-stepper-item__title"},[((q=d.title)==null?void 0:q.call(d,w.value))??n.title]),S&&e("div",{key:"subtitle",class:"v-stepper-item__subtitle"},[((O=d.subtitle)==null?void 0:O.call(d,w.value))??n.subtitle]),(G=d.default)==null?void 0:G.call(d,w.value)])]),[[Oe("ripple"),n.ripple&&n.editable,null]])}),{}}}),wt=ee({...Ke(vt(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VStepperWindow"),Be=ne()({name:"VStepperWindow",props:wt(),emits:{"update:modelValue":n=>!0},setup(n,$){let{slots:d}=$;const m=Ye(Se,null),p=He(n,"modelValue"),f=R({get(){var k;return p.value!=null||!m?p.value:(k=m.items.value.find(g=>m.selected.value.includes(g.id)))==null?void 0:k.value},set(k){p.value=k}});return ie(()=>{const k=fe.filterProps(n);return e(fe,Ve({_as:"VStepperWindow"},k,{modelValue:f.value,"onUpdate:modelValue":g=>f.value=g,class:["v-stepper-window",n.class],style:n.style,mandatory:!1,touch:!1}),d)}),{}}}),Ut=ee({...ft()},"VStepperWindowItem"),ge=ne()({name:"VStepperWindowItem",props:Ut(),setup(n,$){let{slots:d}=$;return ie(()=>{const m=oe.filterProps(n);return e(oe,Ve({_as:"VStepperWindowItem"},m,{class:["v-stepper-window-item",n.class],style:n.style}),d)}),{}}}),Ct=ee({altLabels:Boolean,bgColor:String,completeIcon:Z,editIcon:Z,editable:Boolean,errorIcon:Z,hideActions:Boolean,items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},nonLinear:Boolean,flat:Boolean,...at()},"Stepper"),Pt=ee({...Ct(),...tt({mandatory:"force",selectedClass:"v-stepper-item--selected"}),...yt(),...et(qe(),["prevText","nextText"])},"VStepper"),It=ne()({name:"VStepper",props:Pt(),emits:{"update:modelValue":n=>!0},setup(n,$){let{slots:d}=$;const{items:m,next:p,prev:f,selected:k}=Je(n,Se),{displayClasses:g,mobile:b}=Qe(n),{completeIcon:c,editIcon:C,errorIcon:w,color:o,editable:D,prevText:S,nextText:M}=Xe(n),q=R(()=>n.items.map((F,L)=>{const j=he(F,n.itemTitle,F),Y=he(F,n.itemValue,L+1);return{title:j,value:Y,raw:F}})),O=R(()=>m.value.findIndex(F=>k.value.includes(F.id))),G=R(()=>n.disabled?n.disabled:O.value===0?"prev":O.value===m.value.length-1?"next":!1);return Ze({VStepperItem:{editable:D,errorIcon:w,completeIcon:c,editIcon:C,prevText:S,nextText:M},VStepperActions:{color:o,disabled:G,prevText:S,nextText:M}}),ie(()=>{const F=Pe.filterProps(n),L=!!(d.header||n.items.length),j=n.items.length>0,Y=!n.hideActions&&!!(j||d.actions);return e(Pe,Ve(F,{color:n.bgColor,class:["v-stepper",{"v-stepper--alt-labels":n.altLabels,"v-stepper--flat":n.flat,"v-stepper--non-linear":n.nonLinear,"v-stepper--mobile":b.value},g.value,n.class],style:n.style}),{default:()=>{var K,J;return[L&&e(Te,{key:"stepper-header"},{default:()=>[q.value.map((B,A)=>{let{raw:i,...T}=B;return e(ue,null,[!!A&&e(re,null,null),e(be,T,{default:d[`header-item.${T.value}`]??d.header,icon:d.icon,title:d.title,subtitle:d.subtitle})])})]}),j&&e(Be,{key:"stepper-window"},{default:()=>[q.value.map(B=>e(ge,{value:B.value},{default:()=>{var A,i;return((A=d[`item.${B.value}`])==null?void 0:A.call(d,B))??((i=d.item)==null?void 0:i.call(d,B))}}))]}),(K=d.default)==null?void 0:K.call(d,{prev:f,next:p}),Y&&(((J=d.actions)==null?void 0:J.call(d,{next:p,prev:f}))??e(St,{key:"stepper-actions","onClick:prev":f,"onClick:next":p},d))]}})}),{prev:f,next:p}}}),Dt={class:"d-flex gap-3"},Rt=_e({__name:"AddFranchiseeDialog",props:{isDialogVisible:{type:Boolean}},emits:["update:isDialogVisible","franchiseeAdded"],setup(n,{emit:$}){const d=n,m=$,p=I(),{backendErrors:f,setBackendErrors:k,clearError:g}=Re(),b=Ae(),c=I(1),C=I(!1),w=I(null),o=I({name:"",email:"",phone:"",nationality:"",state:"",city:"",address:"",postalCode:"",type:"store",sizeSqft:"",capacity:"",openingDate:"",monthlyRent:""}),{countries:D,isLoading:S}=mt(),{provinces:M,getCitiesForProvince:q,isLoading:O}=ct(),G=R(()=>q(o.value.state||""));me(()=>o.value.state,()=>{o.value.city=""});const F=[{title:"Store",value:"store"},{title:"Kiosk",value:"kiosk"},{title:"Mobile",value:"mobile"},{title:"Online",value:"online"},{title:"Warehouse",value:"warehouse"},{title:"Office",value:"office"}],L=()=>{c.value=1,w.value=null,o.value={name:"",email:"",phone:"",nationality:"",state:"",city:"",address:"",postalCode:"",type:"store",sizeSqft:"",capacity:"",openingDate:"",monthlyRent:""}},j=A=>{m("update:isDialogVisible",A)},Y=()=>{c.value<2&&(c.value++,w.value=null)},K=()=>{c.value>1&&(c.value--,w.value=null)};me(()=>d.isDialogVisible,A=>{A&&L()});const J=async()=>{var i,T,v,l;const{valid:A}=await p.value.validate();if(!A){w.value="Please fill in all required fields";return}if(!o.value.name||!o.value.email||!o.value.phone){w.value="Please fill in all required fields";return}C.value=!0,w.value=null;try{const u=((T=(i=(await se.getFranchises()).data)==null?void 0:i[0])==null?void 0:T.id)||null,s={name:o.value.name,email:o.value.email,phone:o.value.phone,unit_name:o.value.name,franchise_id:u,unit_type:o.value.type||"store",address:o.value.address,city:o.value.city,state_province:o.value.state,postal_code:o.value.postalCode,nationality:o.value.nationality,size_sqft:o.value.sizeSqft,monthly_rent:o.value.monthlyRent,opening_date:o.value.openingDate,status:"planning"},h=await se.createFranchiseeWithUnit(s);if(h.success){const Ne={id:h.data.unit.id,name:h.data.unit.unit_name,email:h.data.franchisee.email,phone:h.data.franchisee.phone,type:h.data.unit.unit_type,sizeSqft:h.data.unit.size_sqft,capacity:null,openingDate:h.data.unit.opening_date,monthlyRent:h.data.unit.monthly_rent,managerId:h.data.unit.franchisee_id,managerName:h.data.franchisee.name,nationality:h.data.unit.nationality,state:h.data.unit.state_province,city:h.data.unit.city,address:h.data.unit.address,postalCode:h.data.unit.postal_code};m("franchiseeAdded",Ne),j(!1),L()}}catch(y){console.error("Error creating franchisee with unit:",y),w.value=((l=(v=y.response)==null?void 0:v.data)==null?void 0:l.message)||"Failed to create franchisee and unit. Please try again.",k(y)}finally{C.value=!1}},B=A=>{m("update:isDialogVisible",A),A||L()};return(A,i)=>{const T=dt,v=rt,l=ot,y=it;return V(),P($e,{"model-value":d.isDialogVisible,"max-width":"800","onUpdate:modelValue":B},{default:a(()=>[e(W,null,{default:a(()=>[e(pe,{class:"text-center"},{default:a(()=>i[22]||(i[22]=[r("span",{class:"text-h5"},"Add New Franchisee",-1)])),_:1,__:[22]}),e(E,null,{default:a(()=>[t(w)?(V(),P(ve,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":i[0]||(i[0]=u=>w.value=null)},{default:a(()=>[x(_(t(w)),1)]),_:1})):ce("",!0),e(It,{modelValue:t(c),"onUpdate:modelValue":i[20]||(i[20]=u=>H(c)?c.value=u:null),"alt-labels":""},{default:a(()=>[e(Te,null,{default:a(()=>[e(be,{complete:t(c)>1,value:1,title:"Basic Info"},null,8,["complete"]),e(re),e(be,{value:2,title:"Unit Details"})]),_:1}),e(Be,null,{default:a(()=>[e(ge,{value:1},{default:a(()=>[e(ye,{ref_key:"formRef",ref:p},{default:a(()=>[e(X,null,{default:a(()=>[e(U,{cols:"12"},{default:a(()=>[e(T,{modelValue:t(o).name,"onUpdate:modelValue":i[1]||(i[1]=u=>t(o).name=u),label:"Branch Name",placeholder:"Enter Branch name",rules:[t(b).required("Branch name is required"),...t(b).maxLength(255)],"error-messages":t(f).name,onInput:i[2]||(i[2]=u=>t(g)("name"))},null,8,["modelValue","rules","error-messages"])]),_:1}),e(U,{cols:"12",md:"6"},{default:a(()=>[e(T,{modelValue:t(o).email,"onUpdate:modelValue":i[3]||(i[3]=u=>t(o).email=u),label:"Email Address",placeholder:"Enter email address",rules:[t(b).required("Email is required"),t(b).email()],"error-messages":t(f).email,onInput:i[4]||(i[4]=u=>t(g)("email"))},null,8,["modelValue","rules","error-messages"])]),_:1}),e(U,{cols:"12",md:"6"},{default:a(()=>[e(T,{modelValue:t(o).phone,"onUpdate:modelValue":i[5]||(i[5]=u=>t(o).phone=u),label:"Contact Number",placeholder:"Enter contact number",rules:[t(b).required("Phone is required"),...t(b).maxLength(20)],"error-messages":t(f).phone,onInput:i[6]||(i[6]=u=>t(g)("phone"))},null,8,["modelValue","rules","error-messages"])]),_:1}),e(U,{cols:"12",md:"4"},{default:a(()=>[e(v,{modelValue:t(o).nationality,"onUpdate:modelValue":[i[7]||(i[7]=u=>t(o).nationality=u),i[8]||(i[8]=u=>t(g)("nationality"))],items:t(D),loading:t(S),label:"Nationality",placeholder:"Select Nationality",rules:[t(b).required("Nationality is required")],"error-messages":t(f).nationality,clearable:""},null,8,["modelValue","items","loading","rules","error-messages"])]),_:1}),e(U,{cols:"12",md:"4"},{default:a(()=>[e(v,{modelValue:t(o).state,"onUpdate:modelValue":[i[9]||(i[9]=u=>t(o).state=u),i[10]||(i[10]=u=>t(g)("state"))],label:"Province",placeholder:"Select Province",items:t(M),loading:t(O),rules:[t(b).required("Province is required")],"error-messages":t(f).state,clearable:""},null,8,["modelValue","items","loading","rules","error-messages"])]),_:1}),e(U,{cols:"12",md:"4"},{default:a(()=>[e(v,{modelValue:t(o).city,"onUpdate:modelValue":[i[11]||(i[11]=u=>t(o).city=u),i[12]||(i[12]=u=>t(g)("city"))],label:"City",placeholder:"Select City",items:t(G),disabled:!t(o).state,rules:[t(b).required("City is required")],"error-messages":t(f).city,clearable:""},null,8,["modelValue","items","disabled","rules","error-messages"])]),_:1}),e(U,{cols:"12"},{default:a(()=>[e(l,{modelValue:t(o).address,"onUpdate:modelValue":i[13]||(i[13]=u=>t(o).address=u),label:"Address",placeholder:"Enter full address",rules:[t(b).required("Address is required")],"error-messages":t(f).address,onInput:i[14]||(i[14]=u=>t(g)("address"))},null,8,["modelValue","rules","error-messages"])]),_:1}),e(U,{cols:"12"},{default:a(()=>[e(ve,{type:"info",variant:"tonal",class:"mb-0"},{default:a(()=>[r("strong",null,_(t(o).name||"New franchisee"),1),i[23]||(i[23]=x(" will be automatically assigned as the unit manager. "))]),_:1,__:[23]})]),_:1})]),_:1})]),_:1},512)]),_:1}),e(ge,{value:2},{default:a(()=>[e(ye,null,{default:a(()=>[e(X,null,{default:a(()=>[e(U,{cols:"12",md:"6"},{default:a(()=>[e(v,{modelValue:t(o).type,"onUpdate:modelValue":i[15]||(i[15]=u=>t(o).type=u),items:F,label:"Unit Type",placeholder:"Select unit type",rules:[t(ut)]},null,8,["modelValue","rules"])]),_:1}),e(U,{cols:"12",md:"6"},{default:a(()=>[e(y,{modelValue:t(o).openingDate,"onUpdate:modelValue":i[16]||(i[16]=u=>t(o).openingDate=u),label:"Opening Date",placeholder:"Select opening date"},null,8,["modelValue"])]),_:1}),e(U,{cols:"12",md:"4"},{default:a(()=>[e(T,{modelValue:t(o).sizeSqft,"onUpdate:modelValue":i[17]||(i[17]=u=>t(o).sizeSqft=u),label:"Size (sq ft)",placeholder:"Enter size in square feet",type:"number"},null,8,["modelValue"])]),_:1}),e(U,{cols:"12",md:"4"},{default:a(()=>[e(T,{modelValue:t(o).capacity,"onUpdate:modelValue":i[18]||(i[18]=u=>t(o).capacity=u),label:"Capacity",placeholder:"Enter capacity",type:"number"},null,8,["modelValue"])]),_:1}),e(U,{cols:"12",md:"4"},{default:a(()=>[e(T,{modelValue:t(o).monthlyRent,"onUpdate:modelValue":i[19]||(i[19]=u=>t(o).monthlyRent=u),label:"Monthly Rent",placeholder:"Enter monthly rent",type:"number",prefix:"SAR"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(xe,{class:"justify-space-between pa-6"},{default:a(()=>[t(c)>1?(V(),P(z,{key:0,variant:"outlined",disabled:t(C),onClick:K},{default:a(()=>i[24]||(i[24]=[x(" Previous ")])),_:1,__:[24]},8,["disabled"])):(V(),P(ze,{key:1})),r("div",Dt,[e(z,{variant:"outlined",disabled:t(C),onClick:i[21]||(i[21]=u=>j(!1))},{default:a(()=>i[25]||(i[25]=[x(" Cancel ")])),_:1,__:[25]},8,["disabled"]),t(c)<2?(V(),P(z,{key:0,color:"primary",disabled:t(C),onClick:Y},{default:a(()=>i[26]||(i[26]=[x(" Next ")])),_:1,__:[26]},8,["disabled"])):(V(),P(z,{key:1,color:"primary",loading:t(C),disabled:t(C),onClick:J},{default:a(()=>i[27]||(i[27]=[x(" Create Unit ")])),_:1,__:[27]},8,["loading","disabled"]))])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),At=_e({__name:"ChangeStatusDialog",props:{isDialogVisible:{type:Boolean},unitId:{},currentStatus:{},statusOptions:{}},emits:["update:isDialogVisible","status-updated"],setup(n,{emit:$}){const d=n,m=$,p=I(),{backendErrors:f,setBackendErrors:k,clearError:g}=Re(),b=Ae(),c=I(d.currentStatus),C=I(!1);me(()=>d.currentStatus,D=>{c.value=D},{immediate:!0});const w=async()=>{if(!d.unitId)return;const{valid:D}=await p.value.validate();if(D&&c.value!==d.currentStatus)try{C.value=!0,(await se.updateUnitStatus(d.unitId,c.value)).success&&(m("status-updated",{unitId:d.unitId,newStatus:c.value}),m("update:isDialogVisible",!1))}catch(S){console.error("Failed to change unit status:",S),k(S)}finally{C.value=!1}},o=()=>{c.value=d.currentStatus,m("update:isDialogVisible",!1)};return(D,S)=>{const M=bt;return V(),P($e,{"model-value":D.isDialogVisible,"max-width":"600","onUpdate:modelValue":S[2]||(S[2]=q=>m("update:isDialogVisible",q))},{default:a(()=>[e(M,{onClick:o}),e(W,{title:"Change Unit Status"},{default:a(()=>[e(E,null,{default:a(()=>[e(ye,{ref_key:"formRef",ref:p},{default:a(()=>[e(Fe,{modelValue:t(c),"onUpdate:modelValue":[S[0]||(S[0]=q=>H(c)?c.value=q:null),S[1]||(S[1]=q=>t(g)("status"))],label:"Status",items:D.statusOptions,placeholder:"Select Status",rules:[t(b).required("Status is required")],"error-messages":t(f).status},null,8,["modelValue","items","rules","error-messages"])]),_:1},512)]),_:1}),e(xe,null,{default:a(()=>[e(ze),e(z,{color:"secondary",variant:"tonal",onClick:o},{default:a(()=>S[3]||(S[3]=[x(" Cancel ")])),_:1,__:[3]}),e(z,{color:"primary",disabled:!t(c)||t(c)===D.currentStatus,loading:t(C),onClick:w},{default:a(()=>S[4]||(S[4]=[x(" Update Status ")])),_:1,__:[4]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),zt={class:"d-flex align-center justify-space-between"},$t={class:"ms-4"},Ft={class:"text-h4"},qt={key:1},Tt={class:"ms-4"},Bt={class:"text-h4"},Nt={key:1},Et={class:"ms-4"},Mt={class:"text-h4"},Lt={key:1},Wt={class:"ms-4"},Ot={class:"text-h4"},jt={key:1},Gt={class:"text-center py-8"},Yt={class:"d-flex align-center justify-space-between mb-3"},Ht={class:"text-h6"},Kt={class:"mb-2"},Jt={class:"text-body-1"},Qt={class:"mb-2"},Xt={class:"text-body-2"},Zt={class:"mb-3"},ea={class:"text-body-1 font-weight-medium"},ta={class:"text-center"},aa={class:"text-center"},la={class:"d-flex align-center gap-x-3"},sa={class:"text-base font-weight-medium"},na={class:"text-body-2 text-disabled"},ia={class:"text-body-1 font-weight-medium"},oa={class:"text-body-2 text-disabled"},ra={class:"text-body-1"},da={class:"text-body-2 text-disabled"},ua={class:"text-body-2 text-disabled"},ma={class:"text-body-2 text-disabled"},ca={class:"d-flex align-center justify-space-between flex-wrap gap-3 pa-5 pt-3"},pa={class:"text-sm text-disabled mb-0"},va={class:"d-flex align-center",style:{"inline-size":"8rem"}},el=_e({__name:"my-units",setup(n){const $=(v,l,y)=>{const u=(v-1)*l+1,s=Math.min(v*l,y);return`Showing ${u} to ${s} of ${y} entries`},d=lt(),m=I("overview"),p=I([]),f=I(!1),k=I(null),g=I(1),b=I(10);I(0);const c=I(!1),C=I(null),w=I(""),o=I({totalUnits:0,activeUnits:0,pendingUnits:0,inactiveUnits:0,totalRevenue:0,monthlyRoyalty:0,avgRevenuePerUnit:0,revenueChange:0,royaltyRate:8.5,taskStats:{total:0,completed:0,pending:0,completionRate:0}}),D=I(!1),S=R(()=>o.value.totalUnits||p.value.length),M=R(()=>o.value.activeUnits||p.value.filter(v=>v.status==="active").length),q=R(()=>o.value.pendingUnits||p.value.filter(v=>v.status==="pending").length),O=R(()=>o.value.monthlyRoyalty),G=[{title:"Branch Info",key:"branchInfo"},{title:"Unit Manager (Franchisee)",key:"franchisee"},{title:"Location",key:"location"},{title:"Royalty %",key:"royaltyPercentage"},{title:"Contract Period",key:"contractPeriod"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],F=[{title:"Planning",value:"planning"},{title:"Construction",value:"construction"},{title:"Training",value:"training"},{title:"Active",value:"active"},{title:"Pending",value:"pending"},{title:"Temporarily Closed",value:"temporarily_closed"},{title:"Permanently Closed",value:"permanently_closed"}],L=v=>v==="active"?"success":v==="pending"?"warning":v==="inactive"?"error":"secondary",j=async()=>{var v;f.value=!0,k.value=null;try{const l=await se.getUnits();l.success&&l.data.data?p.value=l.data.data.map(y=>{var u,s,h;return{id:y.id,branchName:y.unit_name||"Unnamed Unit",franchiseeName:((u=y.franchisee)==null?void 0:u.name)||"Unassigned",email:((s=y.franchisee)==null?void 0:s.email)||y.email||"unassigned@example.com",contactNumber:((h=y.franchisee)==null?void 0:h.phone)||y.phone||"Not available",address:y.address||"Address not available",city:y.city||"Unknown",state:y.state_province||"Unknown",country:y.country||"Unknown",royaltyPercentage:8.5,contractStartDate:y.lease_start_date||"2024-01-01",renewalDate:y.lease_end_date||"2027-01-01",status:y.status||"inactive",totalTasks:0,completedTasks:0,totalStaff:y.employee_count||0,totalProducts:0,avgRating:0}}):p.value=[]}catch(l){console.error("Failed to load units data:",l),k.value=((v=l==null?void 0:l.data)==null?void 0:v.message)||"Failed to load units data",p.value=[]}finally{f.value=!1}},Y=async()=>{var v,l,y,u;try{const s=await se.getUnitsStatistics();s.success&&s.data&&(o.value={totalUnits:s.data.totalUnits||0,activeUnits:s.data.activeUnits||0,pendingUnits:s.data.pendingUnits||0,inactiveUnits:s.data.inactiveUnits||0,totalRevenue:s.data.totalRevenue||0,monthlyRoyalty:s.data.monthlyRoyalty||0,avgRevenuePerUnit:s.data.avgRevenuePerUnit||0,revenueChange:s.data.revenueChange||0,royaltyRate:s.data.royaltyRate||8.5,taskStats:{total:((v=s.data.taskStats)==null?void 0:v.total)||0,completed:((l=s.data.taskStats)==null?void 0:l.completed)||0,pending:((y=s.data.taskStats)==null?void 0:y.pending)||0,completionRate:((u=s.data.taskStats)==null?void 0:u.completionRate)||0}})}catch(s){console.error("Failed to load statistics data:",s)}},K=async()=>{await Promise.all([j(),Y()])},J=v=>{d.push(`/franchisor/units/${v}`)},B=()=>{D.value=!0},A=v=>{K()};st(()=>{K()});const i=v=>{C.value=v,w.value=v.status,c.value=!0},T=v=>{const l=p.value.findIndex(y=>y.id===v.unitId);l!==-1&&(p.value[l].status=v.newStatus),Y()};return(v,l)=>{var y,u;return V(),Q("section",null,[e(X,{class:"mb-6"},{default:a(()=>[e(U,{cols:"12"},{default:a(()=>[r("div",zt,[l[11]||(l[11]=r("div",null,[r("h2",{class:"text-h2 mb-1"}," My Units "),r("p",{class:"text-body-1 text-medium-emphasis"}," Manage your franchise units and their franchisee managers ")],-1)),e(z,{color:"primary","prepend-icon":"tabler-plus",loading:t(f),onClick:B},{default:a(()=>l[10]||(l[10]=[x(" Add Franchisee ")])),_:1,__:[10]},8,["loading"])])]),_:1})]),_:1}),t(k)?(V(),P(ve,{key:0,type:"error",variant:"tonal",class:"mb-6",closable:"","onClick:close":l[0]||(l[0]=s=>k.value=null)},{default:a(()=>[x(_(t(k)),1)]),_:1})):ce("",!0),e(gt,{modelValue:t(m),"onUpdate:modelValue":l[1]||(l[1]=s=>H(m)?m.value=s:null),class:"mb-6"},{default:a(()=>[e(Ie,{value:"overview"},{default:a(()=>[e(N,{icon:"tabler-dashboard",start:""}),l[12]||(l[12]=x(" Overview "))]),_:1,__:[12]}),e(Ie,{value:"units"},{default:a(()=>[e(N,{icon:"tabler-building-store",start:""}),l[13]||(l[13]=x(" All Units "))]),_:1,__:[13]})]),_:1},8,["modelValue"]),e(fe,{modelValue:t(m),"onUpdate:modelValue":l[7]||(l[7]=s=>H(m)?m.value=s:null),class:"disable-tab-transition"},{default:a(()=>[e(oe,{value:"overview"},{default:a(()=>[e(X,{class:"mb-6"},{default:a(()=>[e(U,{cols:"12",md:"3"},{default:a(()=>[e(W,null,{default:a(()=>[e(E,{class:"d-flex align-center"},{default:a(()=>[e(te,{size:"44",rounded:"",color:"primary",variant:"tonal"},{default:a(()=>[e(N,{icon:"tabler-building-store",size:"26"})]),_:1}),r("div",$t,[l[14]||(l[14]=r("div",{class:"text-body-2 text-disabled"}," Total Units ",-1)),r("h4",Ft,[t(f)?(V(),P(ae,{key:0,indeterminate:"",size:"20"})):(V(),Q("span",qt,_(t(S)),1))])])]),_:1})]),_:1})]),_:1}),e(U,{cols:"12",md:"3"},{default:a(()=>[e(W,null,{default:a(()=>[e(E,{class:"d-flex align-center"},{default:a(()=>[e(te,{size:"44",rounded:"",color:"success",variant:"tonal"},{default:a(()=>[e(N,{icon:"tabler-check",size:"26"})]),_:1}),r("div",Tt,[l[15]||(l[15]=r("div",{class:"text-body-2 text-disabled"}," Active Units ",-1)),r("h4",Bt,[t(f)?(V(),P(ae,{key:0,indeterminate:"",size:"20"})):(V(),Q("span",Nt,_(t(M)),1))])])]),_:1})]),_:1})]),_:1}),e(U,{cols:"12",md:"3"},{default:a(()=>[e(W,null,{default:a(()=>[e(E,{class:"d-flex align-center"},{default:a(()=>[e(te,{size:"44",rounded:"",color:"warning",variant:"tonal"},{default:a(()=>[e(N,{icon:"tabler-clock",size:"26"})]),_:1}),r("div",Et,[l[16]||(l[16]=r("div",{class:"text-body-2 text-disabled"}," Pending Units ",-1)),r("h4",Mt,[t(f)?(V(),P(ae,{key:0,indeterminate:"",size:"20"})):(V(),Q("span",Lt,_(t(q)),1))])])]),_:1})]),_:1})]),_:1}),e(U,{cols:"12",md:"3"},{default:a(()=>[e(W,null,{default:a(()=>[e(E,{class:"d-flex align-center"},{default:a(()=>[e(te,{size:"44",rounded:"",color:"info",variant:"tonal"},{default:a(()=>[e(t(Vt),{size:"26"})]),_:1}),r("div",Wt,[l[17]||(l[17]=r("div",{class:"text-body-2 text-disabled"}," Monthly Royalty ",-1)),r("h4",Ot,[t(f)?(V(),P(ae,{key:0,indeterminate:"",size:"20"})):(V(),Q("span",jt,_(t(nt)(t(O))),1))])])]),_:1})]),_:1})]),_:1})]),_:1}),e(W,null,{default:a(()=>[e(Ce,{class:"pb-4"},{append:a(()=>[e(z,{variant:"text",color:"primary",onClick:l[2]||(l[2]=s=>m.value="units")},{default:a(()=>l[19]||(l[19]=[x(" View All ")])),_:1,__:[19]})]),default:a(()=>[e(pe,null,{default:a(()=>l[18]||(l[18]=[x("Recent Units")])),_:1,__:[18]})]),_:1}),e(E,null,{default:a(()=>[t(f)?(V(),P(X,{key:0},{default:a(()=>[(V(),Q(ue,null,we(3,s=>e(U,{key:s,cols:"12",md:"4"},{default:a(()=>[e(W,{variant:"outlined"},{default:a(()=>[e(E,null,{default:a(()=>[e(le,{type:"text",class:"mb-3"}),e(le,{type:"text",class:"mb-2"}),e(le,{type:"text",class:"mb-2"}),e(le,{type:"text",class:"mb-3"}),e(le,{type:"button"})]),_:1})]),_:1})]),_:2},1024)),64))]),_:1})):t(p).length===0?(V(),P(X,{key:1},{default:a(()=>[e(U,{cols:"12"},{default:a(()=>[r("div",Gt,[e(N,{icon:"tabler-building-store",size:"48",class:"text-disabled mb-4"}),l[21]||(l[21]=r("h4",{class:"text-h4 mb-2"}," No Units Found ",-1)),l[22]||(l[22]=r("p",{class:"text-body-1 text-medium-emphasis mb-4"},` You haven't added any franchise units yet. Click "Add Franchisee" to get started. `,-1)),e(z,{color:"primary","prepend-icon":"tabler-plus",onClick:B},{default:a(()=>l[20]||(l[20]=[x(" Add Your First Unit ")])),_:1,__:[20]})])]),_:1})]),_:1})):(V(),P(X,{key:2},{default:a(()=>[(V(!0),Q(ue,null,we(t(p).slice(0,3),s=>(V(),P(U,{key:s.id,cols:"12",md:"4"},{default:a(()=>[e(W,{variant:"outlined"},{default:a(()=>[e(E,null,{default:a(()=>[r("div",Yt,[r("h6",Ht,_(s.branchName),1),e(de,{color:L(s.status),size:"small",label:"",class:"text-capitalize"},{default:a(()=>[x(_(s.status),1)]),_:2},1032,["color"])]),r("div",Kt,[l[23]||(l[23]=r("div",{class:"text-body-2 text-disabled"}," Franchisee ",-1)),r("div",Jt,_(s.franchiseeName),1)]),r("div",Qt,[l[24]||(l[24]=r("div",{class:"text-body-2 text-disabled"}," Location ",-1)),r("div",Xt,_(s.city)+", "+_(s.state),1)]),r("div",Zt,[l[25]||(l[25]=r("div",{class:"text-body-2 text-disabled"}," Royalty ",-1)),r("div",ea,_(s.royaltyPercentage)+"% ",1)])]),_:2},1024),e(xe,null,{default:a(()=>[e(z,{variant:"text",color:"primary",onClick:h=>J(s.id)},{default:a(()=>l[26]||(l[26]=[x(" View Details ")])),_:2,__:[26]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(oe,{value:"units"},{default:a(()=>[e(W,null,{default:a(()=>[e(Ce,{class:"pb-4"},{append:a(()=>[e(z,{color:"primary","prepend-icon":"tabler-plus",loading:t(f),onClick:B},{default:a(()=>l[28]||(l[28]=[x(" Add Franchisee ")])),_:1,__:[28]},8,["loading"])]),default:a(()=>[e(pe,null,{default:a(()=>l[27]||(l[27]=[x("All Franchise Units")])),_:1,__:[27]})]),_:1}),e(re),t(f)?(V(),P(E,{key:0,class:"py-8"},{default:a(()=>[r("div",ta,[e(ae,{indeterminate:"",size:"48",class:"mb-4"}),l[29]||(l[29]=r("h4",{class:"text-h4 mb-2"}," Loading Units... ",-1)),l[30]||(l[30]=r("p",{class:"text-body-1 text-medium-emphasis"}," Please wait while we fetch your franchise units. ",-1))])]),_:1})):t(p).length===0?(V(),P(E,{key:1,class:"py-8"},{default:a(()=>[r("div",aa,[e(N,{icon:"tabler-building-store",size:"64",class:"text-disabled mb-4"}),l[32]||(l[32]=r("h4",{class:"text-h4 mb-2"}," No Units Found ",-1)),l[33]||(l[33]=r("p",{class:"text-body-1 text-medium-emphasis mb-6"}," You haven't added any franchise units yet. Start by adding your first franchisee and their unit. ",-1)),e(z,{color:"primary","prepend-icon":"tabler-plus",size:"large",onClick:B},{default:a(()=>l[31]||(l[31]=[x(" Add Your First Franchisee & Unit ")])),_:1,__:[31]})])]),_:1})):(V(),P(_t,{key:2,items:t(p),headers:G,class:"text-no-wrap","item-value":"id","items-per-page":t(b),page:t(g),"onUpdate:itemsPerPage":l[5]||(l[5]=s=>b.value=s),"onUpdate:page":l[6]||(l[6]=s=>g.value=s)},{"item.branchInfo":a(({item:s})=>[r("div",la,[e(te,{size:"34",color:"primary",variant:"tonal"},{default:a(()=>[e(N,{icon:"tabler-building-store",size:"20"})]),_:1}),r("div",null,[r("h6",sa,_(s.branchName),1),r("div",na,_(s.email),1)])])]),"item.franchisee":a(({item:s})=>[r("div",null,[r("div",ia,_(s.franchiseeName),1),r("div",oa,[e(N,{icon:"tabler-user-check",size:"14",class:"me-1"}),x(" Unit Manager â€¢ "+_(s.contactNumber),1)])])]),"item.location":a(({item:s})=>[r("div",null,[r("div",ra,_(s.city)+", "+_(s.state),1),r("div",da,_(s.country),1)])]),"item.royaltyPercentage":a(({item:s})=>[s.royaltyPercentage>0?(V(),P(de,{key:0,color:"primary",size:"small",class:"mt-1"},{default:a(()=>[x(_(s.royaltyPercentage)+"% Royalty ",1)]),_:2},1024)):ce("",!0)]),"item.contractPeriod":a(({item:s})=>[r("div",null,[r("div",ua," Start: "+_(s.contractStartDate),1),r("div",ma," Renewal: "+_(s.renewalDate),1)])]),"item.status":a(({item:s})=>[e(de,{color:L(s.status),size:"small",label:"",class:"text-capitalize"},{default:a(()=>[x(_(s.status),1)]),_:2},1032,["color"])]),"item.actions":a(({item:s})=>[e(z,{icon:"",variant:"text",color:"medium-emphasis",size:"small",onClick:Ue(h=>J(s.id),["stop"])},{default:a(()=>[e(N,{icon:"tabler-eye"}),e(De,{activator:"parent"},{default:a(()=>l[34]||(l[34]=[x(" View Unit Details ")])),_:1,__:[34]})]),_:2},1032,["onClick"]),e(z,{icon:"",variant:"text",color:"medium-emphasis",size:"small",onClick:Ue(h=>i(s),["stop"])},{default:a(()=>[e(N,{icon:"tabler-edit"}),e(De,{activator:"parent"},{default:a(()=>l[35]||(l[35]=[x(" Change Status ")])),_:1,__:[35]})]),_:2},1032,["onClick"])]),bottom:a(()=>[e(re),r("div",ca,[r("p",pa,_($(t(g),t(b),t(p).length)),1),e(xt,{modelValue:t(g),"onUpdate:modelValue":l[3]||(l[3]=s=>H(g)?g.value=s:null),length:Math.ceil(t(p).length/t(b)),"total-visible":v.$vuetify.display.xs?1:Math.min(Math.ceil(t(p).length/t(b)),5)},null,8,["modelValue","length","total-visible"]),r("div",va,[l[36]||(l[36]=r("span",{class:"text-no-wrap me-3"},"Rows per page:",-1)),e(Fe,{modelValue:t(b),"onUpdate:modelValue":l[4]||(l[4]=s=>H(b)?b.value=s:null),density:"compact",variant:"outlined",items:[5,10,25,50,100]},null,8,["modelValue"])])])]),_:1},8,["items","items-per-page","page"]))]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Rt,{"is-dialog-visible":t(D),"onUpdate:isDialogVisible":l[8]||(l[8]=s=>H(D)?D.value=s:null),onFranchiseeAdded:A},null,8,["is-dialog-visible"]),e(At,{"is-dialog-visible":t(c),"onUpdate:isDialogVisible":l[9]||(l[9]=s=>H(c)?c.value=s:null),"unit-id":((y=t(C))==null?void 0:y.id)||null,"current-status":((u=t(C))==null?void 0:u.status)||"","status-options":F,onStatusUpdated:T},null,8,["is-dialog-visible","unit-id","current-status"])])}}});export{el as default};
