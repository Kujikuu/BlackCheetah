import{_ as B,V as N}from"./VDialog-DKkWp4GN.js";import{d as A,g as y,O as p,w as M,a as f,o as c,k as n,y as l,h as x,c as q,a7 as _,q as h,t as P}from"./main-BPhS35rw.js";import{f as S}from"./franchise-BPXueY0Z.js";import{f as U}from"./franchisee-dashboard-spBS2_GQ.js";import{V as E,f as O,h as X}from"./VCard-BzA-_fsU.js";import{V as G}from"./VForm-DfkEz1YK.js";import{V as z,a as v}from"./VRow-BBpj0UHg.js";import{V as b}from"./VTextField-DVYvDh-5.js";import{V as L}from"./VTextarea-BMZlRSe-.js";import{V as $}from"./VSelect-CMXFgzzc.js";import{V as j}from"./VFileInput-C4-YBSvt.js";import{V as J}from"./VSpacer-BZoddywn.js";const R={key:0,class:"text-caption text-disabled mt-2"},ne=A({__name:"AddDocumentDialog",props:{isDialogVisible:{type:Boolean},franchiseId:{},unitId:{},documentData:{},mode:{}},emits:["update:isDialogVisible","documentSaved","documentAdded"],setup(C,{emit:F}){const o=C,V=F,D=y(!1),e=y({id:null,name:"",title:"",description:"",file:null,type:"other",status:"active",is_confidential:!1,expiry_date:null}),m=p({get:()=>o.isDialogVisible,set:d=>V("update:isDialogVisible",d)}),T=["FDD","Franchise Agreement","Operations Manual","Brand Guidelines","Legal Documents","Sales Report","Financial Statement","Marketing Materials","Training Materials","Quality Standards","Other"];M(()=>[o.isDialogVisible,o.documentData],()=>{o.isDialogVisible&&(o.documentData?e.value={...o.documentData}:e.value={id:null,name:"",title:"",description:"",file:null,type:o.mode==="unit"?"":"other",status:"active",is_confidential:!1,expiry_date:null})},{immediate:!0});const u=p(()=>o.mode==="unit");p(()=>u.value?e.value.title:e.value.name);const k=async()=>{var a,r,t;if(u.value&&!o.unitId){console.error("No unit ID available");return}if(!u.value&&!o.franchiseId){console.error("No franchise ID available");return}if(!(u.value?e.value.title:e.value.name)||!e.value.file){console.error("Document name/title and file are required");return}D.value=!0;try{if(u.value){const i=new FormData;i.append("title",e.value.title||""),i.append("description",e.value.description||""),i.append("type",e.value.type),i.append("status",e.value.status||"pending"),i.append("comment",""),e.value.file&&i.append("file",e.value.file);const s=await U.createDocument(o.unitId,i);s.success?(V("documentAdded",{...s.data,id:((a=s.data)==null?void 0:a.id)||Date.now(),title:e.value.title,description:e.value.description,type:e.value.type,fileName:(r=e.value.file)==null?void 0:r.name,fileSize:w(((t=e.value.file)==null?void 0:t.size)||0),uploadDate:new Date().toISOString().split("T")[0],status:e.value.status||"pending",comment:"",file:e.value.file}),m.value=!1):console.error("Failed to save document:",s.message)}else{if(!o.franchiseId){console.error("No franchise ID provided");return}const i={name:e.value.name||"",description:e.value.description||"",type:e.value.type,status:e.value.status,is_confidential:e.value.is_confidential,expiry_date:e.value.expiry_date,file:e.value.file};let s;e.value.id!==null?s=await S.updateDocument(o.franchiseId,e.value.id,i):s=await S.createDocument(o.franchiseId,i),s.success?(V("documentSaved"),m.value=!1):console.error("Failed to save document:",s.message)}}catch(i){console.error("Error saving document:",i)}finally{D.value=!1}},w=d=>{if(d===0)return"0 Bytes";const a=1024,r=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(d)/Math.log(a));return`${Number.parseFloat((d/a**t).toFixed(2))} ${r[t]}`},g=()=>{m.value=!1},I=p(()=>e.value.id!==null?"Edit Document":"Add New Document");return(d,a)=>{const r=B;return c(),f(N,{modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=t=>m.value=t),"max-width":"600"},{default:n(()=>[l(r,{onClick:g}),l(E,{title:I.value},{default:n(()=>[l(O,null,{default:n(()=>[l(G,null,{default:n(()=>[l(z,null,{default:n(()=>[l(v,{cols:"12"},{default:n(()=>[u.value?(c(),f(b,{key:0,modelValue:e.value.title,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.title=t),label:"Document Title",placeholder:"Enter document title",variant:"outlined",required:""},null,8,["modelValue"])):(c(),f(b,{key:1,modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.name=t),label:"Document Name",placeholder:"Enter document name",variant:"outlined",required:""},null,8,["modelValue"]))]),_:1}),l(v,{cols:"12"},{default:n(()=>[l(L,{modelValue:e.value.description,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.description=t),label:"Description",placeholder:"Enter document description",rows:"3",variant:"outlined",required:u.value},null,8,["modelValue","required"])]),_:1}),u.value?(c(),f(v,{key:0,cols:"12"},{default:n(()=>[l($,{modelValue:e.value.type,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.type=t),label:"Document Type",placeholder:"Select document type",items:T,variant:"outlined",required:""},null,8,["modelValue"])]),_:1})):x("",!0),l(v,{cols:"12"},{default:n(()=>[l(j,{modelValue:e.value.file,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.file=t),label:"Attach File",accept:u.value?".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.jpg,.jpeg,.png":".pdf,.doc,.docx","prepend-icon":"tabler-paperclip",variant:"outlined",required:""},null,8,["modelValue","accept"]),u.value?(c(),q("div",R," Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, JPG, JPEG, PNG ")):x("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(X,null,{default:n(()=>[l(J),l(_,{color:"secondary",variant:"outlined",onClick:g},{default:n(()=>a[6]||(a[6]=[h(" Cancel ")])),_:1,__:[6]}),l(_,{color:"primary",loading:D.value,onClick:k},{default:n(()=>[h(P(e.value.id!==null?"Update Document":"Add Document"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});export{ne as _};
