import{_ as L}from"./AppTextarea.vue_vue_type_script_setup_true_lang-ozlWohdM.js";import{_ as M}from"./AppSelect.vue_vue_type_script_setup_true_lang-D7xQ4Hmd.js";import{_ as O}from"./AppTextField.vue_vue_type_script_setup_true_lang-DaZorL-F.js";import{d as $,g,e as j,bf as z,b1 as y,bg as E,O as v,w as H,E as G,bl as V,c as I,o as _,l as c,y as o,aV as C,i as e,k as r,G as k,t as w,bb as Y,a as J,h as K,q as x,a7 as Q,s as W}from"./main-CEM1QI86.js";import{a as X,b as Z}from"./auth-v1-top-shape-Be0n9vOV.js";import{V as b}from"./VNodeRenderer-BP_43906.js";import{u as ee,a as ae}from"./useSaudiProvinces-RrPRYxvk.js";import{a as se,d as oe,f as P,V as te}from"./VCard-BQn_ZwHQ.js";import{V as le}from"./VForm-B8cle4sK.js";import{V as re,a as m}from"./VRow-DQylzCgd.js";import{V as ne}from"./VAlert-D7jBKg4h.js";import"./form-ChweRA-D.js";import"./VTextarea-l7amS_Zr.js";import"./VTextField-C2dTSwqb.js";import"./VField-sdCO7WAE.js";import"./forwardRefs-B931MWyl.js";import"./VInput-BhhwivIT.js";import"./VSelect-DAbGf17D.js";import"./VList-DLC3F4tN.js";import"./VDivider-MM1jTXpn.js";import"./VMenu-Dj8Drxav.js";import"./VOverlay-DGzNmcTF.js";import"./scopeId-DY8qXCsp.js";import"./VCheckboxBtn-BXdbbINE.js";import"./VSelectionControl-DcY1Vt5D.js";import"./VChip-BShyV8jA.js";import"./VSlideGroup-Cc3zlOOJ.js";/* empty css              */const ie={class:"auth-wrapper d-flex align-center justify-center pa-4"},de={class:"position-relative my-sm-16"},ue={class:"app-logo"},me={class:"app-logo-title"},ze=$({__name:"onboarding",setup(pe){const s=g({name:"",phone:"",nationality:"",state:"",city:"",address:""}),f=g(!1),i=g(null),u=j(),{smAndUp:S}=z(),A=y("userData"),{updateAbility:ce}=E(),{countries:N,isLoading:F}=ee(),{provinces:R,getCitiesForProvince:T,isLoading:q}=ae(),B=v(()=>T(s.value.state||""));H(()=>s.value.state,()=>{s.value.city=""}),G(async()=>{var p;try{const a=await V.getStatus();if(a.success&&a.data&&(a.data.user&&(s.value={name:a.data.user.name||"",phone:a.data.user.phone||"",nationality:a.data.user.nationality||"",state:a.data.user.state||"",city:a.data.user.city||"",address:a.data.user.address||""}),a.data.profile_completed))switch((p=A.value)==null?void 0:p.role){case"admin":u.push("/admin/dashboard");break;case"franchisor":u.push("/franchisor");break;case"franchisee":u.push("/franchisee/dashboard/sales");break;case"sales":u.push("/sales/lead-management");break;default:u.push("/")}}catch(a){console.error("Failed to check onboarding status:",a)}});const U=async()=>{var p,a;f.value=!0,i.value=null;try{console.log("Submitting onboarding form:",s.value);const l=await V.complete(s.value);if(console.log("Onboarding response:",l),l.success&&l.data){console.log("Onboarding successful, updating user data...");const n=y("userData");switch(n.value&&(n.value={...n.value,profile_completed:!0,...l.data.user}),console.log("Redirecting to dashboard..."),(p=n.value)==null?void 0:p.role){case"admin":u.push("/admin/dashboard");break;case"franchisor":u.push("/franchisor");break;case"franchisee":u.push("/franchisee/dashboard/sales");break;case"sales":u.push("/sales/lead-management");break;default:u.push("/")}}else console.error("Onboarding failed:",l),i.value={general:[l.message||"Failed to complete profile. Please try again."]}}catch(l){console.error("Onboarding error:",l);const n=(l==null?void 0:l.data)||((a=l==null?void 0:l.response)==null?void 0:a._data)||null;n!=null&&n.errors?i.value=n.errors:i.value={general:[(n==null?void 0:n.message)||"Failed to complete profile. Please try again."]}}finally{f.value=!1}},D=v(()=>s.value.name&&s.value.phone&&s.value.nationality&&s.value.state&&s.value.city&&s.value.address);return(p,a)=>{const l=O,n=M,h=L;return _(),I("div",ie,[c("div",de,[o(e(b),{nodes:C("div",{innerHTML:e(X)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),o(e(b),{nodes:C("div",{innerHTML:e(Z)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),o(te,{class:W(["auth-card",e(S)?"pa-6":"pa-0"]),"max-width":"600"},{default:r(()=>[o(se,{class:"justify-center"},{default:r(()=>[o(oe,null,{default:r(()=>[c("div",ue,[o(e(b),{nodes:e(k).app.logo},null,8,["nodes"]),c("h1",me,w(e(k).app.title),1)])]),_:1})]),_:1}),o(P,null,{default:r(()=>a[6]||(a[6]=[c("h4",{class:"text-h4 mb-1"}," Complete Your Profile ",-1),c("p",{class:"mb-0"}," Please provide your personal information to complete your account setup ",-1)])),_:1,__:[6]}),o(P,null,{default:r(()=>[o(le,{onSubmit:Y(U,["prevent"])},{default:r(()=>[o(re,null,{default:r(()=>[o(m,{cols:"12"},{default:r(()=>{var t;return[(t=e(i))!=null&&t.general?(_(),J(ne,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:r(()=>[x(w(e(i).general[0]),1)]),_:1})):K("",!0)]}),_:1}),o(m,{cols:"12"},{default:r(()=>{var t;return[o(l,{modelValue:e(s).name,"onUpdate:modelValue":a[0]||(a[0]=d=>e(s).name=d),autofocus:"",label:"Full Name",placeholder:"Name","error-messages":(t=e(i))==null?void 0:t.name,required:""},null,8,["modelValue","error-messages"])]}),_:1}),o(m,{cols:"12"},{default:r(()=>{var t;return[o(l,{modelValue:e(s).phone,"onUpdate:modelValue":a[1]||(a[1]=d=>e(s).phone=d),label:"Phone Number",placeholder:"+966 50 123 4567","error-messages":(t=e(i))==null?void 0:t.phone,required:""},null,8,["modelValue","error-messages"])]}),_:1}),o(m,{cols:"12",md:"6"},{default:r(()=>{var t;return[o(n,{modelValue:e(s).nationality,"onUpdate:modelValue":a[2]||(a[2]=d=>e(s).nationality=d),label:"Nationality",placeholder:"Select Nationality",items:e(N),loading:e(F),"error-messages":(t=e(i))==null?void 0:t.nationality,clearable:"",required:""},null,8,["modelValue","items","loading","error-messages"])]}),_:1}),o(m,{cols:"12",md:"6"},{default:r(()=>{var t;return[o(n,{modelValue:e(s).state,"onUpdate:modelValue":a[3]||(a[3]=d=>e(s).state=d),label:"Province",placeholder:"Select Province",items:e(R),loading:e(q),"error-messages":(t=e(i))==null?void 0:t.state,clearable:"",required:""},null,8,["modelValue","items","loading","error-messages"])]}),_:1}),o(m,{cols:"12"},{default:r(()=>{var t;return[o(n,{modelValue:e(s).city,"onUpdate:modelValue":a[4]||(a[4]=d=>e(s).city=d),label:"City",placeholder:"Select City",items:e(B),disabled:!e(s).state,"error-messages":(t=e(i))==null?void 0:t.city,clearable:"",required:""},null,8,["modelValue","items","disabled","error-messages"])]}),_:1}),o(m,{cols:"12"},{default:r(()=>{var t;return[o(h,{modelValue:e(s).address,"onUpdate:modelValue":a[5]||(a[5]=d=>e(s).address=d),label:"Address",placeholder:"123 Main Street, Apt 4B","error-messages":(t=e(i))==null?void 0:t.address,rows:"3",required:""},null,8,["modelValue","error-messages"])]}),_:1}),o(m,{cols:"12"},{default:r(()=>[o(Q,{block:"",type:"submit",loading:e(f),disabled:e(f)||!e(D),color:"primary",size:"large"},{default:r(()=>a[7]||(a[7]=[x(" Complete Profile ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])}}});export{ze as default};
