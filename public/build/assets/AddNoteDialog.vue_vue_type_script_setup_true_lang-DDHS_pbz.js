import{_ as y}from"./AppTextarea.vue_vue_type_script_setup_true_lang-DGRpzuUr.js";import{_ as q}from"./AppTextField.vue_vue_type_script_setup_true_lang-CbF3QHBY.js";import{_ as I,V as R}from"./VDialog-DAZY-FZS.js";import{a_ as i,d as S,g,O as L,a as O,o as P,k as n,y as o,b7 as z,i as s,aI as h,a7 as A,q as B}from"./main-DjrYRpVy.js";import{a as G,u as M}from"./useValidationRules-DPwbBx8Y.js";import{V as W,f as j,g as H}from"./VCard-C2C7Fyqz.js";import{V as J}from"./VForm-Ciudj4Q_.js";import{V as K,a as _}from"./VRow-wdXljQGK.js";import{V as Q}from"./VFileInput-Fh91WoVW.js";import{V as X}from"./VSpacer-DuE_SDAT.js";class Y{getBaseUrl(){return"/v1/notes"}async getNotes(e){return await i(this.getBaseUrl(),{method:"GET",query:e})}async getNote(e){return await i(`${this.getBaseUrl()}/${e}`)}async createNote(e){const a=new FormData;return a.append("title",e.title),a.append("description",e.description),e.lead_id&&a.append("lead_id",e.lead_id.toString()),e.attachments&&e.attachments.length>0&&e.attachments.forEach((l,d)=>{a.append(`attachments[${d}]`,l)}),await i(this.getBaseUrl(),{method:"POST",body:a})}async updateNote(e){const a=new FormData;return e.title&&a.append("title",e.title),e.description&&a.append("description",e.description),e.attachments&&e.attachments.length>0&&e.attachments.forEach((l,d)=>{a.append(`attachments[${d}]`,l)}),await i(`${this.getBaseUrl()}/${e.id}`,{method:"PUT",body:a})}async deleteNote(e){return await i(`${this.getBaseUrl()}/${e}`,{method:"DELETE"})}async deleteNoteAttachment(e,a){return await i(`${this.getBaseUrl()}/${e}/attachments/${a}`,{method:"DELETE"})}async updateNoteWithFormData(e,a){return await i(`${this.getBaseUrl()}/${e}`,{method:"POST",body:a})}}const Z=new Y,c=G();function U(){return{note:[c.required("Note content is required"),c.string(),c.minLength(1)],content:[c.required("Note content is required"),c.string(),c.minLength(1)]}}function ue(){return U()}const ce=S({__name:"AddNoteDialog",props:{isDialogVisible:{type:Boolean},leadId:{}},emits:["update:isDialogVisible","noteAdded"],setup(v,{emit:e}){const a=v,l=e,d=g(),{backendErrors:N,setBackendErrors:C,clearError:$}=M(),w=U(),m=g(""),p=g(""),V=g([]),f=L({get:()=>a.isDialogVisible,set:u=>l("update:isDialogVisible",u)}),D=()=>{m.value="",p.value="",V.value=[]},T=u=>{const t=u.target;t.files&&(V.value=Array.from(t.files))},E=async()=>{const{valid:u}=await d.value.validate();if(u)try{const t=await Z.createNote({title:m.value,description:p.value,lead_id:a.leadId,attachments:V.value});t.success?(console.log("Note added successfully:",t.data),l("noteAdded"),f.value=!1,D()):console.error("Failed to add note:",t.message)}catch(t){console.error("Error adding note:",t),C(t)}},b=()=>{f.value=!1,D()};return(u,t)=>{const F=I,k=q,x=y;return P(),O(R,{modelValue:s(f),"onUpdate:modelValue":t[4]||(t[4]=r=>h(f)?f.value=r:null),"max-width":"600"},{default:n(()=>[o(F,{onClick:b}),o(W,{title:"Add Note"},{default:n(()=>[o(j,null,{default:n(()=>[o(J,{ref_key:"formRef",ref:d,onSubmit:z(E,["prevent"])},{default:n(()=>[o(K,null,{default:n(()=>[o(_,{cols:"12"},{default:n(()=>[o(k,{modelValue:s(m),"onUpdate:modelValue":t[0]||(t[0]=r=>h(m)?m.value=r:null),label:"Title",placeholder:"Enter note title",rules:s(w).note,"error-messages":s(N).note,onInput:t[1]||(t[1]=r=>s($)("note"))},null,8,["modelValue","rules","error-messages"])]),_:1}),o(_,{cols:"12"},{default:n(()=>[o(x,{modelValue:s(p),"onUpdate:modelValue":t[2]||(t[2]=r=>h(p)?p.value=r:null),label:"Description",placeholder:"Enter note description...",rows:"6",rules:s(w).content,"error-messages":s(N).content,onInput:t[3]||(t[3]=r=>s($)("content"))},null,8,["modelValue","rules","error-messages"])]),_:1}),o(_,{cols:"12"},{default:n(()=>[o(Q,{label:"Attachments",multiple:"","prepend-icon":"tabler-paperclip",placeholder:"Upload files",chips:"","show-size":"",onChange:T})]),_:1})]),_:1})]),_:1},512)]),_:1}),o(H,null,{default:n(()=>[o(X),o(A,{color:"secondary",variant:"tonal",onClick:b},{default:n(()=>t[5]||(t[5]=[B(" Cancel ")])),_:1,__:[5]}),o(A,{color:"primary",onClick:E},{default:n(()=>t[6]||(t[6]=[B(" Add Note ")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});export{ce as _,Z as n,ue as u};
