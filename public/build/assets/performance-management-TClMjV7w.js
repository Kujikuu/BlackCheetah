import{m as re}from"./vue3-apexcharts-Bdw0aS-j.js";import{d as X,g as p,O as j,a as A,o as m,k as s,y as e,l as t,q as g,t as n,av as y,a7 as B,b2 as E,aF as ne,w as de,E as ce,c as _,h as ue,aD as me,F as J,r as Q,s as pe}from"./main-CEM1QI86.js";import{_ as ve,V as fe}from"./VDialog-B7W_OT1M.js";import{V as F,f as P,h as he,a as xe,d as ye,b as S}from"./VCard-BQn_ZwHQ.js";import{V as Z}from"./VDivider-MM1jTXpn.js";import{V as O,a as z}from"./VRow-DQylzCgd.js";import{V as M}from"./VSelect-DAbGf17D.js";import{V as ee}from"./VAlert-D7jBKg4h.js";import{V as be}from"./VOverlay-DGzNmcTF.js";import{a as _e,V as ge}from"./VTabs-Bxes0duv.js";import{V as q}from"./VRating-ocf4YEqf.js";import{V as we}from"./VChip-BShyV8jA.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-CqkleIqs.js";import"./forwardRefs-B931MWyl.js";import"./scopeId-DY8qXCsp.js";import"./VMenu-Dj8Drxav.js";/* empty css              */import"./VTextField-C2dTSwqb.js";import"./VField-sdCO7WAE.js";import"./form-ChweRA-D.js";import"./VInput-BhhwivIT.js";import"./VList-DLC3F4tN.js";import"./VCheckboxBtn-BXdbbINE.js";import"./VSelectionControl-DcY1Vt5D.js";import"./VWindowItem-DfjmoSwF.js";import"./VSlideGroup-Cc3zlOOJ.js";const Ce={class:"text-body-2"},ke="/v1/franchisor/performance-management",De=X({__name:"ExportPerformanceDialog",props:{isDialogVisible:{type:Boolean},selectedPeriod:{},selectedUnit:{},exportDataTypeOptions:{},exportFormatOptions:{},periodOptions:{},franchiseeUnits:{}},emits:["update:isDialogVisible","exportCompleted"],setup(H,{emit:L}){const i=H,v=L,h=p("performance"),b=p("csv"),V=p(!1),w=j({get:()=>i.isDialogVisible,set:d=>v("update:isDialogVisible",d)}),U=async()=>{var d;V.value=!0;try{const o=i.selectedUnit==="all"?null:i.selectedUnit,f=await E(`${ke}/export`,{query:{period_type:i.selectedPeriod,unit_id:o,export_type:h.value}});if(f.success){const r=new Date().toISOString().split("T")[0],x=((d=i.franchiseeUnits.find(c=>c.id===i.selectedUnit))==null?void 0:d.name)||"All Units";(h.value==="performance"||h.value==="all")&&await C(f.data.performance,r,x),(h.value==="stats"||h.value==="all")&&await $(f.data.stats,r),v("exportCompleted"),w.value=!1}}catch(o){console.error("Error exporting data:",o)}finally{V.value=!1}},C=async(d,o,f)=>{if(!d||d.length===0)return;const r=["Period Date","Branch Name","Revenue","Expenses","Royalties","Profit","Profit Margin","Customer Rating","Reviews","Growth Rate"],x=`performance-data-${f.replace(/\s+/g,"-").toLowerCase()}-${i.selectedPeriod}-${o}.${b.value}`;if(b.value==="csv"){const c=k(d,r);D(c,x,"text/csv")}},$=async(d,o)=>{`${o}${b.value}`,b.value==="csv"&&console.log("Exporting stats data:",d)},k=(d,o)=>{const f=[o.join(",")];for(const r of d){const x=o.map(c=>`"${r[c.toLowerCase().replace(/\s+/g,"_")]||""}"`);f.push(x.join(","))}return f.join(`
`)},D=(d,o,f)=>{const r=new Blob([d],{type:f}),x=window.URL.createObjectURL(r),c=document.createElement("a");c.href=x,c.download=o,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(x)};return(d,o)=>{const f=ve;return m(),A(fe,{modelValue:w.value,"onUpdate:modelValue":o[4]||(o[4]=r=>w.value=r),"max-width":"600"},{default:s(()=>[e(f,{onClick:o[0]||(o[0]=r=>w.value=!1)}),e(F,{title:"Export Data",class:"text-center px-6 py-8"},{default:s(()=>[e(Z,{class:"mb-6"}),e(P,{class:"text-start"},{default:s(()=>[e(O,null,{default:s(()=>[e(z,{cols:"12"},{default:s(()=>[e(M,{modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=r=>h.value=r),items:i.exportDataTypeOptions,"item-title":"title","item-value":"value",label:"Data Type",variant:"outlined",density:"comfortable","prepend-inner-icon":"tabler-database"},null,8,["modelValue","items"])]),_:1}),e(z,{cols:"12"},{default:s(()=>[e(M,{modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=r=>b.value=r),items:i.exportFormatOptions,"item-title":"title","item-value":"value",label:"Export Format",variant:"outlined",density:"comfortable","prepend-inner-icon":"tabler-file-type-csv"},null,8,["modelValue","items"])]),_:1})]),_:1}),e(ee,{type:"info",variant:"tonal",class:"mt-4",density:"compact"},{prepend:s(()=>[e(y,{icon:"tabler-info-circle"})]),default:s(()=>{var r,x;return[t("div",Ce,[o[5]||(o[5]=t("strong",null,"Current Selection:",-1)),o[6]||(o[6]=t("br",null,null,-1)),g(" Period: "+n((r=i.periodOptions.find(c=>c.value===i.selectedPeriod))==null?void 0:r.title),1),o[7]||(o[7]=t("br",null,null,-1)),g(" Unit: "+n((x=i.franchiseeUnits.find(c=>c.id===i.selectedUnit))==null?void 0:x.name),1)])]}),_:1})]),_:1}),e(he,{class:"d-flex align-center justify-center gap-3 pt-4"},{default:s(()=>[e(B,{variant:"outlined",color:"secondary",onClick:o[3]||(o[3]=r=>w.value=!1)},{default:s(()=>o[8]||(o[8]=[g(" Cancel ")])),_:1,__:[8]}),e(B,{color:"primary","prepend-icon":"tabler-download",disabled:V.value,loading:V.value,onClick:U},{default:s(()=>o[9]||(o[9]=[g(" Export Data ")])),_:1,__:[9]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),ze={class:"d-flex justify-space-between align-center flex-wrap gap-4"},Se={class:"d-flex gap-3 align-center flex-wrap"},Ue={style:{height:"400px",position:"relative"}},Ee={key:1,class:"d-flex align-center justify-center h-100"},Fe={class:"text-center"},Pe={class:"d-flex align-center justify-space-between mb-4"},$e={class:"text-body-2 text-medium-emphasis"},Re={class:"mt-4"},Te={key:0},je={class:"d-flex align-center"},Ae={class:"text-caption font-weight-bold"},Oe={class:"text-body-2 font-weight-medium"},Be={class:"text-caption text-medium-emphasis"},Le={class:"text-end"},Ne={class:"text-body-2 font-weight-medium"},Ie={class:"text-caption text-success"},qe={key:1,class:"text-center py-4"},Me={class:"d-flex align-center justify-space-between mb-4"},He={class:"mt-4 text-center"},Ge={class:"d-flex align-center justify-center mb-3"},Ke={class:"text-h3 me-2 text-success"},Ye={class:"text-body-2 text-medium-emphasis"},Je={class:"text-body-2 text-medium-emphasis mb-2"},Qe={class:"d-flex align-center justify-space-between mb-4"},We={key:0,class:"mt-4 text-center"},Xe={class:"text-h6 font-weight-medium mb-1"},Ze={class:"text-body-2 text-medium-emphasis mb-3"},et={class:"d-flex align-center justify-center mb-2"},tt={class:"text-h4 me-2 text-warning"},at={class:"text-caption text-medium-emphasis"},st={key:1,class:"mt-4 text-center"},ot={class:"d-flex align-center justify-space-between mb-4"},lt={key:0,class:"mt-4 text-center"},it={class:"text-h6 font-weight-medium mb-1"},rt={class:"text-body-2 text-medium-emphasis mb-3"},nt={class:"d-flex align-center justify-center mb-2"},dt={class:"text-h4 me-2 text-error"},ct={class:"text-caption text-medium-emphasis mb-3"},ut={key:1,class:"mt-4 text-center"},T="/api/v1/franchisor/performance",mt="rgba(var(--v-theme-on-background), var(--v-high-emphasis-opacity))",W="rgba(var(--v-theme-on-background), var(--v-medium-emphasis-opacity))",pt="rgba(var(--v-border-color), var(--v-border-opacity))",vt=X({__name:"performance-management",setup(H){const L=ne(),i=p("monthly"),v=p("all"),h=p(!1),b=p(null),V=p([]),w=p({periods:[],datasets:{}}),U=p([]),C=p({score:0,max_score:5,total_reviews:0,trend:"0"}),$=p({top_rated:null,lowest_rated:null}),k=j(()=>$.value.top_rated),D=j(()=>$.value.lowest_rated),d={primary:"#9155FD",warning:"#FFB400",success:"#56CA00",error:"#FF4C51"},o=L.computedThemes.value,f=j(()=>({chart:{type:"line",height:400,toolbar:{show:!1},zoom:{enabled:!1},parentHeightOffset:0},stroke:{curve:"smooth",width:3},xaxis:{categories:w.value.periods,labels:{style:{colors:W,fontSize:"13px"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:W,fontSize:"13px"},formatter:l=>`${(l/1e3).toFixed(0)}k SAR`}},legend:{show:!0,position:"top",horizontalAlign:"left",labels:{colors:mt}},colors:[d.primary,d.error,d.warning,d.success],grid:{borderColor:pt,strokeDashArray:5,padding:{top:-20,bottom:-10,left:0,right:0}},tooltip:{theme:o.dark?"dark":"light",y:{formatter:l=>`${l.toLocaleString()} SAR`}}})),r=j(()=>{const l=v.value==="all"?"all":v.value.toString(),a=w.value.datasets[l];return a?[{name:"Revenue",data:a.revenue},{name:"Expenses",data:a.expenses},{name:"Royalties",data:a.royalties},{name:"Profit",data:a.profit}]:[]}),x=async()=>{try{const l=await E(`${T}/units`);l.success&&(V.value=l.data,(!v.value||!l.data.find(a=>a.id===v.value))&&(v.value="all"))}catch(l){console.error("Error fetching units:",l),b.value="Failed to fetch units"}},c=async()=>{try{h.value=!0;const l=v.value==="all"?null:v.value,a=await E(`${T}/chart-data`,{query:{period_type:i.value,unit_id:l}});a.success&&(w.value=a.data)}catch(l){console.error("Error fetching chart data:",l),b.value="Failed to fetch chart data"}finally{h.value=!1}},N=async()=>{try{const l=await E(`${T}/top-performers`,{query:{period_type:i.value,limit:3}});l.success&&(U.value=l.data)}catch(l){console.error("Error fetching top performers:",l)}},G=async()=>{try{const l=await E(`${T}/customer-satisfaction`,{query:{period_type:i.value}});l.success&&(C.value=l.data)}catch(l){console.error("Error fetching customer satisfaction:",l)}},K=async()=>{try{const l=await E(`${T}/ratings`,{query:{period_type:i.value}});l.success&&($.value=l.data)}catch(l){console.error("Error fetching ratings:",l)}},te=async()=>{await Promise.all([x(),c(),N(),G(),K()])};de([i,v],()=>{c(),N(),G(),K()}),ce(()=>{te()});const I=p(!1);p("csv"),p("performance");const ae=[{title:"CSV Format",value:"csv"},{title:"Excel Format",value:"xlsx"}],se=[{title:"Performance Data",value:"performance"},{title:"Statistics Summary",value:"stats"},{title:"All Data",value:"all"}],oe=()=>{I.value=!0},le=()=>{console.log("Export completed successfully")},Y=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}];return(l,a)=>{const ie=re;return m(),_("section",null,[e(be,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=u=>h.value=u),class:"align-center justify-center"},{default:s(()=>[e(me,{indeterminate:"",color:"primary",size:"64"}),a[5]||(a[5]=t("div",{class:"text-center mt-4"},[t("h4",{class:"text-h4"}," Loading Performance Data... "),t("p",{class:"text-body-1 text-medium-emphasis"}," Please wait while we fetch the latest metrics ")],-1))]),_:1,__:[5]},8,["modelValue"]),b.value?(m(),A(ee,{key:0,type:"error",class:"mb-4",dismissible:"","onClick:dismiss":a[1]||(a[1]=u=>b.value=null)},{default:s(()=>[g(n(b.value),1)]),_:1})):ue("",!0),e(O,{class:"mb-6"},{default:s(()=>[e(z,{cols:"12"},{default:s(()=>[t("div",ze,[a[7]||(a[7]=t("div",null,[t("h4",{class:"text-h4 mb-1"}," Performance Management "),t("p",{class:"text-body-1 text-medium-emphasis"}," Monitor and analyze franchise performance across all locations ")],-1)),t("div",Se,[e(M,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=u=>i.value=u),items:Y,"item-title":"title","item-value":"value",density:"compact",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"]),e(B,{color:"primary","prepend-icon":"tabler-download",disabled:h.value,onClick:oe},{default:s(()=>a[6]||(a[6]=[g(" Export ")])),_:1,__:[6]},8,["disabled"])])])]),_:1})]),_:1}),e(O,null,{default:s(()=>[e(z,{cols:"12"},{default:s(()=>[e(F,null,{default:s(()=>[e(xe,{class:"pb-4"},{append:s(()=>[e(_e,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=u=>v.value=u),density:"compact",color:"primary"},{default:s(()=>[(m(!0),_(J,null,Q(V.value,u=>(m(),A(ge,{key:u.id,value:u.id,size:"small"},{default:s(()=>[g(n(u.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),default:s(()=>[e(ye,{class:"text-h6"},{default:s(()=>a[8]||(a[8]=[g(" Franchise Performance Overview ")])),_:1,__:[8]})]),_:1}),e(Z),e(P,null,{default:s(()=>[t("div",Ue,[r.value.length>0?(m(),A(ie,{key:0,type:"line",height:"400",options:f.value,series:r.value},null,8,["options","series"])):(m(),_("div",Ee,[t("div",Fe,[e(y,{icon:"tabler-chart-line",size:"64",class:"text-medium-emphasis mb-4"}),a[9]||(a[9]=t("p",{class:"text-body-1 text-medium-emphasis"}," No data available for the selected period and unit ",-1))])]))])]),_:1})]),_:1})]),_:1})]),_:1}),e(O,{class:"mt-6"},{default:s(()=>[e(z,{cols:"12",md:"3"},{default:s(()=>[e(F,{class:"h-100"},{default:s(()=>[e(P,null,{default:s(()=>[t("div",Pe,[t("div",null,[a[10]||(a[10]=t("h6",{class:"text-h6 mb-1"}," Top 3 Performing Location ",-1)),t("div",$e," This "+n(i.value==="monthly"?"month":i.value==="yearly"?"year":"period"),1)]),e(S,{color:"primary",variant:"tonal",size:"40"},{default:s(()=>[e(y,{icon:"tabler-trophy"})]),_:1})]),t("div",Re,[U.value.length>0?(m(),_("div",Te,[(m(!0),_(J,null,Q(U.value,(u,R)=>(m(),_("div",{key:R,class:pe(["d-flex align-center justify-space-between py-3",{"border-b":R<U.value.length-1}])},[t("div",je,[e(S,{color:R===0?"warning":R===1?"info":"success",size:"24",class:"me-3"},{default:s(()=>[t("span",Ae,n(R+1),1)]),_:2},1032,["color"]),t("div",null,[t("div",Oe,n(u.name),1),t("div",Be,n(u.location),1)])]),t("div",Le,[t("div",Ne,n(u.revenue),1),t("div",Ie,n(u.growth),1)])],2))),128))])):(m(),_("div",qe,[e(y,{icon:"tabler-chart-bar",size:"48",class:"text-medium-emphasis mb-2"}),a[11]||(a[11]=t("p",{class:"text-body-2 text-medium-emphasis"}," No performance data available ",-1))]))])]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"3"},{default:s(()=>[e(F,{class:"h-100"},{default:s(()=>[e(P,null,{default:s(()=>[t("div",Me,[a[12]||(a[12]=t("div",null,[t("h6",{class:"text-h6 mb-1"}," Customer Satisfaction Score "),t("div",{class:"text-body-2 text-medium-emphasis"}," Average rating ")],-1)),e(S,{color:"success",variant:"tonal",size:"40"},{default:s(()=>[e(y,{icon:"tabler-star"})]),_:1})]),t("div",He,[t("div",Ge,[t("h3",Ke,n(C.value.score),1),t("div",Ye," / "+n(C.value.max_score),1)]),e(q,{"model-value":C.value.score,readonly:"",size:"small",color:"warning",class:"mb-3"},null,8,["model-value"]),t("div",Je," Based on "+n(C.value.total_reviews.toLocaleString())+" reviews ",1),e(we,{color:"success",size:"small",variant:"tonal"},{default:s(()=>[e(y,{start:"",icon:"tabler-trending-up",size:"16"}),g(" "+n(C.value.trend)+" this month ",1)]),_:1})])]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"3"},{default:s(()=>[e(F,{class:"h-100"},{default:s(()=>[e(P,null,{default:s(()=>[t("div",Qe,[a[13]||(a[13]=t("div",null,[t("h6",{class:"text-h6 mb-1"}," Top-Rated Franchise "),t("div",{class:"text-body-2 text-medium-emphasis"}," Highest customer rating ")],-1)),e(S,{color:"warning",variant:"tonal",size:"40"},{default:s(()=>[e(y,{icon:"tabler-award"})]),_:1})]),k.value?(m(),_("div",We,[e(S,{color:"warning",size:"60",class:"mb-3"},{default:s(()=>[e(y,{icon:"tabler-building-store",size:"30"})]),_:1}),t("div",Xe,n(k.value.name),1),t("div",Ze,n(k.value.location),1),t("div",et,[t("h4",tt,n(k.value.rating),1),e(q,{"model-value":k.value.rating,readonly:"",size:"small",color:"warning"},null,8,["model-value"])]),t("div",at,n(k.value.reviews)+" reviews ",1)])):(m(),_("div",st,[e(y,{icon:"tabler-star-off",size:"48",class:"text-medium-emphasis mb-2"}),a[14]||(a[14]=t("p",{class:"text-body-2 text-medium-emphasis"}," No rating data available ",-1))]))]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"3"},{default:s(()=>[e(F,{class:"h-100"},{default:s(()=>[e(P,null,{default:s(()=>[t("div",ot,[a[15]||(a[15]=t("div",null,[t("h6",{class:"text-h6 mb-1"}," Lowest-Rated Franchise "),t("div",{class:"text-body-2 text-medium-emphasis"}," Needs attention ")],-1)),e(S,{color:"error",variant:"tonal",size:"40"},{default:s(()=>[e(y,{icon:"tabler-alert-triangle"})]),_:1})]),D.value?(m(),_("div",lt,[e(S,{color:"error",size:"60",class:"mb-3"},{default:s(()=>[e(y,{icon:"tabler-building-store",size:"30"})]),_:1}),t("div",it,n(D.value.name),1),t("div",rt,n(D.value.location),1),t("div",nt,[t("h4",dt,n(D.value.rating),1),e(q,{"model-value":D.value.rating,readonly:"",size:"small",color:"warning"},null,8,["model-value"])]),t("div",ct,n(D.value.reviews)+" reviews ",1),e(B,{color:"error",variant:"tonal",size:"small",block:""},{default:s(()=>[e(y,{start:"",icon:"tabler-message",size:"16"}),a[16]||(a[16]=g(" Contact Unit "))]),_:1,__:[16]})])):(m(),_("div",ut,[e(y,{icon:"tabler-star",size:"48",class:"text-medium-emphasis mb-2"}),a[17]||(a[17]=t("p",{class:"text-body-2 text-medium-emphasis"}," No rating data available ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(De,{"is-dialog-visible":I.value,"onUpdate:isDialogVisible":a[4]||(a[4]=u=>I.value=u),"selected-period":i.value,"selected-unit":v.value,"export-data-type-options":se,"export-format-options":ae,"period-options":Y,"franchisee-units":V.value,onExportCompleted:le},null,8,["is-dialog-visible","selected-period","selected-unit","franchisee-units"])])}}}),It=Ve(vt,[["__scopeId","data-v-f5083f67"]]);export{It as default};
