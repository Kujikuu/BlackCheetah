import{V as Ve,_ as Ce}from"./VDataTableServer-DgUCqbmN.js";import{_ as Fe}from"./AppTextField.vue_vue_type_script_setup_true_lang-0faPZIAK.js";import{_ as ke}from"./AppSelect.vue_vue_type_script_setup_true_lang-Bj4O7Q8N.js";import{_ as De}from"./AddEditFranchisorDrawer.vue_vue_type_script_setup_true_lang-DOAxRWqI.js";import{_ as Ue,a as Ne}from"./ResetPasswordDialog.vue_vue_type_script_setup_true_lang-asm6_iGr.js";import{_ as Ae,a as y}from"./ViewUserDialog.vue_vue_type_script_setup_true_lang-Bmk4DapG.js";import{d as Le,g as n,O as Ee,E as Pe,c as T,o as x,y as a,k as l,l as i,F as $e,r as Se,i as r,a as $,t as u,s as Te,av as m,h as W,q as p,aI as v,a7 as E}from"./main-BWNnj23H.js";import{a as z,V as I}from"./VRow-CswInaof.js";import{V as q,f as B,b as J,a as ze,d as Ie,e as Be}from"./VCard-Ds29YdWC.js";import{V as j}from"./VDivider-UvFNvVgh.js";import{V as je}from"./VSpacer-BtP19Y8C.js";import{V as Q}from"./VMenu-0AUhCnQP.js";import{V as G,a as C,b as F}from"./VList-BBMGPuVo.js";import{V as Oe}from"./VAlert-CeyfWDDv.js";import{V as H}from"./VChip-DvCJp9Wa.js";import"./VPagination-dF8V-on0.js";import"./VDataTable-09J7Hk6b.js";import"./VSelect-B_B1jWF9.js";import"./VTextField-DkMdNLCa.js";import"./VField-Cl6ebA9i.js";import"./form-BflAq2YC.js";import"./VInput-BQnO7MBM.js";import"./VCheckboxBtn-4jdsQFwS.js";import"./VSelectionControl-Box3LWk_.js";import"./VTable-Btj0kh65.js";import"./validators-BHkKs9Dp.js";import"./VForm-DwjLFOlB.js";import"./VNavigationDrawer-Cul7onAY.js";import"./VDialog-OMqAAEGv.js";import"./VTooltip-CoOCmxoD.js";import"./formatters-aoHiJebZ.js";/* empty css              */import"./VSlideGroup-BWKNT972.js";const Re={class:"d-flex justify-space-between"},Me={class:"d-flex flex-column gap-y-1"},We={class:"text-body-1 text-high-emphasis"},qe={class:"d-flex gap-x-2 align-center"},Je={class:"text-h4"},Qe={class:"text-sm"},Ge={class:"me-3 d-flex gap-3"},He={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Ke={style:{"inline-size":"15.625rem"}},Xe={class:"text-center pa-8"},Ye={class:"d-flex align-center gap-x-4"},Ze={key:1},et={class:"d-flex flex-column"},tt={class:"text-base font-weight-medium"},at={class:"text-sm text-medium-emphasis"},st={class:"text-body-1 text-high-emphasis"},lt={class:"text-body-1"},ot={class:"text-body-1"},rt={class:"d-flex gap-1"},Ot=Le({__name:"franchisors",setup(it){const h=n(""),k=n(),w=n(10),b=n(1),K=n([{key:"created_at",order:"desc"}]),X=n("desc"),c=n([]),Y=t=>{var e;t.sortBy&&t.sortBy.length>0&&(K.value=t.sortBy,X.value=(e=t.sortBy[0])==null?void 0:e.order)},Z=[{title:"User",key:"user"},{title:"Franchise Name",key:"franchiseName"},{title:"Email",key:"email"},{title:"Last Login",key:"lastLogin"},{title:"Plan",key:"plan"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],g=n([]),S=n(!1),d=n(""),D=n(0),U=async()=>{S.value=!0,d.value="";try{const t=await y.getFranchisors();if(t.success&&t.data){let e=[];Array.isArray(t.data)?e=t.data:t.data&&typeof t.data=="object"&&"data"in t.data&&Array.isArray(t.data.data)&&(e=t.data.data),console.log("Franchisors API Response:",{response:t,userData:e}),g.value=e.map(o=>({id:o.id,fullName:o.fullName||o.name,email:o.email,phone:o.phone||"",location:o.location||"",status:o.status,avatar:o.avatar,joinedDate:o.joinedDate||o.createdAt||o.created_at,franchiseName:o.franchiseName,lastLogin:o.lastLogin,plan:o.plan})),D.value=g.value.length}else g.value=[],D.value=0,d.value=t.message||"Failed to fetch franchisors"}catch(t){console.error("Error fetching franchisors:",t),console.error("Full error details:",{err:t,response:t==null?void 0:t.response}),g.value=[],D.value=0,d.value=`Failed to fetch franchisors: ${(t==null?void 0:t.message)||"Unknown error"}`}finally{S.value=!1}},ee=t=>t>0?`+${t}`:t,te=t=>{if(!t||typeof t!="string")return"U";const e=t.split(" ");return e.length>1?`${e[0][0]}${e[1][0]}`:t.slice(0,2)},ae=Ee(()=>{let t=g.value;return h.value&&(t=t.filter(e=>{var o;return e.fullName.toLowerCase().includes(h.value.toLowerCase())||e.email.toLowerCase().includes(h.value.toLowerCase())||((o=e.franchiseName)==null?void 0:o.toLowerCase().includes(h.value.toLowerCase()))||!1})),k.value&&(t=t.filter(e=>e.status===k.value)),t}),se=[{title:"Pending",value:"pending"},{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],le=t=>{const e=t.toLowerCase();return e==="pending"?"warning":e==="active"?"success":e==="inactive"?"secondary":"primary"},oe=t=>{if(!t)return"primary";const e=t.toLowerCase();return e==="basic"?"primary":e==="pro"?"success":e==="enterprise"?"warning":"primary"},_=n(!1),N=n(!1),A=n(!1),P=n(!1),f=n(null),V=n(null),re=async t=>{try{const e=await y.createUser({...t,role:"franchisor"});e.success?await U():d.value=e.message||"Failed to create franchisor"}catch(e){console.error("Error creating franchisor:",e),d.value="Failed to create franchisor"}},ie=t=>{f.value={...t},_.value=!0},ne=async t=>{try{const e=await y.updateUser(t.id,t);e.success?(await U(),f.value=null):d.value=e.message||"Failed to update franchisor"}catch(e){console.error("Error updating franchisor:",e),d.value="Failed to update franchisor"}},ce=async t=>{t.id?await ne(t):await re(t)},de=t=>{V.value=t,N.value=!0},ue=async()=>{if(V.value){try{const t=await y.deleteUser(V.value.id);if(t.success){await U();const e=c.value.findIndex(o=>o===V.value.id);e!==-1&&c.value.splice(e,1)}else d.value=t.message||"Failed to delete franchisor"}catch(t){console.error("Error deleting franchisor:",t),d.value="Failed to delete franchisor"}N.value=!1,V.value=null}},pe=async()=>{if(c.value.length!==0)try{for(const t of c.value)await y.deleteUser(t);await U(),c.value=[]}catch(t){console.error("Error bulk deleting franchisors:",t),d.value="Failed to delete selected franchisors"}},fe=t=>{f.value=t,A.value=!0},me=async t=>{var e;if(f.value){try{const o=await y.resetUserPassword(f.value.id,t);o.success?console.log("Password reset successfully for:",(e=f.value)==null?void 0:e.fullName):d.value=o.message||"Failed to reset password"}catch(o){console.error("Error resetting password:",o),d.value="Failed to reset password"}A.value=!1,f.value=null}},ve=()=>{f.value=null},O=n([{title:"Total Franchisors",value:"0",change:0,desc:"All registered franchisors",icon:"tabler-building-store",iconColor:"primary"},{title:"Active Franchisors",value:"0",change:0,desc:"Currently active",icon:"tabler-user-check",iconColor:"success"},{title:"Pending Approval",value:"0",change:0,desc:"Awaiting verification",icon:"tabler-clock",iconColor:"warning"}]),ge=async()=>{try{const t=await y.getFranchisorsStats();t.success&&(O.value=t.data)}catch(t){console.error("Error fetching franchisor stats:",t)}};Pe(()=>{U(),ge()});const he=t=>{f.value=t,P.value=!0},_e=()=>{_.value=!0},ye=()=>{const t=c.value.length>0?g.value.filter(e=>c.value.includes(e.id)):g.value;console.log("Exporting to CSV:",t)},xe=()=>{const t=c.value.length>0?g.value.filter(e=>c.value.includes(e.id)):g.value;console.log("Exporting to PDF:",t)};return(t,e)=>{var R,M;const o=ke,we=Fe,be=Ce;return x(),T("section",null,[a(I,{class:"mb-6"},{default:l(()=>[a(z,{cols:"12"},{default:l(()=>e[14]||(e[14]=[i("div",{class:"d-flex align-center justify-space-between"},[i("div",null,[i("h2",{class:"text-h2 mb-1"}," Franchisor Management "),i("p",{class:"text-body-1 text-medium-emphasis"}," Manage and monitor all franchisor accounts ")])],-1)])),_:1,__:[14]})]),_:1}),a(I,{class:"mb-6"},{default:l(()=>[(x(!0),T($e,null,Se(r(O),(s,L)=>(x(),$(z,{key:L,cols:"12",md:"4",sm:"6"},{default:l(()=>[a(q,null,{default:l(()=>[a(B,null,{default:l(()=>[i("div",Re,[i("div",Me,[i("div",We,u(s.title),1),i("div",qe,[i("h4",Je,u(s.value),1),i("div",{class:Te(["text-base",s.change>0?"text-success":"text-error"])}," ("+u(ee(s.change))+"%) ",3)]),i("div",Qe,u(s.desc),1)]),a(J,{color:s.iconColor,variant:"tonal",rounded:"",size:"42"},{default:l(()=>[a(m,{icon:s.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(q,{class:"mb-6"},{default:l(()=>[a(ze,{class:"pb-4"},{default:l(()=>[a(Ie,null,{default:l(()=>e[15]||(e[15]=[p("Filters")])),_:1,__:[15]})]),_:1}),a(B,null,{default:l(()=>[a(I,null,{default:l(()=>[a(z,{cols:"12",sm:"4"},{default:l(()=>[a(o,{modelValue:r(k),"onUpdate:modelValue":e[0]||(e[0]=s=>v(k)?k.value=s:null),placeholder:"Select Status",items:se,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(j),a(B,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[i("div",Ge,[a(o,{"model-value":r(w),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=parseInt(s,10))},null,8,["model-value"]),r(c).length>0?(x(),$(E,{key:0,variant:"tonal",color:"error",onClick:pe},{default:l(()=>[a(m,{icon:"tabler-trash",class:"me-2"}),p(" Delete Selected ("+u(r(c).length)+") ",1)]),_:1})):W("",!0)]),a(je),i("div",He,[i("div",Ke,[a(we,{modelValue:r(h),"onUpdate:modelValue":e[2]||(e[2]=s=>v(h)?h.value=s:null),placeholder:"Search Franchisor"},null,8,["modelValue"])]),a(E,{variant:"tonal",color:"secondary"},{default:l(()=>[a(m,{icon:"tabler-upload",class:"me-2"}),p(" Export "+u(r(c).length>0?`(${r(c).length})`:"All")+" ",1),a(Q,{activator:"parent"},{default:l(()=>[a(G,null,{default:l(()=>[a(C,{onClick:ye},{prepend:l(()=>[a(m,{icon:"tabler-file-type-csv"})]),default:l(()=>[a(F,null,{default:l(()=>e[16]||(e[16]=[p("Export to CSV")])),_:1,__:[16]})]),_:1}),a(C,{onClick:xe},{prepend:l(()=>[a(m,{icon:"tabler-file-type-pdf"})]),default:l(()=>[a(F,null,{default:l(()=>e[17]||(e[17]=[p("Export to PDF")])),_:1,__:[17]})]),_:1})]),_:1})]),_:1})]),_:1}),a(E,{"prepend-icon":"tabler-plus",onClick:e[3]||(e[3]=s=>_.value=!0)},{default:l(()=>e[18]||(e[18]=[p(" Add New Franchisor ")])),_:1,__:[18]})])]),_:1}),a(j),r(d)?(x(),$(Oe,{key:0,type:"error",class:"ma-4",closable:"","onClick:close":e[4]||(e[4]=s=>d.value="")},{default:l(()=>[p(u(r(d)),1)]),_:1})):W("",!0),a(Ve,{"items-per-page":r(w),"onUpdate:itemsPerPage":e[7]||(e[7]=s=>v(w)?w.value=s:null),"model-value":r(c),"onUpdate:modelValue":e[8]||(e[8]=s=>v(c)?c.value=s:null),page:r(b),"onUpdate:page":e[9]||(e[9]=s=>v(b)?b.value=s:null),items:r(ae),"item-value":"id","items-length":r(D),headers:Z,loading:r(S),class:"text-no-wrap","show-select":"","onUpdate:options":Y},{"no-data":l(()=>[i("div",Xe,[a(m,{icon:"tabler-users-off",size:"64",class:"mb-4 text-disabled"}),e[20]||(e[20]=i("h3",{class:"text-h5 mb-2"}," No Franchisors Found ",-1)),e[21]||(e[21]=i("p",{class:"text-body-1 text-medium-emphasis mb-4"}," No franchisors match your search criteria. Try adjusting your filters. ",-1)),a(E,{color:"primary",onClick:e[5]||(e[5]=s=>_.value=!0)},{default:l(()=>e[19]||(e[19]=[p(" Add First Franchisor ")])),_:1,__:[19]})])]),"item.user":l(({item:s})=>[i("div",Ye,[a(J,{size:"34",variant:s.avatar?void 0:"tonal",color:"primary"},{default:l(()=>[s.avatar?(x(),$(Be,{key:0,src:s.avatar},null,8,["src"])):(x(),T("span",Ze,u(te(s.fullName)),1))]),_:2},1032,["variant"]),i("div",et,[i("h6",tt,u(s.fullName),1),i("div",at," Joined: "+u(s.joinedDate),1)])])]),"item.franchiseName":l(({item:s})=>[i("div",st,u(s.franchiseName),1)]),"item.email":l(({item:s})=>[i("div",lt,u(s.email),1)]),"item.lastLogin":l(({item:s})=>[i("div",ot,u(s.lastLogin),1)]),"item.plan":l(({item:s})=>[a(H,{color:oe(s.plan),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[p(u(s.plan),1)]),_:2},1032,["color"])]),"item.status":l(({item:s})=>[a(H,{color:le(s.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[p(u(s.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:s})=>[i("div",rt,[a(E,{icon:"",variant:"text",color:"medium-emphasis",size:"small"},{default:l(()=>[a(m,{icon:"tabler-dots-vertical",size:"22"}),a(Q,{activator:"parent"},{default:l(()=>[a(G,null,{default:l(()=>[a(C,{onClick:L=>he(s)},{prepend:l(()=>[a(m,{icon:"tabler-eye"})]),default:l(()=>[a(F,null,{default:l(()=>e[22]||(e[22]=[p("View")])),_:1,__:[22]})]),_:2},1032,["onClick"]),a(C,{onClick:L=>ie(s)},{prepend:l(()=>[a(m,{icon:"tabler-pencil"})]),default:l(()=>[a(F,null,{default:l(()=>e[23]||(e[23]=[p("Edit")])),_:1,__:[23]})]),_:2},1032,["onClick"]),a(C,{onClick:L=>fe(s)},{prepend:l(()=>[a(m,{icon:"tabler-key"})]),default:l(()=>[a(F,null,{default:l(()=>e[24]||(e[24]=[p("Reset Password")])),_:1,__:[24]})]),_:2},1032,["onClick"]),a(j,{class:"my-2"}),a(C,{onClick:L=>de(s)},{prepend:l(()=>[a(m,{icon:"tabler-trash",color:"error"})]),default:l(()=>[a(F,{class:"text-error"},{default:l(()=>e[25]||(e[25]=[p(" Delete ")])),_:1,__:[25]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),bottom:l(()=>[a(be,{page:r(b),"onUpdate:page":e[6]||(e[6]=s=>v(b)?b.value=s:null),"items-per-page":r(w),"total-items":r(D)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),a(De,{"is-drawer-open":r(_),"onUpdate:isDrawerOpen":[e[10]||(e[10]=s=>v(_)?_.value=s:null),ve],franchisor:r(f),onFranchisorData:ce},null,8,["is-drawer-open","franchisor"]),a(Ue,{"is-dialog-open":r(N),"onUpdate:isDialogOpen":e[11]||(e[11]=s=>v(N)?N.value=s:null),"user-name":(R=r(V))==null?void 0:R.fullName,"user-type":"Franchisor",onConfirm:ue},null,8,["is-dialog-open","user-name"]),a(Ne,{"is-dialog-open":r(A),"onUpdate:isDialogOpen":e[12]||(e[12]=s=>v(A)?A.value=s:null),"user-name":(M=r(f))==null?void 0:M.fullName,onConfirm:me},null,8,["is-dialog-open","user-name"]),a(Ae,{"is-dialog-open":r(P),"onUpdate:isDialogOpen":e[13]||(e[13]=s=>v(P)?P.value=s:null),user:r(f),"user-type":"Franchisor",onEdit:_e},null,8,["is-dialog-open","user"])])}}});export{Ot as default};
