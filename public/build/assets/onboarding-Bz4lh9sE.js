import{_ as L}from"./AppTextarea.vue_vue_type_script_setup_true_lang-DMn6sV1L.js";import{_ as M}from"./AppSelect.vue_vue_type_script_setup_true_lang-CfL7t8wr.js";import{_ as O}from"./AppTextField.vue_vue_type_script_setup_true_lang-dQJOVDTw.js";import{d as $,g,e as j,b9 as z,aZ as y,bg as E,O as v,w as H,E as G,bx as V,c as I,o as _,l as c,y as o,aR as k,i as e,k as l,G as C,t as x,b5 as Y,a as Z,h as J,q as w,a7 as K,s as Q}from"./main-p_64Ajbw.js";import{a as W,b as X}from"./auth-v1-top-shape-gPxasD3d.js";import{V as b}from"./VNodeRenderer-5KdF8hCk.js";import{u as ee,a as ae}from"./useSaudiProvinces-B1b-QqPj.js";import{a as se,d as oe,f as P,V as te}from"./VCard-C0Tw-4W6.js";import{V as re}from"./VForm-CAd-XVkx.js";import{V as le,a as m}from"./VRow-CqkF75pY.js";import{V as ne}from"./VAlert-BEYgMvIF.js";import"./form-BhenlLYk.js";import"./VTextarea-M7GThMqS.js";import"./VTextField-dDEcwhzX.js";import"./VField-i3dJdciE.js";import"./forwardRefs-B931MWyl.js";import"./VInput-Dn9GKPUx.js";import"./VSelect-D6w66G-Y.js";import"./VList-8BgSZxyl.js";import"./VDivider-Bijs2L80.js";import"./VMenu-B6Kw1s4z.js";import"./VOverlay-kbU4_qk-.js";import"./scopeId-D-uFaV4P.js";import"./VCheckboxBtn-BFEu_OAw.js";import"./VSelectionControl-o0RER-mO.js";import"./VChip-BUM4slpR.js";import"./VSlideGroup-7Py50_j-.js";/* empty css              */const ie={class:"auth-wrapper d-flex align-center justify-center pa-4"},de={class:"position-relative my-sm-16"},ue={class:"app-logo"},me={class:"app-logo-title"},ze=$({__name:"onboarding",setup(pe){const s=g({name:"",phone:"",nationality:"",state:"",city:"",address:""}),f=g(!1),i=g(null),u=j(),{smAndUp:S}=z(),A=y("userData"),{updateAbility:ce}=E(),{countries:N,isLoading:R}=ee(),{provinces:F,getCitiesForProvince:T,isLoading:q}=ae(),B=v(()=>T(s.value.state||""));H(()=>s.value.state,()=>{s.value.city=""}),G(async()=>{var p;try{const a=await V.getStatus();if(a.success&&a.data&&(a.data.user&&(s.value={name:a.data.user.name||"",phone:a.data.user.phone||"",nationality:a.data.user.nationality||"",state:a.data.user.state||"",city:a.data.user.city||"",address:a.data.user.address||""}),a.data.profile_completed))switch((p=A.value)==null?void 0:p.role){case"admin":u.push("/admin/dashboard");break;case"franchisor":u.push("/franchisor");break;case"franchisee":u.push("/franchisee/dashboard/sales");break;case"broker":u.push("/brokers/lead-management");break;default:u.push("/")}}catch(a){console.error("Failed to check onboarding status:",a)}});const U=async()=>{var p,a;f.value=!0,i.value=null;try{console.log("Submitting onboarding form:",s.value);const r=await V.complete(s.value);if(console.log("Onboarding response:",r),r.success&&r.data){console.log("Onboarding successful, updating user data...");const n=y("userData");switch(n.value&&(n.value={...n.value,profile_completed:!0,...r.data.user}),console.log("Redirecting to dashboard..."),(p=n.value)==null?void 0:p.role){case"admin":u.push("/admin/dashboard");break;case"franchisor":u.push("/franchisor");break;case"franchisee":u.push("/franchisee/dashboard/sales");break;case"broker":u.push("/brokers/lead-management");break;default:u.push("/")}}else console.error("Onboarding failed:",r),i.value={general:[r.message||"Failed to complete profile. Please try again."]}}catch(r){console.error("Onboarding error:",r);const n=(r==null?void 0:r.data)||((a=r==null?void 0:r.response)==null?void 0:a._data)||null;n!=null&&n.errors?i.value=n.errors:i.value={general:[(n==null?void 0:n.message)||"Failed to complete profile. Please try again."]}}finally{f.value=!1}},D=v(()=>s.value.name&&s.value.phone&&s.value.nationality&&s.value.state&&s.value.city&&s.value.address);return(p,a)=>{const r=O,n=M,h=L;return _(),I("div",ie,[c("div",de,[o(e(b),{nodes:k("div",{innerHTML:e(W)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),o(e(b),{nodes:k("div",{innerHTML:e(X)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),o(te,{class:Q(["auth-card",e(S)?"pa-6":"pa-0"]),"max-width":"600"},{default:l(()=>[o(se,{class:"justify-center"},{default:l(()=>[o(oe,null,{default:l(()=>[c("div",ue,[o(e(b),{nodes:e(C).app.logo},null,8,["nodes"]),c("h1",me,x(e(C).app.title),1)])]),_:1})]),_:1}),o(P,null,{default:l(()=>a[6]||(a[6]=[c("h4",{class:"text-h4 mb-1"}," Complete Your Profile ",-1),c("p",{class:"mb-0"}," Please provide your personal information to complete your account setup ",-1)])),_:1,__:[6]}),o(P,null,{default:l(()=>[o(re,{onSubmit:Y(U,["prevent"])},{default:l(()=>[o(le,null,{default:l(()=>[o(m,{cols:"12"},{default:l(()=>{var t;return[(t=e(i))!=null&&t.general?(_(),Z(ne,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:l(()=>[w(x(e(i).general[0]),1)]),_:1})):J("",!0)]}),_:1}),o(m,{cols:"12"},{default:l(()=>{var t;return[o(r,{modelValue:e(s).name,"onUpdate:modelValue":a[0]||(a[0]=d=>e(s).name=d),autofocus:"",label:"Full Name",placeholder:"Name","error-messages":(t=e(i))==null?void 0:t.name,required:""},null,8,["modelValue","error-messages"])]}),_:1}),o(m,{cols:"12"},{default:l(()=>{var t;return[o(r,{modelValue:e(s).phone,"onUpdate:modelValue":a[1]||(a[1]=d=>e(s).phone=d),label:"Phone Number",placeholder:"+966 50 123 4567","error-messages":(t=e(i))==null?void 0:t.phone,required:""},null,8,["modelValue","error-messages"])]}),_:1}),o(m,{cols:"12",md:"6"},{default:l(()=>{var t;return[o(n,{modelValue:e(s).nationality,"onUpdate:modelValue":a[2]||(a[2]=d=>e(s).nationality=d),label:"Nationality",placeholder:"Select Nationality",items:e(N),loading:e(R),"error-messages":(t=e(i))==null?void 0:t.nationality,clearable:"",required:""},null,8,["modelValue","items","loading","error-messages"])]}),_:1}),o(m,{cols:"12",md:"6"},{default:l(()=>{var t;return[o(n,{modelValue:e(s).state,"onUpdate:modelValue":a[3]||(a[3]=d=>e(s).state=d),label:"Province",placeholder:"Select Province",items:e(F),loading:e(q),"error-messages":(t=e(i))==null?void 0:t.state,clearable:"",required:""},null,8,["modelValue","items","loading","error-messages"])]}),_:1}),o(m,{cols:"12"},{default:l(()=>{var t;return[o(n,{modelValue:e(s).city,"onUpdate:modelValue":a[4]||(a[4]=d=>e(s).city=d),label:"City",placeholder:"Select City",items:e(B),disabled:!e(s).state,"error-messages":(t=e(i))==null?void 0:t.city,clearable:"",required:""},null,8,["modelValue","items","disabled","error-messages"])]}),_:1}),o(m,{cols:"12"},{default:l(()=>{var t;return[o(h,{modelValue:e(s).address,"onUpdate:modelValue":a[5]||(a[5]=d=>e(s).address=d),label:"Address",placeholder:"123 Main Street, Apt 4B","error-messages":(t=e(i))==null?void 0:t.address,rows:"3",required:""},null,8,["modelValue","error-messages"])]}),_:1}),o(m,{cols:"12"},{default:l(()=>[o(K,{block:"",type:"submit",loading:e(f),disabled:e(f)||!e(D),color:"primary",size:"large"},{default:l(()=>a[7]||(a[7]=[w(" Complete Profile ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])}}});export{ze as default};
