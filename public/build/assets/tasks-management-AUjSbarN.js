import{_ as Ae}from"./CreateTaskDialog.vue_vue_type_script_setup_true_lang-CsNnQVST.js";import{_ as Pe}from"./ViewTaskDialog.vue_vue_type_script_setup_true_lang-CmZwnB_O.js";import{u as Ee,T as Se,_ as Ue}from"./EditTaskDialog.vue_vue_type_script_setup_true_lang-ze2qiyBk.js";import{_ as Me}from"./DeleteTaskDialog.vue_vue_type_script_setup_true_lang-CMqIpyaZ.js";import{d as Le,e as Ne,g as u,O as o,w as W,E as $e,c as P,o as g,y as t,a as q,h as X,k as l,l as n,a7 as Z,q as d,av as c,aI as w,i as r,t as f,bf as Be,F as Re}from"./main-CSU6kgHA.js";import{t as E}from"./task-qHQBqOa6.js";import{a as C,V as ee}from"./VRow-BZVkTVe_.js";import{a as K,V as He}from"./VTabs-5j74-Kdj.js";import{V as Oe}from"./VAlert-BMDbfCJa.js";import{V as F,f as z,b as S,a as je,d as qe,h as Ke}from"./VCard-C3SWsjmI.js";import{V as Ye}from"./VDivider-MLBtUVJ7.js";import{V as Ge}from"./VDataTable-CQ2gcYKE.js";import{V as Je}from"./VMenu-D1DxuMHS.js";import{V as Qe,a as Y,b as G}from"./VList-DCEwk4iA.js";import{V as se}from"./VChip-5PNz7pmK.js";import"./VDialog-CdykBzC-.js";import"./useValidationRules-BzjSj40d.js";import"./tasksValidation-D3ebQKwi.js";import"./VForm-CPwOinhh.js";import"./form-CmgP78I7.js";import"./VTextField-2OrF6uJE.js";import"./VField-C0HWX8hc.js";import"./VInput-BdCPpNmf.js";import"./VTextarea-UaGK6NZh.js";import"./VSelect-BqupoXgM.js";import"./VCheckboxBtn-DTlNmqdA.js";import"./VSelectionControl-Co9vCtOS.js";import"./VSpacer-BqsowJbv.js";import"./franchise-CeRqY42Q.js";import"./api-router-HVeB8xLM.js";import"./users-CEm4PCzz.js";import"./VWindowItem-dIWkd01E.js";import"./VSlideGroup-0Gma-9UL.js";import"./VPagination-BoeKG-uc.js";import"./VTable-CJKL4Ra-.js";const We={class:"d-flex align-center justify-space-between"},Xe={key:1,class:"text-center py-12"},Ze={class:"ms-4"},es={class:"text-h4"},ss={class:"ms-4"},as={class:"text-h4"},ts={class:"ms-4"},ls={class:"text-h4"},rs={class:"ms-4"},is={class:"text-h4"},ns={class:"text-base font-weight-medium"},os={class:"text-body-2 text-disabled"},us={key:0,class:"text-caption text-info mt-1"},ds={class:"text-body-1"},cs={class:"text-center"},fs={class:"text-body-1 text-medium-emphasis"},Js=Le({__name:"tasks-management",setup(ms){Ne();const{getUsersForSelect:ae,initializeUsers:U,loading:te}=Ee(),i=u("my-tasks"),I=u(!1),k=u(!1),_=u(!1),h=u(null),M=u(null),m=u([]),v=u([]),p=u([]),L=u(!1),N=u(!1),$=u(!1),B=u(null),R=u(null),H=u(null),A=u(!1),O=e=>{var s,a,y,x,D;return{id:e.id,title:e.title,description:e.description,category:e.type||"other",assignedTo:((s=e.assigned_to)==null?void 0:s.name)||"Unassigned",assignedToRole:((a=e.assigned_to)==null?void 0:a.role)||null,createdBy:((y=e.created_by)==null?void 0:y.name)||"Unknown",createdByRole:((x=e.created_by)==null?void 0:x.role)||null,unitName:((D=e.unit)==null?void 0:D.unit_name)||"N/A",startDate:e.started_at?new Date(e.started_at).toISOString().split("T")[0]:null,dueDate:e.due_date?new Date(e.due_date).toISOString().split("T")[0]:null,priority:e.priority||"medium",status:e.status||"pending",estimatedHours:e.estimated_hours||0,actualHours:e.actual_hours||0,createdAt:e.created_at,updatedAt:e.updated_at}},T=async()=>{var e,s;L.value=!0,B.value=null;try{const a=await E.getFranchisorTasks({filter:"assigned"});a.success&&((e=a.data)!=null&&e.data)?m.value=a.data.data.map(O):m.value=[]}catch(a){console.error("Failed to load my tasks:",a),B.value=((s=a==null?void 0:a.data)==null?void 0:s.message)||"Failed to load my tasks",m.value=[]}finally{L.value=!1}},b=async()=>{var e,s;N.value=!0,R.value=null;try{const a=await E.getFranchisorTasks({filter:"created"});if(a.success&&((e=a.data)!=null&&e.data)){const y=a.data.data.filter(x=>{var D,Q;return((D=x.assigned_to)==null?void 0:D.role)==="franchisee"||((Q=x.assigned_to)==null?void 0:Q.role)==="unit_manager"});v.value=y.map(O)}else v.value=[]}catch(a){console.error("Failed to load franchisee tasks:",a),R.value=((s=a==null?void 0:a.data)==null?void 0:s.message)||"Failed to load franchisee tasks",v.value=[]}finally{N.value=!1}},V=async()=>{var e,s;$.value=!0,H.value=null;try{const a=await E.getFranchisorTasks();a.success&&((e=a.data)!=null&&e.data)?p.value=a.data.data.map(O):p.value=[]}catch(a){console.error("Failed to load all tasks:",a),H.value=((s=a==null?void 0:a.data)==null?void 0:s.message)||"Failed to load all tasks",p.value=[]}finally{$.value=!1}},le=o(()=>m.value.length),re=o(()=>m.value.filter(e=>e.status==="completed").length),ie=o(()=>m.value.filter(e=>e.status==="in_progress").length),ne=o(()=>{const e=new Date;return m.value.filter(s=>s.dueDate?new Date(s.dueDate)<=e&&s.status!=="completed":!1).length}),oe=o(()=>v.value.length),ue=o(()=>v.value.filter(e=>e.status==="completed").length),de=o(()=>v.value.filter(e=>e.status==="in_progress").length),ce=o(()=>{const e=new Date;return v.value.filter(s=>s.dueDate?new Date(s.dueDate)<=e&&s.status!=="completed":!1).length}),fe=o(()=>p.value.length),me=o(()=>p.value.filter(e=>e.status==="completed").length),ve=o(()=>p.value.filter(e=>e.status==="in_progress").length),pe=o(()=>{const e=new Date;return p.value.filter(s=>s.dueDate?new Date(s.dueDate)<=e&&s.status!=="completed":!1).length}),J=o(()=>i.value==="my-tasks"?m.value:i.value==="franchisee"?v.value:p.value),ye=o(()=>i.value==="my-tasks"?le.value:i.value==="franchisee"?oe.value:fe.value),ge=o(()=>i.value==="my-tasks"?re.value:i.value==="franchisee"?ue.value:me.value),ke=o(()=>i.value==="my-tasks"?ie.value:i.value==="franchisee"?de.value:ve.value),_e=o(()=>i.value==="my-tasks"?ne.value:i.value==="franchisee"?ce.value:pe.value),he=o(()=>i.value==="my-tasks"?L.value:i.value==="franchisee"?N.value:$.value),j=o(()=>i.value==="my-tasks"?B.value:i.value==="franchisee"?R.value:H.value),Te=o(()=>ae("franchisee").map(e=>({title:e.title,value:String(e.value)}))),be=e=>e==="completed"?"success":e==="in_progress"?"warning":e==="pending"?"info":"secondary",Ve=e=>e==="high"?"error":e==="medium"?"warning":e==="low"?"info":"secondary",xe=async e=>{try{const s=await E.createFranchisorTask({title:e.title,description:e.description,category:e.category,priority:e.priority,status:e.status||"pending",due_date:e.dueDate,estimated_hours:e.estimatedHours});s.success?await Promise.all([T(),b(),V()]):console.error("Failed to create task:",s)}catch(s){console.error("Error creating task:",s)}},De=[...Se],we=e=>{h.value=e,I.value=!0},Ce=e=>{h.value={...e},k.value=!0},Fe=e=>{M.value=e,_.value=!0},ze=async e=>{await Promise.all([T(),b(),V()]),k.value=!1,h.value=null},Ie=async e=>{await Promise.all([T(),b(),V()]),_.value=!1,M.value=null};return W(i,async e=>{e==="my-tasks"&&m.value.length===0?await T():e==="franchisee"&&v.value.length===0?await b():e==="all-tasks"&&p.value.length===0&&await V(),await U("franchisee")}),W(k,async e=>{e&&await U("franchisee")}),$e(async()=>{await Promise.all([T(),b(),V()]),await U("franchisee")}),(e,s)=>(g(),P("section",null,[t(ee,{class:"mb-6"},{default:l(()=>[t(C,{cols:"12"},{default:l(()=>[n("div",We,[s[8]||(s[8]=n("div",null,[n("h2",{class:"text-h2 mb-1"}," Tasks Management "),n("p",{class:"text-body-1 text-medium-emphasis"}," Manage and track tasks - bidirectional between you and your franchisees ")],-1)),t(Z,{color:"primary","prepend-icon":"tabler-plus",onClick:s[0]||(s[0]=a=>A.value=!0)},{default:l(()=>s[7]||(s[7]=[d(" Create Task ")])),_:1,__:[7]})])]),_:1})]),_:1}),t(He,{modelValue:r(i),"onUpdate:modelValue":s[1]||(s[1]=a=>w(i)?i.value=a:null),class:"mb-6"},{default:l(()=>[t(K,{value:"my-tasks"},{default:l(()=>[t(c,{icon:"tabler-user",start:""}),s[9]||(s[9]=d(" My Tasks "))]),_:1,__:[9]}),t(K,{value:"franchisee"},{default:l(()=>[t(c,{icon:"tabler-building-store",start:""}),s[10]||(s[10]=d(" Franchisee Tasks "))]),_:1,__:[10]}),t(K,{value:"all-tasks"},{default:l(()=>[t(c,{icon:"tabler-list",start:""}),s[11]||(s[11]=d(" All Tasks "))]),_:1,__:[11]})]),_:1},8,["modelValue"]),r(j)?(g(),q(Oe,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":s[2]||(s[2]=a=>j.value=null)},{default:l(()=>[d(f(r(j)),1)]),_:1})):X("",!0),r(he)?(g(),P("div",Xe,[t(Be,{indeterminate:"",size:"64",class:"mb-4"}),s[12]||(s[12]=n("h3",{class:"text-h3 mb-2"}," Loading Tasks... ",-1)),s[13]||(s[13]=n("p",{class:"text-body-1 text-medium-emphasis"}," Please wait while we fetch the task information. ",-1))])):(g(),P(Re,{key:2},[t(ee,{class:"mb-6"},{default:l(()=>[t(C,{cols:"12",md:"3"},{default:l(()=>[t(F,null,{default:l(()=>[t(z,{class:"d-flex align-center"},{default:l(()=>[t(S,{size:"44",rounded:"",color:"primary",variant:"tonal"},{default:l(()=>[t(c,{icon:"tabler-checklist",size:"26"})]),_:1}),n("div",Ze,[s[14]||(s[14]=n("div",{class:"text-body-2 text-disabled"}," Total Tasks ",-1)),n("h4",es,f(r(ye)),1)])]),_:1})]),_:1})]),_:1}),t(C,{cols:"12",md:"3"},{default:l(()=>[t(F,null,{default:l(()=>[t(z,{class:"d-flex align-center"},{default:l(()=>[t(S,{size:"44",rounded:"",color:"success",variant:"tonal"},{default:l(()=>[t(c,{icon:"tabler-check",size:"26"})]),_:1}),n("div",ss,[s[15]||(s[15]=n("div",{class:"text-body-2 text-disabled"}," Completed ",-1)),n("h4",as,f(r(ge)),1)])]),_:1})]),_:1})]),_:1}),t(C,{cols:"12",md:"3"},{default:l(()=>[t(F,null,{default:l(()=>[t(z,{class:"d-flex align-center"},{default:l(()=>[t(S,{size:"44",rounded:"",color:"warning",variant:"tonal"},{default:l(()=>[t(c,{icon:"tabler-clock",size:"26"})]),_:1}),n("div",ts,[s[16]||(s[16]=n("div",{class:"text-body-2 text-disabled"}," In Progress ",-1)),n("h4",ls,f(r(ke)),1)])]),_:1})]),_:1})]),_:1}),t(C,{cols:"12",md:"3"},{default:l(()=>[t(F,null,{default:l(()=>[t(z,{class:"d-flex align-center"},{default:l(()=>[t(S,{size:"44",rounded:"",color:"error",variant:"tonal"},{default:l(()=>[t(c,{icon:"tabler-alert-circle",size:"26"})]),_:1}),n("div",rs,[s[17]||(s[17]=n("div",{class:"text-body-2 text-disabled"}," Due ",-1)),n("h4",is,f(r(_e)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),t(F,null,{default:l(()=>[t(je,{class:"pb-4"},{default:l(()=>[t(qe,null,{default:l(()=>[d(f(r(i)==="my-tasks"?"My Tasks":r(i)==="franchisee"?"Franchisee Tasks":"All Tasks"),1)]),_:1}),t(Ke,{class:"text-body-2 text-disabled"},{default:l(()=>[d(f(r(i)==="my-tasks"?"Tasks assigned to you (including from franchisees)":r(i)==="franchisee"?"Tasks you created for franchisees":"All tasks in your franchise network"),1)]),_:1})]),_:1}),t(Ye),r(J).length>0?(g(),q(Ge,{key:0,items:r(J),headers:De,class:"text-no-wrap","item-value":"id"},{"item.taskInfo":l(({item:a})=>[n("div",null,[n("h6",ns,f(a.title),1),n("div",os,f(a.description),1),r(i)==="my-tasks"&&a.createdByRole==="franchisee"?(g(),P("div",us,[t(c,{icon:"tabler-arrow-up",size:"12"}),s[18]||(s[18]=d(" Created by franchisee "))])):X("",!0)])]),"item.unitName":l(({item:a})=>[n("div",ds,f(a.unitName),1)]),"item.priority":l(({item:a})=>[t(se,{color:Ve(a.priority),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[d(f(a.priority),1)]),_:2},1032,["color"])]),"item.status":l(({item:a})=>[t(se,{color:be(a.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[d(f(a.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:a})=>[t(Z,{icon:"",variant:"text",color:"medium-emphasis",size:"small"},{default:l(()=>[t(c,{icon:"tabler-dots-vertical"}),t(Je,{activator:"parent"},{default:l(()=>[t(Qe,null,{default:l(()=>[t(Y,{onClick:y=>we(a)},{prepend:l(()=>[t(c,{icon:"tabler-eye"})]),default:l(()=>[t(G,null,{default:l(()=>s[19]||(s[19]=[d("View")])),_:1,__:[19]})]),_:2},1032,["onClick"]),t(Y,{onClick:y=>Ce(a)},{prepend:l(()=>[t(c,{icon:"tabler-edit"})]),default:l(()=>[t(G,null,{default:l(()=>s[20]||(s[20]=[d("Edit")])),_:1,__:[20]})]),_:2},1032,["onClick"]),t(Y,{onClick:y=>Fe(a.id)},{prepend:l(()=>[t(c,{icon:"tabler-trash"})]),default:l(()=>[t(G,null,{default:l(()=>s[21]||(s[21]=[d("Delete")])),_:1,__:[21]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["items"])):(g(),q(z,{key:1,class:"py-8"},{default:l(()=>[n("div",cs,[t(c,{icon:"tabler-checklist",size:"64",class:"text-disabled mb-4"}),s[22]||(s[22]=n("h4",{class:"text-h4 mb-2"}," No Tasks Found ",-1)),n("p",fs,f(r(i)==="my-tasks"?"You have no tasks assigned to you yet.":r(i)==="franchisee"?"There are no tasks assigned to franchisees yet. Create tasks to manage operations across your franchise network.":"There are no tasks in your franchise network yet."),1)])]),_:1}))]),_:1})],64)),t(Ae,{"is-dialog-visible":r(A),"onUpdate:isDialogVisible":s[3]||(s[3]=a=>w(A)?A.value=a:null),"current-tab":"franchisee","is-franchisee":!1,onTaskCreated:xe},null,8,["is-dialog-visible"]),t(Ue,{"is-dialog-visible":r(k),"onUpdate:isDialogVisible":s[4]||(s[4]=a=>w(k)?k.value=a:null),task:r(h),"user-options":r(Te),"users-loading":r(te),onTaskUpdated:ze},null,8,["is-dialog-visible","task","user-options","users-loading"]),t(Me,{"is-dialog-visible":r(_),"onUpdate:isDialogVisible":s[5]||(s[5]=a=>w(_)?_.value=a:null),"task-id":r(M),onTaskDeleted:Ie},null,8,["is-dialog-visible","task-id"]),t(Pe,{"is-dialog-visible":r(I),"onUpdate:isDialogVisible":s[6]||(s[6]=a=>w(I)?I.value=a:null),task:r(h)},null,8,["is-dialog-visible","task"])]))}});export{Js as default};
