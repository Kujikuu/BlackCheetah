import{g as o,E as m,a_ as y,O as w}from"./main-p_64Ajbw.js";const f="countriesCacheV1",S=10080*60*1e3;function _(a=S){const e=o([]),t=o(!1),r=o(null);function l(){try{const s=localStorage.getItem(f);if(!s)return null;const{ts:n,data:g}=JSON.parse(s);return Date.now()-n>a?null:g}catch{return null}}function p(s){try{localStorage.setItem(f,JSON.stringify({ts:Date.now(),data:s}))}catch{}}async function v(){const s=l();if(s){e.value=s;return}t.value=!0,r.value=null;try{const n=await y("/v1/countries",{method:"GET"});if(n.success&&Array.isArray(n.data))e.value=n.data,p(n.data);else throw new Error("Invalid response format")}catch(n){r.value=(n==null?void 0:n.message)||"Failed to load countries",e.value=["Saudi Arabia","United States","United Kingdom","Canada","Australia","Germany","France","Italy","Spain","Japan"]}finally{t.value=!1}}return m(v),{countries:e,isLoading:t,error:r,refresh:v}}const C="saudiProvincesCacheV1",E=10080*60*1e3,i=o([]),u=o(!1),d=o(null),c=o(!1);function A(){try{const a=localStorage.getItem(C);if(!a)return null;const{ts:e,data:t}=JSON.parse(a);return Date.now()-e>E?null:t}catch{return null}}function I(a){try{localStorage.setItem(C,JSON.stringify({ts:Date.now(),data:a}))}catch{}}async function h(){if(c.value||u.value)return;const a=A();if(a){i.value=a,c.value=!0;return}u.value=!0,d.value=null;try{const e=await y("/v1/provinces",{method:"GET"});if(e.success&&Array.isArray(e.data))i.value=e.data,I(e.data),c.value=!0;else throw new Error("Invalid response format")}catch(e){d.value=(e==null?void 0:e.message)||"Failed to load provinces",i.value=[{name:"Riyadh",cities:["Riyadh"]},{name:"Makkah",cities:["Mecca","Jeddah"]},{name:"Madinah",cities:["Medina"]},{name:"Eastern Province",cities:["Dammam","Al Khobar"]}],c.value=!0}finally{u.value=!1}}function F(){return m(()=>{c.value||h()}),{provinces:w(()=>i.value.map(t=>t.name)),getCitiesForProvince:t=>{if(!t)return[];const r=i.value.find(l=>l.name===t);return(r==null?void 0:r.cities)||[]},isLoading:u,error:d,refresh:h}}export{F as a,_ as u};
