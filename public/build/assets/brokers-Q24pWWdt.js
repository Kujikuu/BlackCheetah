import{_ as Ee,V as ae}from"./VDialog-OMqAAEGv.js";import{V as Le,_ as Pe}from"./VDataTableServer-DgUCqbmN.js";import{_ as Be}from"./AppTextField.vue_vue_type_script_setup_true_lang-0faPZIAK.js";import{_ as De}from"./AppSelect.vue_vue_type_script_setup_true_lang-Bj4O7Q8N.js";import{d as $e,g as u,O as G,w as se,E as Ue,c as O,o as _,y as l,k as a,q as m,aI as x,i as s,l as n,a as P,h as N,a7 as C,av as k,t as d,F as Te,r as Fe,b7 as Ie}from"./main-BWNnj23H.js";import{_ as Ne}from"./ConfirmDeleteDialog.vue_vue_type_script_setup_true_lang-BGDpJYzd.js";import{u as B}from"./users-CpaDlCDE.js";import{a as oe}from"./formatters-aoHiJebZ.js";import{u as qe,a as ze}from"./useSaudiProvinces-Cgh7GH_2.js";import{a as Re,d as Me,f as q,b as ie,e as Oe,V as j,g as ne}from"./VCard-Ds29YdWC.js";import{V as Q,a as v}from"./VRow-CswInaof.js";import{V as H}from"./VDivider-UvFNvVgh.js";import{V as J}from"./VSpacer-BtP19Y8C.js";import{V as re}from"./VMenu-0AUhCnQP.js";import{V as de,a as z,b as R}from"./VList-BBMGPuVo.js";import{V as W}from"./VChip-DvCJp9Wa.js";import{V as je}from"./VTable-Btj0kh65.js";import{V as Qe}from"./VForm-DwjLFOlB.js";import"./VPagination-dF8V-on0.js";import"./VDataTable-09J7Hk6b.js";import"./VSelect-B_B1jWF9.js";import"./VTextField-DkMdNLCa.js";import"./VField-Cl6ebA9i.js";import"./form-BflAq2YC.js";import"./VInput-BQnO7MBM.js";import"./VCheckboxBtn-4jdsQFwS.js";import"./VSelectionControl-Box3LWk_.js";import"./api-router-BuTofTy9.js";/* empty css              */import"./VSlideGroup-BWKNT972.js";const We={class:"me-3 d-flex gap-3"},Ge={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},He={style:{"inline-size":"15.625rem"}},Je={class:"d-flex align-center gap-x-4"},Ke={key:1},Xe={class:"d-flex flex-column"},Ye={class:"text-base font-weight-medium"},Ze={class:"text-body-1"},et={class:"text-body-1"},tt={class:"text-body-1 font-weight-medium"},lt={class:"d-flex align-center gap-4 mb-6"},at={class:"text-h4"},st={class:"text-h4 mb-1"},ot={class:"mb-4"},it={class:"text-body-1"},nt={class:"mb-4"},rt={class:"text-body-1"},dt={class:"mb-4"},ut={class:"text-body-1"},ct={class:"mb-4"},mt={class:"text-body-1"},vt={class:"mb-4"},pt={class:"text-body-1"},ft={class:"mb-4"},yt={class:"text-body-1"},Ht=$e({__name:"brokers",setup(_t){const D=u(""),$=u(),w=u(10),g=u(1),K=u(),X=u(),c=u([]),M=u(!1),b=u(!1);u(!1);const U=u(),ue=i=>{var e,r;K.value=(e=i.sortBy[0])==null?void 0:e.key,X.value=(r=i.sortBy[0])==null?void 0:r.order,T()},ce=[{title:"Broker",key:"name"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Status",key:"status"},{title:"Assigned Leads",key:"assignedLeads"},{title:"Actions",key:"actions",sortable:!1}],V=u({associates:[],total:0}),h=G(()=>V.value.associates),Y=G(()=>V.value.total),me=i=>({new:"primary",contacted:"info",qualified:"warning",converted:"success",lost:"error",follow_up:"secondary"})[i]||"default",ve=i=>({low:"success",medium:"warning",high:"error"})[i]||"default",T=async()=>{try{M.value=!0;const i=await B.getBrokersWithFilters({page:g.value,per_page:w.value,search:D.value||void 0,status:$.value||void 0,sort_by:K.value||void 0,order_by:X.value||void 0});if(i.success&&i.data){const e=i.data;V.value={associates:e.data||[],total:e.total||0}}else V.value={associates:[],total:0}}catch(i){console.error("Error fetching brokers:",i),V.value={associates:[],total:0}}finally{M.value=!1}},Z=[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],{countries:pe,isLoading:fe}=qe(),{provinces:ye,getCitiesForProvince:_e,isLoading:ge}=ze(),ee=i=>{const e=i.toLowerCase();return e==="active"?"success":e==="inactive"?"secondary":"primary"},F=u(!1),A=u(null),be=i=>{A.value=i,F.value=!0},Ve=async()=>{if(A.value!==null)try{if(b.value=!0,(await B.deleteBroker(A.value)).success){const e=V.value.associates.findIndex(f=>f.id===A.value);e!==-1&&(V.value.associates.splice(e,1),V.value.total-=1);const r=c.value.findIndex(f=>f===A.value);r!==-1&&c.value.splice(r,1),console.log("Sales associate deleted successfully")}}catch(i){console.error("Error deleting sales associate:",i)}finally{b.value=!1,F.value=!1,A.value=null}},S=u(!1),E=u(!1),L=u(!1),o=u(null),xe=G(()=>o.value?_e(o.value.state||""):[]);se(()=>{var i;return(i=o.value)==null?void 0:i.state},()=>{o.value&&(o.value.city="")});const Ce=async i=>{if(i===null)return;const e=h.value.find(r=>r.id===i);if(e&&e.id!==null)try{M.value=!0;const r=await B.getBrokerDetails(e.id);r.success&&(o.value=r.data,S.value=!0)}catch(r){console.error("Error fetching associate details:",r),o.value=e,S.value=!0}finally{M.value=!1}},te=i=>{if(i===null)return;const e=h.value.find(r=>r.id===i);e&&(o.value={...e},E.value=!0)},ke=()=>{o.value={id:null,name:"",email:"",phone:"",status:"active",country:"",state:"",city:"",assignedLeads:0,avatar:"",password:""},L.value=!0},le=async()=>{if(o.value){if(U.value){const{valid:i}=await U.value.validate();if(!i)return}try{b.value=!0;const i=o.value.id!==null,e={name:o.value.name,email:o.value.email,phone:o.value.phone,status:o.value.status,country:o.value.country||"",state:o.value.state||"",city:o.value.city||""};!i&&o.value.password&&(e.password=o.value.password),(i?await B.updateBroker(o.value.id,e):await B.createBroker(e)).success&&(U.value&&U.value.reset(),L.value=!1,E.value=!1,o.value={id:null,name:"",email:"",phone:"",status:"active",country:"",state:"",city:"",password:"",assignedLeads:0,avatar:"",avatarText:""},await T(),console.log(i?"Associate updated successfully":"Associate created successfully"))}catch(i){console.error("Error saving associate:",i)}finally{b.value=!1}}},we=()=>{const e=["Name,Email,Phone,Status,Country,State,City,Assigned Leads",...(c.value.length>0?h.value.filter(p=>c.value.includes(p.id)):h.value).map(p=>`"${p.name}","${p.email}","${p.phone}","${p.status}","${p.country||""}","${p.state||""}","${p.city||""}","${p.assignedLeads}"`)].join(`
`),r=new Blob([e],{type:"text/csv"}),f=window.URL.createObjectURL(r),I=document.createElement("a");I.href=f,I.download=`sales_associates_${c.value.length>0?"selected":"all"}_${new Date().toISOString().split("T")[0]}.csv`,I.click(),window.URL.revokeObjectURL(f)},he=()=>{const i=c.value.length>0?h.value.filter(e=>c.value.includes(e.id)):h.value;console.log("Exporting to PDF:",i)},Se=async()=>{if(c.value.length!==0)try{b.value=!0;for(const i of c.value)i!==null&&await B.deleteBroker(i);await T(),c.value=[],console.log("Sales associates deleted successfully")}catch(i){console.error("Error bulk deleting associates:",i)}finally{b.value=!1}},Ae=async()=>{await Ve()};return Ue(()=>{T()}),se([D,$],()=>{g.value=1,T()}),(i,e)=>{const r=De,f=Be,I=Pe,p=Ee;return _(),O("section",null,[l(j,{class:"mb-6"},{default:a(()=>[l(Re,{class:"pb-4"},{default:a(()=>[l(Me,null,{default:a(()=>e[23]||(e[23]=[m("Filters")])),_:1,__:[23]})]),_:1}),l(q,null,{default:a(()=>[l(Q,null,{default:a(()=>[l(v,{cols:"12",sm:"6"},{default:a(()=>[l(r,{modelValue:s($),"onUpdate:modelValue":e[0]||(e[0]=t=>x($)?$.value=t:null),placeholder:"Select Status",items:Z,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(H),l(q,{class:"d-flex flex-wrap gap-4"},{default:a(()=>[n("div",We,[l(r,{"model-value":s(w),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=parseInt(t,10))},null,8,["model-value"]),s(c).length>0?(_(),P(C,{key:0,variant:"tonal",color:"error",onClick:Se},{default:a(()=>[l(k,{icon:"tabler-trash",class:"me-2"}),m(" Delete Selected ("+d(s(c).length)+") ",1)]),_:1})):N("",!0)]),l(J),n("div",Ge,[n("div",He,[l(f,{modelValue:s(D),"onUpdate:modelValue":e[2]||(e[2]=t=>x(D)?D.value=t:null),placeholder:"Search Broker"},null,8,["modelValue"])]),l(C,{variant:"tonal",color:"secondary"},{default:a(()=>[l(k,{icon:"tabler-upload",class:"me-2"}),m(" Export "+d(s(c).length>0?`(${s(c).length})`:"All")+" ",1),l(re,{activator:"parent"},{default:a(()=>[l(de,null,{default:a(()=>[l(z,{onClick:we},{prepend:a(()=>[l(k,{icon:"tabler-file-type-csv"})]),default:a(()=>[l(R,null,{default:a(()=>e[24]||(e[24]=[m("Export to CSV")])),_:1,__:[24]})]),_:1}),l(z,{onClick:he},{prepend:a(()=>[l(k,{icon:"tabler-file-type-pdf"})]),default:a(()=>[l(R,null,{default:a(()=>e[25]||(e[25]=[m("Export to PDF")])),_:1,__:[25]})]),_:1})]),_:1})]),_:1})]),_:1}),l(C,{"prepend-icon":"tabler-plus",onClick:ke},{default:a(()=>e[26]||(e[26]=[m(" Add Broker ")])),_:1,__:[26]})])]),_:1}),l(H),l(Le,{"items-per-page":s(w),"onUpdate:itemsPerPage":e[4]||(e[4]=t=>x(w)?w.value=t:null),"model-value":s(c),"onUpdate:modelValue":e[5]||(e[5]=t=>x(c)?c.value=t:null),page:s(g),"onUpdate:page":e[6]||(e[6]=t=>x(g)?g.value=t:null),items:s(h),"item-value":"id","items-length":s(Y),headers:ce,class:"text-no-wrap","show-select":"","onUpdate:options":ue},{"item.name":a(({item:t})=>[n("div",Je,[l(ie,{size:"34",variant:t.avatar?void 0:"tonal",color:t.avatar?void 0:"primary"},{default:a(()=>[t.avatar?(_(),P(Oe,{key:0,src:t.avatar},null,8,["src"])):(_(),O("span",Ke,d(s(oe)(t.name)),1))]),_:2},1032,["variant","color"]),n("div",Xe,[n("h6",Ye,d(t.name),1)])])]),"item.email":a(({item:t})=>[n("div",Ze,d(t.email),1)]),"item.phone":a(({item:t})=>[n("div",et,d(t.phone),1)]),"item.status":a(({item:t})=>[l(W,{color:ee(t.status),size:"small",label:"",class:"text-capitalize"},{default:a(()=>[m(d(t.status),1)]),_:2},1032,["color"])]),"item.assignedLeads":a(({item:t})=>[n("div",tt,d(t.assignedLeads),1)]),"item.actions":a(({item:t})=>[l(C,{icon:"",variant:"text",color:"medium-emphasis"},{default:a(()=>[l(k,{icon:"tabler-dots-vertical"}),l(re,{activator:"parent"},{default:a(()=>[l(de,null,{default:a(()=>[l(z,{onClick:y=>Ce(t.id)},{prepend:a(()=>[l(k,{icon:"tabler-eye"})]),default:a(()=>[l(R,null,{default:a(()=>e[27]||(e[27]=[m("View")])),_:1,__:[27]})]),_:2},1032,["onClick"]),l(z,{onClick:y=>te(t.id)},{prepend:a(()=>[l(k,{icon:"tabler-pencil"})]),default:a(()=>[l(R,null,{default:a(()=>e[28]||(e[28]=[m("Edit")])),_:1,__:[28]})]),_:2},1032,["onClick"]),l(z,{onClick:y=>t.id!==null&&be(t.id)},{prepend:a(()=>[l(k,{icon:"tabler-trash"})]),default:a(()=>[l(R,null,{default:a(()=>e[29]||(e[29]=[m("Delete")])),_:1,__:[29]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:a(()=>[l(I,{page:s(g),"onUpdate:page":e[3]||(e[3]=t=>x(g)?g.value=t:null),"items-per-page":s(w),"total-items":s(Y)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1}),l(ae,{modelValue:s(S),"onUpdate:modelValue":e[10]||(e[10]=t=>x(S)?S.value=t:null),"max-width":"600"},{default:a(()=>[l(p,{onClick:e[7]||(e[7]=t=>S.value=!1)}),s(o)?(_(),P(j,{key:0,title:"Broker Details"},{default:a(()=>[l(q,null,{default:a(()=>[l(Q,null,{default:a(()=>[l(v,{cols:"12"},{default:a(()=>{var t;return[n("div",lt,[l(ie,{size:"80",variant:"tonal",color:"primary"},{default:a(()=>[n("span",at,d(s(oe)(s(o).name)),1)]),_:1}),n("div",null,[n("h4",st,d(s(o).name),1),l(W,{color:ee(((t=s(o))==null?void 0:t.status)||""),size:"small",label:"",class:"text-capitalize"},{default:a(()=>[m(d(s(o).status),1)]),_:1},8,["color"])])])]}),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[n("div",ot,[e[30]||(e[30]=n("div",{class:"text-sm text-disabled mb-1"}," Email ",-1)),n("div",it,d(s(o).email),1)])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[n("div",nt,[e[31]||(e[31]=n("div",{class:"text-sm text-disabled mb-1"}," Phone ",-1)),n("div",rt,d(s(o).phone),1)])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[n("div",dt,[e[32]||(e[32]=n("div",{class:"text-sm text-disabled mb-1"}," Country ",-1)),n("div",ut,d(s(o).country||"Not specified"),1)])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[n("div",ct,[e[33]||(e[33]=n("div",{class:"text-sm text-disabled mb-1"}," State ",-1)),n("div",mt,d(s(o).state||"Not specified"),1)])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[n("div",vt,[e[34]||(e[34]=n("div",{class:"text-sm text-disabled mb-1"}," City ",-1)),n("div",pt,d(s(o).city||"Not specified"),1)])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[n("div",ft,[e[35]||(e[35]=n("div",{class:"text-sm text-disabled mb-1"}," Assigned Leads ",-1)),n("div",yt,d(s(o).assignedLeads),1)])]),_:1})]),_:1}),s(o).leads&&s(o).leads.length>0?(_(),P(Q,{key:0},{default:a(()=>[l(v,{cols:"12"},{default:a(()=>[l(H,{class:"my-4"}),e[37]||(e[37]=n("div",{class:"text-h6 mb-4"}," Assigned Leads ",-1)),l(j,{variant:"outlined"},{default:a(()=>[l(q,{class:"pa-0"},{default:a(()=>[l(je,null,{default:a(()=>{var t;return[e[36]||(e[36]=n("thead",null,[n("tr",null,[n("th",null,"Name"),n("th",null,"Email"),n("th",null,"Status"),n("th",null,"Priority")])],-1)),n("tbody",null,[(_(!0),O(Te,null,Fe(((t=s(o))==null?void 0:t.leads)||[],y=>(_(),O("tr",{key:y.id},[n("td",null,d(y.first_name)+" "+d(y.last_name),1),n("td",null,d(y.email),1),n("td",null,[l(W,{color:me(y.status),size:"small",class:"text-capitalize"},{default:a(()=>[m(d(y.status.replace("_"," ")),1)]),_:2},1032,["color"])]),n("td",null,[l(W,{color:ve(y.priority),size:"small",class:"text-capitalize"},{default:a(()=>[m(d(y.priority),1)]),_:2},1032,["color"])])]))),128))])]}),_:1,__:[36]})]),_:1})]),_:1})]),_:1,__:[37]})]),_:1})):N("",!0)]),_:1}),l(ne,null,{default:a(()=>[l(J),l(C,{color:"secondary",variant:"tonal",onClick:e[8]||(e[8]=t=>S.value=!1)},{default:a(()=>e[38]||(e[38]=[m(" Close ")])),_:1,__:[38]}),l(C,{color:"primary",onClick:e[9]||(e[9]=t=>te(s(o).id))},{default:a(()=>e[39]||(e[39]=[m(" Edit ")])),_:1,__:[39]})]),_:1})]),_:1})):N("",!0)]),_:1},8,["modelValue"]),l(ae,{"model-value":s(L)||s(E),"max-width":"600",persistent:"","onUpdate:modelValue":e[21]||(e[21]=t=>{t||(L.value=!1,E.value=!1)})},{default:a(()=>[l(p,{onClick:e[11]||(e[11]=t=>{L.value=!1,E.value=!1})}),s(o)?(_(),P(j,{key:0,title:s(o).id===null?"Add New Broker":"Edit Broker"},{default:a(()=>[l(q,null,{default:a(()=>[l(Qe,{ref_key:"associateForm",ref:U,onSubmit:Ie(le,["prevent"])},{default:a(()=>[l(Q,null,{default:a(()=>[l(v,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:s(o).name,"onUpdate:modelValue":e[12]||(e[12]=t=>s(o).name=t),label:"Full Name",placeholder:"Enter full name",rules:[t=>!!t||"Full name is required",t=>t.length<=255||"Name must not exceed 255 characters"],required:""},null,8,["modelValue","rules"])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:s(o).email,"onUpdate:modelValue":e[13]||(e[13]=t=>s(o).email=t),label:"Email Address",type:"email",placeholder:"Enter email address",rules:[t=>!!t||"Email is required",t=>/.+@.+\..+/.test(t)||"Email must be valid"],required:""},null,8,["modelValue","rules"])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:s(o).phone,"onUpdate:modelValue":e[14]||(e[14]=t=>s(o).phone=t),label:"Phone Number",placeholder:"+966 50 123 4567",rules:[t=>!!t||"Phone number is required",t=>t.length<=20||"Phone number must not exceed 20 characters"],required:""},null,8,["modelValue","rules"])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[l(r,{modelValue:s(o).status,"onUpdate:modelValue":e[15]||(e[15]=t=>s(o).status=t),label:"Status",items:Z,placeholder:"Select status",rules:[t=>!!t||"Status is required"],required:""},null,8,["modelValue","rules"])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[l(r,{modelValue:s(o).country,"onUpdate:modelValue":e[16]||(e[16]=t=>s(o).country=t),label:"Country",items:s(pe),loading:s(fe),placeholder:"Select country",clearable:""},null,8,["modelValue","items","loading"])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[l(r,{modelValue:s(o).state,"onUpdate:modelValue":e[17]||(e[17]=t=>s(o).state=t),label:"Province",placeholder:"Select Province",items:s(ye),loading:s(ge),rules:[t=>!t||t.length<=100||"Province must not exceed 100 characters"],clearable:""},null,8,["modelValue","items","loading","rules"])]),_:1}),l(v,{cols:"12",md:"6"},{default:a(()=>[l(r,{modelValue:s(o).city,"onUpdate:modelValue":e[18]||(e[18]=t=>s(o).city=t),label:"City",placeholder:"Select City",items:s(xe),disabled:!s(o).state,rules:[t=>!t||t.length<=100||"City must not exceed 100 characters"],clearable:""},null,8,["modelValue","items","disabled","rules"])]),_:1}),s(o).id===null?(_(),P(v,{key:0,cols:"12",md:"6"},{default:a(()=>[l(f,{modelValue:s(o).password,"onUpdate:modelValue":e[19]||(e[19]=t=>s(o).password=t),label:"Password",type:"password",placeholder:"Enter password (minimum 8 characters)",rules:[t=>!!t||"Password is required",t=>t.length>=8||"Password must be at least 8 characters"],required:""},null,8,["modelValue","rules"])]),_:1})):N("",!0)]),_:1})]),_:1},512)]),_:1}),l(ne,null,{default:a(()=>[l(J),l(C,{color:"secondary",variant:"tonal",disabled:s(b),onClick:e[20]||(e[20]=t=>{L.value=!1,E.value=!1})},{default:a(()=>e[40]||(e[40]=[m(" Cancel ")])),_:1,__:[40]},8,["disabled"]),l(C,{color:"primary",loading:s(b),onClick:le},{default:a(()=>[m(d(s(o).id===null?"Create Associate":"Save Changes"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])):N("",!0)]),_:1},8,["model-value"]),l(Ne,{"is-dialog-visible":s(F),"onUpdate:isDialogVisible":e[22]||(e[22]=t=>x(F)?F.value=t:null),title:"Confirm Delete Broker",message:"Are you sure you want to delete this broker? This action cannot be undone.",onConfirm:Ae},null,8,["is-dialog-visible"])])}}});export{Ht as default};
