var de=Object.defineProperty;var pe=(P,i,u)=>i in P?de(P,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):P[i]=u;var ae=(P,i,u)=>pe(P,typeof i!="symbol"?i+"":i,u);import{_ as ce}from"./AppSelect.vue_vue_type_script_setup_true_lang-Bxp2islL.js";import{_ as te}from"./AppTextField.vue_vue_type_script_setup_true_lang-BiafB3D_.js";import{a_ as E,d as z,g,O as le,w as me,E as se,a as A,o as w,k as l,y as e,i as a,l as p,h as q,c as $,t as N,bf as fe,a7 as T,av as Z,q as x,b7 as oe,aZ as W,F as H,r as Q,aI as L,u as ve}from"./main-CrqE58uP.js";import{u as ye,a as ge}from"./useSaudiProvinces-359s5H10.js";import{a as _,V as F}from"./VRow-CpsRAF9x.js";import{V as X,f as D,b as be,e as _e,a as Ve,d as we}from"./VCard-CZdMCf39.js";import{V as O,a as he}from"./VAlert-DS-ohESv.js";import{V as K}from"./VDivider-CI--kmsf.js";import{V as re}from"./VForm-CFw85RGO.js";import{V as xe}from"./VTable-B-UYDmW2.js";import{V as Y}from"./VCheckbox-DSW4XjM-.js";import{a as Pe,V as ke}from"./VTabs-DHC3EQNT.js";import{a as J,V as Ce}from"./VWindowItem-Bkp00TYr.js";import"./form-B3cvC5mg.js";import"./VSelect-Di3OJX7Y.js";import"./VTextField-D8j7WlPL.js";import"./VField-B7JFJ89s.js";import"./VInput-DSx6x9Bd.js";import"./VList-lIvAURjR.js";import"./VMenu-DgtDpKbJ.js";import"./VCheckboxBtn-CG-S7hsL.js";import"./VSelectionControl-DN2C_DWa.js";import"./VChip-DAJCEXh0.js";import"./VSlideGroup-0oZ-DmCO.js";const Ue="/v1/account";class Ae{constructor(){ae(this,"baseUrl",Ue)}async getProfile(){return await E(`${this.baseUrl}/profile`,{method:"GET"})}async updateProfile(i){return await E(`${this.baseUrl}/profile`,{method:"PUT",body:i})}async updatePassword(i){return await E(`${this.baseUrl}/password`,{method:"PUT",body:i})}async uploadAvatar(i){const u=new FormData;return u.append("avatar",i),await E(`${this.baseUrl}/avatar`,{method:"POST",body:u})}async deleteAvatar(){return await E(`${this.baseUrl}/avatar`,{method:"DELETE"})}async updateNotificationPreferences(i){return await E(`${this.baseUrl}/notifications`,{method:"PUT",body:{notifications:i}})}}const I=new Ae,Ne={class:"d-flex align-center"},Se={class:"position-relative me-6"},Te={key:1,class:"text-5xl font-weight-medium"},Ie={key:0,class:"position-absolute top-0 start-0 w-100 h-100 d-flex align-center justify-center",style:{background:"rgba(0,0,0,0.5)","border-radius":"8px"}},$e={class:"d-flex flex-column justify-center gap-4"},Ee={class:"d-flex flex-wrap gap-2"},Fe=z({__name:"AccountSettingsAccount",setup(P){const i=g(),u=g(!1),b=g(!1),v=g(!1),o=g(null),t=g({avatarImg:"",name:"",email:"",phone:"",dateOfBirth:"",gender:"",nationality:"",state:"",city:"",address:""}),n=g({type:null,message:""}),{countries:r,isLoading:m}=ye(),{provinces:h,getCitiesForProvince:C,isLoading:j}=ge(),B=le(()=>C(t.value.state||""));me(()=>t.value.state,(c,s)=>{if(s!==void 0&&s!==c){const y=C(c||""),k=t.value.city;k&&!y.includes(k)&&(t.value.city="")}});const d=[{title:"Male",value:"male"},{title:"Female",value:"female"},{title:"Other",value:"other"}],U=async()=>{try{u.value=!0;const c=await I.getProfile();c.success&&(o.value=c.data,t.value={avatarImg:c.data.avatar||"",name:c.data.name,email:c.data.email,phone:c.data.phone||"",dateOfBirth:c.data.date_of_birth||"",gender:c.data.gender||"",nationality:c.data.nationality||"",state:c.data.state||"",city:c.data.city||"",address:c.data.address||""})}catch(c){console.error("Error loading profile:",c)}finally{u.value=!1}},V=()=>{o.value&&(t.value={avatarImg:o.value.avatar||"",name:o.value.name,email:o.value.email,phone:o.value.phone||"",dateOfBirth:o.value.date_of_birth||"",gender:o.value.gender||"",nationality:o.value.nationality||"",state:o.value.state||"",city:o.value.city||"",address:o.value.address||""})},ne=async c=>{var y,k,f;const{files:s}=c.target;if(s&&s.length){const S=s[0];if(S.size>800*1024){n.value={type:"error",message:"File size must be less than 800KB"},setTimeout(()=>n.value={type:null,message:""},5e3);return}if(!["image/jpeg","image/png","image/jpg","image/gif"].includes(S.type)){n.value={type:"error",message:"Only JPG, PNG, and GIF files are allowed"},setTimeout(()=>n.value={type:null,message:""},5e3);return}try{const R=new FileReader;R.onload=M=>{var ee;t.value.avatarImg=(ee=M.target)==null?void 0:ee.result},R.readAsDataURL(S),v.value=!0,n.value={type:null,message:"Uploading..."};const G=await I.uploadAvatar(S);if(G.success){t.value.avatarImg=G.data.avatar,o.value&&(o.value.avatar=G.data.avatar);const M=W("userData");M.value&&(M.value={...M.value,avatar:G.data.avatar}),n.value={type:"success",message:"Avatar uploaded successfully!"},setTimeout(()=>n.value={type:null,message:""},3e3)}}catch(R){console.error("Error uploading avatar:",R),n.value={type:"error",message:((k=(y=R.response)==null?void 0:y.data)==null?void 0:k.message)||"Failed to upload avatar"},(f=o.value)!=null&&f.avatar&&(t.value.avatarImg=o.value.avatar),setTimeout(()=>n.value={type:null,message:""},5e3)}finally{v.value=!1}}},ie=async()=>{var c,s;try{v.value=!0,n.value={type:null,message:"Removing avatar..."},await I.deleteAvatar(),t.value.avatarImg="",o.value&&(o.value.avatar=null);const y=W("userData");y.value&&(y.value={...y.value,avatar:null}),n.value={type:"success",message:"Avatar removed successfully!"},setTimeout(()=>n.value={type:null,message:""},3e3)}catch(y){console.error("Error deleting avatar:",y),n.value={type:"error",message:((s=(c=y.response)==null?void 0:c.data)==null?void 0:s.message)||"Failed to remove avatar"},setTimeout(()=>n.value={type:null,message:""},5e3)}finally{v.value=!1}},ue=async()=>{try{b.value=!0;const c={name:t.value.name,phone:t.value.phone||null,date_of_birth:t.value.dateOfBirth||null,gender:t.value.gender||null,nationality:t.value.nationality||null,state:t.value.state||null,city:t.value.city||null,address:t.value.address||null},s=await I.updateProfile(c);if(s.success){o.value=s.data,t.value={...t.value,name:s.data.name,phone:s.data.phone||"",dateOfBirth:s.data.date_of_birth||"",gender:s.data.gender||"",nationality:s.data.nationality||"",state:s.data.state||"",city:s.data.city||"",address:s.data.address||""};const y=W("userData");y.value&&(y.value={...y.value,name:s.data.name,fullName:s.data.name})}}catch(c){console.error("Error updating profile:",c)}finally{b.value=!1}};return se(()=>{U()}),(c,s)=>{const y=te,k=ce;return w(),A(F,null,{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(X,{title:"Profile Details",loading:a(u)},{default:l(()=>[e(D,{class:"d-flex flex-column gap-4"},{default:l(()=>[p("div",Ne,[p("div",Se,[e(be,{rounded:"",size:"100"},{default:l(()=>[a(t).avatarImg?(w(),A(_e,{key:0,src:a(t).avatarImg},null,8,["src"])):(w(),$("span",Te,N(a(t).name.charAt(0).toUpperCase()),1))]),_:1}),a(v)?(w(),$("div",Ie,[e(fe,{indeterminate:"",color:"white",size:"32"})])):q("",!0)]),p("div",$e,[p("div",Ee,[e(T,{color:"primary",loading:a(v),disabled:a(u)||a(v),onClick:s[0]||(s[0]=f=>{var S;return(S=a(i))==null?void 0:S.click()})},{default:l(()=>[e(Z,{icon:"tabler-cloud-upload",class:"d-sm-none"}),s[11]||(s[11]=p("span",{class:"d-none d-sm-block"},"Upload new photo",-1))]),_:1,__:[11]},8,["loading","disabled"]),p("input",{ref_key:"refInputEl",ref:i,type:"file",name:"file",accept:".jpeg,.png,.jpg,.gif",hidden:"",onInput:ne},null,544),e(T,{type:"reset",color:"secondary",variant:"outlined",loading:a(v),disabled:a(u)||a(v)||!a(t).avatarImg,onClick:ie},{default:l(()=>s[12]||(s[12]=[x(" Reset ")])),_:1,__:[12]},8,["loading","disabled"])]),s[13]||(s[13]=p("p",{class:"text-body-1 mb-0"}," Allowed JPG, GIF or PNG. Max size of 800K ",-1))])]),a(n).message?(w(),A(O,{key:0,type:a(n).type||"info",variant:"tonal",closable:"","onClick:close":s[1]||(s[1]=f=>n.value={type:null,message:""})},{default:l(()=>[x(N(a(n).message),1)]),_:1},8,["type"])):q("",!0)]),_:1}),e(K),e(D,null,{default:l(()=>[e(re,{class:"mt-6"},{default:l(()=>[e(F,null,{default:l(()=>[e(_,{cols:"12",md:"12"},{default:l(()=>[e(y,{modelValue:a(t).name,"onUpdate:modelValue":s[2]||(s[2]=f=>a(t).name=f),label:"Full Name",placeholder:"Name"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",md:"12"},{default:l(()=>[e(y,{modelValue:a(t).email,"onUpdate:modelValue":s[3]||(s[3]=f=>a(t).email=f),label:"Email",type:"email",placeholder:"admin@example.com",readonly:"","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",md:"6"},{default:l(()=>[e(y,{modelValue:a(t).phone,"onUpdate:modelValue":s[4]||(s[4]=f=>a(t).phone=f),label:"Phone Number",placeholder:"+966 50 123 4567"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",md:"6"},{default:l(()=>[e(y,{modelValue:a(t).dateOfBirth,"onUpdate:modelValue":s[5]||(s[5]=f=>a(t).dateOfBirth=f),label:"Date of Birth",type:"date",placeholder:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",md:"6"},{default:l(()=>[e(k,{modelValue:a(t).gender,"onUpdate:modelValue":s[6]||(s[6]=f=>a(t).gender=f),label:"Gender",items:d,placeholder:"Select Gender",clearable:""},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",md:"6"},{default:l(()=>[e(k,{modelValue:a(t).nationality,"onUpdate:modelValue":s[7]||(s[7]=f=>a(t).nationality=f),label:"Nationality",items:a(r),placeholder:"Select Nationality",clearable:"",loading:a(m)},null,8,["modelValue","items","loading"])]),_:1}),e(_,{cols:"12",md:"6"},{default:l(()=>[e(k,{modelValue:a(t).state,"onUpdate:modelValue":s[8]||(s[8]=f=>a(t).state=f),label:"Province",placeholder:"Select Province",items:a(h),loading:a(j),clearable:""},null,8,["modelValue","items","loading"])]),_:1}),e(_,{cols:"12",md:"6"},{default:l(()=>[e(k,{modelValue:a(t).city,"onUpdate:modelValue":s[9]||(s[9]=f=>a(t).city=f),label:"City",placeholder:"Select City",items:a(B),disabled:!a(t).state,clearable:""},null,8,["modelValue","items","disabled"])]),_:1}),e(_,{cols:"12",md:"12"},{default:l(()=>[e(y,{modelValue:a(t).address,"onUpdate:modelValue":s[10]||(s[10]=f=>a(t).address=f),label:"Address",placeholder:"Enter Full Address"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(T,{loading:a(b),disabled:a(u),onClick:ue},{default:l(()=>s[14]||(s[14]=[x(" Save changes ")])),_:1,__:[14]},8,["loading","disabled"]),e(T,{color:"secondary",variant:"outlined",type:"reset",disabled:a(u)||a(b),onClick:oe(V,["prevent"])},{default:l(()=>s[15]||(s[15]=[x(" Reset ")])),_:1,__:[15]},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1})}}}),De={class:"text-body-1 text-high-emphasis"},Be=z({__name:"AccountSettingsNotification",setup(P){const i=g(!1),u=g(!1),b=g(""),v=g([{key:"new_user_registration",type:"New user registration",email:!0,browser:!0,app:!0},{key:"new_technical_request",type:"New technical request",email:!0,browser:!0,app:!0},{key:"technical_request_status_change",type:"Technical request status change",email:!0,browser:!1,app:!0},{key:"new_franchisor_application",type:"New franchisor application",email:!0,browser:!0,app:!1},{key:"payment_received",type:"Payment received",email:!0,browser:!1,app:!1},{key:"system_alerts",type:"System alerts",email:!0,browser:!0,app:!0}]),o=async()=>{var n;try{i.value=!0;const r=await I.getProfile();if(r.success&&((n=r.data.preferences)!=null&&n.notifications)){const m=r.data.preferences.notifications;v.value.forEach(h=>{const C=h.key;m[C]&&(h.email=m[C].email,h.browser=m[C].browser,h.app=m[C].app)})}}catch(r){console.error("Error loading notifications:",r)}finally{i.value=!1}},t=async()=>{try{u.value=!0,b.value="";const n={};v.value.forEach(r=>{const m=r.key;n[m]={email:r.email,browser:r.browser,app:r.app}}),await I.updateNotificationPreferences(n),b.value="Notification preferences saved successfully",setTimeout(()=>{b.value=""},3e3)}catch(n){console.error("Error saving notifications:",n)}finally{u.value=!1}};return se(()=>{o()}),(n,r)=>(w(),A(F,null,{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(X,{loading:a(i)},{default:l(()=>[e(Ve,null,{default:l(()=>[e(we,null,{default:l(()=>r[1]||(r[1]=[x("Notification Preferences")])),_:1,__:[1]}),r[2]||(r[2]=p("p",{class:"text-body-1 mb-0"},[x(" Choose how you want to receive notifications. We need permission from your browser to show notifications. "),p("span",{class:"text-primary cursor-pointer"},"Request Permission")],-1))]),_:1,__:[2]}),a(b)?(w(),A(D,{key:0},{default:l(()=>[e(O,{variant:"tonal",color:"success",closable:"","onClick:close":r[0]||(r[0]=m=>b.value="")},{default:l(()=>[x(N(a(b)),1)]),_:1})]),_:1})):q("",!0),e(D,{class:"px-0"},{default:l(()=>[e(K),e(xe,{class:"text-no-wrap rounded"},{default:l(()=>[r[3]||(r[3]=p("thead",null,[p("tr",null,[p("th",{scope:"col"}," Type "),p("th",{scope:"col"}," EMAIL "),p("th",{scope:"col"}," BROWSER "),p("th",{scope:"col"}," APP ")])],-1)),p("tbody",null,[(w(!0),$(H,null,Q(a(v),m=>(w(),$("tr",{key:m.type},[p("td",De,N(m.type),1),p("td",null,[e(Y,{modelValue:m.email,"onUpdate:modelValue":h=>m.email=h},null,8,["modelValue","onUpdate:modelValue"])]),p("td",null,[e(Y,{modelValue:m.browser,"onUpdate:modelValue":h=>m.browser=h},null,8,["modelValue","onUpdate:modelValue"])]),p("td",null,[e(Y,{modelValue:m.app,"onUpdate:modelValue":h=>m.app=h},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1,__:[3]})]),_:1}),e(K),e(D,null,{default:l(()=>[e(T,{loading:a(u),disabled:a(i),onClick:t},{default:l(()=>r[4]||(r[4]=[x(" Save Changes ")])),_:1,__:[4]},8,["loading","disabled"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}}),Re={class:"d-flex flex-column gap-y-2"},Me={class:"text-base"},Le=z({__name:"AccountSettingsSecurity",setup(P){const i=g(!1),u=g(!1),b=g(!1),v=g(""),o=g(""),t=g(""),n=g(!1),r=g(""),m=g(""),h=["Minimum 8 characters long - the more, the better","At least one lowercase character","At least one uppercase character","At least one number, symbol, or whitespace character"],C=async()=>{var B,d;if(r.value="",m.value="",o.value!==t.value){r.value="New passwords do not match";return}if(o.value.length<8){r.value="Password must be at least 8 characters long";return}try{n.value=!0,await I.updatePassword({current_password:v.value,password:o.value,password_confirmation:t.value}),m.value="Password updated successfully",v.value="",o.value="",t.value=""}catch(U){(d=(B=U.response)==null?void 0:B.data)!=null&&d.message?r.value=U.response.data.message:r.value="Failed to update password. Please try again.",console.error("Error updating password:",U)}finally{n.value=!1}},j=()=>{v.value="",o.value="",t.value="",r.value="",m.value=""};return(B,d)=>{const U=te;return w(),A(F,null,{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(X,{title:"Change Password"},{default:l(()=>[e(D,null,{default:l(()=>[a(m)?(w(),A(O,{key:0,variant:"tonal",color:"success",class:"mb-6",closable:"","onClick:close":d[0]||(d[0]=V=>m.value="")},{default:l(()=>[x(N(a(m)),1)]),_:1})):q("",!0),a(r)?(w(),A(O,{key:1,variant:"tonal",color:"error",class:"mb-6",closable:"","onClick:close":d[1]||(d[1]=V=>r.value="")},{default:l(()=>[x(N(a(r)),1)]),_:1})):q("",!0),e(O,{variant:"tonal",color:"warning",class:"mb-6"},{default:l(()=>[e(he,{class:"mb-1"},{default:l(()=>d[8]||(d[8]=[x(" Ensure that these requirements are met ")])),_:1,__:[8]}),d[9]||(d[9]=p("span",null,"Minimum 8 characters long, uppercase & symbol",-1))]),_:1,__:[9]}),e(re,{onSubmit:oe(C,["prevent"])},{default:l(()=>[e(F,null,{default:l(()=>[e(_,{cols:"12",md:"6"},{default:l(()=>[e(U,{modelValue:a(v),"onUpdate:modelValue":d[2]||(d[2]=V=>L(v)?v.value=V:null),type:a(i)?"text":"password","append-inner-icon":a(i)?"tabler-eye-off":"tabler-eye",label:"Current Password",placeholder:"············","onClick:appendInner":d[3]||(d[3]=V=>i.value=!a(i))},null,8,["modelValue","type","append-inner-icon"])]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(_,{cols:"12",md:"6"},{default:l(()=>[e(U,{modelValue:a(o),"onUpdate:modelValue":d[4]||(d[4]=V=>L(o)?o.value=V:null),type:a(u)?"text":"password","append-inner-icon":a(u)?"tabler-eye-off":"tabler-eye",label:"New Password",placeholder:"············","onClick:appendInner":d[5]||(d[5]=V=>u.value=!a(u))},null,8,["modelValue","type","append-inner-icon"])]),_:1}),e(_,{cols:"12",md:"6"},{default:l(()=>[e(U,{modelValue:a(t),"onUpdate:modelValue":d[6]||(d[6]=V=>L(t)?t.value=V:null),type:a(b)?"text":"password","append-inner-icon":a(b)?"tabler-eye-off":"tabler-eye",label:"Confirm New Password",placeholder:"············","onClick:appendInner":d[7]||(d[7]=V=>b.value=!a(b))},null,8,["modelValue","type","append-inner-icon"])]),_:1}),e(_,{cols:"12"},{default:l(()=>[d[10]||(d[10]=p("h6",{class:"text-h6 text-medium-emphasis mb-4"}," Password Requirements: ",-1)),p("ul",Re,[(w(),$(H,null,Q(h,V=>p("li",{key:V,class:"d-flex align-center"},[p("div",null,[e(Z,{size:"8",icon:"tabler-circle",class:"me-2"}),p("span",Me,N(V),1)])])),64))])]),_:1,__:[10]}),e(_,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[e(T,{type:"submit",loading:a(n)},{default:l(()=>d[11]||(d[11]=[x(" Save changes ")])),_:1,__:[11]},8,["loading"]),e(T,{type:"reset",color:"secondary",variant:"outlined",disabled:a(n),onClick:j},{default:l(()=>d[12]||(d[12]=[x(" Reset ")])),_:1,__:[12]},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),ma=z({__name:"[tab]",setup(P){const i=ve(),u=le({get:()=>i.params.tab,set:()=>i.params.tab}),b=[{title:"Account",icon:"tabler-user",tab:"account"},{title:"Security",icon:"tabler-lock",tab:"security"},{title:"Notifications",icon:"tabler-bell",tab:"notifications"}];return(v,o)=>(w(),$("div",null,[o[2]||(o[2]=p("div",{class:"mb-6"},[p("h2",{class:"text-h2 mb-1"}," Account Settings "),p("p",{class:"text-body-1 text-medium-emphasis"}," Manage your account preferences and settings ")],-1)),e(ke,{modelValue:a(u),"onUpdate:modelValue":o[0]||(o[0]=t=>L(u)?u.value=t:null),class:"v-tabs-pill"},{default:l(()=>[(w(),$(H,null,Q(b,t=>e(Pe,{key:t.icon,value:t.tab,to:{name:"pages-account-settings-tab",params:{tab:t.tab}}},{default:l(()=>[e(Z,{size:"20",start:"",icon:t.icon},null,8,["icon"]),x(" "+N(t.title),1)]),_:2},1032,["value","to"])),64))]),_:1},8,["modelValue"]),e(Ce,{modelValue:a(u),"onUpdate:modelValue":o[1]||(o[1]=t=>L(u)?u.value=t:null),class:"mt-6 disable-tab-transition",touch:!1},{default:l(()=>[e(J,{value:"account"},{default:l(()=>[e(Fe)]),_:1}),e(J,{value:"security"},{default:l(()=>[e(Le)]),_:1}),e(J,{value:"notifications"},{default:l(()=>[e(Be)]),_:1})]),_:1},8,["modelValue"])]))}});export{ma as default};
