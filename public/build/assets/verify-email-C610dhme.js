import{d as Y,bb as q,u as H,e as I,g as f,E as G,aZ as T,aQ as Q,c as B,o as m,l as o,y as s,aR as D,i as a,k as t,G as N,t as h,h as v,a as b,q as x,bf as U,F as W,a7 as Z,av as E,s as J}from"./main-B-HpKHYF.js";import{a as K,b as O}from"./auth-v1-top-shape-gPxasD3d.js";import{V as w}from"./VNodeRenderer-QwDTt3ie.js";import{a as R}from"./auth-BkfStFTF.js";import{a as X,d as $,f as j,V as ee}from"./VCard-DzLdWoon.js";import{V as ae,a as _}from"./VRow-kz8ZjEOC.js";import{V as S}from"./VAlert-Cs3qb595.js";import{V as se}from"./VDivider-DzNjH6NQ.js";const te={class:"auth-wrapper d-flex align-center justify-center pa-4"},le={class:"position-relative my-sm-16"},oe={class:"app-logo"},ie={class:"app-logo-title"},ne={class:"text-h4 mb-1"},re={class:"mb-0"},ce={class:"d-flex align-center"},ue={class:"text-h6 mb-4"},de={class:"text-center"},Ve=Y({__name:"verify-email",setup(fe){const{smAndUp:M}=q(),P=H(),p=I(),g=f(!1),k=f(!1),d=f(null),y=f(null),r=f(!1),z=f(!1),C=f("");G(async()=>{try{const c=T("userData").value;c&&typeof c=="object"&&"email"in c&&(C.value=c.email)}catch{}const{id:l,hash:e,expires:i,signature:V}=P.query;l&&e&&i&&V?await F(Number(l),String(e),String(i),String(V)):await A()});const A=async()=>{try{const l=await R.checkVerificationStatus();l.success&&l.data&&(r.value=l.data.is_verified,r.value&&(d.value="Your email address is already verified!"))}catch{}},F=async(l,e,i,V)=>{var c;z.value=!0,g.value=!0,y.value=null,d.value=null;try{const n=await R.verifyEmail(l,e,i,V);n.success&&(r.value=!0,d.value=n.message||"Your email has been verified successfully!",setTimeout(()=>{const u=T("userData").value;if(u&&typeof u=="object"&&"role"in u)switch(u.role){case"admin":p.push("/admin/dashboard");break;case"franchisor":p.push("/franchisor");break;case"franchisee":p.push("/franchisee/dashboard/sales");break;case"broker":p.push("/brokers/lead-management");break;default:p.push("/")}else p.push("/login")},2e3))}catch(n){const u=(n==null?void 0:n.data)||((c=n==null?void 0:n.response)==null?void 0:c._data)||null;y.value=(u==null?void 0:u.message)||"Failed to verify email. The link may be invalid or expired."}finally{g.value=!1}},L=async()=>{var l;k.value=!0,y.value=null,d.value=null;try{const e=await R.sendVerificationEmail();e.success&&(d.value=e.message||"Verification email has been sent! Please check your inbox.")}catch(e){const i=(e==null?void 0:e.data)||((l=e==null?void 0:e.response)==null?void 0:l._data)||null;y.value=(i==null?void 0:i.message)||"Failed to send verification email. Please try again."}finally{k.value=!1}};return(l,e)=>{const i=Q("RouterLink");return m(),B("div",te,[o("div",le,[s(a(w),{nodes:D("div",{innerHTML:a(K)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),s(a(w),{nodes:D("div",{innerHTML:a(O)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),s(ee,{class:J(["auth-card",a(M)?"pa-6":"pa-2"]),"max-width":"600"},{default:t(()=>[s(X,{class:"justify-center"},{default:t(()=>[s($,null,{default:t(()=>[s(i,{to:"/"},{default:t(()=>[o("div",oe,[s(a(w),{nodes:a(N).app.logo},null,8,["nodes"]),o("h1",ie,h(a(N).app.title),1)])]),_:1})]),_:1})]),_:1}),s(j,null,{default:t(()=>[o("h4",ne,h(a(r)?"Email Verified! âœ…":"Verify Your Email ðŸ“§"),1),o("p",re,h(a(r)?"Your email address has been successfully verified.":"Please verify your email address to continue."),1)]),_:1}),s(j,null,{default:t(()=>[s(ae,null,{default:t(()=>[s(_,{cols:"12"},{default:t(()=>[a(g)?(m(),b(S,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:t(()=>[o("div",ce,[s(U,{indeterminate:"",size:"20",class:"me-3"}),e[0]||(e[0]=x(" Verifying your email... "))])]),_:1})):v("",!0),a(y)?(m(),b(S,{key:1,type:"error",variant:"tonal",class:"mb-4"},{default:t(()=>[x(h(a(y)),1)]),_:1})):v("",!0),a(d)?(m(),b(S,{key:2,type:a(r)?"success":"info",variant:"tonal",class:"mb-4"},{default:t(()=>[x(h(a(d)),1)]),_:1},8,["type"])):v("",!0)]),_:1}),!a(r)&&!a(g)?(m(),B(W,{key:0},[a(C)?(m(),b(_,{key:0,cols:"12"},{default:t(()=>[e[1]||(e[1]=o("p",{class:"text-body-1"}," We've sent a verification email to: ",-1)),o("p",ue,h(a(C)),1),e[2]||(e[2]=o("p",{class:"text-body-2 text-disabled"}," Please check your inbox and click the verification link. Don't forget to check your spam folder. ",-1))]),_:1,__:[1,2]})):v("",!0),s(_,{cols:"12"},{default:t(()=>[s(Z,{block:"",loading:a(k),disabled:a(k),onClick:L},{default:t(()=>[s(E,{icon:"tabler-mail",class:"me-2"}),e[3]||(e[3]=x(" Resend Verification Email "))]),_:1,__:[3]},8,["loading","disabled"])]),_:1}),s(_,{cols:"12"},{default:t(()=>[s(se)]),_:1}),s(_,{cols:"12"},{default:t(()=>[s(i,{class:"d-flex align-center justify-center",to:{name:"login"}},{default:t(()=>[s(E,{icon:"tabler-chevron-left",size:"20",class:"me-1 flip-in-rtl"}),e[4]||(e[4]=o("span",null,"Back to login",-1))]),_:1,__:[4]})]),_:1})],64)):v("",!0),a(r)?(m(),b(_,{key:1,cols:"12"},{default:t(()=>[o("p",de,[s(E,{icon:"tabler-circle-check",color:"success",size:"64"})]),e[5]||(e[5]=o("p",{class:"text-body-1 text-center"}," Redirecting you to the dashboard... ",-1))]),_:1,__:[5]})):v("",!0)]),_:1})]),_:1})]),_:1},8,["class"])])])}}});export{Ve as default};
