import{_ as R,V as X}from"./VDialog-BzrmTsGT.js";import{d as z,g as F,O as g,w as G,a as D,o as m,k as r,y as i,h as k,i as n,c as B,l as y,av as L,t as S,a7 as h,q as T}from"./main-BhQQEtPK.js";import{f as A}from"./franchise-CLiJuXtc.js";import{f as j}from"./franchisee-dashboard-BvBpw-jE.js";import{u as J}from"./useValidationRules-B8mQXoPr.js";import{u as K}from"./documentValidation-BbJOFoUx.js";import{V as H,f as Q,g as W}from"./VCard-Ba8KRL8r.js";import{V as Y}from"./VForm-jdZ3ETEx.js";import{V as Z,a as x}from"./VRow-eXEJlD_Q.js";import{V as N}from"./VTextField-DZpI-VzR.js";import{V as ee}from"./VTextarea-BUn9c_nA.js";import{V as te}from"./VSelect-ApLJyqC9.js";import{V as ae}from"./VAlert-ms9A9st5.js";import{V as le}from"./VFileInput-D8qkRCJl.js";import{V as ie}from"./VSpacer-WCr5FxLL.js";const oe={class:"d-flex align-center"},ne={class:"text-caption"},re={key:1,class:"text-caption text-disabled mt-2"},se={key:2,class:"text-caption text-disabled mt-2"},ke=z({__name:"AddDocumentDialog",props:{isDialogVisible:{type:Boolean},franchiseId:{},unitId:{},documentData:{},mode:{}},emits:["update:isDialogVisible","documentSaved","documentAdded"],setup(q,{emit:E}){const l=q,_=E,C=F(),{backendErrors:p,setBackendErrors:M,clearError:f}=J(),v=K(),b=F(!1),e=F({id:null,name:"",title:"",description:"",file:null,file_name:null,type:"other",status:"active",is_confidential:!1,expiry_date:null}),V=g({get:()=>l.isDialogVisible,set:d=>_("update:isDialogVisible",d)}),P=[{title:"FDD",value:"fdd"},{title:"Franchise Agreement",value:"franchise_agreement"},{title:"Financial Study",value:"financial_study"},{title:"Franchise Kit",value:"franchise_kit"},{title:"Contract",value:"contract"},{title:"Agreement",value:"agreement"},{title:"Manual",value:"manual"},{title:"Certificate",value:"certificate"},{title:"Report",value:"report"},{title:"Other",value:"other"}];G(()=>[l.isDialogVisible,l.documentData],()=>{l.isDialogVisible&&(l.documentData?e.value={...l.documentData}:e.value={id:null,name:"",title:"",description:"",file:null,file_name:null,type:l.mode==="unit"?"":"other",status:"active",is_confidential:!1,expiry_date:null})},{immediate:!0});const s=g(()=>l.mode==="unit");g(()=>s.value?e.value.title:e.value.name);const U=async()=>{var c,a,I;const{valid:d}=await C.value.validate();if(!d)return;if(s.value&&!l.unitId){console.error("No unit ID available");return}if(!s.value&&!l.franchiseId){console.error("No franchise ID available");return}if(!(s.value?e.value.title:e.value.name)){console.error("Document name/title is required");return}if(!e.value.id&&!e.value.file){console.error("File is required for new documents");return}b.value=!0;try{if(s.value){const o=new FormData;o.append("title",e.value.title||""),o.append("description",e.value.description||""),o.append("type",e.value.type),o.append("status",e.value.status||"pending"),o.append("comment",""),e.value.file&&o.append("file",e.value.file);const u=await j.createDocument(l.unitId,o);u.success?(_("documentAdded",{...u.data,id:((c=u.data)==null?void 0:c.id)||Date.now(),title:e.value.title,description:e.value.description,type:e.value.type,fileName:(a=e.value.file)==null?void 0:a.name,fileSize:$(((I=e.value.file)==null?void 0:I.size)||0),uploadDate:new Date().toISOString().split("T")[0],status:e.value.status||"pending",comment:"",file:e.value.file}),V.value=!1):console.error("Failed to save document:",u.message)}else{if(!l.franchiseId){console.error("No franchise ID provided");return}const o={name:e.value.name||"",description:e.value.description||"",type:e.value.type,status:e.value.status,is_confidential:e.value.is_confidential};e.value.expiry_date&&(o.expiry_date=e.value.expiry_date),e.value.file&&(o.file=e.value.file);let u;e.value.id!==null?u=await A.updateDocument(l.franchiseId,e.value.id,o):u=await A.createDocument(l.franchiseId,o),u.success?(_("documentSaved"),V.value=!1):console.error("Failed to save document:",u.message)}}catch(o){console.error("Error saving document:",o),M(o)}finally{b.value=!1}},$=d=>{if(d===0)return"0 Bytes";const t=1024,c=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(d)/Math.log(t));return`${Number.parseFloat((d/t**a).toFixed(2))} ${c[a]}`},w=()=>{V.value=!1},O=g(()=>e.value.id!==null?"Edit Document":"Add New Document");return(d,t)=>{const c=R;return m(),D(X,{modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=a=>V.value=a),"max-width":"600"},{default:r(()=>[i(c,{onClick:w}),i(H,{title:O.value},{default:r(()=>[i(Q,null,{default:r(()=>[i(Y,{ref_key:"formRef",ref:C},{default:r(()=>[i(Z,null,{default:r(()=>[i(x,{cols:"12"},{default:r(()=>[s.value?(m(),D(N,{key:0,modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.title=a),label:"Document Title",placeholder:"Enter document title",variant:"outlined",rules:n(v).name,"error-messages":n(p).name,onInput:t[1]||(t[1]=a=>n(f)("name")),required:""},null,8,["modelValue","rules","error-messages"])):(m(),D(N,{key:1,modelValue:e.value.name,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.name=a),label:"Document Name",placeholder:"Enter document name",variant:"outlined",rules:n(v).name,"error-messages":n(p).name,onInput:t[3]||(t[3]=a=>n(f)("name")),required:""},null,8,["modelValue","rules","error-messages"]))]),_:1}),i(x,{cols:"12"},{default:r(()=>[i(ee,{modelValue:e.value.description,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.description=a),label:"Description",placeholder:"Enter document description",rows:"3",variant:"outlined",rules:n(v).description,"error-messages":n(p).description,onInput:t[5]||(t[5]=a=>n(f)("description")),required:s.value},null,8,["modelValue","rules","error-messages","required"])]),_:1}),s.value?(m(),D(x,{key:0,cols:"12"},{default:r(()=>[i(te,{modelValue:e.value.type,"onUpdate:modelValue":[t[6]||(t[6]=a=>e.value.type=a),t[7]||(t[7]=a=>n(f)("type"))],label:"Document Type",placeholder:"Select document type",items:P,variant:"outlined",rules:n(v).type,"error-messages":n(p).type,required:""},null,8,["modelValue","rules","error-messages"])]),_:1})):k("",!0),i(x,{cols:"12"},{default:r(()=>[e.value.id&&l.documentData?(m(),D(ae,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:r(()=>[y("div",oe,[i(L,{icon:"tabler-file",class:"me-2"}),y("div",null,[t[11]||(t[11]=y("div",{class:"font-weight-medium"},"Current File",-1)),y("div",ne,S(l.documentData.file_name||"Document file"),1)])])]),_:1})):k("",!0),i(le,{modelValue:e.value.file,"onUpdate:modelValue":[t[8]||(t[8]=a=>e.value.file=a),t[9]||(t[9]=a=>n(f)("file"))],label:e.value.id?"Replace File (Optional)":"Attach File",accept:s.value?".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.jpg,.jpeg,.png":".pdf,.doc,.docx","prepend-icon":"tabler-paperclip",variant:"outlined",rules:e.value.id?[]:n(v).file,"error-messages":n(p).file,required:!e.value.id},null,8,["modelValue","label","accept","rules","error-messages","required"]),s.value?(m(),B("div",re," Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, JPG, JPEG, PNG (Max 10MB) ")):e.value.id?(m(),B("div",se," Leave empty to keep the current file, or upload a new file to replace it (Max 10MB) ")):k("",!0)]),_:1})]),_:1})]),_:1},512)]),_:1}),i(W,null,{default:r(()=>[i(ie),i(h,{color:"secondary",variant:"outlined",onClick:w},{default:r(()=>t[12]||(t[12]=[T(" Cancel ")])),_:1,__:[12]}),i(h,{color:"primary",loading:b.value,onClick:U},{default:r(()=>[T(S(e.value.id!==null?"Update Document":"Add Document"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});export{ke as _};
