import{g as V,b6 as y,d as C,w,a as D,o as T,k as i,y as l,h as A,i as s,a7 as S,q as U,a_ as H}from"./main-CaTcLKNL.js";import{f as O}from"./franchise-CwZkgf9U.js";import{u as I}from"./users-cwrjjoYl.js";import{_ as E,V as F}from"./VDialog-z6AiDkdm.js";import{V as q,f as B,g as P}from"./VCard-CS_ziklW.js";import{V as _}from"./VDivider-BQAl4UcD.js";import{V as N,a as n}from"./VRow-DYWQ7lCi.js";import{V as g}from"./VTextField-CvCFH6P5.js";import{V as x}from"./VTextarea-B3zF-AXj.js";import{V as k}from"./VSelect-DxDkvyke.js";import{V as R}from"./VSpacer-gpOajNGi.js";const ae=()=>{const m=V([]),p=V([]),c=V(!1),u=V(null),a=async()=>{var e,o;try{c.value=!0,u.value=null;const t=await O.getFranchisees();t.success&&((e=t.data)!=null&&e.data)?m.value=t.data.data.map(r=>({id:r.id,name:r.name,email:r.email,role:"franchisee",status:r.status})):m.value=[]}catch(t){console.error("Failed to fetch franchisees:",t),u.value=((o=t==null?void 0:t.data)==null?void 0:o.message)||"Failed to fetch franchisees",m.value=[]}finally{c.value=!1}},f=async()=>{var e;try{c.value=!0,u.value=null;const o=await I.getBrokers();if(o.success&&o.data){const t=Array.isArray(o.data)?o.data:o.data.data||[];p.value=t.map(r=>({id:r.id,name:r.name,email:r.email,role:"broker",status:r.status}))}else p.value=[]}catch(o){console.error("Failed to fetch brokers:",o),u.value=((e=o==null?void 0:o.data)==null?void 0:e.message)||"Failed to fetch brokers",p.value=[]}finally{c.value=!1}},b=e=>(e==="franchisee"?m.value:p.value).filter(t=>t.status==="active").map(t=>({title:`${t.name} (${t.email})`,value:t.id,subtitle:t.role})),v=(e,o)=>{const r=(o==="franchisee"?m.value:p.value).find(h=>h.id===e);return r?r.name:"Unknown User"},d=async(e="both")=>{(e==="franchisee"||e==="both")&&await a(),(e==="broker"||e==="both")&&await f()};return{franchisees:y(m),brokers:y(p),loading:y(c),error:y(u),fetchFranchisees:a,fetchBrokers:f,getUsersForSelect:b,getUserNameById:v,initializeUsers:d}},$=["Onboarding","Training","Compliance","Maintenance","Marketing","Operations","Finance","Support","Other"],L=[{title:"Low",value:"low"},{title:"Medium",value:"medium"},{title:"High",value:"high"},{title:"Urgent",value:"urgent"}],M=[{title:"Pending",value:"pending"},{title:"On Hold",value:"on_hold"},{title:"Cancelled",value:"cancelled"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],te=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Assigned To",key:"assignedTo"},{title:"Unit",key:"unitName"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],le=C({__name:"EditTaskDialog",props:{isDialogVisible:{type:Boolean},task:{},userOptions:{},usersLoading:{type:Boolean,default:!1}},emits:["update:isDialogVisible","task-updated"],setup(m,{emit:p}){const c=m,u=p,a=V(null),f=V(!1);w(()=>c.task,d=>{d&&(a.value={...d})},{immediate:!0});const b=async()=>{var d;if(a.value)try{f.value=!0;const e=await H(`/v1/franchisor/tasks/${a.value.id}`,{method:"PUT",body:{title:a.value.title,description:a.value.description,category:a.value.category,priority:a.value.priority,status:a.value.status,due_date:a.value.dueDate,estimated_hours:a.value.estimatedHours,actual_hours:a.value.actualHours}});if(e.success){const o={id:e.data.id,title:e.data.title,description:e.data.description,category:e.data.type||"other",assignedTo:((d=e.data.assigned_to)==null?void 0:d.name)||a.value.assignedTo,startDate:e.data.started_at?new Date(e.data.started_at).toISOString().split("T")[0]:a.value.startDate,dueDate:e.data.due_date?new Date(e.data.due_date).toISOString().split("T")[0]:a.value.dueDate,priority:e.data.priority||a.value.priority,status:e.data.status||a.value.status,estimatedHours:e.data.estimated_hours||a.value.estimatedHours,actualHours:e.data.actual_hours||a.value.actualHours};u("task-updated",o),u("update:isDialogVisible",!1)}else console.error("Failed to update task:",e)}catch(e){console.error("Error updating task:",e)}finally{f.value=!1}},v=()=>{u("update:isDialogVisible",!1)};return(d,e)=>{const o=E;return T(),D(F,{"model-value":d.isDialogVisible,"max-width":"600",persistent:"","onUpdate:modelValue":e[10]||(e[10]=t=>u("update:isDialogVisible",t))},{default:i(()=>[l(o,{onClick:v}),l(q,{title:"Edit Task"},{default:i(()=>[l(_),s(a)?(T(),D(B,{key:0,class:"pa-6"},{default:i(()=>[l(N,null,{default:i(()=>[l(n,{cols:"12"},{default:i(()=>[l(g,{modelValue:s(a).title,"onUpdate:modelValue":e[0]||(e[0]=t=>s(a).title=t),label:"Task Title",placeholder:"Enter task title",required:""},null,8,["modelValue"])]),_:1}),l(n,{cols:"12"},{default:i(()=>[l(x,{modelValue:s(a).description,"onUpdate:modelValue":e[1]||(e[1]=t=>s(a).description=t),label:"Description",placeholder:"Enter task description",rows:"3",required:""},null,8,["modelValue"])]),_:1}),l(n,{cols:"12",md:"6"},{default:i(()=>[l(k,{modelValue:s(a).category,"onUpdate:modelValue":e[2]||(e[2]=t=>s(a).category=t),label:"Category",placeholder:"Select category",items:s($),required:""},null,8,["modelValue","items"])]),_:1}),l(n,{cols:"12",md:"6"},{default:i(()=>[l(k,{modelValue:s(a).assignedTo,"onUpdate:modelValue":e[3]||(e[3]=t=>s(a).assignedTo=t),label:"Assigned To",placeholder:"Select user",items:d.userOptions,loading:d.usersLoading,"item-title":"title","item-value":"value",required:""},null,8,["modelValue","items","loading"])]),_:1}),l(n,{cols:"12",md:"6"},{default:i(()=>[l(g,{modelValue:s(a).startDate,"onUpdate:modelValue":e[4]||(e[4]=t=>s(a).startDate=t),label:"Start Date",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(n,{cols:"12",md:"6"},{default:i(()=>[l(g,{modelValue:s(a).dueDate,"onUpdate:modelValue":e[5]||(e[5]=t=>s(a).dueDate=t),label:"Due Date",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(n,{cols:"12",md:"6"},{default:i(()=>[l(k,{modelValue:s(a).priority,"onUpdate:modelValue":e[6]||(e[6]=t=>s(a).priority=t),label:"Priority",items:s(L),required:""},null,8,["modelValue","items"])]),_:1}),l(n,{cols:"12",md:"6"},{default:i(()=>[l(k,{modelValue:s(a).status,"onUpdate:modelValue":e[7]||(e[7]=t=>s(a).status=t),label:"Status",items:s(M),required:""},null,8,["modelValue","items"])]),_:1}),l(n,{cols:"12",md:"6"},{default:i(()=>[l(g,{modelValue:s(a).estimatedHours,"onUpdate:modelValue":e[8]||(e[8]=t=>s(a).estimatedHours=t),label:"Estimated Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),l(n,{cols:"12",md:"6"},{default:i(()=>[l(g,{modelValue:s(a).actualHours,"onUpdate:modelValue":e[9]||(e[9]=t=>s(a).actualHours=t),label:"Actual Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):A("",!0),l(_),l(P,{class:"pa-6"},{default:i(()=>[l(R),l(S,{color:"secondary",variant:"tonal",onClick:v},{default:i(()=>e[11]||(e[11]=[U(" Cancel ")])),_:1,__:[11]}),l(S,{color:"primary",loading:s(f),onClick:b},{default:i(()=>e[12]||(e[12]=[U(" Save Changes ")])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{L as P,M as S,te as T,le as _,$ as a,ae as u};
