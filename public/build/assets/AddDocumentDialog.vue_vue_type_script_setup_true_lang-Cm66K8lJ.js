import{_ as B}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-CarmOyZu.js";import{d as N,g as y,O as p,w as A,a as f,o as c,k as n,y as l,h as x,c as M,a7 as _,q as h,t as q}from"./main-DTJHMfaq.js";import{f as S}from"./franchise-D_zzTmGQ.js";import{f as P}from"./franchisee-dashboard-CgqYzx__.js";import{V as U,f as E,g as O}from"./VCard-BEgq0Zx7.js";import{V as X}from"./VForm-eNmP1NWV.js";import{V as G,a as v}from"./VRow-vWSGPnzR.js";import{V as b}from"./VTextField-DW79TKGE.js";import{V as z}from"./VTextarea-Ek2NBoTJ.js";import{V as L}from"./VSelect-DcsiMjZB.js";import{V as $}from"./VFileInput-uStUNFcH.js";import{V as j}from"./VSpacer-C41_h5hf.js";import{V as J}from"./VDialog-DAi3BTyw.js";const R={key:0,class:"text-caption text-disabled mt-2"},ue=N({__name:"AddDocumentDialog",props:{isDialogVisible:{type:Boolean},franchiseId:{},unitId:{},documentData:{},mode:{}},emits:["update:isDialogVisible","documentSaved","documentAdded"],setup(C,{emit:F}){const o=C,V=F,D=y(!1),e=y({id:null,name:"",title:"",description:"",file:null,type:"other",status:"active",is_confidential:!1,expiry_date:null}),m=p({get:()=>o.isDialogVisible,set:s=>V("update:isDialogVisible",s)}),T=["FDD","Franchise Agreement","Operations Manual","Brand Guidelines","Legal Documents","Sales Report","Financial Statement","Marketing Materials","Training Materials","Quality Standards","Other"];A(()=>[o.isDialogVisible,o.documentData],()=>{o.isDialogVisible&&(o.documentData?e.value={...o.documentData}:e.value={id:null,name:"",title:"",description:"",file:null,type:o.mode==="unit"?"":"other",status:"active",is_confidential:!1,expiry_date:null})},{immediate:!0});const u=p(()=>o.mode==="unit");p(()=>u.value?e.value.title:e.value.name);const k=async()=>{var a,d,t;if(u.value&&!o.unitId){console.error("No unit ID available");return}if(!u.value&&!o.franchiseId){console.error("No franchise ID available");return}if(!(u.value?e.value.title:e.value.name)||!e.value.file){console.error("Document name/title and file are required");return}D.value=!0;try{if(u.value){const i=new FormData;i.append("title",e.value.title||""),i.append("description",e.value.description||""),i.append("type",e.value.type),i.append("status",e.value.status||"pending"),i.append("comment",""),e.value.file&&i.append("file",e.value.file);const r=await P.createDocument(o.unitId,i);r.success?(V("documentAdded",{...r.data,id:((a=r.data)==null?void 0:a.id)||Date.now(),title:e.value.title,description:e.value.description,type:e.value.type,fileName:(d=e.value.file)==null?void 0:d.name,fileSize:w(((t=e.value.file)==null?void 0:t.size)||0),uploadDate:new Date().toISOString().split("T")[0],status:e.value.status||"pending",comment:"",file:e.value.file}),m.value=!1):console.error("Failed to save document:",r.message)}else{if(!o.franchiseId){console.error("No franchise ID provided");return}const i={name:e.value.name||"",description:e.value.description||"",type:e.value.type,status:e.value.status,is_confidential:e.value.is_confidential,expiry_date:e.value.expiry_date,file:e.value.file};let r;e.value.id!==null?r=await S.updateDocument(o.franchiseId,e.value.id,i):r=await S.createDocument(o.franchiseId,i),r.success?(V("documentSaved"),m.value=!1):console.error("Failed to save document:",r.message)}}catch(i){console.error("Error saving document:",i)}finally{D.value=!1}},w=s=>{if(s===0)return"0 Bytes";const a=1024,d=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(s)/Math.log(a));return`${Number.parseFloat((s/a**t).toFixed(2))} ${d[t]}`},g=()=>{m.value=!1},I=p(()=>e.value.id!==null?"Edit Document":"Add New Document");return(s,a)=>{const d=B;return c(),f(J,{modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=t=>m.value=t),"max-width":"600"},{default:n(()=>[l(d,{onClick:g}),l(U,{title:I.value},{default:n(()=>[l(E,null,{default:n(()=>[l(X,null,{default:n(()=>[l(G,null,{default:n(()=>[l(v,{cols:"12"},{default:n(()=>[u.value?(c(),f(b,{key:0,modelValue:e.value.title,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.title=t),label:"Document Title",placeholder:"Enter document title",variant:"outlined",required:""},null,8,["modelValue"])):(c(),f(b,{key:1,modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.name=t),label:"Document Name",placeholder:"Enter document name",variant:"outlined",required:""},null,8,["modelValue"]))]),_:1}),l(v,{cols:"12"},{default:n(()=>[l(z,{modelValue:e.value.description,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.description=t),label:"Description",placeholder:"Enter document description",rows:"3",variant:"outlined",required:u.value},null,8,["modelValue","required"])]),_:1}),u.value?(c(),f(v,{key:0,cols:"12"},{default:n(()=>[l(L,{modelValue:e.value.type,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.type=t),label:"Document Type",placeholder:"Select document type",items:T,variant:"outlined",required:""},null,8,["modelValue"])]),_:1})):x("",!0),l(v,{cols:"12"},{default:n(()=>[l($,{modelValue:e.value.file,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.file=t),label:"Attach File",accept:u.value?".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.jpg,.jpeg,.png":".pdf,.doc,.docx","prepend-icon":"tabler-paperclip",variant:"outlined",required:""},null,8,["modelValue","accept"]),u.value?(c(),M("div",R," Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, JPG, JPEG, PNG ")):x("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(O,null,{default:n(()=>[l(j),l(_,{color:"secondary",variant:"outlined",onClick:g},{default:n(()=>a[6]||(a[6]=[h(" Cancel ")])),_:1,__:[6]}),l(_,{color:"primary",loading:D.value,onClick:k},{default:n(()=>[h(q(e.value.id!==null?"Update Document":"Add Document"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});export{ue as _};
