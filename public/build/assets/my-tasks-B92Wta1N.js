import{_ as Ie}from"./CreateTaskDialog.vue_vue_type_script_setup_true_lang-CEUw9Bif.js";import{_ as Ae}from"./ViewTaskDialog.vue_vue_type_script_setup_true_lang-DN2mC44j.js";import{u as Pe,T as Ee,_ as Se}from"./EditTaskDialog.vue_vue_type_script_setup_true_lang-BDnhtRH8.js";import{_ as Ue}from"./DeleteTaskDialog.vue_vue_type_script_setup_true_lang-BVky2VG_.js";import{d as Me,e as Le,g as u,O as n,w as Q,E as Ne,c as P,o as k,y as s,a as Y,h as W,k as l,l as i,a7 as X,q as d,av as c,aI as D,i as r,t as f,bf as $e,F as Be}from"./main-Ba103yhi.js";import{t as E}from"./task-D12gp56v.js";import{a as w,V as Z}from"./VRow-Dx2Trj3j.js";import{a as j,V as Re}from"./VTabs-CKqGohA4.js";import{V as He}from"./VAlert-Ggmg3-Ms.js";import{V as C,f as F,b as S,a as Oe,d as qe,h as Ye}from"./VCard-Cb8_Y0Yd.js";import{V as je}from"./VDivider-CvCrdYHK.js";import{V as Ke}from"./VDataTable-CYb37QYz.js";import{V as Ge}from"./VMenu-DuoRags1.js";import{V as Je,a as K,b as G}from"./VList-DtrVsWR5.js";import{V as ee}from"./VChip-Drkk6XCc.js";import"./VDialog-BWe1CE-k.js";import"./useValidationRules-DaXnPE7i.js";import"./tasksValidation-D1fMwE6m.js";import"./VForm-CCFDSz63.js";import"./form-BPVkQvCl.js";import"./VTextField-Czf4EICU.js";import"./VField-CJdPLUY4.js";import"./VInput-CramvUWe.js";import"./VTextarea-C0_dMK85.js";import"./VSelect-CDshdr-k.js";import"./VCheckboxBtn-B-zFmbH4.js";import"./VSelectionControl-xG2Aj-vP.js";import"./VSpacer-CJfcmjci.js";import"./franchise-BhYJGABj.js";import"./api-router-CPDBRqGb.js";import"./users-CrtR2-7R.js";import"./VWindowItem-CGfnh6W5.js";import"./VSlideGroup-Bt9Ce2JV.js";import"./VPagination-B3KXKW1b.js";import"./VTable-D5JLLm4f.js";const Qe={class:"d-flex align-center justify-space-between"},We={key:1,class:"text-center py-12"},Xe={class:"ms-4"},Ze={class:"text-h4"},et={class:"ms-4"},tt={class:"text-h4"},at={class:"ms-4"},st={class:"text-h4"},lt={class:"ms-4"},rt={class:"text-h4"},ot={class:"text-base font-weight-medium"},it={class:"text-body-2 text-disabled"},nt={key:0,class:"text-caption text-primary mt-1"},ut={class:"text-body-1"},dt={class:"text-center"},ct={class:"text-body-1 text-medium-emphasis"},Gt=Me({__name:"my-tasks",setup(ft){Le();const{getUsersForSelect:te,initializeUsers:U,loading:ae}=Pe(),o=u("my-tasks"),z=u(!1),g=u(!1),_=u(!1),h=u(null),M=u(null),m=u([]),v=u([]),p=u([]),L=u(!1),N=u(!1),$=u(!1),B=u(null),R=u(null),H=u(null),I=u(!1),O=e=>{var t,a,y,A,x;return{id:e.id,title:e.title,description:e.description,category:e.type||"other",assignedTo:((t=e.assigned_to)==null?void 0:t.name)||"Unassigned",assignedToRole:((a=e.assigned_to)==null?void 0:a.role)||null,createdBy:((y=e.created_by)==null?void 0:y.name)||"Unknown",createdByRole:((A=e.created_by)==null?void 0:A.role)||null,unitName:((x=e.unit)==null?void 0:x.unit_name)||"N/A",startDate:e.started_at?new Date(e.started_at).toISOString().split("T")[0]:null,dueDate:e.due_date?new Date(e.due_date).toISOString().split("T")[0]:null,priority:e.priority||"medium",status:e.status||"pending",estimatedHours:e.estimated_hours||0,actualHours:e.actual_hours||0,createdAt:e.created_at,updatedAt:e.updated_at}},T=async()=>{var e,t;L.value=!0,B.value=null;try{const a=await E.getFranchiseeTasks({filter:"assigned"});a.success&&((e=a.data)!=null&&e.data)?m.value=a.data.data.map(O):m.value=[]}catch(a){console.error("Failed to load my tasks:",a),B.value=((t=a==null?void 0:a.data)==null?void 0:t.message)||"Failed to load my tasks",m.value=[]}finally{L.value=!1}},b=async()=>{var e,t;N.value=!0,R.value=null;try{const a=await E.getFranchiseeTasks({filter:"created"});if(a.success&&((e=a.data)!=null&&e.data)){const y=a.data.data.filter(A=>{var x;return((x=A.assigned_to)==null?void 0:x.role)==="franchisor"});v.value=y.map(O)}else v.value=[]}catch(a){console.error("Failed to load franchisor tasks:",a),R.value=((t=a==null?void 0:a.data)==null?void 0:t.message)||"Failed to load franchisor tasks",v.value=[]}finally{N.value=!1}},V=async()=>{var e,t;$.value=!0,H.value=null;try{const a=await E.getFranchiseeTasks();a.success&&((e=a.data)!=null&&e.data)?p.value=a.data.data.map(O):p.value=[]}catch(a){console.error("Failed to load all tasks:",a),H.value=((t=a==null?void 0:a.data)==null?void 0:t.message)||"Failed to load all tasks",p.value=[]}finally{$.value=!1}},se=n(()=>m.value.length),le=n(()=>m.value.filter(e=>e.status==="completed").length),re=n(()=>m.value.filter(e=>e.status==="in_progress").length),oe=n(()=>{const e=new Date;return m.value.filter(t=>t.dueDate?new Date(t.dueDate)<=e&&t.status!=="completed":!1).length}),ie=n(()=>v.value.length),ne=n(()=>v.value.filter(e=>e.status==="completed").length),ue=n(()=>v.value.filter(e=>e.status==="in_progress").length),de=n(()=>{const e=new Date;return v.value.filter(t=>t.dueDate?new Date(t.dueDate)<=e&&t.status!=="completed":!1).length}),ce=n(()=>p.value.length),fe=n(()=>p.value.filter(e=>e.status==="completed").length),me=n(()=>p.value.filter(e=>e.status==="in_progress").length),ve=n(()=>{const e=new Date;return p.value.filter(t=>t.dueDate?new Date(t.dueDate)<=e&&t.status!=="completed":!1).length}),J=n(()=>o.value==="my-tasks"?m.value:o.value==="franchisor"?v.value:p.value),pe=n(()=>o.value==="my-tasks"?se.value:o.value==="franchisor"?ie.value:ce.value),ye=n(()=>o.value==="my-tasks"?le.value:o.value==="franchisor"?ne.value:fe.value),ke=n(()=>o.value==="my-tasks"?re.value:o.value==="franchisor"?ue.value:me.value),ge=n(()=>o.value==="my-tasks"?oe.value:o.value==="franchisor"?de.value:ve.value),_e=n(()=>o.value==="my-tasks"?L.value:o.value==="franchisor"?N.value:$.value),q=n(()=>o.value==="my-tasks"?B.value:o.value==="franchisor"?R.value:H.value),he=n(()=>te("franchisee").map(e=>({title:e.title,value:String(e.value)}))),Te=e=>e==="completed"?"success":e==="in_progress"?"warning":e==="pending"?"info":"secondary",be=e=>e==="high"?"error":e==="medium"?"warning":e==="low"?"info":"secondary",Ve=async e=>{try{const t=await E.createFranchiseeTask({title:e.title,description:e.description,category:e.category,priority:e.priority,status:e.status||"pending",due_date:e.dueDate,estimated_hours:e.estimatedHours});t.success?await Promise.all([T(),b(),V()]):console.error("Failed to create task:",t)}catch(t){console.error("Error creating task:",t)}},xe=[...Ee],De=e=>{h.value=e,z.value=!0},we=e=>{h.value={...e},g.value=!0},Ce=e=>{M.value=e,_.value=!0},Fe=async e=>{await Promise.all([T(),b(),V()]),g.value=!1,h.value=null},ze=async e=>{await Promise.all([T(),b(),V()]),_.value=!1,M.value=null};return Q(o,async e=>{e==="my-tasks"&&m.value.length===0?await T():e==="franchisor"&&v.value.length===0?await b():e==="all-tasks"&&p.value.length===0&&await V(),await U("franchisee")}),Q(g,async e=>{e&&await U("franchisee")}),Ne(async()=>{await Promise.all([T(),b(),V()]),await U("franchisee")}),(e,t)=>(k(),P("section",null,[s(Z,{class:"mb-6"},{default:l(()=>[s(w,{cols:"12"},{default:l(()=>[i("div",Qe,[t[8]||(t[8]=i("div",null,[i("h2",{class:"text-h2 mb-1"}," My Tasks "),i("p",{class:"text-body-1 text-medium-emphasis"}," Manage and track tasks - bidirectional between you and your franchisor ")],-1)),s(X,{color:"primary","prepend-icon":"tabler-plus",onClick:t[0]||(t[0]=a=>I.value=!0)},{default:l(()=>t[7]||(t[7]=[d(" Create Task ")])),_:1,__:[7]})])]),_:1})]),_:1}),s(Re,{modelValue:r(o),"onUpdate:modelValue":t[1]||(t[1]=a=>D(o)?o.value=a:null),class:"mb-6"},{default:l(()=>[s(j,{value:"my-tasks"},{default:l(()=>[s(c,{icon:"tabler-user",start:""}),t[9]||(t[9]=d(" My Tasks "))]),_:1,__:[9]}),s(j,{value:"franchisor"},{default:l(()=>[s(c,{icon:"tabler-building-community",start:""}),t[10]||(t[10]=d(" Franchisor Tasks "))]),_:1,__:[10]}),s(j,{value:"all-tasks"},{default:l(()=>[s(c,{icon:"tabler-list",start:""}),t[11]||(t[11]=d(" All Tasks "))]),_:1,__:[11]})]),_:1},8,["modelValue"]),r(q)?(k(),Y(He,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":t[2]||(t[2]=a=>q.value=null)},{default:l(()=>[d(f(r(q)),1)]),_:1})):W("",!0),r(_e)?(k(),P("div",We,[s($e,{indeterminate:"",size:"64",class:"mb-4"}),t[12]||(t[12]=i("h3",{class:"text-h3 mb-2"}," Loading Tasks... ",-1)),t[13]||(t[13]=i("p",{class:"text-body-1 text-medium-emphasis"}," Please wait while we fetch the task information. ",-1))])):(k(),P(Be,{key:2},[s(Z,{class:"mb-6"},{default:l(()=>[s(w,{cols:"12",md:"3"},{default:l(()=>[s(C,null,{default:l(()=>[s(F,{class:"d-flex align-center"},{default:l(()=>[s(S,{size:"44",rounded:"",color:"primary",variant:"tonal"},{default:l(()=>[s(c,{icon:"tabler-checklist",size:"26"})]),_:1}),i("div",Xe,[t[14]||(t[14]=i("div",{class:"text-body-2 text-disabled"}," Total Tasks ",-1)),i("h4",Ze,f(r(pe)),1)])]),_:1})]),_:1})]),_:1}),s(w,{cols:"12",md:"3"},{default:l(()=>[s(C,null,{default:l(()=>[s(F,{class:"d-flex align-center"},{default:l(()=>[s(S,{size:"44",rounded:"",color:"success",variant:"tonal"},{default:l(()=>[s(c,{icon:"tabler-check",size:"26"})]),_:1}),i("div",et,[t[15]||(t[15]=i("div",{class:"text-body-2 text-disabled"}," Completed ",-1)),i("h4",tt,f(r(ye)),1)])]),_:1})]),_:1})]),_:1}),s(w,{cols:"12",md:"3"},{default:l(()=>[s(C,null,{default:l(()=>[s(F,{class:"d-flex align-center"},{default:l(()=>[s(S,{size:"44",rounded:"",color:"warning",variant:"tonal"},{default:l(()=>[s(c,{icon:"tabler-clock",size:"26"})]),_:1}),i("div",at,[t[16]||(t[16]=i("div",{class:"text-body-2 text-disabled"}," In Progress ",-1)),i("h4",st,f(r(ke)),1)])]),_:1})]),_:1})]),_:1}),s(w,{cols:"12",md:"3"},{default:l(()=>[s(C,null,{default:l(()=>[s(F,{class:"d-flex align-center"},{default:l(()=>[s(S,{size:"44",rounded:"",color:"error",variant:"tonal"},{default:l(()=>[s(c,{icon:"tabler-alert-circle",size:"26"})]),_:1}),i("div",lt,[t[17]||(t[17]=i("div",{class:"text-body-2 text-disabled"}," Due ",-1)),i("h4",rt,f(r(ge)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),s(C,null,{default:l(()=>[s(Oe,{class:"pb-4"},{default:l(()=>[s(qe,null,{default:l(()=>[d(f(r(o)==="my-tasks"?"My Tasks":r(o)==="franchisor"?"Franchisor Tasks":"All Tasks"),1)]),_:1}),s(Ye,{class:"text-body-2 text-disabled"},{default:l(()=>[d(f(r(o)==="my-tasks"?"Tasks assigned to you (including from your franchisor)":r(o)==="franchisor"?"Tasks you created for your franchisor":"All tasks related to your unit and franchise"),1)]),_:1})]),_:1}),s(je),r(J).length>0?(k(),Y(Ke,{key:0,items:r(J),headers:xe,class:"text-no-wrap","item-value":"id"},{"item.taskInfo":l(({item:a})=>[i("div",null,[i("h6",ot,f(a.title),1),i("div",it,f(a.description),1),r(o)==="my-tasks"&&a.createdByRole==="franchisor"?(k(),P("div",nt,[s(c,{icon:"tabler-arrow-down",size:"12"}),t[18]||(t[18]=d(" Created by franchisor "))])):W("",!0)])]),"item.unitName":l(({item:a})=>[i("div",ut,f(a.unitName),1)]),"item.priority":l(({item:a})=>[s(ee,{color:be(a.priority),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[d(f(a.priority),1)]),_:2},1032,["color"])]),"item.status":l(({item:a})=>[s(ee,{color:Te(a.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[d(f(a.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:a})=>[s(X,{icon:"",variant:"text",color:"medium-emphasis",size:"small"},{default:l(()=>[s(c,{icon:"tabler-dots-vertical"}),s(Ge,{activator:"parent"},{default:l(()=>[s(Je,null,{default:l(()=>[s(K,{onClick:y=>De(a)},{prepend:l(()=>[s(c,{icon:"tabler-eye"})]),default:l(()=>[s(G,null,{default:l(()=>t[19]||(t[19]=[d("View")])),_:1,__:[19]})]),_:2},1032,["onClick"]),s(K,{onClick:y=>we(a)},{prepend:l(()=>[s(c,{icon:"tabler-edit"})]),default:l(()=>[s(G,null,{default:l(()=>t[20]||(t[20]=[d("Edit")])),_:1,__:[20]})]),_:2},1032,["onClick"]),s(K,{onClick:y=>Ce(a.id)},{prepend:l(()=>[s(c,{icon:"tabler-trash"})]),default:l(()=>[s(G,null,{default:l(()=>t[21]||(t[21]=[d("Delete")])),_:1,__:[21]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["items"])):(k(),Y(F,{key:1,class:"py-8"},{default:l(()=>[i("div",dt,[s(c,{icon:"tabler-checklist",size:"64",class:"text-disabled mb-4"}),t[22]||(t[22]=i("h4",{class:"text-h4 mb-2"}," No Tasks Found ",-1)),i("p",ct,f(r(o)==="my-tasks"?"You have no tasks assigned to you yet.":r(o)==="franchisor"?"You have not created any tasks for your franchisor yet. Create tasks to communicate needs or requests.":"There are no tasks related to your unit yet."),1)])]),_:1}))]),_:1})],64)),s(Ie,{"is-dialog-visible":r(I),"onUpdate:isDialogVisible":t[3]||(t[3]=a=>D(I)?I.value=a:null),"current-tab":"franchisee","is-franchisee":!0,onTaskCreated:Ve},null,8,["is-dialog-visible"]),s(Se,{"is-dialog-visible":r(g),"onUpdate:isDialogVisible":t[4]||(t[4]=a=>D(g)?g.value=a:null),task:r(h),"user-options":r(he),"users-loading":r(ae),onTaskUpdated:Fe},null,8,["is-dialog-visible","task","user-options","users-loading"]),s(Ue,{"is-dialog-visible":r(_),"onUpdate:isDialogVisible":t[5]||(t[5]=a=>D(_)?_.value=a:null),"task-id":r(M),onTaskDeleted:ze},null,8,["is-dialog-visible","task-id"]),s(Ae,{"is-dialog-visible":r(z),"onUpdate:isDialogVisible":t[6]||(t[6]=a=>D(z)?z.value=a:null),task:r(h)},null,8,["is-dialog-visible","task"])]))}});export{Gt as default};
