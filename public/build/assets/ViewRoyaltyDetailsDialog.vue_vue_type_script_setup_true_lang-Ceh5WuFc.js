import{_ as A,V as U}from"./VDialog-DKkWp4GN.js";import{a_ as y,d as P,g as k,O as T,w as j,a as x,o as R,k as l,y as e,b5 as N,l as s,a7 as h,q as b,h as B,t as m,av as v,i as C}from"./main-BPhS35rw.js";import{g as z}from"./api-router-DNaOhggD.js";import{V as g,f as O,h as F}from"./VCard-BzA-_fsU.js";import{V as E}from"./VForm-DfkEz1YK.js";import{V as M,a as n}from"./VRow-BBpj0UHg.js";import{V as $}from"./VTextField-DVYvDh-5.js";import{V as I}from"./VSelect-CMXFgzzc.js";import{V as q}from"./VFileInput-C4-YBSvt.js";import{V as L}from"./VSpacer-BZoddywn.js";import{f as S}from"./formatters--UtN2sCw.js";import{V as D}from"./VDivider-D5TM1l_v.js";import{V as G}from"./VChip-D4pF-Hih.js";import{V as H}from"./VTable-CjdTM1xT.js";class J{getBaseUrl(){return z("royalties")}async getRoyalties(i){return await y(this.getBaseUrl(),{params:i})}async getRoyalty(i){return await y(`${this.getBaseUrl()}/${i}`)}async getStatistics(i){return await y(`${this.getBaseUrl()}/statistics`,{params:i})}async markAsPaid(i,a){const d=new FormData;return d.append("amount_paid",(a.amount_paid||0).toString()),d.append("payment_date",a.payment_date||""),d.append("payment_method",a.payment_type||""),a.payment_reference&&d.append("payment_reference",a.payment_reference),a.notes&&d.append("notes",a.notes),a.attachment&&d.append("attachment",a.attachment),d.append("_method","PATCH"),await y(`${this.getBaseUrl()}/${i}/mark-paid`,{method:"POST",body:d,headers:{"Content-Type":void 0}})}async exportRoyalties(i){return await y(`${this.getBaseUrl()}/export`,{params:i,parseResponse:a=>a})}async createRoyalty(i){return await y(`${this.getBaseUrl()}`,{method:"POST",body:i})}async updateRoyalty(i,a){return await y(`${this.getBaseUrl()}/${i}`,{method:"PUT",body:a})}async deleteRoyalty(i){await y(`${this.getBaseUrl()}/${i}`,{method:"DELETE"})}async addAdjustment(i,a,d){return await y(`${this.getBaseUrl()}/${i}/adjustments`,{method:"POST",body:{adjustment_amount:a,adjustment_reason:d}})}async calculateLateFee(i){return await y(`${this.getBaseUrl()}/${i}/late-fee`,{method:"POST"})}}const X=new J,At=P({__name:"MarkCompletedRoyaltyDialog",props:{isDialogVisible:{type:Boolean},selectedRoyalty:{},paymentTypeOptions:{}},emits:["update:isDialogVisible","paymentSubmitted"],setup(w,{emit:i}){const a=w,d=i,p=k(!1),u=k({amount_paid:0,payment_date:"",payment_type:"",attachment:null}),f=T({get:()=>a.isDialogVisible,set:t=>d("update:isDialogVisible",t)});j(()=>a.selectedRoyalty,t=>{t&&(u.value={amount_paid:t.amount,payment_date:new Date().toISOString().split("T")[0],payment_type:"",attachment:null})},{immediate:!0});const V=async()=>{if(a.selectedRoyalty){p.value=!0;try{await X.markAsPaid(a.selectedRoyalty.id,u.value),d("paymentSubmitted"),f.value=!1,u.value={amount_paid:0,payment_date:"",payment_type:"",attachment:null}}catch(t){console.error("Error submitting payment:",t)}finally{p.value=!1}}},c=t=>{const o=t.target;o.files&&o.files[0]&&(u.value.attachment=o.files[0])};return(t,o)=>{const _=A;return R(),x(U,{modelValue:f.value,"onUpdate:modelValue":o[5]||(o[5]=r=>f.value=r),"max-width":"600"},{default:l(()=>[e(_,{onClick:o[0]||(o[0]=r=>f.value=!1)}),e(g,{title:"Mark Royalty as Completed"},{default:l(()=>[e(O,null,{default:l(()=>[e(E,{onSubmit:N(V,["prevent"])},{default:l(()=>[e(M,null,{default:l(()=>[e(n,{cols:"12",md:"6"},{default:l(()=>[e($,{modelValue:u.value.amount_paid,"onUpdate:modelValue":o[1]||(o[1]=r=>u.value.amount_paid=r),modelModifiers:{number:!0},label:"Amount Paid (SAR)",type:"number",variant:"outlined",density:"compact",rules:[r=>!!r||"Amount is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[e($,{modelValue:u.value.payment_date,"onUpdate:modelValue":o[2]||(o[2]=r=>u.value.payment_date=r),label:"Payment Date",type:"date",variant:"outlined",density:"compact",rules:[r=>!!r||"Payment date is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(I,{modelValue:u.value.payment_type,"onUpdate:modelValue":o[3]||(o[3]=r=>u.value.payment_type=r),items:a.paymentTypeOptions,"item-title":"title","item-value":"value",label:"Payment Type",variant:"outlined",density:"compact",rules:[r=>!!r||"Payment type is required"]},null,8,["modelValue","items","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(q,{label:"Attachment (Optional)",variant:"outlined",density:"compact",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:c}),o[6]||(o[6]=s("div",{class:"text-caption text-medium-emphasis mt-1"}," Supported formats: PDF, JPG, PNG, DOC, DOCX ",-1))]),_:1,__:[6]})]),_:1})]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(L),e(h,{color:"secondary",variant:"tonal",onClick:o[4]||(o[4]=r=>f.value=!1)},{default:l(()=>o[7]||(o[7]=[b(" Cancel ")])),_:1,__:[7]}),e(h,{color:"primary",loading:p.value,onClick:V},{default:l(()=>o[8]||(o[8]=[b(" Mark as Completed ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),K={class:"mb-4"},Q={class:"font-weight-medium"},W={class:"mb-4"},Y={class:"font-weight-medium"},Z={class:"mb-4"},tt={class:"font-weight-medium text-primary"},et={class:"mb-4"},at={class:"font-weight-medium"},st={class:"text-center"},lt={class:"text-h6 font-weight-bold"},ot={class:"text-center"},it={class:"text-h6 font-weight-bold"},nt={class:"text-center"},dt={class:"text-h6 font-weight-bold"},rt={class:"mb-4"},mt={class:"mb-4"},ut={class:"font-weight-medium"},yt={class:"text-end"},pt={class:"text-end"},ct={class:"text-end"},ft={class:"bg-primary-lighten-5"},_t={class:"text-end font-weight-bold text-primary"},Ut=P({__name:"ViewRoyaltyDetailsDialog",props:{isDialogVisible:{type:Boolean},viewedRoyalty:{}},emits:["update:isDialogVisible","markAsCompleted"],setup(w,{emit:i}){const a=w,d=i,p=T({get:()=>a.isDialogVisible,set:c=>d("update:isDialogVisible",c)}),u=c=>new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),f=c=>{switch(c){case"paid":return"success";case"pending":return"warning";case"overdue":return"error";default:return"default"}},V=()=>{a.viewedRoyalty&&(d("markAsCompleted",a.viewedRoyalty),p.value=!1)};return(c,t)=>{const o=A;return R(),x(U,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=_=>p.value=_),"max-width":"600"},{default:l(()=>[e(o,{onClick:t[0]||(t[0]=_=>p.value=!1)}),a.viewedRoyalty?(R(),x(g,{key:0,title:"Royalty Details"},{default:l(()=>[e(O,null,{default:l(()=>[e(M,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>t[3]||(t[3]=[s("h6",{class:"text-h6 mb-4 text-primary"}," Basic Information ",-1)])),_:1,__:[3]}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",K,[t[4]||(t[4]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Billing Period ",-1)),s("div",Q,m(a.viewedRoyalty.billing_period),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",W,[t[5]||(t[5]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Due Date ",-1)),s("div",Y,m(u(a.viewedRoyalty.due_date)),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",Z,[t[6]||(t[6]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Franchisee Name ",-1)),s("div",tt,m(a.viewedRoyalty.franchisee_name),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",et,[t[7]||(t[7]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Store Location ",-1)),s("div",at,m(a.viewedRoyalty.store_location),1)])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(D,{class:"my-4"}),t[8]||(t[8]=s("h6",{class:"text-h6 mb-4 text-primary"}," Financial Details ",-1))]),_:1,__:[8]}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(g,{variant:"tonal",color:"info",class:"pa-4"},{default:l(()=>[s("div",st,[e(v,{icon:"tabler-chart-line",size:"32",class:"mb-2"}),t[9]||(t[9]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Gross Sales ",-1)),s("div",lt,m(C(S)(a.viewedRoyalty.gross_sales||0,"SAR",!1)),1)])]),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(g,{variant:"tonal",color:"primary",class:"pa-4"},{default:l(()=>[s("div",ot,[e(v,{icon:"tabler-percentage",size:"32",class:"mb-2"}),t[10]||(t[10]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Rate ",-1)),s("div",it,m(a.viewedRoyalty.royalty_percentage)+"% ",1)])]),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(g,{variant:"tonal",color:"success",class:"pa-4"},{default:l(()=>[s("div",nt,[e(v,{icon:"tabler-coins",size:"32",class:"mb-2"}),t[11]||(t[11]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Amount ",-1)),s("div",dt,m(C(S)(a.viewedRoyalty.amount||0,"SAR",!1)),1)])]),_:1})]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(D,{class:"my-4"}),t[12]||(t[12]=s("h6",{class:"text-h6 mb-4 text-primary"}," Status Information ",-1))]),_:1,__:[12]}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",rt,[t[13]||(t[13]=s("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Payment Status ",-1)),e(G,{color:f(a.viewedRoyalty.status),size:"large",variant:"tonal",class:"text-capitalize"},{default:l(()=>[e(v,{icon:a.viewedRoyalty.status==="paid"?"tabler-check":a.viewedRoyalty.status==="pending"?"tabler-clock":"tabler-alert-triangle",class:"me-2"},null,8,["icon"]),b(" "+m(a.viewedRoyalty.status),1)]),_:1},8,["color"])])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",mt,[t[14]||(t[14]=s("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Days Until Due ",-1)),s("div",ut,m(Math.ceil((new Date(a.viewedRoyalty.due_date).getTime()-new Date().getTime())/(1e3*60*60*24)))+" days ",1)])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(D,{class:"my-4"}),t[15]||(t[15]=s("h6",{class:"text-h6 mb-4 text-primary"}," Calculation Breakdown ",-1))]),_:1,__:[15]}),e(n,{cols:"12"},{default:l(()=>[e(H,{density:"compact"},{default:l(()=>[s("tbody",null,[s("tr",null,[t[16]||(t[16]=s("td",{class:"font-weight-medium"}," Gross Sales: ",-1)),s("td",yt,m(C(S)(a.viewedRoyalty.gross_sales||0,"SAR",!1)),1)]),s("tr",null,[t[17]||(t[17]=s("td",{class:"font-weight-medium"}," Royalty Rate: ",-1)),s("td",pt,m(a.viewedRoyalty.royalty_percentage)+"% ",1)]),s("tr",null,[t[18]||(t[18]=s("td",{class:"font-weight-medium"}," Calculation: ",-1)),s("td",ct,m((a.viewedRoyalty.gross_sales||0).toLocaleString())+" × "+m(a.viewedRoyalty.royalty_percentage)+"% ",1)]),s("tr",ft,[t[19]||(t[19]=s("td",{class:"font-weight-bold text-primary"}," Total Royalty Amount: ",-1)),s("td",_t,m((a.viewedRoyalty.amount||0).toLocaleString())+" SAR ",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(F,null,{default:l(()=>[e(L),e(h,{color:"secondary",variant:"tonal",onClick:t[1]||(t[1]=_=>p.value=!1)},{default:l(()=>t[20]||(t[20]=[b(" Close ")])),_:1,__:[20]}),a.viewedRoyalty.status!=="paid"?(R(),x(h,{key:0,color:"primary",onClick:V},{default:l(()=>[e(v,{icon:"tabler-check",class:"me-2"}),t[21]||(t[21]=b(" Mark as Completed "))]),_:1,__:[21]})):B("",!0)]),_:1})]),_:1})):B("",!0)]),_:1},8,["modelValue"])}}});export{At as _,Ut as a,X as r};
