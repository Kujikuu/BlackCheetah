import{_ as A}from"./AppTextField.vue_vue_type_script_setup_true_lang-BiafB3D_.js";import{d as D,g as b,e as B,bb as L,be as N,aQ as P,c as U,o as k,l as u,y as o,aR as w,i as s,k as r,G as _,t as V,q as p,b7 as S,a as M,h as j,a7 as E,s as F,a_ as $,aZ as h}from"./main-CrqE58uP.js";import{a as z,b as H}from"./auth-v1-top-shape-gPxasD3d.js";import{V as v}from"./VNodeRenderer-Cp4LkVpV.js";import{a as I,d as q,f as x,V as G}from"./VCard-CZdMCf39.js";import{V as O}from"./VForm-CFw85RGO.js";import{V as Q,a as g}from"./VRow-CpsRAF9x.js";import{V as W}from"./VAlert-DS-ohESv.js";import{V as Y}from"./VCheckbox-DSW4XjM-.js";import"./form-B3cvC5mg.js";import"./VTextField-D8j7WlPL.js";import"./VField-B7JFJ89s.js";import"./VInput-DSx6x9Bd.js";import"./VCheckboxBtn-CG-S7hsL.js";import"./VSelectionControl-DN2C_DWa.js";const Z={class:"auth-wrapper d-flex align-center justify-center pa-4"},J={class:"position-relative my-sm-16"},K={class:"app-logo"},X={class:"app-logo-title"},ee={class:"text-h4 mb-1"},ae={class:"text-capitalize"},se={class:"d-flex align-center justify-space-between flex-wrap my-6"},Ve=D({__name:"login",setup(oe){const l=b({email:"",password:"",remember:!1}),c=b(!1),f=b(!1),i=b(null),m=B(),{smAndUp:C}=L(),{updateAbility:R}=N(),T=async()=>{var y,e;f.value=!0,i.value=null;try{const a=await $("/v1/auth/login",{method:"POST",body:{email:l.value.email,password:l.value.password,remember:l.value.remember}});if(h("accessToken").value=a.accessToken,h("userData").value=a.userData,h("userAbilityRules").value=a.userAbilityRules,R(a.userAbilityRules),a.userData.role==="franchisor"&&a.userData.franchise_id===null){m.push("/franchisor/franchise-registration");return}switch(a.userData.role){case"admin":m.push("/admin/dashboard");break;case"franchisor":m.push("/franchisor");break;case"franchisee":m.push("/franchisee/dashboard/sales");break;case"broker":m.push("/brokers/lead-management");break;default:m.push("/")}}catch(a){const t=(a==null?void 0:a.data)||((y=a==null?void 0:a.response)==null?void 0:y._data)||null;(a==null?void 0:a.status)===429||((e=a==null?void 0:a.response)==null?void 0:e.status)===429?i.value={general:(t==null?void 0:t.message)||"Too many login attempts. Your account has been temporarily locked."}:t!=null&&t.errors?i.value={email:t.errors.email,password:t.errors.password,general:t.message}:i.value={general:(t==null?void 0:t.message)||"Login failed. Please check your credentials and try again."}}finally{f.value=!1}};return(y,e)=>{const a=P("RouterLink"),t=A;return k(),U("div",Z,[u("div",J,[o(s(v),{nodes:w("div",{innerHTML:s(z)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),o(s(v),{nodes:w("div",{innerHTML:s(H)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),o(G,{class:F(["auth-card",s(C)?"pa-6":"pa-0"]),"max-width":"600"},{default:r(()=>[o(I,{class:"justify-center"},{default:r(()=>[o(q,null,{default:r(()=>[o(a,{to:"/"},{default:r(()=>[u("div",K,[o(s(v),{nodes:s(_).app.logo},null,8,["nodes"]),u("h1",X,V(s(_).app.title),1)])]),_:1})]),_:1})]),_:1}),o(x,null,{default:r(()=>[u("h4",ee,[e[4]||(e[4]=p(" Welcome to ")),u("span",ae,V(s(_).app.title),1),e[5]||(e[5]=p("!  "))]),e[6]||(e[6]=u("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1))]),_:1,__:[6]}),o(x,null,{default:r(()=>[o(O,{onSubmit:S(T,["prevent"])},{default:r(()=>[o(Q,null,{default:r(()=>[o(g,{cols:"12"},{default:r(()=>{var d;return[(d=s(i))!=null&&d.general?(k(),M(W,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:r(()=>{var n;return[p(V((n=s(i))==null?void 0:n.general),1)]}),_:1})):j("",!0)]}),_:1}),o(g,{cols:"12"},{default:r(()=>{var d;return[o(t,{modelValue:s(l).email,"onUpdate:modelValue":e[0]||(e[0]=n=>s(l).email=n),autofocus:"",label:"Email or Username",type:"email","error-messages":(d=s(i))==null?void 0:d.email,placeholder:"Email or Username"},null,8,["modelValue","error-messages"])]}),_:1}),o(g,{cols:"12"},{default:r(()=>{var d;return[o(t,{modelValue:s(l).password,"onUpdate:modelValue":e[1]||(e[1]=n=>s(l).password=n),label:"Password",placeholder:"路路路路路路路路路路路路",type:s(c)?"text":"password",autocomplete:"password","error-messages":(d=s(i))==null?void 0:d.password,"append-inner-icon":s(c)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=n=>c.value=!s(c))},null,8,["modelValue","type","error-messages","append-inner-icon"]),u("div",se,[o(Y,{modelValue:s(l).remember,"onUpdate:modelValue":e[3]||(e[3]=n=>s(l).remember=n),label:"Remember me"},null,8,["modelValue"]),o(a,{class:"text-primary",to:{name:"forgot-password"}},{default:r(()=>e[7]||(e[7]=[p(" Forgot Password? ")])),_:1,__:[7]})]),o(E,{block:"",type:"submit",loading:s(f),disabled:s(f)},{default:r(()=>e[8]||(e[8]=[p(" Login ")])),_:1,__:[8]},8,["loading","disabled"])]}),_:1}),o(g,{cols:"12",class:"text-body-1 text-center"},{default:r(()=>[e[10]||(e[10]=u("span",{class:"d-inline-block"}," New on our platform? ",-1)),o(a,{class:"text-primary ms-1 d-inline-block text-body-1",to:{name:"register"}},{default:r(()=>e[9]||(e[9]=[p(" Create an account ")])),_:1,__:[9]})]),_:1,__:[10]})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])}}});export{Ve as default};
