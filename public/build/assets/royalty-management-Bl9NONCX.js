import{_ as at}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-BvECCC8O.js";import{d as lt,g as i,O as M,w as ot,E as st,c as it,o as $,y as e,k as a,l as o,a7 as p,q as n,av as _,t as r,i as y,a as nt,h as rt}from"./main-BW7ujPgi.js";import{_ as ut,a as dt,r as T}from"./ViewRoyaltyDetailsDialog.vue_vue_type_script_setup_true_lang-B60nrHfv.js";import{f as g}from"./formatters-aoHiJebZ.js";import{a as v,V as b}from"./VRow-DOJYQ3f-.js";import{V as P}from"./VSelect-BQyjcUCB.js";import{V as x,f as V,b as B,a as mt,d as ct,h as pt}from"./VCard-Du_dUEXW.js";import{S as yt}from"./saudi-riyal-DF_LM-xK.js";import{V as vt}from"./VDivider-DiD0yh14.js";import{V as ft}from"./VDataTable-Bm9tqRvO.js";import{V as L}from"./VTooltip-WZuU2L6r.js";import{V as j}from"./VChip-Ca2pKUug.js";import{V as _t}from"./VAlert-hqpo6uxX.js";import{V as gt}from"./VDialog-CoRSGWsb.js";import"./api-router-D5QkrJkU.js";import"./useValidationRules-CiNNZzED.js";import"./VForm-BRNKvuLX.js";import"./form-x0YzGAFX.js";import"./VTextField-Br1BPWXu.js";import"./VField-Bajrcpo6.js";import"./VInput-CyTVKGU1.js";import"./VFileInput-D1sBPwxo.js";import"./VSpacer-VLAELZOw.js";import"./VTable-DMjwn7qf.js";import"./VList-Br0R7qP9.js";import"./VMenu-D6xrVprv.js";import"./VCheckboxBtn-DILMF5fr.js";import"./VSelectionControl-DxRLKyI6.js";import"./VPagination-N4YDO54B.js";import"./VSlideGroup-Dd0a3dCz.js";const bt={class:"d-flex justify-space-between align-center flex-wrap gap-4"},xt={class:"d-flex gap-3 align-center flex-wrap"},Vt={class:"d-flex align-center justify-space-between"},wt={class:"text-h4 text-success"},Ct={class:"d-flex align-center justify-space-between"},kt={class:"text-h4 text-warning"},Rt={class:"font-weight-medium"},Dt={class:"text-body-2"},St={class:"font-weight-medium text-info"},Tt={class:"font-weight-medium text-success"},At={class:"d-flex gap-2"},ht={class:"text-body-2"},re=lt({__name:"royalty-management",setup(Et){const A=i(!1),h=i(!1),u=i("all"),m=i(!1),f=i(!1),w=i(!1),C=i(null),E=i(null),c=i("csv"),O=i("all"),F=i({amount_paid:0,payment_date:"",payment_type:"",attachment:null}),U=i([]),k=i({royalty_collected_till_date:0,upcoming_royalties:0,total_royalties:0,pending_amount:0,paid_amount:0,overdue_amount:0,overdue_count:0}),I=M(()=>k.value.royalty_collected_till_date),N=M(()=>k.value.upcoming_royalties),q=[{title:"All Time",value:"all"},{title:"This Year",value:"yearly"},{title:"This Month",value:"monthly"},{title:"Today",value:"daily"}],G=[{title:"CSV",value:"csv"},{title:"Excel",value:"excel"}],H=[{title:"All Royalties",value:"all"},{title:"Paid Only",value:"paid"},{title:"Pending Only",value:"pending"},{title:"Overdue Only",value:"overdue"}],Y=[{title:"Bank Transfer",value:"bank_transfer"},{title:"Credit Card",value:"credit_card"},{title:"Mada",value:"mada"},{title:"STC Pay",value:"stc_pay"},{title:"SADAD",value:"sadad"},{title:"Check",value:"check"},{title:"Cash",value:"cash"},{title:"Online Payment",value:"online_payment"}],J=[{title:"Billing Period",key:"billing_period",sortable:!0},{title:"Due Date",key:"due_date",sortable:!0},{title:"Gross Sales (SAR)",key:"gross_sales",sortable:!0},{title:"Royalty %",key:"royalty_percentage",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],R=async()=>{try{A.value=!0;const s=await T.getRoyalties({period:u.value});U.value=s.data.data}catch(s){console.error("Error fetching royalties:",s)}finally{A.value=!1}},D=async()=>{try{h.value=!0;const s=await T.getStatistics({period:u.value});k.value=s.data}catch(s){console.error("Error fetching statistics:",s)}finally{h.value=!1}},K=()=>{m.value=!0},Q=async()=>{try{const s=await T.exportRoyalties({format:c.value,data_type:O.value,period:u.value}),t=window.URL.createObjectURL(s),d=document.createElement("a");d.href=t,d.download=`royalty-data-${u.value}-${new Date().toISOString().split("T")[0]}.${c.value==="csv"?"csv":"xlsx"}`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(t),m.value=!1}catch(s){console.error("Error exporting royalties:",s)}},W=s=>{E.value=s,w.value=!0},z=s=>{C.value=s,F.value={amount_paid:s.amount,payment_date:new Date().toISOString().split("T")[0],payment_type:"",attachment:null},f.value=!0},X=async()=>{await R(),await D(),f.value=!1,C.value=null},Z=s=>{z(s)},tt=s=>{switch(s){case"paid":return"success";case"pending":return"warning";case"overdue":return"error";default:return"default"}},et=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return ot(u,()=>{R(),D()}),st(()=>{R(),D()}),(s,t)=>{const d=at;return $(),it("section",null,[e(b,{class:"mb-6"},{default:a(()=>[e(v,{cols:"12"},{default:a(()=>[o("div",bt,[t[8]||(t[8]=o("div",null,[o("h4",{class:"text-h4 mb-1"}," Royalty Management "),o("p",{class:"text-body-1 text-medium-emphasis"}," Track and manage royalty payments from all franchise units ")],-1)),o("div",xt,[e(P,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=l=>u.value=l),items:q,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"]),e(p,{color:"primary",variant:"elevated",onClick:K},{default:a(()=>[e(_,{icon:"tabler-download",class:"me-2"}),t[7]||(t[7]=n(" Export "))]),_:1,__:[7]})])])]),_:1})]),_:1}),e(b,{class:"mb-6"},{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[e(x,null,{default:a(()=>[e(V,null,{default:a(()=>[o("div",Vt,[o("div",null,[t[9]||(t[9]=o("h6",{class:"text-h6 mb-1"}," Royalty Collected Till Date ",-1)),t[10]||(t[10]=o("div",{class:"text-body-2 text-medium-emphasis mb-3"}," Total payments received ",-1)),o("h4",wt,r(y(g)(I.value||0,"SAR",!1)),1)]),e(B,{color:"success",variant:"tonal",size:"56"},{default:a(()=>[e(y(yt),{size:28})]),_:1})])]),_:1})]),_:1})]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(x,null,{default:a(()=>[e(V,null,{default:a(()=>[o("div",Ct,[o("div",null,[t[11]||(t[11]=o("h6",{class:"text-h6 mb-1"}," Upcoming Royalties ",-1)),t[12]||(t[12]=o("div",{class:"text-body-2 text-medium-emphasis mb-3"}," Pending payments due ",-1)),o("h4",kt,r(y(g)(N.value||0,"SAR",!1)),1)]),e(B,{color:"warning",variant:"tonal",size:"56"},{default:a(()=>[e(_,{icon:"tabler-clock",size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(b,null,{default:a(()=>[e(v,{cols:"12"},{default:a(()=>[e(x,null,{default:a(()=>[e(mt,{class:"pb-4"},{default:a(()=>[e(ct,{class:"text-h6"},{default:a(()=>t[13]||(t[13]=[n(" Royalty Records ")])),_:1,__:[13]}),e(pt,{class:"text-body-2"},{default:a(()=>t[14]||(t[14]=[n(" Manage royalty payments and track collection status ")])),_:1,__:[14]})]),_:1}),e(vt),e(ft,{headers:J,items:U.value,"items-per-page":10,class:"text-no-wrap"},{"item.billing_period":a(({item:l})=>[o("div",Rt,r(l.billing_period),1)]),"item.due_date":a(({item:l})=>[o("div",Dt,r(et(l.due_date)),1)]),"item.gross_sales":a(({item:l})=>[o("div",St,r(y(g)(l.gross_sales||0,"SAR",!1)),1)]),"item.royalty_percentage":a(({item:l})=>[e(j,{size:"small",variant:"tonal",color:"primary"},{default:a(()=>[n(r(l.royalty_percentage)+"% ",1)]),_:2},1024)]),"item.amount":a(({item:l})=>[o("div",Tt,r(y(g)(l.amount||0,"SAR",!1)),1)]),"item.status":a(({item:l})=>[e(j,{color:tt(l.status),size:"small",variant:"tonal",class:"text-capitalize"},{default:a(()=>[n(r(l.status),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[o("div",At,[e(p,{icon:"",size:"small",color:"info",variant:"text",onClick:S=>W(l)},{default:a(()=>[e(_,{icon:"tabler-eye",size:"20"}),e(L,{activator:"parent",location:"top"},{default:a(()=>t[15]||(t[15]=[n(" View Details ")])),_:1,__:[15]})]),_:2},1032,["onClick"]),l.status!=="paid"?($(),nt(p,{key:0,icon:"",size:"small",color:"success",variant:"text",onClick:S=>z(l)},{default:a(()=>[e(_,{icon:"tabler-check",size:"20"}),e(L,{activator:"parent",location:"top"},{default:a(()=>t[16]||(t[16]=[n(" Mark as Completed ")])),_:1,__:[16]})]),_:2},1032,["onClick"])):rt("",!0)])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),e(gt,{modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=l=>m.value=l),"max-width":"600"},{default:a(()=>[e(d,{onClick:t[1]||(t[1]=l=>m.value=!1)}),e(x,{title:"Export Royalty Data"},{default:a(()=>[e(V,null,{default:a(()=>[e(b,null,{default:a(()=>[e(v,{cols:"12"},{default:a(()=>[e(P,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=l=>c.value=l),items:G,"item-title":"title","item-value":"value",label:"Export Format",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(_t,{type:"info",variant:"tonal",class:"mt-4"},{default:a(()=>{var l;return[o("div",ht,[t[17]||(t[17]=o("strong",null,"Current Selection:",-1)),t[18]||(t[18]=o("br",null,null,-1)),n(" Period: "+r(u.value.charAt(0).toUpperCase()+u.value.slice(1)),1),t[19]||(t[19]=o("br",null,null,-1)),n(" Data Type: "+r((l=H.find(S=>S.value===O.value))==null?void 0:l.title),1),t[20]||(t[20]=o("br",null,null,-1)),n(" Format: "+r(c.value.toUpperCase()),1)])]}),_:1})]),_:1}),e(V,{class:"d-flex align-center justify-center gap-4"},{default:a(()=>[e(p,{color:"error",variant:"outlined",onClick:t[3]||(t[3]=l=>m.value=!1)},{default:a(()=>t[21]||(t[21]=[n(" Cancel ")])),_:1,__:[21]}),e(p,{color:"primary",variant:"elevated",onClick:Q},{default:a(()=>t[22]||(t[22]=[n(" Export Data ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ut,{"is-dialog-visible":f.value,"onUpdate:isDialogVisible":t[5]||(t[5]=l=>f.value=l),"selected-royalty":C.value,"payment-type-options":Y,onPaymentSubmitted:X},null,8,["is-dialog-visible","selected-royalty"]),e(dt,{"is-dialog-visible":w.value,"onUpdate:isDialogVisible":t[6]||(t[6]=l=>w.value=l),"viewed-royalty":E.value,onMarkAsCompleted:Z},null,8,["is-dialog-visible","viewed-royalty"])])}}});export{re as default};
