import{_ as de}from"./AppTextField.vue_vue_type_script_setup_true_lang-CbF3QHBY.js";import{_ as me}from"./AppSelect.vue_vue_type_script_setup_true_lang-BNAkJb35.js";import{_ as ve,a as pe,b as fe,c as ge,d as be,e as ye,t as x}from"./TechnicalRequestsTable.vue_vue_type_script_setup_true_lang-BR1tN_sv.js";import{d as we,g as a,O as z,E as Ve,aZ as ke,w as qe,c as he,o as O,y as s,k as o,l as u,a7 as S,q as p,av as N,a as Ce,h as _e,i as xe,t as F,by as Se}from"./main-DjrYRpVy.js";import{a as D,V as M}from"./VRow-wdXljQGK.js";import{a as De,d as Ue,f as H,V as Re}from"./VCard-C2C7Fyqz.js";import{V as Q}from"./VDivider-CTQt1wKM.js";import{V as Pe}from"./VSpacer-DuE_SDAT.js";import"./form-jRq57Kt-.js";import"./VTextField-7ql3LvrM.js";import"./VField-Z2CTCHF9.js";import"./VInput-CdNQt4f8.js";import"./VSelect-CQeM3shC.js";import"./VList-u4ppXP5c.js";import"./VMenu-C2iClWBO.js";import"./VCheckboxBtn-BhC0mwzJ.js";import"./VSelectionControl-BHoh6e7P.js";import"./VChip-DvvKExJN.js";import"./VSlideGroup-D10q4egA.js";import"./AppTextarea.vue_vue_type_script_setup_true_lang-DGRpzuUr.js";import"./VTextarea-CB0xJPAy.js";import"./VDialog-DAZY-FZS.js";import"./VForm-Ciudj4Q_.js";import"./VFileInput-Fh91WoVW.js";import"./VTooltip-Cb7Kqgmg.js";import"./api-router-GltIg0kR.js";import"./VDataTableServer-DgxgTVFx.js";import"./VPagination-CI4cqEW4.js";import"./VDataTable-sTptgDxR.js";import"./VTable-Bx4Z2wDS.js";/* empty css              */const Te={class:"d-flex align-center justify-space-between"},Be={class:"me-3 d-flex gap-3"},Ee={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Ie={style:{"inline-size":"15.625rem"}},pt=we({__name:"technical-requests",setup($e){const n=a(!1),c=a({show:!1,message:"",color:"success"}),U=(t,e="success")=>{c.value={show:!0,message:t,color:e}},f=a(""),g=a(),b=a(),v=a(10),h=a(1),Z=a(),G=a(),r=a([]),C=a(!1),y=a(!1),R=a(null),_=a(!1),P=a(null),w=a(!1),d=a(null),V=a(!1),T=a(""),k=z(()=>T.value==="admin"),J=t=>{var e,i;Z.value=(e=t.sortBy[0])==null?void 0:e.key,G.value=(i=t.sortBy[0])==null?void 0:i.order},B=t=>{var i;const e=(i=t.split(".").pop())==null?void 0:i.toLowerCase();return["jpg","jpeg","png","gif","svg","webp"].includes(e||"")?"tabler-photo":["pdf"].includes(e||"")?"tabler-file-type-pdf":["doc","docx"].includes(e||"")?"tabler-file-type-doc":["xls","xlsx"].includes(e||"")?"tabler-file-type-xls":["txt","log"].includes(e||"")?"tabler-file-text":["zip","rar","7z"].includes(e||"")?"tabler-file-zip":"tabler-file"},E=t=>{const e=t.toLowerCase().replace("_","-");return e==="open"?"info":e==="in-progress"||e==="pending-info"?"warning":e==="resolved"?"success":e==="closed"?"secondary":e==="cancelled"?"error":"primary"},I=t=>{const e=t.toLowerCase();return e==="low"?{color:"info",icon:"tabler-arrow-down"}:e==="medium"?{color:"warning",icon:"tabler-minus"}:e==="high"?{color:"error",icon:"tabler-arrow-up"}:e==="urgent"?{color:"error",icon:"tabler-alert-triangle"}:{color:"primary",icon:"tabler-minus"}},$=t=>t?t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "):"",K=[{title:"Request ID",key:"requestId"},{title:"Subject",key:"subject"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Date",key:"date"},{title:"Actions",key:"actions",sortable:!1}],A=a([]),L=a(0),W=t=>{var i,q;let e=[];return t.attachments&&Array.isArray(t.attachments)&&(e=t.attachments.map((l,ce)=>({name:l.split("/").pop()||`attachment-${ce}`,size:"Unknown",url:l}))),{id:t.id,requestId:t.ticket_number,userName:((i=t.requester)==null?void 0:i.name)||"Unknown",userEmail:((q=t.requester)==null?void 0:q.email)||"",userAvatar:"",subject:t.title,description:t.description,priority:t.priority,status:t.status,date:new Date(t.created_at).toISOString().split("T")[0],category:t.category,attachments:e}},m=async()=>{try{n.value=!0;const t=await x.getTechnicalRequests({status:g.value,priority:b.value,search:f.value,per_page:v.value,page:h.value});A.value=t.data.data.map(W),L.value=t.data.total}catch(t){console.error("Error fetching technical requests:",t)}finally{n.value=!1}},X=z(()=>A.value),Y=[{title:"Open",value:"open"},{title:"In Progress",value:"in_progress"},{title:"Pending Info",value:"pending_info"},{title:"Resolved",value:"resolved"},{title:"Closed",value:"closed"},{title:"Cancelled",value:"cancelled"}],ee=[{title:"Low",value:"low"},{title:"Medium",value:"medium"},{title:"High",value:"high"},{title:"Urgent",value:"urgent"}],te=t=>{R.value=t,y.value=!0},j=t=>{P.value=t,_.value=!0,y.value=!1},le=t=>{j(t)},se=t=>{d.value=t,w.value=!0},ae=async()=>{if(d.value)try{n.value=!0,await x.deleteTechnicalRequest(d.value.id),await m();const t=r.value.findIndex(e=>e===d.value.id);t!==-1&&r.value.splice(t,1),d.value=null,w.value=!1}catch(t){console.error("Error deleting technical request:",t)}finally{n.value=!1}},oe=()=>{r.value.length!==0&&(V.value=!0)},ie=async()=>{try{n.value=!0,await x.bulkDelete(r.value),await m(),r.value=[],V.value=!1}catch(t){console.error("Error bulk deleting requests:",t)}finally{n.value=!1}},re=oe,ne=async()=>{U("Technical request created successfully!","success"),await m()},ue=async()=>{U("Technical request updated successfully!","success"),await m()};return Ve(()=>{var e;const t=ke("userData");T.value=((e=t.value)==null?void 0:e.role)||"",m()}),qe([g,b,f],()=>{m()}),(t,e)=>{const i=me,q=de;return O(),he("section",null,[s(M,{class:"mb-6"},{default:o(()=>[s(D,{cols:"12"},{default:o(()=>[u("div",Te,[e[16]||(e[16]=u("div",null,[u("h2",{class:"text-h2 mb-1"}," Technical Requests "),u("p",{class:"text-body-1 text-medium-emphasis"}," Manage and track all technical support requests ")],-1)),u("div",null,[s(S,{color:"primary",onClick:e[0]||(e[0]=l=>C.value=!0)},{default:o(()=>[s(N,{icon:"tabler-plus",class:"me-2"}),e[15]||(e[15]=p(" Submit Request "))]),_:1,__:[15]})])])]),_:1})]),_:1}),s(Re,{class:"mb-6"},{default:o(()=>[s(De,{class:"pb-4"},{default:o(()=>[s(Ue,null,{default:o(()=>e[17]||(e[17]=[p("Filters")])),_:1,__:[17]})]),_:1}),s(H,null,{default:o(()=>[s(M,null,{default:o(()=>[s(D,{cols:"12",sm:"4"},{default:o(()=>[s(i,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),placeholder:"Select Status",items:Y,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),s(D,{cols:"12",sm:"4"},{default:o(()=>[s(i,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=l=>b.value=l),placeholder:"Select Priority",items:ee,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(Q),s(H,{class:"d-flex flex-wrap gap-4"},{default:o(()=>[u("div",Be,[s(i,{"model-value":v.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[3]||(e[3]=l=>v.value=parseInt(l,10))},null,8,["model-value"]),r.value.length>0?(O(),Ce(S,{key:0,variant:"tonal",color:"error",onClick:xe(re)},{default:o(()=>[s(N,{icon:"tabler-trash",class:"me-2"}),p(" Delete Selected ("+F(r.value.length)+") ",1)]),_:1},8,["onClick"])):_e("",!0)]),s(Pe),u("div",Ee,[u("div",Ie,[s(q,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l),placeholder:"Search Requests"},null,8,["modelValue"])])])]),_:1}),s(Q),s(ve,{items:X.value,"items-length":L.value,loading:n.value,selectedRows:r.value,"onUpdate:selectedRows":e[5]||(e[5]=l=>r.value=l),headers:K,"is-admin":k.value,itemsPerPage:v.value,"onUpdate:itemsPerPage":e[6]||(e[6]=l=>v.value=l),page:h.value,"onUpdate:page":e[7]||(e[7]=l=>h.value=l),"resolve-priority-variant":I,"resolve-status-variant":E,"format-status":$,"get-file-icon":B,onViewRequest:te,onEditRequest:j,onDeleteRequest:se,"onUpdate:options":J},null,8,["items","items-length","loading","selectedRows","is-admin","itemsPerPage","page"])]),_:1}),s(pe,{visible:y.value,"onUpdate:visible":e[8]||(e[8]=l=>y.value=l),request:R.value,"show-edit-button":k.value,"is-admin":k.value,"resolve-priority-variant":I,"resolve-status-variant":E,"format-status":$,"get-file-icon":B,onEdit:le},null,8,["visible","request","show-edit-button","is-admin"]),s(fe,{visible:_.value,"onUpdate:visible":e[9]||(e[9]=l=>_.value=l),request:P.value,"is-admin":k.value,onSuccess:ue},null,8,["visible","request","is-admin"]),s(ge,{visible:C.value,"onUpdate:visible":e[10]||(e[10]=l=>C.value=l),onSuccess:ne},null,8,["visible"]),s(be,{visible:w.value,"onUpdate:visible":e[11]||(e[11]=l=>w.value=l),request:d.value,loading:n.value,onConfirm:ae},null,8,["visible","request","loading"]),s(ye,{visible:V.value,"onUpdate:visible":e[12]||(e[12]=l=>V.value=l),"selected-count":r.value.length,loading:n.value,onConfirm:ie},null,8,["visible","selected-count","loading"]),s(Se,{modelValue:c.value.show,"onUpdate:modelValue":e[14]||(e[14]=l=>c.value.show=l),timeout:"3000"},{actions:o(()=>[s(S,{color:c.value.color,onClick:e[13]||(e[13]=l=>c.value.show=!1)},{default:o(()=>e[18]||(e[18]=[p(" Close ")])),_:1,__:[18]},8,["color"])]),default:o(()=>[p(F(c.value.message)+" ",1)]),_:1},8,["modelValue"])])}}});export{pt as default};
