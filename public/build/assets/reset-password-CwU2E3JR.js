import{_ as z}from"./AppTextField.vue_vue_type_script_setup_true_lang-zpwrxD59.js";import{d as U,bb as $,u as D,e as E,g as r,E as H,aQ as Y,c as M,o as m,l as i,y as a,aR as N,i as s,k as o,G as q,t as h,b7 as G,h as g,a as x,q as V,bf as Q,F as J,a7 as K,av as O,s as W}from"./main-C_m4DwnX.js";import{a as X,b as Z}from"./auth-v1-top-shape-gPxasD3d.js";import{V as C}from"./VNodeRenderer-DnjIsvNv.js";import{a as S}from"./auth-Bn0kXdn0.js";import{a as ee,d as se,f as F,V as ae}from"./VCard-SlzzMb5H.js";import{V as oe}from"./VForm-D4l7pbSV.js";import{V as te,a as c}from"./VRow-CiO-FbWu.js";import{V as R}from"./VAlert-HZNsvzFR.js";import"./form-DYCB4Gfc.js";import"./VTextField-DqjZ8OOj.js";import"./VField-DvEiP886.js";import"./VInput-BI41h3_F.js";const re={class:"auth-wrapper d-flex align-center justify-center pa-4"},le={class:"position-relative my-sm-16"},ne={class:"app-logo"},ie={class:"app-logo-title"},de={class:"d-flex align-center"},he=U({__name:"reset-password",setup(ue){const{smAndUp:A}=$(),T=D(),L=E(),k=r(T.query.token||""),P=r(T.query.email||""),l=r({newPassword:"",confirmPassword:""}),f=r(!1),w=r(!1),v=r(!1),_=r(!1),y=r(null),n=r(null),b=r(null),B=r(!1);H(async()=>{var d;if(!k.value||!P.value){n.value="Invalid reset link. Please request a new password reset.";return}_.value=!0;try{(await S.validateResetToken({token:k.value,email:P.value})).success?B.value=!0:n.value="Invalid or expired reset link. Please request a new password reset."}catch(e){const t=(e==null?void 0:e.data)||((d=e==null?void 0:e.response)==null?void 0:d._data)||null;n.value=(t==null?void 0:t.message)||"Invalid or expired reset link. Please request a new password reset."}finally{_.value=!1}});const j=async()=>{var d;if(n.value=null,y.value=null,b.value=null,!l.value.newPassword||l.value.newPassword.length<8){n.value="Password must be at least 8 characters.";return}if(l.value.newPassword!==l.value.confirmPassword){n.value="Passwords do not match.";return}v.value=!0;try{const e=await S.resetPassword({token:k.value,email:P.value,password:l.value.newPassword,password_confirmation:l.value.confirmPassword});e.success&&(y.value=e.message||"Your password has been reset successfully. Redirecting to login...",setTimeout(()=>{L.push({name:"login"})},2e3))}catch(e){const t=(e==null?void 0:e.data)||((d=e==null?void 0:e.response)==null?void 0:d._data)||null;t!=null&&t.errors?(b.value={password:t.errors.password,password_confirmation:t.errors.password_confirmation},n.value=t.message):n.value=(t==null?void 0:t.message)||"Failed to reset password. Please try again."}finally{v.value=!1}};return(d,e)=>{const t=Y("RouterLink"),I=z;return m(),M("div",re,[i("div",le,[a(s(C),{nodes:N("div",{innerHTML:s(X)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),a(s(C),{nodes:N("div",{innerHTML:s(Z)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),a(ae,{class:W(["auth-card",s(A)?"pa-6":"pa-2"]),"max-width":"600"},{default:o(()=>[a(ee,{class:"justify-center"},{default:o(()=>[a(se,null,{default:o(()=>[a(t,{to:"/"},{default:o(()=>[i("div",ne,[a(s(C),{nodes:s(q).app.logo},null,8,["nodes"]),i("h1",ie,h(s(q).app.title),1)])]),_:1})]),_:1})]),_:1}),a(F,null,{default:o(()=>e[4]||(e[4]=[i("h4",{class:"text-h4 mb-1"}," Reset Password 🔒 ",-1),i("p",{class:"mb-0"}," Your new password must be different from previously used passwords ",-1)])),_:1,__:[4]}),a(F,null,{default:o(()=>[a(oe,{onSubmit:G(j,["prevent"])},{default:o(()=>[a(te,null,{default:o(()=>[a(c,{cols:"12"},{default:o(()=>[s(_)?(m(),x(R,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:o(()=>[i("div",de,[a(Q,{indeterminate:"",size:"20",class:"me-3"}),e[5]||(e[5]=V(" Validating reset link... "))])]),_:1})):g("",!0),s(n)?(m(),x(R,{key:1,type:"error",variant:"tonal",class:"mb-4"},{default:o(()=>[V(h(s(n)),1)]),_:1})):g("",!0),s(y)?(m(),x(R,{key:2,type:"success",variant:"tonal",class:"mb-4"},{default:o(()=>[V(h(s(y)),1)]),_:1})):g("",!0)]),_:1}),s(B)&&!s(_)?(m(),M(J,{key:0},[a(c,{cols:"12"},{default:o(()=>{var u;return[a(I,{modelValue:s(l).newPassword,"onUpdate:modelValue":e[0]||(e[0]=p=>s(l).newPassword=p),autofocus:"",label:"New Password",placeholder:"············",type:s(f)?"text":"password",autocomplete:"new-password","error-messages":(u=s(b))==null?void 0:u.password,"append-inner-icon":s(f)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[1]||(e[1]=p=>f.value=!s(f))},null,8,["modelValue","type","error-messages","append-inner-icon"]),e[6]||(e[6]=i("p",{class:"text-caption text-disabled mt-1"}," Password must be at least 8 characters and contain uppercase, lowercase, number, and special character. ",-1))]}),_:1,__:[6]}),a(c,{cols:"12"},{default:o(()=>{var u;return[a(I,{modelValue:s(l).confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=p=>s(l).confirmPassword=p),label:"Confirm Password",autocomplete:"new-password",placeholder:"············",type:s(w)?"text":"password","error-messages":(u=s(b))==null?void 0:u.password_confirmation,"append-inner-icon":s(w)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[3]||(e[3]=p=>w.value=!s(w))},null,8,["modelValue","type","error-messages","append-inner-icon"])]}),_:1}),a(c,{cols:"12"},{default:o(()=>[a(K,{block:"",type:"submit",loading:s(v),disabled:s(v)},{default:o(()=>e[7]||(e[7]=[V(" Set New Password ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1})],64)):g("",!0),a(c,{cols:"12"},{default:o(()=>[a(t,{class:"d-flex align-center justify-center",to:{name:"login"}},{default:o(()=>[a(O,{icon:"tabler-chevron-left",size:"20",class:"me-1 flip-in-rtl"}),e[8]||(e[8]=i("span",null,"Back to login",-1))]),_:1,__:[8]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])}}});export{he as default};
