import{d as j,g as f,O as D,w as K,a as E,o as I,k as e,y as t,h as G,l as o,t as c,q as p,i,aI as P,a7 as M,e as Q,E as W,c as X,av as b}from"./main-CrqE58uP.js";import{t as U}from"./task-B5fldEvW.js";import{_ as Y}from"./ViewTaskDialog.vue_vue_type_script_setup_true_lang-GqmnDf_W.js";import{_ as Z}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-tIPcQsM3.js";import{u as tt}from"./useValidationRules-PeLbHKqm.js";import{b as et}from"./tasksValidation-CSbL0sid.js";import{V as T,f as h,g as st,b as $,a as at,d as lt}from"./VCard-CZdMCf39.js";import{V as L}from"./VDivider-CI--kmsf.js";import{V as N}from"./VChip-DAJCEXh0.js";import{V as ot}from"./VForm-CFw85RGO.js";import{V as it}from"./VSelect-Di3OJX7Y.js";import{V as rt}from"./VSpacer-aXcnQPec.js";import{V as nt}from"./VDialog-B-G_-ykr.js";import{a as S,V as O}from"./VRow-CpsRAF9x.js";import{V as dt}from"./VAlert-DS-ohESv.js";import{V as ut}from"./VDataTable-GjxH-5h4.js";import{V as ct}from"./VMenu-DgtDpKbJ.js";import{V as mt,a as q,b as H}from"./VList-lIvAURjR.js";import"./api-router-Bz2EkdfU.js";import"./VSlideGroup-0oZ-DmCO.js";import"./form-B3cvC5mg.js";import"./VTextField-D8j7WlPL.js";import"./VField-B7JFJ89s.js";import"./VInput-DSx6x9Bd.js";import"./VCheckboxBtn-CG-S7hsL.js";import"./VSelectionControl-DN2C_DWa.js";import"./VPagination-DOpeEva-.js";import"./VTable-B-UYDmW2.js";const ft={class:"mb-4"},pt={class:"text-base font-weight-medium mb-2"},vt={class:"text-body-2 text-disabled"},kt=j({__name:"StatusChangeTaskDialog",props:{isDialogVisible:{type:Boolean},task:{}},emits:["update:isDialogVisible","status-updated"],setup(F,{emit:y}){const d=F,v=y,k=f(),{backendErrors:g,setBackendErrors:C,clearError:V}=tt(),B=et(),u=f(""),x=f(!1),_=D({get:()=>d.isDialogVisible,set:r=>{v("update:isDialogVisible",r),r||(u.value="")}});K(()=>{var r;return(r=d.task)==null?void 0:r.status},r=>{r&&(u.value=r)},{immediate:!0});const z=[{title:"Pending",value:"pending"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"},{title:"Cancelled",value:"cancelled"},{title:"On Hold",value:"on_hold"}],R=r=>r==="completed"?"success":r==="in_progress"?"warning":r==="pending"?"info":r==="cancelled"?"error":"secondary",A=async()=>{if(!d.task)return;const{valid:r}=await k.value.validate();if(r){x.value=!0;try{const l=await U.updateTaskStatus(d.task.id,u.value);if(l.success){const w={...d.task,status:u.value};v("status-updated",w),_.value=!1}else console.error("Failed to update task status:",l.message)}catch(l){console.error("Error updating task status:",l),C(l)}finally{x.value=!1}}};return(r,l)=>{const w=Z;return I(),E(nt,{modelValue:i(_),"onUpdate:modelValue":l[4]||(l[4]=m=>P(_)?_.value=m:null),"max-width":"600"},{default:e(()=>[t(w,{onClick:l[0]||(l[0]=m=>_.value=!1)}),t(T,{title:"Change Task Status"},{default:e(()=>[t(L),d.task?(I(),E(h,{key:0,class:"pa-6"},{default:e(()=>[o("div",ft,[o("h6",pt,c(d.task.title),1),o("div",vt,[l[5]||(l[5]=p(" Current Status: ")),t(N,{color:R(d.task.status),size:"small",label:"",class:"text-capitalize ml-2"},{default:e(()=>[p(c(d.task.status),1)]),_:1},8,["color"])])]),t(ot,{ref_key:"formRef",ref:k},{default:e(()=>[t(it,{modelValue:i(u),"onUpdate:modelValue":[l[1]||(l[1]=m=>P(u)?u.value=m:null),l[2]||(l[2]=m=>i(V)("status"))],label:"New Status",items:z,"item-title":"title","item-value":"value",rules:i(B).status,"error-messages":i(g).status,required:""},null,8,["modelValue","rules","error-messages"])]),_:1},512)]),_:1})):G("",!0),t(L),t(st,{class:"pa-6"},{default:e(()=>{var m;return[t(rt),t(M,{color:"secondary",variant:"tonal",onClick:l[3]||(l[3]=a=>_.value=!1)},{default:e(()=>l[6]||(l[6]=[p(" Cancel ")])),_:1,__:[6]}),t(M,{color:"primary",disabled:!i(u)||i(u)===((m=d.task)==null?void 0:m.status)||i(x),loading:i(x),onClick:A},{default:e(()=>l[7]||(l[7]=[p(" Update Status ")])),_:1,__:[7]},8,["disabled","loading"])]}),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),_t={class:"ms-4"},gt={class:"text-h4"},Vt={class:"ms-4"},bt={class:"text-h4"},yt={class:"ms-4"},xt={class:"text-h4"},Tt={class:"ms-4"},Ct={class:"text-h4"},wt={class:"text-base font-weight-medium"},St={class:"text-body-2 text-disabled"},ee=j({__name:"my-tasks",setup(F){Q();const y=f(!1),d=f(!1),v=f(null),k=f([]),g=f({totalTasks:0,completedTasks:0,inProgressTasks:0,dueTasks:0}),C=f(!1),V=f(null),B=D(()=>g.value.totalTasks),u=D(()=>g.value.completedTasks),x=D(()=>g.value.inProgressTasks),_=D(()=>g.value.dueTasks),z=async()=>{try{C.value=!0,V.value=null;const[a,s]=await Promise.all([U.getMyTasks(),U.getStatistics()]);a.success&&a.data&&(k.value=Array.isArray(a.data)?a.data:a.data.data||[]),s.success&&s.data&&(g.value=s.data)}catch(a){console.error("Error fetching tasks:",a),V.value=a.message||"Failed to load tasks",k.value=[]}finally{C.value=!1}};W(()=>{z()});const R=a=>a==="completed"?"success":a==="in_progress"?"warning":a==="pending"?"info":"secondary",A=a=>a==="high"?"error":a==="medium"?"warning":a==="low"?"info":"secondary",r=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],l=a=>{v.value=a,y.value=!0},w=a=>{v.value={...a},d.value=!0},m=a=>{const s=k.value.findIndex(n=>n.id===a.id);s!==-1&&(k.value[s]=a),z(),d.value=!1,v.value=null};return(a,s)=>(I(),X("section",null,[t(O,{class:"mb-6"},{default:e(()=>[t(S,{cols:"12"},{default:e(()=>s[3]||(s[3]=[o("div",null,[o("h2",{class:"text-h2 mb-1"}," My Tasks "),o("p",{class:"text-body-1 text-medium-emphasis"}," Track and manage tasks assigned to you ")],-1)])),_:1,__:[3]})]),_:1}),t(O,{class:"mb-6"},{default:e(()=>[t(S,{cols:"12",md:"3"},{default:e(()=>[t(T,null,{default:e(()=>[t(h,{class:"d-flex align-center"},{default:e(()=>[t($,{size:"44",rounded:"",color:"primary",variant:"tonal"},{default:e(()=>[t(b,{icon:"tabler-checklist",size:"26"})]),_:1}),o("div",_t,[s[4]||(s[4]=o("div",{class:"text-body-2 text-disabled"}," Total Tasks ",-1)),o("h4",gt,c(i(B)),1)])]),_:1})]),_:1})]),_:1}),t(S,{cols:"12",md:"3"},{default:e(()=>[t(T,null,{default:e(()=>[t(h,{class:"d-flex align-center"},{default:e(()=>[t($,{size:"44",rounded:"",color:"success",variant:"tonal"},{default:e(()=>[t(b,{icon:"tabler-check",size:"26"})]),_:1}),o("div",Vt,[s[5]||(s[5]=o("div",{class:"text-body-2 text-disabled"}," Completed ",-1)),o("h4",bt,c(i(u)),1)])]),_:1})]),_:1})]),_:1}),t(S,{cols:"12",md:"3"},{default:e(()=>[t(T,null,{default:e(()=>[t(h,{class:"d-flex align-center"},{default:e(()=>[t($,{size:"44",rounded:"",color:"warning",variant:"tonal"},{default:e(()=>[t(b,{icon:"tabler-clock",size:"26"})]),_:1}),o("div",yt,[s[6]||(s[6]=o("div",{class:"text-body-2 text-disabled"}," In Progress ",-1)),o("h4",xt,c(i(x)),1)])]),_:1})]),_:1})]),_:1}),t(S,{cols:"12",md:"3"},{default:e(()=>[t(T,null,{default:e(()=>[t(h,{class:"d-flex align-center"},{default:e(()=>[t($,{size:"44",rounded:"",color:"error",variant:"tonal"},{default:e(()=>[t(b,{icon:"tabler-alert-circle",size:"26"})]),_:1}),o("div",Tt,[s[7]||(s[7]=o("div",{class:"text-body-2 text-disabled"}," Due ",-1)),o("h4",Ct,c(i(_)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),i(V)?(I(),E(dt,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-6","onClick:close":s[0]||(s[0]=n=>V.value=null)},{default:e(()=>[p(c(i(V)),1)]),_:1})):G("",!0),t(T,null,{default:e(()=>[t(at,{class:"pb-4"},{default:e(()=>[t(lt,null,{default:e(()=>s[8]||(s[8]=[p("My Tasks")])),_:1,__:[8]})]),_:1}),t(L),t(ut,{items:i(k),headers:r,loading:i(C),class:"text-no-wrap","item-value":"id"},{"item.taskInfo":e(({item:n})=>[o("div",null,[o("h6",wt,c(n.title),1),o("div",St,c(n.description),1)])]),"item.priority":e(({item:n})=>[t(N,{color:A(n.priority),size:"small",label:"",class:"text-capitalize"},{default:e(()=>[p(c(n.priority),1)]),_:2},1032,["color"])]),"item.status":e(({item:n})=>[t(N,{color:R(n.status),size:"small",label:"",class:"text-capitalize"},{default:e(()=>[p(c(n.status),1)]),_:2},1032,["color"])]),"item.actions":e(({item:n})=>[t(M,{icon:"",variant:"text",color:"medium-emphasis",size:"small"},{default:e(()=>[t(b,{icon:"tabler-dots-vertical"}),t(ct,{activator:"parent"},{default:e(()=>[t(mt,null,{default:e(()=>[t(q,{onClick:J=>l(n)},{prepend:e(()=>[t(b,{icon:"tabler-eye"})]),default:e(()=>[t(H,null,{default:e(()=>s[9]||(s[9]=[p("View")])),_:1,__:[9]})]),_:2},1032,["onClick"]),t(q,{onClick:J=>w(n)},{prepend:e(()=>[t(b,{icon:"tabler-refresh"})]),default:e(()=>[t(H,null,{default:e(()=>s[10]||(s[10]=[p("Change Status")])),_:1,__:[10]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["items","loading"])]),_:1}),t(Y,{"is-dialog-visible":i(y),"onUpdate:isDialogVisible":s[1]||(s[1]=n=>P(y)?y.value=n:null),task:i(v)},null,8,["is-dialog-visible","task"]),t(kt,{"is-dialog-visible":i(d),"onUpdate:isDialogVisible":s[2]||(s[2]=n=>P(d)?d.value=n:null),task:i(v),onStatusUpdated:m},null,8,["is-dialog-visible","task"])]))}});export{ee as default};
