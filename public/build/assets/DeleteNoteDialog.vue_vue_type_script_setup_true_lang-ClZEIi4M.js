import{_ as ee}from"./AppTextarea.vue_vue_type_script_setup_true_lang-yjpBO3IP.js";import{_ as te}from"./AppTextField.vue_vue_type_script_setup_true_lang-Cn0UWUmm.js";import{_ as q,V as G}from"./VDialog-CdykBzC-.js";import{d as L,g as $,O,w as oe,a as _,o as f,k as i,y as o,h as z,i as n,b7 as ae,l as m,c as R,F as j,r as K,av as U,t as v,a7 as N,q as M,aI as X,aZ as se}from"./main-CSU6kgHA.js";import{u as le,n as S}from"./AddNoteDialog.vue_vue_type_script_setup_true_lang-DisacN7v.js";import{u as ie}from"./useValidationRules-BzjSj40d.js";import{V as T,f as H,g as P}from"./VCard-C3SWsjmI.js";import{V as ne}from"./VForm-CPwOinhh.js";import{V as I,a as x}from"./VRow-BZVkTVe_.js";import{V as re}from"./VFileInput-CbS93rS-.js";import{V as Z}from"./VDivider-MLBtUVJ7.js";import{V as J}from"./VSpacer-BqsowJbv.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ce}from"./ConfirmDeleteDialog.vue_vue_type_script_setup_true_lang-CcAHhokg.js";const ue={class:"flex-grow-1 me-3"},me={class:"text-body-2 font-weight-medium"},fe={class:"text-caption text-disabled"},Se=L({__name:"EditNoteDialog",props:{isDialogVisible:{type:Boolean},note:{}},emits:["update:isDialogVisible","noteUpdated"],setup(B,{emit:F}){const c=B,V=F,g=$(),{backendErrors:p,setBackendErrors:b,clearError:w}=ie(),y=le(),r=$(null),e=$([]),s=$(!1),d=O({get:()=>c.isDialogVisible,set:a=>V("update:isDialogVisible",a)});oe(()=>c.note,a=>{a&&(r.value={...a})},{immediate:!0});const l=a=>{const t=a.target;t.files&&(e.value=Array.from(t.files))},k=a=>{if(a===0)return"0 Bytes";const t=1024,D=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(a)/Math.log(t));return`${Number.parseFloat((a/t**C).toFixed(2))} ${D[C]}`},E=async a=>{if(r.value)try{const t=await S.deleteNoteAttachment(r.value.id,a);t.success?(r.value.attachments.splice(a,1),console.log("Attachment removed successfully")):console.error("Failed to remove attachment:",t.message)}catch(t){console.error("Error removing attachment:",t)}},h=async()=>{if(!r.value)return;const{valid:a}=await g.value.validate();if(a)try{s.value=!0;const t=new FormData;t.append("title",r.value.title),t.append("description",r.value.description),t.append("_method","PUT"),e.value.forEach(C=>{t.append("attachments[]",C)});const D=await S.updateNoteWithFormData(r.value.id,t);D.success?(console.log("Note updated successfully"),V("noteUpdated"),d.value=!1,e.value=[]):console.error("Failed to update note:",D.message)}catch(t){console.error("Error updating note:",t),b(t)}finally{s.value=!1}},A=()=>{d.value=!1,e.value=[],c.note&&(r.value={...c.note})},Q=a=>a.startsWith("image/")?"tabler-photo":a.startsWith("video/")?"tabler-video":a.startsWith("audio/")?"tabler-music":a.includes("pdf")?"tabler-file-type-pdf":a.includes("word")||a.includes("document")?"tabler-file-type-doc":a.includes("excel")||a.includes("spreadsheet")?"tabler-file-type-xls":a.includes("zip")||a.includes("compressed")?"tabler-file-zip":"tabler-file";return(a,t)=>{const D=q,C=te,Y=ee;return f(),_(G,{modelValue:n(d),"onUpdate:modelValue":t[4]||(t[4]=u=>X(d)?d.value=u:null),"max-width":"800"},{default:i(()=>[o(D,{onClick:A}),n(r)?(f(),_(T,{key:0,title:"Edit Note"},{default:i(()=>[o(H,null,{default:i(()=>[o(ne,{ref_key:"formRef",ref:g,onSubmit:ae(h,["prevent"])},{default:i(()=>[o(I,null,{default:i(()=>[o(x,{cols:"12"},{default:i(()=>[o(C,{modelValue:n(r).title,"onUpdate:modelValue":t[0]||(t[0]=u=>n(r).title=u),label:"Title",placeholder:"Enter note title",disabled:n(s),rules:n(y).note,"error-messages":n(p).note,onInput:t[1]||(t[1]=u=>n(w)("note"))},null,8,["modelValue","disabled","rules","error-messages"])]),_:1}),o(x,{cols:"12"},{default:i(()=>[o(Y,{modelValue:n(r).description,"onUpdate:modelValue":t[2]||(t[2]=u=>n(r).description=u),label:"Description",placeholder:"Enter note description...",rows:"6",disabled:n(s),rules:n(y).content,"error-messages":n(p).content,onInput:t[3]||(t[3]=u=>n(w)("content"))},null,8,["modelValue","disabled","rules","error-messages"])]),_:1}),n(r).attachments&&n(r).attachments.length>0?(f(),_(x,{key:0,cols:"12"},{default:i(()=>[t[5]||(t[5]=m("h6",{class:"text-h6 mb-3"}," Existing Attachments ",-1)),o(I,null,{default:i(()=>[(f(!0),R(j,null,K(n(r).attachments,(u,W)=>(f(),_(x,{key:W,cols:"12"},{default:i(()=>[o(T,{variant:"tonal",class:"d-flex align-center pa-3"},{default:i(()=>[o(U,{icon:Q(u.type),size:"32",class:"me-3"},null,8,["icon"]),m("div",ue,[m("div",me,v(u.name),1),m("div",fe,v(k(u.size)),1)]),o(N,{icon:"",size:"small",variant:"text",color:"error",disabled:n(s),onClick:ye=>E(W)},{default:i(()=>[o(U,{icon:"tabler-trash"})]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1,__:[5]})):z("",!0),o(x,{cols:"12"},{default:i(()=>[o(re,{label:"Attachments",multiple:"","prepend-icon":"tabler-paperclip",placeholder:"Upload files",chips:"","show-size":"",disabled:n(s),onChange:l},null,8,["disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1}),o(Z),o(P,null,{default:i(()=>[o(J),o(N,{color:"secondary",variant:"tonal",disabled:n(s),onClick:A},{default:i(()=>t[6]||(t[6]=[M(" Cancel ")])),_:1,__:[6]},8,["disabled"]),o(N,{color:"primary",loading:n(s),disabled:n(s),onClick:h},{default:i(()=>t[7]||(t[7]=[M(" Update Note ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1})]),_:1})):z("",!0)]),_:1},8,["modelValue"])}}}),pe={class:"mb-6"},ge={class:"text-body-1 whitespace-pre-wrap"},be={class:"text-body-2 text-medium-emphasis"},he={key:0},ve={class:"text-h6 mb-3"},_e={class:"flex-grow-1 me-3"},Ve={class:"text-body-2 font-weight-medium"},we={class:"text-caption text-disabled"},ke=L({__name:"ViewNoteDialog",props:{isDialogVisible:{type:Boolean},note:{}},emits:["update:isDialogVisible"],setup(B,{emit:F}){const c=B,V=F,g=$(new Set),p=O({get:()=>c.isDialogVisible,set:e=>V("update:isDialogVisible",e)}),b=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=e=>{if(e===0)return"0 Bytes";const s=1024,d=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(s));return`${Number.parseFloat((e/s**l).toFixed(2))} ${d[l]}`},y=async(e,s)=>{if(c.note){g.value.add(s);try{const d=se("accessToken").value;if(!d){console.error("No access token found");return}const l=await fetch(`/api/v1/notes/${c.note.id}/attachments/${s}/download`,{method:"GET",headers:{Authorization:`Bearer ${d}`,Accept:"application/octet-stream","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!l.ok){const A=await l.text();throw console.error("Download failed:",l.status,A),new Error(`Failed to download attachment: ${l.status}`)}const k=await l.blob(),E=window.URL.createObjectURL(k),h=document.createElement("a");h.href=E,h.download=e.name,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(E)}catch(d){console.error("Error downloading attachment:",d);const l=document.createElement("a");l.href=`/storage/${e.path}`,l.download=e.name,l.target="_blank",document.body.appendChild(l),l.click(),document.body.removeChild(l)}finally{g.value.delete(s)}}},r=e=>e.startsWith("image/")?"tabler-photo":e.startsWith("video/")?"tabler-video":e.startsWith("audio/")?"tabler-music":e.includes("pdf")?"tabler-file-type-pdf":e.includes("word")||e.includes("document")?"tabler-file-type-doc":e.includes("excel")||e.includes("spreadsheet")?"tabler-file-type-xls":e.includes("zip")||e.includes("compressed")?"tabler-file-zip":"tabler-file";return(e,s)=>{const d=q;return f(),_(G,{modelValue:n(p),"onUpdate:modelValue":s[2]||(s[2]=l=>X(p)?p.value=l:null),"max-width":"800"},{default:i(()=>[o(d,{onClick:s[0]||(s[0]=l=>p.value=!1)}),e.note?(f(),_(T,{key:0,title:"Note Details"},{default:i(()=>[o(H,null,{default:i(()=>[m("div",pe,[m("p",ge,v(e.note.description),1),m("p",be," Created by "+v(e.note.createdBy)+" at "+v(b(e.note.createdAt)),1)]),e.note.attachments&&e.note.attachments.length>0?(f(),R("div",he,[m("h6",ve," Attachments ("+v(e.note.attachments.length)+") ",1),o(I,null,{default:i(()=>[(f(!0),R(j,null,K(e.note.attachments,(l,k)=>(f(),_(x,{key:k,cols:"12"},{default:i(()=>[o(T,{variant:"tonal",class:"d-flex align-center pa-3"},{default:i(()=>[o(U,{icon:r(l.type),size:"32",class:"me-3"},null,8,["icon"]),m("div",_e,[m("div",Ve,v(l.name),1),m("div",we,v(w(l.size)),1)]),o(N,{icon:"",size:"small",variant:"text",color:"primary",loading:n(g).has(k),onClick:E=>y(l,k)},{default:i(()=>[o(U,{icon:"tabler-download"})]),_:2},1032,["loading","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):z("",!0)]),_:1}),o(Z),o(P,null,{default:i(()=>[o(J),o(N,{color:"secondary",variant:"tonal",onClick:s[1]||(s[1]=l=>p.value=!1)},{default:i(()=>s[3]||(s[3]=[M(" Close ")])),_:1,__:[3]})]),_:1})]),_:1})):z("",!0)]),_:1},8,["modelValue"])}}}),Ie=de(ke,[["__scopeId","data-v-4dce7bec"]]),Le=L({__name:"DeleteNoteDialog",props:{isDialogVisible:{type:Boolean},noteId:{}},emits:["update:isDialogVisible","note-deleted"],setup(B,{emit:F}){const c=B,V=F,g=$(!1),p=async()=>{if(c.noteId!==null){g.value=!0;try{const b=await S.deleteNote(c.noteId);b.success?(V("note-deleted"),V("update:isDialogVisible",!1)):console.error("Failed to delete note:",b.message)}catch(b){console.error("Error deleting note:",b)}finally{g.value=!1}}};return(b,w)=>(f(),_(ce,{"is-dialog-visible":c.isDialogVisible,"onUpdate:isDialogVisible":w[0]||(w[0]=y=>c.isDialogVisible=y),title:"Confirm Delete Note",message:"Are you sure you want to delete this note? This action cannot be undone.",onConfirm:p},null,8,["is-dialog-visible"]))}});export{Ie as V,Se as _,Le as a};
