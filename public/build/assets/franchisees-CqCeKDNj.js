import{V as we,_ as Ve}from"./VDataTableServer-DO7FSF6g.js";import{_ as be}from"./AppTextField.vue_vue_type_script_setup_true_lang-CrhyYF4c.js";import{_ as Ce}from"./AppSelect.vue_vue_type_script_setup_true_lang-Bz4_qTpH.js";import{_ as Fe}from"./AddEditFranchiseeDrawer.vue_vue_type_script_setup_true_lang-UxNoAUXu.js";import{_ as ke,a as De}from"./ResetPasswordDialog.vue_vue_type_script_setup_true_lang-DFrY-XsS.js";import{_ as Ue,a as V}from"./ViewUserDialog.vue_vue_type_script_setup_true_lang-Dy5fDIWO.js";import{d as Ae,g as n,O as Ee,E as Pe,c as B,o as b,y as a,k as l,l as i,F as $e,r as Ne,i as o,a as T,t as u,s as Se,av as v,h as Q,q as f,aM as g,a7 as $}from"./main-BYpBSAj5.js";import{a as z,V as I}from"./VRow-BqYOgTz2.js";import{V as G,f as O,b as H,a as Te,d as Le,e as Be}from"./VCard-Ca_zP91K.js";import{V as j}from"./VDivider-DekgMQwS.js";import{V as ze}from"./VSpacer-DHG0No5I.js";import{V as K}from"./VMenu-BmvlNcnX.js";import{V as X,a as k,b as D}from"./VList-CIyV_jON.js";import{V as Ie}from"./VAlert-BdnW2TdI.js";import{V as Oe}from"./VChip-CIWZSwOd.js";import"./VDataTable-BtxFyHeU.js";import"./VSelect-B4XFvlOB.js";import"./VTextField-DyLIUBXh.js";import"./VField-eqPlPWcK.js";import"./form-3qejRGpX.js";import"./forwardRefs-B931MWyl.js";import"./VInput-DSHxIYJN.js";import"./VOverlay-fzIdOlHt.js";import"./scopeId-DntWhGWm.js";import"./VCheckboxBtn-BGrXAimH.js";import"./VSelectionControl-BOWDk1vX.js";import"./VTable-B2PHCaSR.js";import"./validators-BHkKs9Dp.js";import"./VForm-BOJkEg2X.js";import"./VNavigationDrawer-CE_n64ZO.js";import"./VDialog-CpdD25yY.js";import"./VTooltip-DAjDDCy4.js";import"./formatters--UtN2sCw.js";/* empty css              */import"./VSlideGroup-BvgzkMEi.js";const je={class:"d-flex justify-space-between"},Re={class:"d-flex flex-column gap-y-1"},Me={class:"text-body-1 text-high-emphasis"},We={class:"d-flex gap-x-2 align-center"},qe={class:"text-h4"},Je={class:"text-sm"},Qe={class:"me-3 d-flex gap-3"},Ge={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},He={style:{"inline-size":"15.625rem"}},Ke={class:"text-center pa-8"},Xe={class:"d-flex align-center gap-x-4"},Ye={key:1},Ze={class:"d-flex flex-column"},et={class:"text-base font-weight-medium"},tt={class:"text-sm text-medium-emphasis"},at={class:"text-body-1 text-high-emphasis"},st={class:"text-body-1"},lt={class:"text-body-1"},ot={class:"d-flex gap-1"},Rt=Ae({__name:"franchisees",setup(it){const _=n(""),C=n(),y=n(10),x=n(1),R=n([{key:"created_at",order:"desc"}]),M=n("desc"),d=n([]),Y=t=>{var e;t.sortBy&&t.sortBy.length>0&&(R.value=t.sortBy,M.value=(e=t.sortBy[0])==null?void 0:e.order)},Z=[{title:"User",key:"user"},{title:"Location",key:"location"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],h=n([]),L=n(!1),c=n(""),N=n(0),U=async()=>{try{L.value=!0,c.value="";const t={search:_.value||void 0,status:C.value||void 0,sortBy:R.value||"created_at",sortOrder:M.value||"desc",perPage:y.value,page:x.value},e=await V.getFranchisees();if(e.success&&e.data){let r=[];Array.isArray(e.data)?r=e.data:e.data&&typeof e.data=="object"&&"data"in e.data&&Array.isArray(e.data.data)&&(r=e.data.data),console.log("Franchisees API Response:",{response:e,userData:r}),h.value=r.map(p=>({id:p.id,fullName:p.fullName||p.name,email:p.email,phone:p.phone||"",location:p.location||"",status:p.status,avatar:p.avatar||"",joinedDate:p.joinedDate||p.createdAt||p.created_at})),N.value=h.value.length}else h.value=[],N.value=0,c.value=e.message||"Failed to fetch franchisees"}catch(t){console.error("Error fetching franchisees:",t),c.value="Failed to fetch franchisees"}finally{L.value=!1}},ee=Ee(()=>{let t=h.value;return _.value&&(t=t.filter(e=>e.fullName.toLowerCase().includes(_.value.toLowerCase())||e.email.toLowerCase().includes(_.value.toLowerCase())||e.location.toLowerCase().includes(_.value.toLowerCase()))),C.value&&(t=t.filter(e=>e.status===C.value)),t}),te=[{title:"Pending",value:"pending"},{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],ae=t=>{const e=t.toLowerCase();return e==="pending"?"warning":e==="active"?"success":e==="inactive"?"secondary":"primary"},w=n(!1),A=n(!1),E=n(!1),S=n(!1),m=n(null),F=n(null),se=t=>t>0?`+${t}`:t,le=t=>{if(!t||typeof t!="string")return"U";const e=t.split(" ");return e.length>1?`${e[0][0]}${e[1][0]}`:t.slice(0,2)},oe=async t=>{try{const e={...t,city:t.location,role:"franchisee"};delete e.location;const r=await V.createUser(e);r.success?await U():c.value=r.message||"Failed to create franchisee"}catch(e){console.error("Error creating franchisee:",e),c.value="Failed to create franchisee"}},ie=t=>{m.value={...t},w.value=!0},re=async t=>{try{const e={...t,city:t.location};delete e.location;const r=await V.updateUser(t.id,e);r.success?(await U(),m.value=null):c.value=r.message||"Failed to update franchisee"}catch(e){console.error("Error updating franchisee:",e),c.value="Failed to update franchisee"}},ne=async t=>{t.id?await re(t):await oe(t)},de=t=>{F.value=t,A.value=!0},ce=async()=>{if(F.value){try{const t=await V.deleteUser(F.value.id);if(t.success){await U();const e=d.value.findIndex(r=>r===F.value.id);e!==-1&&d.value.splice(e,1)}else c.value=t.message||"Failed to delete franchisee"}catch(t){console.error("Error deleting franchisee:",t),c.value="Failed to delete franchisee"}A.value=!1,F.value=null}},ue=async()=>{if(d.value.length!==0)try{for(const t of d.value)await V.deleteUser(t);await U(),d.value=[]}catch(t){console.error("Error bulk deleting franchisees:",t),c.value="Failed to delete selected franchisees"}},pe=t=>{m.value=t,E.value=!0},fe=async t=>{var e;if(m.value){try{const r=await V.resetUserPassword(m.value.id,t);r.success?console.log("Password reset successfully for:",(e=m.value)==null?void 0:e.fullName):c.value=r.message||"Failed to reset password"}catch(r){console.error("Error resetting password:",r),c.value="Failed to reset password"}E.value=!1,m.value=null}},me=()=>{m.value=null},ve=t=>{m.value=t,S.value=!0},ge=()=>{w.value=!0},_e=()=>{const t=d.value.length>0?h.value.filter(e=>d.value.includes(e.id)):h.value;console.log("Exporting to CSV:",t)},he=()=>{const t=d.value.length>0?h.value.filter(e=>d.value.includes(e.id)):h.value;console.log("Exporting to PDF:",t)},W=n([{title:"Total Franchisees",value:"0",change:0,desc:"All registered franchisees",icon:"tabler-user-check",iconColor:"primary"},{title:"Active Franchisees",value:"0",change:0,desc:"Currently active",icon:"tabler-user-circle",iconColor:"success"},{title:"Pending Approval",value:"0",change:0,desc:"Awaiting verification",icon:"tabler-clock",iconColor:"warning"}]),ye=async()=>{try{const t=await V.getFranchiseesStats();t.success&&(W.value=t.data)}catch(t){console.error("Error fetching franchisee stats:",t)}};return Pe(()=>{U(),ye()}),(t,e)=>{var q,J;const r=Ce,p=be,xe=Ve;return b(),B("section",null,[a(I,{class:"mb-6"},{default:l(()=>[a(z,{cols:"12"},{default:l(()=>e[14]||(e[14]=[i("div",{class:"d-flex align-center justify-space-between"},[i("div",null,[i("h2",{class:"text-h2 mb-1"}," Franchisee Management "),i("p",{class:"text-body-1 text-medium-emphasis"}," Manage and monitor all franchisee accounts ")])],-1)])),_:1,__:[14]})]),_:1}),a(I,{class:"mb-6"},{default:l(()=>[(b(!0),B($e,null,Ne(o(W),(s,P)=>(b(),T(z,{key:P,cols:"12",md:"4",sm:"6"},{default:l(()=>[a(G,null,{default:l(()=>[a(O,null,{default:l(()=>[i("div",je,[i("div",Re,[i("div",Me,u(s.title),1),i("div",We,[i("h4",qe,u(s.value),1),i("div",{class:Se(["text-base",s.change>0?"text-success":"text-error"])}," ("+u(se(s.change))+"%) ",3)]),i("div",Je,u(s.desc),1)]),a(H,{color:s.iconColor,variant:"tonal",rounded:"",size:"42"},{default:l(()=>[a(v,{icon:s.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(G,{class:"mb-6"},{default:l(()=>[a(Te,{class:"pb-4"},{default:l(()=>[a(Le,null,{default:l(()=>e[15]||(e[15]=[f("Filters")])),_:1,__:[15]})]),_:1}),a(O,null,{default:l(()=>[a(I,null,{default:l(()=>[a(z,{cols:"12",sm:"4"},{default:l(()=>[a(r,{modelValue:o(C),"onUpdate:modelValue":e[0]||(e[0]=s=>g(C)?C.value=s:null),placeholder:"Select Status",items:te,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(j),a(O,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[i("div",Qe,[a(r,{"model-value":o(y),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=parseInt(s,10))},null,8,["model-value"]),o(d).length>0?(b(),T($,{key:0,variant:"tonal",color:"error",onClick:ue},{default:l(()=>[a(v,{icon:"tabler-trash",class:"me-2"}),f(" Delete Selected ("+u(o(d).length)+") ",1)]),_:1})):Q("",!0)]),a(ze),i("div",Ge,[i("div",He,[a(p,{modelValue:o(_),"onUpdate:modelValue":e[2]||(e[2]=s=>g(_)?_.value=s:null),placeholder:"Search Franchisee"},null,8,["modelValue"])]),a($,{variant:"tonal",color:"secondary"},{default:l(()=>[a(v,{icon:"tabler-upload",class:"me-2"}),f(" Export "+u(o(d).length>0?`(${o(d).length})`:"All")+" ",1),a(K,{activator:"parent"},{default:l(()=>[a(X,null,{default:l(()=>[a(k,{onClick:_e},{prepend:l(()=>[a(v,{icon:"tabler-file-type-csv"})]),default:l(()=>[a(D,null,{default:l(()=>e[16]||(e[16]=[f("Export to CSV")])),_:1,__:[16]})]),_:1}),a(k,{onClick:he},{prepend:l(()=>[a(v,{icon:"tabler-file-type-pdf"})]),default:l(()=>[a(D,null,{default:l(()=>e[17]||(e[17]=[f("Export to PDF")])),_:1,__:[17]})]),_:1})]),_:1})]),_:1})]),_:1}),a($,{"prepend-icon":"tabler-plus",onClick:e[3]||(e[3]=s=>w.value=!0)},{default:l(()=>e[18]||(e[18]=[f(" Add New Franchisee ")])),_:1,__:[18]})])]),_:1}),a(j),o(c)?(b(),T(Ie,{key:0,type:"error",class:"ma-4",closable:"","onClick:close":e[4]||(e[4]=s=>c.value="")},{default:l(()=>[f(u(o(c)),1)]),_:1})):Q("",!0),a(we,{"items-per-page":o(y),"onUpdate:itemsPerPage":e[7]||(e[7]=s=>g(y)?y.value=s:null),"model-value":o(d),"onUpdate:modelValue":e[8]||(e[8]=s=>g(d)?d.value=s:null),page:o(x),"onUpdate:page":e[9]||(e[9]=s=>g(x)?x.value=s:null),items:o(ee),"item-value":"id","items-length":o(N),headers:Z,loading:o(L),class:"text-no-wrap","show-select":"","onUpdate:options":Y},{"no-data":l(()=>[i("div",Ke,[a(v,{icon:"tabler-users-off",size:"64",class:"mb-4 text-disabled"}),e[20]||(e[20]=i("h3",{class:"text-h5 mb-2"}," No Franchisees Found ",-1)),e[21]||(e[21]=i("p",{class:"text-body-1 text-medium-emphasis mb-4"}," No franchisees match your search criteria. Try adjusting your filters. ",-1)),a($,{color:"primary",onClick:e[5]||(e[5]=s=>w.value=!0)},{default:l(()=>e[19]||(e[19]=[f(" Add First Franchisee ")])),_:1,__:[19]})])]),"item.user":l(({item:s})=>[i("div",Xe,[a(H,{size:"34",variant:s.avatar?void 0:"tonal",color:"info"},{default:l(()=>[s.avatar?(b(),T(Be,{key:0,src:s.avatar},null,8,["src"])):(b(),B("span",Ye,u(le(s.fullName)),1))]),_:2},1032,["variant"]),i("div",Ze,[i("h6",et,u(s.fullName),1),i("div",tt," Joined: "+u(s.joinedDate),1)])])]),"item.location":l(({item:s})=>[i("div",at,u(s.location),1)]),"item.email":l(({item:s})=>[i("div",st,u(s.email),1)]),"item.phone":l(({item:s})=>[i("div",lt,u(s.phone),1)]),"item.status":l(({item:s})=>[a(Oe,{color:ae(s.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[f(u(s.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:s})=>[i("div",ot,[a($,{icon:"",variant:"text",color:"medium-emphasis",size:"small"},{default:l(()=>[a(v,{icon:"tabler-dots-vertical",size:"22"}),a(K,{activator:"parent"},{default:l(()=>[a(X,null,{default:l(()=>[a(k,{onClick:P=>ve(s)},{prepend:l(()=>[a(v,{icon:"tabler-eye"})]),default:l(()=>[a(D,null,{default:l(()=>e[22]||(e[22]=[f("View")])),_:1,__:[22]})]),_:2},1032,["onClick"]),a(k,{onClick:P=>ie(s)},{prepend:l(()=>[a(v,{icon:"tabler-pencil"})]),default:l(()=>[a(D,null,{default:l(()=>e[23]||(e[23]=[f("Edit")])),_:1,__:[23]})]),_:2},1032,["onClick"]),a(k,{onClick:P=>pe(s)},{prepend:l(()=>[a(v,{icon:"tabler-key"})]),default:l(()=>[a(D,null,{default:l(()=>e[24]||(e[24]=[f("Reset Password")])),_:1,__:[24]})]),_:2},1032,["onClick"]),a(j,{class:"my-2"}),a(k,{onClick:P=>de(s)},{prepend:l(()=>[a(v,{icon:"tabler-trash",color:"error"})]),default:l(()=>[a(D,{class:"text-error"},{default:l(()=>e[25]||(e[25]=[f(" Delete ")])),_:1,__:[25]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),bottom:l(()=>[a(xe,{page:o(x),"onUpdate:page":e[6]||(e[6]=s=>g(x)?x.value=s:null),"items-per-page":o(y),"total-items":o(N)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),a(Fe,{"is-drawer-open":o(w),"onUpdate:isDrawerOpen":[e[10]||(e[10]=s=>g(w)?w.value=s:null),me],franchisee:o(m),onFranchiseeData:ne},null,8,["is-drawer-open","franchisee"]),a(ke,{"is-dialog-open":o(A),"onUpdate:isDialogOpen":e[11]||(e[11]=s=>g(A)?A.value=s:null),"user-name":(q=o(F))==null?void 0:q.fullName,"user-type":"Franchisee",onConfirm:ce},null,8,["is-dialog-open","user-name"]),a(De,{"is-dialog-open":o(E),"onUpdate:isDialogOpen":e[12]||(e[12]=s=>g(E)?E.value=s:null),"user-name":(J=o(m))==null?void 0:J.fullName,onConfirm:fe},null,8,["is-dialog-open","user-name"]),a(Ue,{"is-dialog-open":o(S),"onUpdate:isDialogOpen":e[13]||(e[13]=s=>g(S)?S.value=s:null),user:o(m),"user-type":"Franchisee",onEdit:ge},null,8,["is-dialog-open","user"])])}}});export{Rt as default};
