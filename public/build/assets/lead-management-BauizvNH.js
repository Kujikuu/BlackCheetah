import{V as ge,_ as ye}from"./VDataTableServer-D9OHaVwO.js";import{_ as be}from"./AppTextField.vue_vue_type_script_setup_true_lang-zpwrxD59.js";import{_ as Ve}from"./AppSelect.vue_vue_type_script_setup_true_lang-DL-DX4eG.js";import{_ as xe}from"./AddNoteDialog.vue_vue_type_script_setup_true_lang-Do9H4gRM.js";import{_ as he}from"./ImportLeadsDialog.vue_vue_type_script_setup_true_lang-EROnG71i.js";import{_ as Ce}from"./DeleteLeadDialog.vue_vue_type_script_setup_true_lang-Bb4uZPUy.js";import{d as we,g as n,O as ke,w as Se,E as De,e as Le,aQ as Ue,c as q,o as A,l as i,y as l,k as a,F as Ne,r as $e,i as o,a as O,t as r,s as Ae,av as k,q as v,aI as c,h as Be,a7 as S}from"./main-C_m4DwnX.js";import{l as D}from"./lead-C-DHPbnV.js";import{a as B,V as j}from"./VRow-CiO-FbWu.js";import{V as M,f as E,b as Q,a as Ie,d as Te}from"./VCard-SlzzMb5H.js";import{V as J}from"./VDivider-DrLnT-Ac.js";import{V as Ee}from"./VSpacer-Boan_0s7.js";import{V as Pe}from"./VMenu-nkRY6JLl.js";import{V as ze,a as W,b as G}from"./VList-CKyyLZkF.js";import{V as Fe}from"./VChip-bNZZiaKp.js";import"./VPagination-Qh7xe0gx.js";import"./VDataTable-Ch9w524i.js";import"./VSelect-Cdrlsxi4.js";import"./VTextField-DqjZ8OOj.js";import"./VField-DvEiP886.js";import"./form-DYCB4Gfc.js";import"./VInput-BI41h3_F.js";import"./VCheckboxBtn-q5wTK24I.js";import"./VSelectionControl-Dh4iX8GB.js";import"./VTable-BboKDnZ1.js";import"./AppTextarea.vue_vue_type_script_setup_true_lang-Bg7Xdqpb.js";import"./VTextarea-CHZPsePj.js";import"./VDialog-KRupcDn1.js";import"./useValidationRules-DgFsizhd.js";import"./VForm-D4l7pbSV.js";import"./VFileInput-pjBSiYlJ.js";import"./api-router-B3QnVntj.js";import"./VSlideGroup-BekFRdKS.js";const Re={class:"d-flex mb-6"},qe={class:"d-flex justify-space-between"},Oe={class:"d-flex flex-column gap-y-1"},je={class:"text-body-1 text-high-emphasis"},Me={class:"d-flex gap-x-2 align-center"},Qe={class:"text-h4"},Je={class:"me-3 d-flex gap-3"},We={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Ge={style:{"inline-size":"15.625rem"}},He={class:"text-body-1 font-weight-medium"},Ke={class:"d-flex align-center gap-x-4"},Xe={class:"d-flex flex-column"},Ye={class:"text-body-1"},Ze={class:"text-body-1"},et={class:"text-body-1"},tt={class:"text-body-1"},lt={class:"text-body-1 text-capitalize"},at={class:"text-body-1"},st={class:"text-body-1"},Ft=we({__name:"lead-management",setup(ot){const g=n(""),y=n(),b=n(),V=n(),L=n(!1),P=n(null),x=n(!1),h=n(!1),I=n(null),f=n(!1),C=n(null),m=n(10),p=n(1),z=n(),F=n(),d=n([]),H=s=>{var t,u;z.value=(t=s.sortBy[0])==null?void 0:t.key,F.value=(u=s.sortBy[0])==null?void 0:u.order,_()},K=s=>s>0?`+${s}`:s,X=s=>s.split(" ").map(t=>t[0]).join("").toUpperCase(),Y=[{title:"#",key:"index",sortable:!1},{title:"Lead Name",key:"name"},{title:"Company",key:"company"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Location",key:"location"},{title:"Source",key:"source"},{title:"Status",key:"status"},{title:"Owner",key:"owner"},{title:"Last Contacted",key:"lastContacted"},{title:"Actions",key:"actions",sortable:!1}],U=n([]),w=n(0),R=n([]),Z=ke(()=>U.value),_=async()=>{try{f.value=!0,C.value=null;const s=await D.getLeads({status:y.value,source:b.value,owner:V.value,search:g.value,itemsPerPage:m.value,page:p.value,sortBy:z.value,orderBy:F.value});s.success&&s.data?(U.value=s.data.leads||[],w.value=s.data.total||0):(U.value=[],w.value=0)}catch(s){C.value=s.message||"Failed to fetch leads",console.error("Error fetching leads:",s),U.value=[],w.value=0}finally{f.value=!1}},N=async()=>{try{const s=await D.getStatistics();s.success&&(R.value=s.data)}catch(s){console.error("Error fetching statistics:",s)}};Se([g,y,b,V,p,m],()=>{_()}),De(()=>{_(),N()});const ee=[{title:"Website",value:"website"},{title:"Referral",value:"referral"},{title:"Social Media",value:"social_media"},{title:"Email Campaign",value:"email"}],te=[{title:"Qualified",value:"qualified"},{title:"Unqualified",value:"unqualified"}],le=[{title:"Sarah Johnson",value:"sarah_johnson"},{title:"John Smith",value:"john_smith"},{title:"Michael Brown",value:"michael_brown"}],ae=s=>{const t=s.toLowerCase();return t==="qualified"?"success":t==="unqualified"?"error":"primary"},se=s=>{I.value=s,h.value=!0},oe=async()=>{if(d.value.length!==0)try{f.value=!0,(await D.bulkDelete(d.value)).success&&(await _(),await N(),d.value=[])}catch(s){console.error("Error bulk deleting leads:",s),C.value=s.message||"Failed to delete leads"}finally{f.value=!1}},$=n(null),ie=async()=>{if(!$.value){C.value="Please select a CSV file";return}try{f.value=!0,(await D.importCsv($.value)).success&&(await _(),await N(),x.value=!1,$.value=null)}catch(s){console.error("Error importing CSV:",s),C.value=s.message||"Failed to import CSV"}finally{f.value=!1}},ne=()=>{const s=d.value.length>0?d.value:void 0,t=D.exportCsv(s),u=document.createElement("a");u.href=t,u.download=`leads_${d.value.length>0?"selected":"all"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(u),u.click(),document.body.removeChild(u)},re=s=>{P.value=s,L.value=!0},de=()=>{console.log("Note added successfully")},ue=async()=>{await _(),await N(),h.value=!1,I.value=null},ce=s=>{s&&($.value=s,ie())},me=Le(),pe=()=>{me.push({name:"broker-add-lead"})};return(s,t)=>{const u=Ve,ve=be,fe=Ue("RouterLink"),_e=ye;return A(),q("section",null,[i("div",Re,[l(j,null,{default:a(()=>[(A(!0),q(Ne,null,$e(o(R),(e,T)=>(A(),O(B,{key:T,cols:"12",md:"4",sm:"6"},{default:a(()=>[l(M,null,{default:a(()=>[l(E,null,{default:a(()=>[i("div",qe,[i("div",Oe,[i("div",je,r(e.title),1),i("div",Me,[i("h4",Qe,r(e.value),1),i("div",{class:Ae(["text-base",e.change>0?"text-success":"text-error"])}," ("+r(K(e.change))+"%) ",3)])]),l(Q,{color:e.iconColor,variant:"tonal",rounded:"",size:"42"},{default:a(()=>[l(k,{icon:e.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),l(M,{class:"mb-6"},{default:a(()=>[l(Ie,{class:"pb-4"},{default:a(()=>[l(Te,null,{default:a(()=>t[13]||(t[13]=[v("Filters")])),_:1,__:[13]})]),_:1}),l(E,null,{default:a(()=>[l(j,null,{default:a(()=>[l(B,{cols:"12",sm:"4"},{default:a(()=>[l(u,{modelValue:o(b),"onUpdate:modelValue":t[0]||(t[0]=e=>c(b)?b.value=e:null),placeholder:"Select Source",items:ee,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),l(B,{cols:"12",sm:"4"},{default:a(()=>[l(u,{modelValue:o(y),"onUpdate:modelValue":t[1]||(t[1]=e=>c(y)?y.value=e:null),placeholder:"Select Status",items:te,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),l(B,{cols:"12",sm:"4"},{default:a(()=>[l(u,{modelValue:o(V),"onUpdate:modelValue":t[2]||(t[2]=e=>c(V)?V.value=e:null),placeholder:"Select Owner",items:le,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(J),l(E,{class:"d-flex flex-wrap gap-4"},{default:a(()=>[i("div",Je,[l(u,{"model-value":o(m),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":t[3]||(t[3]=e=>m.value=parseInt(e,10))},null,8,["model-value"]),o(d).length>0?(A(),O(S,{key:0,variant:"tonal",color:"error",onClick:oe},{default:a(()=>[l(k,{icon:"tabler-trash",class:"me-2"}),v(" Delete Selected ("+r(o(d).length)+") ",1)]),_:1})):Be("",!0)]),l(Ee),i("div",We,[i("div",Ge,[l(ve,{modelValue:o(g),"onUpdate:modelValue":t[4]||(t[4]=e=>c(g)?g.value=e:null),placeholder:"Search Lead"},null,8,["modelValue"])]),l(S,{variant:"tonal",color:"secondary","prepend-icon":"tabler-file-import",onClick:t[5]||(t[5]=e=>x.value=!0)},{default:a(()=>t[14]||(t[14]=[v(" Import ")])),_:1,__:[14]}),l(S,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload",onClick:ne},{default:a(()=>[v(" Export "+r(o(d).length>0?`(${o(d).length})`:"All"),1)]),_:1}),l(S,{"prepend-icon":"tabler-plus",onClick:pe},{default:a(()=>t[15]||(t[15]=[v(" Add Lead ")])),_:1,__:[15]})])]),_:1}),l(J),l(ge,{"items-per-page":o(m),"onUpdate:itemsPerPage":t[7]||(t[7]=e=>c(m)?m.value=e:null),"model-value":o(d),"onUpdate:modelValue":t[8]||(t[8]=e=>c(d)?d.value=e:null),page:o(p),"onUpdate:page":t[9]||(t[9]=e=>c(p)?p.value=e:null),items:o(Z),"item-value":"id","items-length":o(w),headers:Y,class:"text-no-wrap","show-select":"","onUpdate:options":H},{"item.index":a(({index:e})=>[i("div",He,r((o(p)-1)*o(m)+e+1),1)]),"item.name":a(({item:e})=>[i("div",Ke,[l(Q,{size:"34",variant:"tonal",color:"primary"},{default:a(()=>[i("span",null,r(X(`${e.firstName} ${e.lastName}`)),1)]),_:2},1024),i("div",Xe,[l(fe,{to:{name:"broker-leads-id",params:{id:e.id}},class:"text-link"},{default:a(()=>[v(r(e.firstName)+" "+r(e.lastName),1)]),_:2},1032,["to"])])])]),"item.company":a(({item:e})=>[i("div",Ye,r(e.company),1)]),"item.email":a(({item:e})=>[i("div",Ze,r(e.email),1)]),"item.phone":a(({item:e})=>[i("div",et,r(e.phone),1)]),"item.location":a(({item:e})=>[i("div",tt,r(e.city)+", "+r(e.state),1)]),"item.source":a(({item:e})=>[i("div",lt,r(e.source),1)]),"item.status":a(({item:e})=>[l(Fe,{color:ae(e.status),size:"small",label:"",class:"text-capitalize"},{default:a(()=>[v(r(e.status),1)]),_:2},1032,["color"])]),"item.owner":a(({item:e})=>[i("div",at,r(e.owner),1)]),"item.lastContacted":a(({item:e})=>[i("div",st,r(e.lastContacted),1)]),"item.actions":a(({item:e})=>[l(S,{icon:"",variant:"text",color:"medium-emphasis"},{default:a(()=>[l(k,{icon:"tabler-dots-vertical"}),l(Pe,{activator:"parent"},{default:a(()=>[l(ze,null,{default:a(()=>[l(W,{onClick:T=>re(e.id)},{prepend:a(()=>[l(k,{icon:"tabler-note"})]),default:a(()=>[l(G,null,{default:a(()=>t[16]||(t[16]=[v("Add Note")])),_:1,__:[16]})]),_:2},1032,["onClick"]),l(W,{onClick:T=>se(e.id)},{prepend:a(()=>[l(k,{icon:"tabler-trash"})]),default:a(()=>[l(G,null,{default:a(()=>t[17]||(t[17]=[v("Delete")])),_:1,__:[17]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:a(()=>[l(_e,{page:o(p),"onUpdate:page":t[6]||(t[6]=e=>c(p)?p.value=e:null),"items-per-page":o(m),"total-items":o(w)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1}),l(he,{"is-dialog-visible":o(x),"onUpdate:isDialogVisible":t[10]||(t[10]=e=>c(x)?x.value=e:null),onImport:ce},null,8,["is-dialog-visible"]),l(Ce,{"is-dialog-visible":o(h),"onUpdate:isDialogVisible":t[11]||(t[11]=e=>c(h)?h.value=e:null),"lead-id":o(I),onLeadDeleted:ue},null,8,["is-dialog-visible","lead-id"]),l(xe,{"is-dialog-visible":o(L),"onUpdate:isDialogVisible":t[12]||(t[12]=e=>c(L)?L.value=e:null),"lead-id":o(P)||0,onNoteAdded:de},null,8,["is-dialog-visible","lead-id"])])}}});export{Ft as default};
