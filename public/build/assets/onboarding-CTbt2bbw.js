import{_ as B}from"./AppTextarea.vue_vue_type_script_setup_true_lang-DJ9yPu0I.js";import{_ as U}from"./AppSelect.vue_vue_type_script_setup_true_lang-Bz4_qTpH.js";import{_ as N}from"./AppTextField.vue_vue_type_script_setup_true_lang-CrhyYF4c.js";import{d as T,g as b,e as F,bf as O,b1 as y,bg as D,E,bl as v,O as M,c as L,o as V,l as c,y as s,aV as _,i as a,k as l,G as k,t as C,bb as I,a as Y,h as $,q as A,a7 as j,s as z}from"./main-BYpBSAj5.js";import{a as H,b as J}from"./auth-v1-top-shape-Be0n9vOV.js";import{V as h}from"./VNodeRenderer-DD_4D426.js";import{a as K,d as Q,f as S,V as G}from"./VCard-Ca_zP91K.js";import{V as W}from"./VForm-BOJkEg2X.js";import{V as X,a as m}from"./VRow-BqYOgTz2.js";import{V as Z}from"./VAlert-BdnW2TdI.js";import"./form-3qejRGpX.js";import"./VTextarea-BfIJJp-J.js";import"./VTextField-DyLIUBXh.js";import"./VField-eqPlPWcK.js";import"./forwardRefs-B931MWyl.js";import"./VInput-DSHxIYJN.js";import"./VSelect-B4XFvlOB.js";import"./VList-CIyV_jON.js";import"./VDivider-DekgMQwS.js";import"./VMenu-BmvlNcnX.js";import"./VOverlay-fzIdOlHt.js";import"./scopeId-DntWhGWm.js";import"./VCheckboxBtn-BGrXAimH.js";import"./VSelectionControl-BOWDk1vX.js";import"./VChip-CIWZSwOd.js";import"./VSlideGroup-BvgzkMEi.js";/* empty css              */const ee={class:"auth-wrapper d-flex align-center justify-center pa-4"},ae={class:"position-relative my-sm-16"},se={class:"app-logo"},oe={class:"app-logo-title"},Ne=T({__name:"onboarding",setup(te){const o=b({name:"",phone:"",country:"",state:"",city:"",address:""}),f=b(!1),i=b(null),d=F(),{smAndUp:w}=O(),x=y("userData"),{updateAbility:re}=D(),P=[{title:"Saudi Arabia",value:"Saudi Arabia"},{title:"United Arab Emirates",value:"United Arab Emirates"},{title:"Qatar",value:"Qatar"},{title:"Kuwait",value:"Kuwait"},{title:"Oman",value:"Oman"},{title:"Bahrain",value:"Bahrain"},{title:"Jordan",value:"Jordan"},{title:"Lebanon",value:"Lebanon"},{title:"Egypt",value:"Egypt"},{title:"Iraq",value:"Iraq"},{title:"Syria",value:"Syria"},{title:"Palestine",value:"Palestine"},{title:"Yemen",value:"Yemen"}];E(async()=>{var p;try{const e=await v.getStatus();if(e.success&&e.data&&(e.data.user&&(o.value={name:e.data.user.name||"",phone:e.data.user.phone||"",country:e.data.user.country||"",state:e.data.user.state||"",city:e.data.user.city||"",address:e.data.user.address||""}),e.data.profile_completed))switch((p=x.value)==null?void 0:p.role){case"admin":d.push("/admin/dashboard");break;case"franchisor":d.push("/franchisor");break;case"franchisee":d.push("/franchisee/dashboard/sales");break;case"sales":d.push("/sales/lead-management");break;default:d.push("/")}}catch(e){console.error("Failed to check onboarding status:",e)}});const R=async()=>{var p,e;f.value=!0,i.value=null;try{console.log("Submitting onboarding form:",o.value);const t=await v.complete(o.value);if(console.log("Onboarding response:",t),t.success&&t.data){console.log("Onboarding successful, updating user data...");const n=y("userData");switch(n.value&&(n.value={...n.value,profile_completed:!0,...t.data.user}),console.log("Redirecting to dashboard..."),(p=n.value)==null?void 0:p.role){case"admin":d.push("/admin/dashboard");break;case"franchisor":d.push("/franchisor");break;case"franchisee":d.push("/franchisee/dashboard/sales");break;case"sales":d.push("/sales/lead-management");break;default:d.push("/")}}else console.error("Onboarding failed:",t),i.value={general:[t.message||"Failed to complete profile. Please try again."]}}catch(t){console.error("Onboarding error:",t);const n=(t==null?void 0:t.data)||((e=t==null?void 0:t.response)==null?void 0:e._data)||null;n!=null&&n.errors?i.value=n.errors:i.value={general:[(n==null?void 0:n.message)||"Failed to complete profile. Please try again."]}}finally{f.value=!1}},q=M(()=>o.value.name&&o.value.phone&&o.value.country&&o.value.state&&o.value.city&&o.value.address);return(p,e)=>{const t=N,n=U,g=B;return V(),L("div",ee,[c("div",ae,[s(a(h),{nodes:_("div",{innerHTML:a(H)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),s(a(h),{nodes:_("div",{innerHTML:a(J)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),s(G,{class:z(["auth-card",a(w)?"pa-6":"pa-0"]),"max-width":"600"},{default:l(()=>[s(K,{class:"justify-center"},{default:l(()=>[s(Q,null,{default:l(()=>[c("div",se,[s(a(h),{nodes:a(k).app.logo},null,8,["nodes"]),c("h1",oe,C(a(k).app.title),1)])]),_:1})]),_:1}),s(S,null,{default:l(()=>e[6]||(e[6]=[c("h4",{class:"text-h4 mb-1"}," Complete Your Profile ",-1),c("p",{class:"mb-0"}," Please provide your personal information to complete your account setup ",-1)])),_:1,__:[6]}),s(S,null,{default:l(()=>[s(W,{onSubmit:I(R,["prevent"])},{default:l(()=>[s(X,null,{default:l(()=>[s(m,{cols:"12"},{default:l(()=>{var r;return[(r=a(i))!=null&&r.general?(V(),Y(Z,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:l(()=>[A(C(a(i).general[0]),1)]),_:1})):$("",!0)]}),_:1}),s(m,{cols:"12"},{default:l(()=>{var r;return[s(t,{modelValue:a(o).name,"onUpdate:modelValue":e[0]||(e[0]=u=>a(o).name=u),autofocus:"",label:"Full Name",placeholder:"Name","error-messages":(r=a(i))==null?void 0:r.name,required:""},null,8,["modelValue","error-messages"])]}),_:1}),s(m,{cols:"12"},{default:l(()=>{var r;return[s(t,{modelValue:a(o).phone,"onUpdate:modelValue":e[1]||(e[1]=u=>a(o).phone=u),label:"Phone Number",placeholder:"+966 50 123 4567","error-messages":(r=a(i))==null?void 0:r.phone,required:""},null,8,["modelValue","error-messages"])]}),_:1}),s(m,{cols:"12",md:"6"},{default:l(()=>{var r;return[s(n,{modelValue:a(o).country,"onUpdate:modelValue":e[2]||(e[2]=u=>a(o).country=u),label:"Country",placeholder:"Select Country",items:P,"error-messages":(r=a(i))==null?void 0:r.country,required:""},null,8,["modelValue","error-messages"])]}),_:1}),s(m,{cols:"12",md:"6"},{default:l(()=>{var r;return[s(t,{modelValue:a(o).state,"onUpdate:modelValue":e[3]||(e[3]=u=>a(o).state=u),label:"State/Province",placeholder:"Riyadh","error-messages":(r=a(i))==null?void 0:r.state,required:""},null,8,["modelValue","error-messages"])]}),_:1}),s(m,{cols:"12"},{default:l(()=>{var r;return[s(t,{modelValue:a(o).city,"onUpdate:modelValue":e[4]||(e[4]=u=>a(o).city=u),label:"City",placeholder:"Riyadh","error-messages":(r=a(i))==null?void 0:r.city,required:""},null,8,["modelValue","error-messages"])]}),_:1}),s(m,{cols:"12"},{default:l(()=>{var r;return[s(g,{modelValue:a(o).address,"onUpdate:modelValue":e[5]||(e[5]=u=>a(o).address=u),label:"Address",placeholder:"123 Main Street, Apt 4B","error-messages":(r=a(i))==null?void 0:r.address,rows:"3",required:""},null,8,["modelValue","error-messages"])]}),_:1}),s(m,{cols:"12"},{default:l(()=>[s(j,{block:"",type:"submit",loading:a(f),disabled:a(f)||!a(q),color:"primary",size:"large"},{default:l(()=>e[7]||(e[7]=[A(" Complete Profile ")])),_:1,__:[7]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])}}});export{Ne as default};
