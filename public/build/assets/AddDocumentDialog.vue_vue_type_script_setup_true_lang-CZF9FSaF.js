import{_ as q,V as P}from"./VDialog-z6AiDkdm.js";import{d as U,g as x,O as f,w as E,a as p,o as s,k as n,y as i,h as g,c as h,l as v,av as O,t as b,a7 as F,q as C}from"./main-CaTcLKNL.js";import{f as k}from"./franchise-CwZkgf9U.js";import{f as M}from"./franchisee-dashboard-BU0FK4Y9.js";import{V as X,f as z,g as G}from"./VCard-CS_ziklW.js";import{V as L}from"./VForm-C3QLM41t.js";import{V as R,a as V}from"./VRow-DYWQ7lCi.js";import{V as w}from"./VTextField-CvCFH6P5.js";import{V as $}from"./VTextarea-B3zF-AXj.js";import{V as j}from"./VSelect-DxDkvyke.js";import{V as J}from"./VAlert-Bum3S62G.js";import{V as K}from"./VFileInput-DnCsnAow.js";import{V as H}from"./VSpacer-gpOajNGi.js";const Q={class:"d-flex align-center"},W={class:"text-caption"},Y={key:1,class:"text-caption text-disabled mt-2"},Z={key:2,class:"text-caption text-disabled mt-2"},pe=U({__name:"AddDocumentDialog",props:{isDialogVisible:{type:Boolean},franchiseId:{},unitId:{},documentData:{},mode:{}},emits:["update:isDialogVisible","documentSaved","documentAdded"],setup(I,{emit:S}){const l=I,D=S,y=x(!1),e=x({id:null,name:"",title:"",description:"",file:null,file_name:null,type:"other",status:"active",is_confidential:!1,expiry_date:null}),m=f({get:()=>l.isDialogVisible,set:d=>D("update:isDialogVisible",d)}),T=[{title:"FDD",value:"fdd"},{title:"Franchise Agreement",value:"franchise_agreement"},{title:"Financial Study",value:"financial_study"},{title:"Franchise Kit",value:"franchise_kit"},{title:"Contract",value:"contract"},{title:"Agreement",value:"agreement"},{title:"Manual",value:"manual"},{title:"Certificate",value:"certificate"},{title:"Report",value:"report"},{title:"Other",value:"other"}];E(()=>[l.isDialogVisible,l.documentData],()=>{l.isDialogVisible&&(l.documentData?e.value={...l.documentData}:e.value={id:null,name:"",title:"",description:"",file:null,file_name:null,type:l.mode==="unit"?"":"other",status:"active",is_confidential:!1,expiry_date:null})},{immediate:!0});const u=f(()=>l.mode==="unit");f(()=>u.value?e.value.title:e.value.name);const A=async()=>{var t,c,a;if(u.value&&!l.unitId){console.error("No unit ID available");return}if(!u.value&&!l.franchiseId){console.error("No franchise ID available");return}if(!(u.value?e.value.title:e.value.name)){console.error("Document name/title is required");return}if(!e.value.id&&!e.value.file){console.error("File is required for new documents");return}y.value=!0;try{if(u.value){const o=new FormData;o.append("title",e.value.title||""),o.append("description",e.value.description||""),o.append("type",e.value.type),o.append("status",e.value.status||"pending"),o.append("comment",""),e.value.file&&o.append("file",e.value.file);const r=await M.createDocument(l.unitId,o);r.success?(D("documentAdded",{...r.data,id:((t=r.data)==null?void 0:t.id)||Date.now(),title:e.value.title,description:e.value.description,type:e.value.type,fileName:(c=e.value.file)==null?void 0:c.name,fileSize:B(((a=e.value.file)==null?void 0:a.size)||0),uploadDate:new Date().toISOString().split("T")[0],status:e.value.status||"pending",comment:"",file:e.value.file}),m.value=!1):console.error("Failed to save document:",r.message)}else{if(!l.franchiseId){console.error("No franchise ID provided");return}const o={name:e.value.name||"",description:e.value.description||"",type:e.value.type,status:e.value.status,is_confidential:e.value.is_confidential};e.value.expiry_date&&(o.expiry_date=e.value.expiry_date),e.value.file&&(o.file=e.value.file);let r;e.value.id!==null?r=await k.updateDocument(l.franchiseId,e.value.id,o):r=await k.createDocument(l.franchiseId,o),r.success?(D("documentSaved"),m.value=!1):console.error("Failed to save document:",r.message)}}catch(o){console.error("Error saving document:",o)}finally{y.value=!1}},B=d=>{if(d===0)return"0 Bytes";const t=1024,c=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(d)/Math.log(t));return`${Number.parseFloat((d/t**a).toFixed(2))} ${c[a]}`},_=()=>{m.value=!1},N=f(()=>e.value.id!==null?"Edit Document":"Add New Document");return(d,t)=>{const c=q;return s(),p(P,{modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=a=>m.value=a),"max-width":"600"},{default:n(()=>[i(c,{onClick:_}),i(X,{title:N.value},{default:n(()=>[i(z,null,{default:n(()=>[i(L,null,{default:n(()=>[i(R,null,{default:n(()=>[i(V,{cols:"12"},{default:n(()=>[u.value?(s(),p(w,{key:0,modelValue:e.value.title,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.title=a),label:"Document Title",placeholder:"Enter document title",variant:"outlined",required:""},null,8,["modelValue"])):(s(),p(w,{key:1,modelValue:e.value.name,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.name=a),label:"Document Name",placeholder:"Enter document name",variant:"outlined",required:""},null,8,["modelValue"]))]),_:1}),i(V,{cols:"12"},{default:n(()=>[i($,{modelValue:e.value.description,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.description=a),label:"Description",placeholder:"Enter document description",rows:"3",variant:"outlined",required:u.value},null,8,["modelValue","required"])]),_:1}),u.value?(s(),p(V,{key:0,cols:"12"},{default:n(()=>[i(j,{modelValue:e.value.type,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.type=a),label:"Document Type",placeholder:"Select document type",items:T,variant:"outlined",required:""},null,8,["modelValue"])]),_:1})):g("",!0),i(V,{cols:"12"},{default:n(()=>[e.value.id&&l.documentData?(s(),p(J,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:n(()=>[v("div",Q,[i(O,{icon:"tabler-file",class:"me-2"}),v("div",null,[t[6]||(t[6]=v("div",{class:"font-weight-medium"},"Current File",-1)),v("div",W,b(l.documentData.file_name||"Document file"),1)])])]),_:1})):g("",!0),i(K,{modelValue:e.value.file,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.file=a),label:e.value.id?"Replace File (Optional)":"Attach File",accept:u.value?".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.jpg,.jpeg,.png":".pdf,.doc,.docx","prepend-icon":"tabler-paperclip",variant:"outlined",required:!e.value.id},null,8,["modelValue","label","accept","required"]),u.value?(s(),h("div",Y," Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, JPG, JPEG, PNG ")):e.value.id?(s(),h("div",Z," Leave empty to keep the current file, or upload a new file to replace it ")):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),i(G,null,{default:n(()=>[i(H),i(F,{color:"secondary",variant:"outlined",onClick:_},{default:n(()=>t[7]||(t[7]=[C(" Cancel ")])),_:1,__:[7]}),i(F,{color:"primary",loading:y.value,onClick:A},{default:n(()=>[C(b(e.value.id!==null?"Update Document":"Add Document"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});export{pe as _};
