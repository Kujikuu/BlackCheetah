var oe=Object.defineProperty;var se=(t,s,i)=>s in t?oe(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i;var X=(t,s,i)=>se(t,typeof s!="symbol"?s+"":s,i);import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a_ as C,K,L as Q,ao as re,an as ie,a$ as le,aj as ce,aB as de,b0 as ue,M as W,b1 as me,y as o,n as I,b2 as fe,b3 as ge,b4 as Z,ad as _e,b5 as he,$ as ee,R as ve,b6 as be,I as P,J as U,av as w,c as V,o as u,l as p,t as y,d as E,O as G,a as _,aQ as te,k as n,q as N,i as l,r as j,F as $,h as S,b7 as pe,s as ye,g as F,b8 as M,E as ke,aZ as R,b9 as we,a7 as xe,e as Ce,ba as Ae,aH as Ne}from"./main-CSU6kgHA.js";import{C as ae}from"./NavbarThemeSwitcher.vue_vue_type_script_setup_true_lang-C6kYczi0.js";import{V as Y}from"./VMenu-D1DxuMHS.js";import{V as Ve,a as Se,d as $e,b as z,e as D}from"./VCard-C3SWsjmI.js";import{V as Te}from"./VChip-5PNz7pmK.js";import{V as Be}from"./VTooltip-C5u1F3aW.js";import{V as H}from"./VDivider-MLBtUVJ7.js";import{V as J,a as T,b as O,c as Pe}from"./VList-DCEwk4iA.js";import{V as Ue}from"./VSpacer-BqsowJbv.js";import{a as Re}from"./auth-CSgWpzPG.js";class Le{constructor(){X(this,"baseUrl","/v1/notifications")}async getNotifications(s){return await C(this.baseUrl,{method:"GET",query:s})}async getStats(){return await C(`${this.baseUrl}/stats`)}async markAsRead(s){return await C(`${this.baseUrl}/${s}/read`,{method:"PATCH"})}async markAsUnread(s){return await C(`${this.baseUrl}/${s}/unread`,{method:"PATCH"})}async markMultipleAsRead(s){return await C(`${this.baseUrl}/mark-multiple-read`,{method:"PATCH",body:s})}async markMultipleAsUnread(s){return await C(`${this.baseUrl}/mark-multiple-unread`,{method:"PATCH",body:s})}async markAllAsRead(){return await C(`${this.baseUrl}/mark-all-read`,{method:"PATCH"})}async deleteNotification(s){return await C(`${this.baseUrl}/${s}`,{method:"DELETE"})}}const A=new Le,Ie=Q({bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:ve,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...ee(),...he({location:"top end"}),..._e(),...Z(),...ge(),...fe({transition:"scale-rotate-transition"})},"VBadge"),L=K()({name:"VBadge",inheritAttrs:!1,props:Ie(),setup(t,s){const{backgroundColorClasses:i,backgroundColorStyles:r}=re(()=>t.color),{roundedClasses:k}=ie(t),{t:h}=le(),{textColorClasses:f,textColorStyles:v}=ce(()=>t.textColor),{themeClasses:g}=de(),{locationStyles:m}=ue(t,!0,d=>(t.floating?t.dot?2:4:t.dot?8:12)+(["top","bottom"].includes(d)?Number(t.offsetY??0):["left","right"].includes(d)?Number(t.offsetX??0):0));return W(()=>{const d=Number(t.content),x=!t.max||isNaN(d)?t.content:d<=Number(t.max)?d:`${t.max}+`,[e,a]=me(s.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return o(t.tag,I({class:["v-badge",{"v-badge--bordered":t.bordered,"v-badge--dot":t.dot,"v-badge--floating":t.floating,"v-badge--inline":t.inline},t.class]},a,{style:t.style}),{default:()=>{var c,b;return[o("div",{class:"v-badge__wrapper"},[(b=(c=s.slots).default)==null?void 0:b.call(c),o(be,{transition:t.transition},{default:()=>{var B,q;return[P(o("span",I({class:["v-badge__badge",g.value,i.value,k.value,f.value],style:[r.value,v.value,t.inline?{}:m.value],"aria-atomic":"true","aria-label":h(t.label,d),"aria-live":"polite",role:"status"},e),[t.dot?void 0:s.slots.badge?(q=(B=s.slots).badge)==null?void 0:q.call(B):t.icon?o(w,{icon:t.icon},null):x]),[[U,t.modelValue]])]}})])]}})}),{}}}),Ee=Q({start:Boolean,end:Boolean,...ee(),...Z()},"VListItemAction"),Fe=K()({name:"VListItemAction",props:Ee(),setup(t,s){let{slots:i}=s;return W(()=>o(t.tag,{class:["v-list-item-action",{"v-list-item-action--start":t.start,"v-list-item-action--end":t.end},t.class],style:t.style},i)),{}}}),Me={},ze={class:"h-100 d-flex align-center justify-md-space-between justify-center"},De={class:"d-flex align-center text-medium-emphasis"};function He(t,s){return u(),V("div",ze,[p("span",De," Copyright Â© BlackCheetah "+y(new Date().getFullYear())+". ",1)])}const ft=ne(Me,[["render",He]]),je={class:"d-flex align-start gap-3"},Ye={key:0},Je={class:"text-sm font-weight-medium mb-1"},Oe={class:"text-body-2 mb-2",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},qe={class:"text-sm text-disabled mb-0",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},Xe={class:"d-flex flex-column align-end"},Ge=E({__name:"Notifications",props:{notifications:{},badgeProps:{default:void 0},location:{default:"bottom end"}},emits:["read","unread","remove","click:notification"],setup(t,{emit:s}){const i=t,r=s;function k(m){return m?m.split(" ").map(d=>d[0]).join("").toUpperCase():""}const h=G(()=>i.notifications.some(m=>m.isSeen===!1)),f=()=>{const m=i.notifications.map(d=>d.id);h.value?r("read",m):r("unread",m)},v=G(()=>i.notifications.filter(m=>m.isSeen===!1).length),g=(m,d)=>{m?r("unread",[d]):r("read",[d])};return(m,d)=>{const x=te("IconBtn");return u(),_(x,{id:"notification-btn"},{default:n(()=>[o(L,I(i.badgeProps,{"model-value":i.notifications.some(e=>!e.isSeen),color:"error",dot:"","offset-x":"2","offset-y":"3"}),{default:n(()=>[o(w,{icon:"tabler-bell"})]),_:1},16,["model-value"]),o(Y,{activator:"parent",width:"380px",location:i.location,offset:"12px","close-on-content-click":!1},{default:n(()=>[o(Ve,{class:"d-flex flex-column"},{default:n(()=>[o(Se,{class:"notification-section"},{append:n(()=>[P(o(Te,{size:"small",color:"primary",class:"me-2"},{default:n(()=>[N(y(l(v))+" New ",1)]),_:1},512),[[U,i.notifications.some(e=>!e.isSeen)]]),P(o(x,{size:"34",onClick:f},{default:n(()=>[o(w,{size:"20",color:"high-emphasis",icon:l(h)?"tabler-mail-opened":"tabler-mail"},null,8,["icon"]),o(Be,{activator:"parent",location:"start"},{default:n(()=>[N(y(l(h)?"Mark all as read":"Mark all as unread"),1)]),_:1})]),_:1},512),[[U,i.notifications.length]])]),default:n(()=>[o($e,{class:"text-h6"},{default:n(()=>d[0]||(d[0]=[N(" Notifications ")])),_:1,__:[0]})]),_:1}),o(H),o(l(ae),{options:{wheelPropagation:!1},style:{"max-block-size":"23.75rem"}},{default:n(()=>[o(J,{class:"notification-list rounded-0 py-0"},{default:n(()=>[(u(!0),V($,null,j(i.notifications,(e,a)=>(u(),V($,{key:e.id},[a>0?(u(),_(H,{key:0})):S("",!0),o(T,{link:"",lines:"one","min-height":"66px",class:"list-item-hover-class",onClick:c=>m.$emit("click:notification",e)},{default:n(()=>{var c,b;return[p("div",je,[o(z,{color:e.color&&!e.img?e.color:void 0,variant:e.img?void 0:"tonal"},{default:n(()=>[e.text?(u(),V("span",Ye,y(k(e.text)),1)):S("",!0),e.img?(u(),_(D,{key:1,src:e.img},null,8,["src"])):S("",!0),e.icon?(u(),_(w,{key:2,icon:e.icon},null,8,["icon"])):S("",!0)]),_:2},1032,["color","variant"]),p("div",null,[p("p",Je,y((c=e.data)==null?void 0:c.title),1),p("p",Oe,y((b=e.data)==null?void 0:b.message),1),p("p",qe,y(e.created_at?new Date(e.created_at).toLocaleString():""),1)]),o(Ue),p("div",Xe,[o(w,{size:"10",icon:"tabler-circle-filled",color:e.isSeen?"#a8aaae":"primary",class:ye([`${e.isSeen?"visible-in-hover":""}`,"mb-2"]),onClick:pe(B=>g(e.isSeen,e.id),["stop"])},null,8,["color","class","onClick"]),o(w,{size:"20",icon:"tabler-x",class:"visible-in-hover",onClick:B=>m.$emit("remove",e.id)},null,8,["onClick"])])])]}),_:2},1032,["onClick"])],64))),128)),P(o(T,{class:"text-center text-medium-emphasis",style:{"block-size":"56px"}},{default:n(()=>[o(O,null,{default:n(()=>d[1]||(d[1]=[N("No Notification Found!")])),_:1,__:[1]})]),_:1},512),[[U,!i.notifications.length]])]),_:1})]),_:1})]),_:1})]),_:1},8,["location"])]),_:1})}}}),Ke=()=>{const t=F([]),s=F(!1),i=F({total:0,unread:0,read:0}),r=e=>{const a=new Date(e),b=Math.floor((new Date().getTime()-a.getTime())/(1e3*60*60));return b<1?"Just now":b<24?`${b}h ago`:b<48?"Yesterday":a.toLocaleDateString()},k=e=>{let a=e.data;if(typeof a=="string")try{a=JSON.parse(a)}catch(b){console.error("Failed to parse notification data:",b),a={}}const c=a||{};return{id:e.id,title:c.title||"Notification",subtitle:c.message||c.subtitle||"",time:r(e.created_at),color:c.color||"primary",isSeen:!!e.read_at,icon:c.icon||"tabler-bell",img:c.img,text:c.text,data:c,created_at:e.created_at,read_at:e.read_at}},h=async(e=!1)=>{try{s.value=!0;const a=e?{unread_only:!0}:{},c=await A.getNotifications(a);return c.success&&c.data?(t.value=c.data.data.map(k),c.data):null}catch(a){throw console.error("Error fetching notifications:",a),a}finally{s.value=!1}},f=async()=>{try{const e=await A.getStats();return e.success&&e.data?(i.value=e.data,e.data):null}catch(e){throw console.error("Error fetching notification stats:",e),e}},v=async e=>{try{e.length===1?await A.markAsRead(e[0]):await A.markMultipleAsRead({notification_ids:e}),t.value.forEach(a=>{e.includes(a.id)&&(a.isSeen=!0)}),await f()}catch(a){throw console.error("Error marking notifications as read:",a),a}},g=async e=>{try{e.length===1?await A.markAsUnread(e[0]):await A.markMultipleAsUnread({notification_ids:e}),t.value.forEach(a=>{e.includes(a.id)&&(a.isSeen=!1)}),await f()}catch(a){throw console.error("Error marking notifications as unread:",a),a}},m=async()=>{try{await A.markAllAsRead(),t.value.forEach(e=>{e.isSeen=!0}),await f()}catch(e){throw console.error("Error marking all notifications as read:",e),e}},d=async e=>{try{await A.deleteNotification(e);const a=t.value.findIndex(c=>c.id===e);a>-1&&t.value.splice(a,1),await f()}catch(a){throw console.error("Error removing notification:",a),a}},x=async e=>{e.isSeen||await v([e.id])};return{notifications:M(t),loading:M(s),stats:M(i),fetchNotifications:h,fetchStats:f,markAsRead:v,markAsUnread:g,markAllAsRead:m,removeNotification:d,handleNotificationClick:x}},gt=E({__name:"NavBarNotifications",setup(t){const{notifications:s,fetchNotifications:i,fetchStats:r,markAsRead:k,markAsUnread:h,removeNotification:f,handleNotificationClick:v}=Ke();ke(async()=>{try{if(!R("accessToken").value){console.warn("No access token available, skipping notification fetch");return}await i(),await r()}catch(e){if((e==null?void 0:e.status)===401||(e==null?void 0:e._statusCode)===401){console.warn("User not authenticated, skipping notification fetch");return}console.error("Failed to load notifications:",e)}});const g=async e=>{try{await f(e)}catch(a){console.error("Failed to remove notification:",a)}},m=async e=>{try{await k(e)}catch(a){console.error("Failed to mark notifications as read:",a)}},d=async e=>{try{await h(e)}catch(a){console.error("Failed to mark notifications as unread:",a)}},x=async e=>{try{await v(e)}catch(a){console.error("Failed to handle notification click:",a)}};return(e,a)=>{const c=Ge;return u(),_(c,{notifications:l(s),onRemove:g,onRead:m,onUnread:d,"onClick:notification":x},null,8,["notifications"])}}}),Qe=()=>we(),We={class:"d-flex gap-2 align-center"},Ze={class:"text-h6 font-weight-medium"},et={class:"px-4 py-2"},_t=E({__name:"UserProfile",setup(t){const s=Ce(),i=Qe(),r=R("userData"),k=async()=>{try{await Re.logout()}catch(f){console.error("Logout API error:",f)}finally{R("accessToken").value=null,r.value=null,R("userAbilityRules").value=null,i.update([]),await s.push("/login")}},h=[{type:"divider"},{type:"navItem",icon:"tabler-user",title:"Profile",to:{name:"pages-account-settings-tab",params:{tab:"account"}}},{type:"navItem",icon:"tabler-settings",title:"Settings",to:{name:"pages-account-settings-tab",params:{tab:"security"}}},{type:"divider"}];return(f,v)=>l(r)?(u(),_(L,{key:0,dot:"",bordered:"",location:"bottom right","offset-x":"1","offset-y":"2",color:"success"},{default:n(()=>[o(z,{size:"38",class:"cursor-pointer",color:l(r)&&l(r).avatar?void 0:"primary",variant:l(r)&&l(r).avatar?void 0:"tonal"},{default:n(()=>[l(r)&&l(r).avatar?(u(),_(D,{key:0,src:l(r).avatar},null,8,["src"])):(u(),_(w,{key:1,icon:"tabler-user"})),o(Y,{activator:"parent",width:"240",location:"bottom end",offset:"12px"},{default:n(()=>[o(J,null,{default:n(()=>[o(T,null,{default:n(()=>[p("div",We,[o(Fe,null,{default:n(()=>[o(L,{dot:"",location:"bottom right","offset-x":"3","offset-y":"3",color:"success",bordered:""},{default:n(()=>[o(z,{color:l(r)&&l(r).avatar?void 0:"primary",variant:l(r)&&l(r).avatar?void 0:"tonal"},{default:n(()=>[l(r)&&l(r).avatar?(u(),_(D,{key:0,src:l(r).avatar},null,8,["src"])):(u(),_(w,{key:1,icon:"tabler-user"}))]),_:1},8,["color","variant"])]),_:1})]),_:1}),p("div",null,[p("h6",Ze,y(l(r).fullName||l(r).name||l(r).username||"User"),1),o(Pe,{class:"text-capitalize text-disabled"},{default:n(()=>[N(y(l(r).role),1)]),_:1})])])]),_:1}),o(l(ae),{options:{wheelPropagation:!1}},{default:n(()=>[(u(),V($,null,j(h,g=>(u(),V($,{key:g.title},[g.type==="navItem"?(u(),_(T,{key:0,to:g.to},Ae({prepend:n(()=>[o(w,{icon:g.icon,size:"22"},null,8,["icon"])]),default:n(()=>[o(O,null,{default:n(()=>[N(y(g.title),1)]),_:2},1024)]),_:2},[g.badgeProps?{name:"append",fn:n(()=>[o(L,I({rounded:"sm",class:"me-3",ref_for:!0},g.badgeProps),null,16)]),key:"0"}:void 0]),1032,["to"])):(u(),_(H,{key:1,class:"my-2"}))],64))),64)),p("div",et,[o(xe,{block:"",size:"small",color:"error","append-icon":"tabler-logout",onClick:k},{default:n(()=>v[0]||(v[0]=[N(" Logout ")])),_:1,__:[0]})])]),_:1})]),_:1})]),_:1})]),_:1},8,["color","variant"])]),_:1})):S("",!0)}}),ht=E({__name:"I18n",props:{languages:{},location:{default:"bottom end"}},setup(t){const s=t,{locale:i}=Ne({useScope:"global"});return(r,k)=>{const h=te("IconBtn");return u(),_(h,null,{default:n(()=>[o(w,{icon:"tabler-language"}),o(Y,{activator:"parent",location:s.location,offset:"12px",width:"175"},{default:n(()=>[o(J,{selected:[l(i)],color:"primary"},{default:n(()=>[(u(!0),V($,null,j(s.languages,f=>(u(),_(T,{key:f.i18nLang,value:f.i18nLang,onClick:v=>i.value=f.i18nLang},{default:n(()=>[o(O,null,{default:n(()=>[N(y(f.label),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["selected"])]),_:1},8,["location"])]),_:1})}}});export{ft as F,L as V,ht as _,gt as a,_t as b};
