import{V as xe,_ as we}from"./VDataTableServer-DgxgTVFx.js";import{_ as Ve}from"./AppTextField.vue_vue_type_script_setup_true_lang-CbF3QHBY.js";import{_ as Ce}from"./AppSelect.vue_vue_type_script_setup_true_lang-BNAkJb35.js";import{_ as he}from"./AddEditBrokerDrawer.vue_vue_type_script_setup_true_lang-Uj18kWev.js";import{_ as Ue,a as Be}from"./ResetPasswordDialog.vue_vue_type_script_setup_true_lang-DVHKwqbV.js";import{_ as De,a as k}from"./ViewUserDialog.vue_vue_type_script_setup_true_lang-DUctfWzQ.js";import{d as Ae,g as n,O as Fe,E as Ee,c as T,o as b,y as s,k as l,l as r,F as Pe,r as $e,i as o,a as N,t as c,s as Ne,av as f,h as W,q as p,aI as v,a7 as A}from"./main-DjrYRpVy.js";import{a as L,V as I}from"./VRow-wdXljQGK.js";import{V as q,f as z,b as J,a as Se,d as Te,e as Le}from"./VCard-C2C7Fyqz.js";import{V as j}from"./VDivider-CTQt1wKM.js";import{V as Ie}from"./VSpacer-DuE_SDAT.js";import{V as Q}from"./VMenu-C2iClWBO.js";import{V as G,a as C,b as h}from"./VList-u4ppXP5c.js";import{V as ze}from"./VAlert-D9DJCpy5.js";import{V as je}from"./VChip-DvvKExJN.js";import"./VPagination-CI4cqEW4.js";import"./VDataTable-sTptgDxR.js";import"./VSelect-CQeM3shC.js";import"./VTextField-7ql3LvrM.js";import"./VField-Z2CTCHF9.js";import"./form-jRq57Kt-.js";import"./VInput-CdNQt4f8.js";import"./VCheckboxBtn-BhC0mwzJ.js";import"./VSelectionControl-BHoh6e7P.js";import"./VTable-Bx4Z2wDS.js";import"./VForm-Ciudj4Q_.js";import"./VNavigationDrawer-DGjowmbh.js";import"./VDialog-DAZY-FZS.js";import"./VTooltip-Cb7Kqgmg.js";import"./formatters-aoHiJebZ.js";/* empty css              */import"./VSlideGroup-D10q4egA.js";const Oe={class:"d-flex justify-space-between"},Re={class:"d-flex flex-column gap-y-1"},Me={class:"text-body-1 text-high-emphasis"},We={class:"d-flex gap-x-2 align-center"},qe={class:"text-h4"},Je={class:"text-sm"},Qe={class:"me-3 d-flex gap-3"},Ge={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},He={style:{"inline-size":"15.625rem"}},Ke={class:"text-center pa-8"},Xe={class:"d-flex align-center gap-x-4"},Ye={key:1},Ze={class:"d-flex flex-column"},et={class:"text-base font-weight-medium"},tt={class:"text-sm text-medium-emphasis"},st={class:"text-body-1 text-high-emphasis"},at={class:"text-body-1"},lt={class:"text-body-1"},ot={class:"d-flex gap-1"},zt=Ae({__name:"brokers",setup(rt){const _=n(""),U=n(),x=n(10),w=n(1),H=n([{key:"created_at",order:"desc"}]),K=n("desc"),u=n([]),X=t=>{var e;t.sortBy&&t.sortBy.length>0&&(H.value=t.sortBy,K.value=(e=t.sortBy[0])==null?void 0:e.order)},Y=[{title:"User",key:"user"},{title:"City",key:"city"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],g=n([]),S=n(!1),d=n(""),F=n(0),B=async()=>{S.value=!0,d.value="";try{const t=await k.getBrokers();if(t.success&&t.data){let e=[];Array.isArray(t.data)?e=t.data:t.data&&typeof t.data=="object"&&"data"in t.data&&Array.isArray(t.data.data)&&(e=t.data.data),console.log("Broker Users API Response:",{response:t,userData:e}),g.value=e.map(i=>({id:i.id,fullName:i.fullName||i.name,email:i.email,phone:i.phone||"",location:i.location||"",city:i.city||i.location||"",status:i.status,avatar:i.avatar,joinedDate:i.joinedDate||i.createdAt||i.created_at})),F.value=g.value.length}else g.value=[],F.value=0,d.value=t.message||"Failed to fetch broker users"}catch(t){console.error("Error fetching broker users:",t),d.value="Failed to fetch broker users"}finally{S.value=!1}},Z=Fe(()=>{let t=g.value;return _.value&&(t=t.filter(e=>e.fullName.toLowerCase().includes(_.value.toLowerCase())||e.email.toLowerCase().includes(_.value.toLowerCase())||e.city.toLowerCase().includes(_.value.toLowerCase()))),U.value&&(t=t.filter(e=>e.status===U.value)),t}),ee=[{title:"Pending",value:"pending"},{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],te=t=>{const e=t.toLowerCase();return e==="pending"?"warning":e==="active"?"success":e==="inactive"?"secondary":"primary"},y=n(!1),E=n(!1),P=n(!1),$=n(!1),m=n(null),V=n(null),se=t=>t>0?`+${t}`:t,ae=t=>{if(!t||typeof t!="string")return"U";const e=t.split(" ");return e.length>1?`${e[0][0]}${e[1][0]}`:t.slice(0,2)},le=async t=>{try{const e=await k.createUser({...t,role:"broker"});e.success?await B():d.value=e.message||"Failed to create broker user"}catch(e){console.error("Error creating broker user:",e),d.value="Failed to create broker user"}},oe=t=>{m.value={...t},y.value=!0},re=async t=>{try{const e=await k.updateUser(t.id,t);e.success?(await B(),m.value=null):d.value=e.message||"Failed to update broker user"}catch(e){console.error("Error updating broker user:",e),d.value="Failed to update broker user"}},ie=async t=>{t.id?await re(t):await le(t)},ne=t=>{V.value=t,E.value=!0},ue=async()=>{if(V.value){try{const t=await k.deleteUser(V.value.id);if(t.success){await B();const e=u.value.findIndex(i=>i===V.value.id);e!==-1&&u.value.splice(e,1)}else d.value=t.message||"Failed to delete broker user"}catch(t){console.error("Error deleting broker user:",t),d.value="Failed to delete broker user"}V.value=null}},de=async()=>{if(u.value.length!==0)try{for(const t of u.value)await k.deleteUser(t);await B(),u.value=[]}catch(t){console.error("Error bulk deleting broker users:",t),d.value="Failed to delete selected broker users"}},ce=t=>{m.value=t,P.value=!0},pe=async t=>{if(m.value){try{const e=await k.resetUserPassword(m.value.id,t);e.success?console.log("Password reset successfully for:",m.value.fullName):d.value=e.message||"Failed to reset password"}catch(e){console.error("Error resetting password:",e),d.value="Failed to reset password"}m.value=null}},me=()=>{m.value=null},O=n([{title:"Total Broker Users",value:"0",change:0,desc:"All broker team members",icon:"tabler-chart-line",iconColor:"primary"},{title:"Active Broker",value:"0",change:0,desc:"Currently active",icon:"tabler-user-check",iconColor:"success"},{title:"Pending Approval",value:"0",change:0,desc:"Awaiting verification",icon:"tabler-clock",iconColor:"warning"}]),fe=async()=>{try{const t=await k.getBrokersStats();t.success&&(O.value=t.data)}catch(t){console.error("Error fetching broker stats:",t)}},ve=t=>{m.value=t,$.value=!0},ge=()=>{y.value=!0},_e=()=>{const t=u.value.length>0?g.value.filter(e=>u.value.includes(e.id)):g.value;console.log("Exporting to CSV:",t)},ye=()=>{const t=u.value.length>0?g.value.filter(e=>u.value.includes(e.id)):g.value;console.log("Exporting to PDF:",t)};return Ee(()=>{B(),fe()}),(t,e)=>{var R,M;const i=Ce,ke=Ve,be=we;return b(),T("section",null,[s(I,{class:"mb-6"},{default:l(()=>[s(L,{cols:"12"},{default:l(()=>e[14]||(e[14]=[r("div",{class:"d-flex align-center justify-space-between"},[r("div",null,[r("h2",{class:"text-h2 mb-1"}," Brokers Management "),r("p",{class:"text-body-1 text-medium-emphasis"}," Manage and monitor all brokers ")])],-1)])),_:1,__:[14]})]),_:1}),s(I,{class:"mb-6"},{default:l(()=>[(b(!0),T(Pe,null,$e(o(O),(a,D)=>(b(),N(L,{key:D,cols:"12",md:"4",sm:"6"},{default:l(()=>[s(q,null,{default:l(()=>[s(z,null,{default:l(()=>[r("div",Oe,[r("div",Re,[r("div",Me,c(a.title),1),r("div",We,[r("h4",qe,c(a.value),1),r("div",{class:Ne(["text-base",a.change>0?"text-success":"text-error"])}," ("+c(se(a.change))+"%) ",3)]),r("div",Je,c(a.desc),1)]),s(J,{color:a.iconColor,variant:"tonal",rounded:"",size:"42"},{default:l(()=>[s(f,{icon:a.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(q,{class:"mb-6"},{default:l(()=>[s(Se,{class:"pb-4"},{default:l(()=>[s(Te,null,{default:l(()=>e[15]||(e[15]=[p("Filters")])),_:1,__:[15]})]),_:1}),s(z,null,{default:l(()=>[s(I,null,{default:l(()=>[s(L,{cols:"12",sm:"4"},{default:l(()=>[s(i,{modelValue:o(U),"onUpdate:modelValue":e[0]||(e[0]=a=>v(U)?U.value=a:null),placeholder:"Select Status",items:ee,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(j),s(z,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[r("div",Qe,[s(i,{"model-value":o(x),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=parseInt(a,10))},null,8,["model-value"]),o(u).length>0?(b(),N(A,{key:0,variant:"tonal",color:"error",onClick:de},{default:l(()=>[s(f,{icon:"tabler-trash",class:"me-2"}),p(" Delete Selected ("+c(o(u).length)+") ",1)]),_:1})):W("",!0)]),s(Ie),r("div",Ge,[r("div",He,[s(ke,{modelValue:o(_),"onUpdate:modelValue":e[2]||(e[2]=a=>v(_)?_.value=a:null),placeholder:"Search Broker User"},null,8,["modelValue"])]),s(A,{variant:"tonal",color:"secondary"},{default:l(()=>[s(f,{icon:"tabler-upload",class:"me-2"}),p(" Export "+c(o(u).length>0?`(${o(u).length})`:"All")+" ",1),s(Q,{activator:"parent"},{default:l(()=>[s(G,null,{default:l(()=>[s(C,{onClick:_e},{prepend:l(()=>[s(f,{icon:"tabler-file-type-csv"})]),default:l(()=>[s(h,null,{default:l(()=>e[16]||(e[16]=[p("Export to CSV")])),_:1,__:[16]})]),_:1}),s(C,{onClick:ye},{prepend:l(()=>[s(f,{icon:"tabler-file-type-pdf"})]),default:l(()=>[s(h,null,{default:l(()=>e[17]||(e[17]=[p("Export to PDF")])),_:1,__:[17]})]),_:1})]),_:1})]),_:1})]),_:1}),s(A,{"prepend-icon":"tabler-plus",onClick:e[3]||(e[3]=a=>y.value=!0)},{default:l(()=>e[18]||(e[18]=[p(" Add New Broker User ")])),_:1,__:[18]})])]),_:1}),s(j),o(d)?(b(),N(ze,{key:0,type:"error",class:"ma-4",closable:"","onClick:close":e[4]||(e[4]=a=>d.value="")},{default:l(()=>[p(c(o(d)),1)]),_:1})):W("",!0),s(xe,{"items-per-page":o(x),"onUpdate:itemsPerPage":e[7]||(e[7]=a=>v(x)?x.value=a:null),"model-value":o(u),"onUpdate:modelValue":e[8]||(e[8]=a=>v(u)?u.value=a:null),page:o(w),"onUpdate:page":e[9]||(e[9]=a=>v(w)?w.value=a:null),items:o(Z),"item-value":"id","items-length":o(F),headers:Y,class:"text-no-wrap","show-select":"",loading:o(S),"onUpdate:options":X},{"no-data":l(()=>[r("div",Ke,[s(f,{icon:"tabler-users-off",size:"64",class:"mb-4 text-disabled"}),e[20]||(e[20]=r("h3",{class:"text-h5 mb-2"}," No Broker Users Found ",-1)),e[21]||(e[21]=r("p",{class:"text-body-1 text-medium-emphasis mb-4"}," No broker users match your search criteria. Try adjusting your filters. ",-1)),s(A,{color:"primary",onClick:e[5]||(e[5]=a=>y.value=!0)},{default:l(()=>e[19]||(e[19]=[p(" Add First Broker User ")])),_:1,__:[19]})])]),"item.user":l(({item:a})=>[r("div",Xe,[s(J,{size:"34",variant:a.avatar?void 0:"tonal",color:"warning"},{default:l(()=>[a.avatar?(b(),N(Le,{key:0,src:a.avatar},null,8,["src"])):(b(),T("span",Ye,c(ae(a.fullName)),1))]),_:2},1032,["variant"]),r("div",Ze,[r("h6",et,c(a.fullName),1),r("div",tt," Joined: "+c(a.joinedDate),1)])])]),"item.city":l(({item:a})=>[r("div",st,c(a.city),1)]),"item.email":l(({item:a})=>[r("div",at,c(a.email),1)]),"item.phone":l(({item:a})=>[r("div",lt,c(a.phone),1)]),"item.status":l(({item:a})=>[s(je,{color:te(a.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[p(c(a.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:a})=>[r("div",ot,[s(A,{icon:"",variant:"text",color:"medium-emphasis",size:"small"},{default:l(()=>[s(f,{icon:"tabler-dots-vertical",size:"22"}),s(Q,{activator:"parent"},{default:l(()=>[s(G,null,{default:l(()=>[s(C,{onClick:D=>ve(a)},{prepend:l(()=>[s(f,{icon:"tabler-eye"})]),default:l(()=>[s(h,null,{default:l(()=>e[22]||(e[22]=[p("View")])),_:1,__:[22]})]),_:2},1032,["onClick"]),s(C,{onClick:D=>oe(a)},{prepend:l(()=>[s(f,{icon:"tabler-pencil"})]),default:l(()=>[s(h,null,{default:l(()=>e[23]||(e[23]=[p("Edit")])),_:1,__:[23]})]),_:2},1032,["onClick"]),s(C,{onClick:D=>ce(a)},{prepend:l(()=>[s(f,{icon:"tabler-key"})]),default:l(()=>[s(h,null,{default:l(()=>e[24]||(e[24]=[p("Reset Password")])),_:1,__:[24]})]),_:2},1032,["onClick"]),s(j,{class:"my-2"}),s(C,{onClick:D=>ne(a)},{prepend:l(()=>[s(f,{icon:"tabler-trash",color:"error"})]),default:l(()=>[s(h,{class:"text-error"},{default:l(()=>e[25]||(e[25]=[p(" Delete ")])),_:1,__:[25]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),bottom:l(()=>[s(be,{page:o(w),"onUpdate:page":e[6]||(e[6]=a=>v(w)?w.value=a:null),"items-per-page":o(x),"total-items":o(F)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),s(he,{"is-drawer-open":o(y),"onUpdate:isDrawerOpen":[e[10]||(e[10]=a=>v(y)?y.value=a:null),me],"broker-user":o(m),onBrokerUserData:ie},null,8,["is-drawer-open","broker-user"]),s(Ue,{"is-dialog-open":o(E),"onUpdate:isDialogOpen":e[11]||(e[11]=a=>v(E)?E.value=a:null),"user-name":(R=o(V))==null?void 0:R.fullName,"user-type":"Broker User",onConfirm:ue},null,8,["is-dialog-open","user-name"]),s(Be,{"is-dialog-open":o(P),"onUpdate:isDialogOpen":e[12]||(e[12]=a=>v(P)?P.value=a:null),"user-name":(M=o(m))==null?void 0:M.fullName,onConfirm:pe},null,8,["is-dialog-open","user-name"]),s(De,{"is-dialog-open":o($),"onUpdate:isDialogOpen":e[13]||(e[13]=a=>v($)?$.value=a:null),user:o(m),"user-type":"Broker User",onEdit:ge},null,8,["is-dialog-open","user"])])}}});export{zt as default};
