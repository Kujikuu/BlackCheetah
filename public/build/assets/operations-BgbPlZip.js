import{_ as ye}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-CarmOyZu.js";import{V as Ce,_ as Te}from"./VDataTableServer-CKmfsbUj.js";import{_ as xe}from"./AppTextField.vue_vue_type_script_setup_true_lang-DQMalJbq.js";import{_ as De}from"./AppSelect.vue_vue_type_script_setup_true_lang-D4JkpZOU.js";import{d as we,g as p,w as Le,O as z,E as ee,c as U,o as y,y as t,k as a,F as N,r as R,q as h,av as C,t as g,aI as k,i as s,l as m,a as M,s as Se,h as te,a7 as w,b5 as Ae}from"./main-DTJHMfaq.js";import{_ as Ue}from"./ViewTaskDialog.vue_vue_type_script_setup_true_lang-BMhl5fGG.js";import{_ as $e}from"./DeleteTaskDialog.vue_vue_type_script_setup_true_lang-DIdZPXpW.js";import{f as Ie}from"./franchise-D_zzTmGQ.js";import{t as ae}from"./task-BxJC9pJL.js";import{a as Pe,V as Ee}from"./VTabs-Bayg_NbT.js";import{a as Oe,V as Be}from"./VWindowItem-CGc5GUTV.js";import{V as j,a as _}from"./VRow-vWSGPnzR.js";import{V as W,f as $,b as le,a as Fe,d as ze,g as Ne}from"./VCard-BEgq0Zx7.js";import{V as se}from"./VDivider-zvRfNiVO.js";import{V as oe}from"./VSpacer-C41_h5hf.js";import{V as Re}from"./VMenu-AaevCT9J.js";import{V as Me,a as q,b as H}from"./VList-Ep_DohB9.js";import{V as re}from"./VChip-DCBBAlzy.js";import{V as je}from"./VForm-eNmP1NWV.js";import{V as We}from"./VDialog-DAi3BTyw.js";import"./VPagination-DOW_yVym.js";import"./VDataTable-g1AsGRIG.js";import"./VSelect-DcsiMjZB.js";import"./VTextField-DW79TKGE.js";import"./VField-BTPv3jI0.js";import"./form-BTCRKuvE.js";import"./forwardRefs-B931MWyl.js";import"./VInput-DnyuMNdn.js";import"./VOverlay-Cl5-0R4l.js";import"./scopeId-Do09yNC1.js";import"./VCheckboxBtn-g4un3INl.js";import"./VSelectionControl-C7u8c___.js";import"./VTable-v4njjhfr.js";import"./api-router-zf5lUZNn.js";import"./VSlideGroup-D88xb4kb.js";/* empty css              */const qe={class:"d-flex mb-6"},He={class:"d-flex justify-space-between"},Qe={class:"d-flex flex-column gap-y-1"},Ge={class:"text-body-1 text-high-emphasis"},Je={class:"d-flex gap-x-2 align-center"},Ke={class:"text-h4"},Xe={class:"text-sm"},Ye={class:"me-3 d-flex gap-3"},Ze={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},et={style:{"inline-size":"15.625rem"}},tt={class:"d-flex flex-column"},at={class:"text-base font-weight-medium"},lt={class:"d-flex align-center gap-x-4"},st={class:"text-body-1"},ot={class:"text-body-1"},jt=we({__name:"operations",setup(rt){const I=p(null),Q=p(!1),G=async()=>{Q.value=!0;try{const o=await Ie.getDashboardOperations();I.value=o}catch(o){console.error("Error fetching operations data:",o),I.value=null}finally{Q.value=!1}},d=p("franchisee"),P=p(""),E=p(),O=p(),T=p(10),x=p(1),ie=p(),ne=p(),v=p([]),ce=o=>{var e,c;ie.value=(e=o.sortBy[0])==null?void 0:e.key,ne.value=(c=o.sortBy[0])==null?void 0:c.order},ue=[{title:"Task",key:"task"},{title:"Assigned To",key:"assignedTo"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Due Date",key:"dueDate"},{title:"Actions",key:"actions",sortable:!1}],f=p({franchisee:{tasks:[],total:0},broker:{tasks:[],total:0},staff:{tasks:[],total:0}}),L=p({franchisee:[{title:"Total",value:"0",change:0,desc:"All tasks",icon:"tabler-list-check",iconColor:"primary"},{title:"Completed",value:"0",change:0,desc:"Finished tasks",icon:"tabler-circle-check",iconColor:"success"},{title:"In Progress",value:"0",change:0,desc:"Active tasks",icon:"tabler-progress",iconColor:"info"},{title:"Due",value:"0",change:0,desc:"Overdue tasks",icon:"tabler-alert-circle",iconColor:"error"}],broker:[{title:"Total",value:"0",change:0,desc:"All tasks",icon:"tabler-list-check",iconColor:"primary"},{title:"Completed",value:"0",change:0,desc:"Finished tasks",icon:"tabler-circle-check",iconColor:"success"},{title:"In Progress",value:"0",change:0,desc:"Active tasks",icon:"tabler-progress",iconColor:"info"},{title:"Due",value:"0",change:0,desc:"Overdue tasks",icon:"tabler-alert-circle",iconColor:"error"}],staff:[{title:"Total",value:"0",change:0,desc:"All tasks",icon:"tabler-list-check",iconColor:"primary"},{title:"Completed",value:"0",change:0,desc:"Finished tasks",icon:"tabler-circle-check",iconColor:"success"},{title:"In Progress",value:"0",change:0,desc:"Active tasks",icon:"tabler-progress",iconColor:"info"},{title:"Due",value:"0",change:0,desc:"Overdue tasks",icon:"tabler-alert-circle",iconColor:"error"}]});Le(I,o=>{const e=o;if(e!=null&&e.success&&(e!=null&&e.data)){const c=e.data,u=i=>Array.isArray(i)?i.map(l=>({id:l.id,task:l.task,assignedTo:l.assigned_to,priority:l.priority,status:l.status,dueDate:new Date(l.due_date).toLocaleDateString()})):[],b=c.tasks??{franchisee:[],broker:[],staff:[]},r=c.stats??{franchisee:{total:0,total_change:0,completed:0,completed_change:0,in_progress:0,in_progress_change:0,due:0,due_change:0},broker:{total:0,total_change:0,completed:0,completed_change:0,in_progress:0,in_progress_change:0,due:0,due_change:0},staff:{total:0,total_change:0,completed:0,completed_change:0,in_progress:0,in_progress_change:0,due:0,due_change:0}};f.value={franchisee:{tasks:u(b.franchisee),total:r.franchisee.total},broker:{tasks:u(b.broker),total:r.broker.total},staff:{tasks:u(b.staff),total:r.staff.total}},L.value={franchisee:[{title:"Total",value:r.franchisee.total.toLocaleString(),change:r.franchisee.total_change,desc:"All tasks",icon:"tabler-list-check",iconColor:"primary"},{title:"Completed",value:r.franchisee.completed.toLocaleString(),change:r.franchisee.completed_change,desc:"Finished tasks",icon:"tabler-circle-check",iconColor:"success"},{title:"In Progress",value:r.franchisee.in_progress.toLocaleString(),change:r.franchisee.in_progress_change,desc:"Active tasks",icon:"tabler-progress",iconColor:"info"},{title:"Due",value:r.franchisee.due.toLocaleString(),change:r.franchisee.due_change,desc:"Overdue tasks",icon:"tabler-alert-circle",iconColor:"error"}],broker:[{title:"Total",value:r.broker.total.toLocaleString(),change:r.broker.total_change,desc:"All tasks",icon:"tabler-list-check",iconColor:"primary"},{title:"Completed",value:r.broker.completed.toLocaleString(),change:r.broker.completed_change,desc:"Finished tasks",icon:"tabler-circle-check",iconColor:"success"},{title:"In Progress",value:r.broker.in_progress.toLocaleString(),change:r.broker.in_progress_change,desc:"Active tasks",icon:"tabler-progress",iconColor:"info"},{title:"Due",value:r.broker.due.toLocaleString(),change:r.broker.due_change,desc:"Overdue tasks",icon:"tabler-alert-circle",iconColor:"error"}],staff:[{title:"Total",value:r.staff.total.toLocaleString(),change:r.staff.total_change,desc:"All tasks",icon:"tabler-list-check",iconColor:"primary"},{title:"Completed",value:r.staff.completed.toLocaleString(),change:r.staff.completed_change,desc:"Finished tasks",icon:"tabler-circle-check",iconColor:"success"},{title:"In Progress",value:r.staff.in_progress.toLocaleString(),change:r.staff.in_progress_change,desc:"Active tasks",icon:"tabler-progress",iconColor:"info"},{title:"Due",value:r.staff.due.toLocaleString(),change:r.staff.due_change,desc:"Overdue tasks",icon:"tabler-alert-circle",iconColor:"error"}]}}},{immediate:!0});const B=z(()=>d.value==="franchisee"?f.value.franchisee.tasks:d.value==="broker"?f.value.broker.tasks:f.value.staff.tasks),J=z(()=>d.value==="franchisee"?f.value.franchisee.total:d.value==="broker"?f.value.broker.total:f.value.staff.total),de=z(()=>d.value==="franchisee"?L.value.franchisee:d.value==="broker"?L.value.broker:L.value.staff);ee(()=>{G()});const K=[{title:"High",value:"high"},{title:"Medium",value:"medium"},{title:"Low",value:"low"}],X=[{title:"Completed",value:"completed"},{title:"In Progress",value:"in_progress"},{title:"Due",value:"due"}],fe=o=>{const e=o.toLowerCase();return e==="completed"?"success":e==="in_progress"?"info":e==="due"?"error":"primary"},pe=o=>{const e=o.toLowerCase();return e==="high"?"error":e==="medium"?"warning":e==="low"?"success":"primary"},D=p(!1),F=p(null),me=o=>{F.value=o,D.value=!0},ve=async()=>{if(v.value.length!==0)try{for(const e of v.value)await ae.deleteTask(e);const o=d.value==="franchisee"?f.value.franchisee.tasks:d.value==="broker"?f.value.broker.tasks:f.value.staff.tasks;v.value.forEach(e=>{const c=o.findIndex(u=>u.id===e);c!==-1&&o.splice(c,1)}),v.value=[]}catch(o){console.error("Error bulk deleting tasks:",o)}},S=p(!1),V=p(!1),n=p(null),ge=o=>{const c=(d.value==="franchisee"?f.value.franchisee.tasks:d.value==="broker"?f.value.broker.tasks:f.value.staff.tasks).find(u=>u.id===o);c&&(n.value=c,S.value=!0)},ke=o=>{const c=(d.value==="franchisee"?f.value.franchisee.tasks:d.value==="broker"?f.value.broker.tasks:f.value.staff.tasks).find(u=>u.id===o);c&&(n.value={...c},V.value=!0)},Y=async()=>{if(n.value){try{const o=await ae.updateTask(n.value.id,n.value);if(o.success&&o.data){const e=d.value==="franchisee"?f.value.franchisee.tasks:d.value==="broker"?f.value.broker.tasks:f.value.staff.tasks,c=e.findIndex(u=>u.id===n.value.id);if(c!==-1&&o.data){const u=o.data;e[c]={id:u.id,task:u.title||n.value.task,assignedTo:u.assignedTo||n.value.assignedTo,priority:u.priority||n.value.priority,status:u.status||n.value.status,dueDate:u.dueDate||n.value.dueDate}}}}catch(o){console.error("Error updating task:",o)}V.value=!1,n.value=null}},he=o=>{const e=d.value==="franchisee"?f.value.franchisee.tasks:d.value==="broker"?f.value.broker.tasks:f.value.staff.tasks,c=e.findIndex(u=>u.id===o);c!==-1&&e.splice(c,1),D.value=!1,F.value=null},be=()=>{const e=["Task,Assigned To,Priority,Status,Due Date",...(v.value.length>0?B.value.filter(r=>v.value.includes(r.id)):B.value).map(r=>`"${r.task}","${r.assignedTo}","${r.priority}","${r.status}","${r.dueDate}"`)].join(`
`),c=new Blob([e],{type:"text/csv"}),u=window.URL.createObjectURL(c),b=document.createElement("a");b.href=u,b.download=`${d.value}_tasks_${v.value.length>0?"selected":"all"}_${new Date().toISOString().split("T")[0]}.csv`,b.click(),window.URL.revokeObjectURL(u)},_e=o=>o>0?`+${o}`:`${o}`,Ve=o=>o.split(" ").map(e=>e[0]).join("").toUpperCase(),Z=[{title:"Franchisee",value:"franchisee",icon:"tabler-building-store"},{title:"Broker",value:"broker",icon:"tabler-users"},{title:"Staff",value:"staff",icon:"tabler-user"}];return ee(()=>{G()}),(o,e)=>{const c=De,u=xe,b=Te,r=ye;return y(),U("section",null,[t(Ee,{modelValue:s(d),"onUpdate:modelValue":e[0]||(e[0]=i=>k(d)?d.value=i:null),class:"mb-6"},{default:a(()=>[(y(),U(N,null,R(Z,i=>t(Pe,{key:i.value,value:i.value},{default:a(()=>[t(C,{icon:i.icon,start:""},null,8,["icon"]),h(" "+g(i.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),t(Be,{modelValue:s(d),"onUpdate:modelValue":e[9]||(e[9]=i=>k(d)?d.value=i:null),class:"disable-tab-transition"},{default:a(()=>[(y(),U(N,null,R(Z,i=>t(Oe,{key:i.value,value:i.value},{default:a(()=>[m("div",qe,[t(j,null,{default:a(()=>[(y(!0),U(N,null,R(s(de),(l,A)=>(y(),M(_,{key:A,cols:"12",md:"3",sm:"6"},{default:a(()=>[t(W,null,{default:a(()=>[t($,null,{default:a(()=>[m("div",He,[m("div",Qe,[m("div",Ge,g(l.title),1),m("div",Je,[m("h4",Ke,g(l.value),1),m("div",{class:Se(["text-base",l.change>0?"text-success":"text-error"])}," ("+g(_e(l.change))+"%) ",3)]),m("div",Xe,g(l.desc),1)]),t(le,{color:l.iconColor,variant:"tonal",rounded:"",size:"42"},{default:a(()=>[t(C,{icon:l.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),t(W,{class:"mb-6"},{default:a(()=>[t(Fe,{class:"pb-4"},{default:a(()=>[t(ze,null,{default:a(()=>e[20]||(e[20]=[h("Filters")])),_:1,__:[20]})]),_:1}),t($,null,{default:a(()=>[t(j,null,{default:a(()=>[t(_,{cols:"12",sm:"6"},{default:a(()=>[t(c,{modelValue:s(O),"onUpdate:modelValue":e[1]||(e[1]=l=>k(O)?O.value=l:null),placeholder:"Select Priority",items:K,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),t(_,{cols:"12",sm:"6"},{default:a(()=>[t(c,{modelValue:s(E),"onUpdate:modelValue":e[2]||(e[2]=l=>k(E)?E.value=l:null),placeholder:"Select Status",items:X,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(se),t($,{class:"d-flex flex-wrap gap-4"},{default:a(()=>[m("div",Ye,[t(c,{"model-value":s(T),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[3]||(e[3]=l=>T.value=parseInt(l,10))},null,8,["model-value"]),s(v).length>0?(y(),M(w,{key:0,variant:"tonal",color:"error",onClick:ve},{default:a(()=>[t(C,{icon:"tabler-trash",class:"me-2"}),h(" Delete Selected ("+g(s(v).length)+") ",1)]),_:1})):te("",!0)]),t(oe),m("div",Ze,[m("div",et,[t(u,{modelValue:s(P),"onUpdate:modelValue":e[4]||(e[4]=l=>k(P)?P.value=l:null),placeholder:"Search Task"},null,8,["modelValue"])]),t(w,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload",onClick:be},{default:a(()=>[h(" Export "+g(s(v).length>0?`(${s(v).length})`:"All"),1)]),_:1})])]),_:1}),t(se),t(Ce,{"items-per-page":s(T),"onUpdate:itemsPerPage":e[6]||(e[6]=l=>k(T)?T.value=l:null),"model-value":s(v),"onUpdate:modelValue":e[7]||(e[7]=l=>k(v)?v.value=l:null),page:s(x),"onUpdate:page":e[8]||(e[8]=l=>k(x)?x.value=l:null),items:s(B),"item-value":"id","items-length":s(J),headers:ue,class:"text-no-wrap","show-select":"","onUpdate:options":ce},{"item.task":a(({item:l})=>[m("div",tt,[m("h6",at,g(l.task),1)])]),"item.assignedTo":a(({item:l})=>[m("div",lt,[t(le,{size:"34",variant:"tonal",color:"primary"},{default:a(()=>[m("span",null,g(Ve(l.assignedTo)),1)]),_:2},1024),m("div",st,g(l.assignedTo),1)])]),"item.priority":a(({item:l})=>[t(re,{color:pe(l.priority),size:"small",label:"",class:"text-capitalize"},{default:a(()=>[h(g(l.priority),1)]),_:2},1032,["color"])]),"item.status":a(({item:l})=>[t(re,{color:fe(l.status),size:"small",label:"",class:"text-capitalize"},{default:a(()=>[h(g(l.status.replace("_"," ")),1)]),_:2},1032,["color"])]),"item.dueDate":a(({item:l})=>[m("div",ot,g(l.dueDate),1)]),"item.actions":a(({item:l})=>[t(w,{icon:"",variant:"text",color:"medium-emphasis"},{default:a(()=>[t(C,{icon:"tabler-dots-vertical"}),t(Re,{activator:"parent"},{default:a(()=>[t(Me,null,{default:a(()=>[t(q,{onClick:A=>ge(l.id)},{prepend:a(()=>[t(C,{icon:"tabler-eye"})]),default:a(()=>[t(H,null,{default:a(()=>e[21]||(e[21]=[h("View")])),_:1,__:[21]})]),_:2},1032,["onClick"]),t(q,{onClick:A=>ke(l.id)},{prepend:a(()=>[t(C,{icon:"tabler-pencil"})]),default:a(()=>[t(H,null,{default:a(()=>e[22]||(e[22]=[h("Edit")])),_:1,__:[22]})]),_:2},1032,["onClick"]),t(q,{onClick:A=>me(l.id)},{prepend:a(()=>[t(C,{icon:"tabler-trash"})]),default:a(()=>[t(H,null,{default:a(()=>e[23]||(e[23]=[h("Delete")])),_:1,__:[23]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:a(()=>[t(b,{page:s(x),"onUpdate:page":e[5]||(e[5]=l=>k(x)?x.value=l:null),"items-per-page":s(T),"total-items":s(J)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1})]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),t(Ue,{"is-dialog-visible":s(S),"onUpdate:isDialogVisible":e[10]||(e[10]=i=>k(S)?S.value=i:null),task:s(n)?{id:s(n).id,title:s(n).task,description:s(n).task,category:"general",assignedTo:s(n).assignedTo,unitName:null,startDate:null,dueDate:s(n).dueDate,priority:s(n).priority,status:s(n).status,leadId:null,leadName:null}:null},null,8,["is-dialog-visible","task"]),t(We,{modelValue:s(V),"onUpdate:modelValue":e[18]||(e[18]=i=>k(V)?V.value=i:null),"max-width":"600"},{default:a(()=>[t(r,{onClick:e[11]||(e[11]=i=>V.value=!1)}),s(n)?(y(),M(W,{key:0,title:"Edit Task"},{default:a(()=>[t($,null,{default:a(()=>[t(je,{onSubmit:Ae(Y,["prevent"])},{default:a(()=>[t(j,null,{default:a(()=>[t(_,{cols:"12"},{default:a(()=>[t(u,{modelValue:s(n).task,"onUpdate:modelValue":e[12]||(e[12]=i=>s(n).task=i),label:"Task",placeholder:"Enter task description"},null,8,["modelValue"])]),_:1}),t(_,{cols:"12",md:"6"},{default:a(()=>[t(u,{modelValue:s(n).assignedTo,"onUpdate:modelValue":e[13]||(e[13]=i=>s(n).assignedTo=i),label:"Assigned To",placeholder:"Enter assignee name"},null,8,["modelValue"])]),_:1}),t(_,{cols:"12",md:"6"},{default:a(()=>[t(u,{modelValue:s(n).dueDate,"onUpdate:modelValue":e[14]||(e[14]=i=>s(n).dueDate=i),label:"Due Date",type:"date"},null,8,["modelValue"])]),_:1}),t(_,{cols:"12",md:"6"},{default:a(()=>[t(c,{modelValue:s(n).priority,"onUpdate:modelValue":e[15]||(e[15]=i=>s(n).priority=i),label:"Priority",items:K,placeholder:"Select priority"},null,8,["modelValue"])]),_:1}),t(_,{cols:"12",md:"6"},{default:a(()=>[t(c,{modelValue:s(n).status,"onUpdate:modelValue":e[16]||(e[16]=i=>s(n).status=i),label:"Status",items:X,placeholder:"Select status"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(Ne,null,{default:a(()=>[t(oe),t(w,{color:"secondary",variant:"tonal",onClick:e[17]||(e[17]=i=>V.value=!1)},{default:a(()=>e[24]||(e[24]=[h(" Cancel ")])),_:1,__:[24]}),t(w,{color:"primary",onClick:Y},{default:a(()=>e[25]||(e[25]=[h(" Save Changes ")])),_:1,__:[25]})]),_:1})]),_:1})):te("",!0)]),_:1},8,["modelValue"]),t($e,{"is-dialog-visible":s(D),"onUpdate:isDialogVisible":e[19]||(e[19]=i=>k(D)?D.value=i:null),"task-id":s(F),onTaskDeleted:he},null,8,["is-dialog-visible","task-id"])])}}});export{jt as default};
