import{_ as P}from"./AppTextarea.vue_vue_type_script_setup_true_lang-DJ9yPu0I.js";import{_ as J}from"./AppTextField.vue_vue_type_script_setup_true_lang-CrhyYF4c.js";import{_ as L,V as R}from"./VDialog-CpdD25yY.js";import{d as M,g as x,O as W,w as Q,a as v,o as b,k as s,y as o,h as $,i as r,bb as Y,l as p,c as z,F as I,r as q,av as F,t as _,a7 as B,q as E,aM as G,b1 as Z}from"./main-BYpBSAj5.js";import{n as U}from"./AddNoteDialog.vue_vue_type_script_setup_true_lang-DLOqjYSz.js";import{V as N,f as O,h as j}from"./VCard-Ca_zP91K.js";import{V as ee}from"./VForm-BOJkEg2X.js";import{V as T,a as D}from"./VRow-BqYOgTz2.js";import{V as te}from"./VFileInput-C7r6RRJp.js";import{V as K}from"./VDivider-DekgMQwS.js";import{V as X}from"./VSpacer-DHG0No5I.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ae}from"./ConfirmDeleteDialog.vue_vue_type_script_setup_true_lang-ChT5AQ89.js";const le={class:"flex-grow-1 me-3"},se={class:"text-body-2 font-weight-medium"},ie={class:"text-caption text-disabled"},Ne=M({__name:"EditNoteDialog",props:{isDialogVisible:{type:Boolean},note:{}},emits:["update:isDialogVisible","noteUpdated"],setup(y,{emit:k}){const c=y,V=k,i=x(null),u=x([]),d=x(!1),g=W({get:()=>c.isDialogVisible,set:e=>V("update:isDialogVisible",e)});Q(()=>c.note,e=>{e&&(i.value={...e})},{immediate:!0});const C=e=>{const a=e.target;a.files&&(u.value=Array.from(a.files))},A=e=>{if(e===0)return"0 Bytes";const a=1024,f=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(e)/Math.log(a));return`${Number.parseFloat((e/a**w).toFixed(2))} ${f[w]}`},t=async e=>{if(i.value)try{const a=await U.deleteNoteAttachment(i.value.id,e);a.success?(i.value.attachments.splice(e,1),console.log("Attachment removed successfully")):console.error("Failed to remove attachment:",a.message)}catch(a){console.error("Error removing attachment:",a)}},n=async()=>{if(i.value)try{d.value=!0;const e=new FormData;e.append("title",i.value.title),e.append("description",i.value.description),e.append("_method","PUT"),u.value.forEach(f=>{e.append("attachments[]",f)});const a=await U.updateNoteWithFormData(i.value.id,e);a.success?(console.log("Note updated successfully"),V("noteUpdated"),g.value=!1,u.value=[]):console.error("Failed to update note:",a.message)}catch(e){console.error("Error updating note:",e)}finally{d.value=!1}},m=()=>{g.value=!1,u.value=[],c.note&&(i.value={...c.note})},l=e=>e.startsWith("image/")?"tabler-photo":e.startsWith("video/")?"tabler-video":e.startsWith("audio/")?"tabler-music":e.includes("pdf")?"tabler-file-type-pdf":e.includes("word")||e.includes("document")?"tabler-file-type-doc":e.includes("excel")||e.includes("spreadsheet")?"tabler-file-type-xls":e.includes("zip")||e.includes("compressed")?"tabler-file-zip":"tabler-file";return(e,a)=>{const f=L,w=J,H=P;return b(),v(R,{modelValue:r(g),"onUpdate:modelValue":a[2]||(a[2]=h=>G(g)?g.value=h:null),"max-width":"800"},{default:s(()=>[o(f,{onClick:m}),r(i)?(b(),v(N,{key:0,title:"Edit Note"},{default:s(()=>[o(O,null,{default:s(()=>[o(ee,{onSubmit:Y(n,["prevent"])},{default:s(()=>[o(T,null,{default:s(()=>[o(D,{cols:"12"},{default:s(()=>[o(w,{modelValue:r(i).title,"onUpdate:modelValue":a[0]||(a[0]=h=>r(i).title=h),label:"Title",placeholder:"Enter note title",disabled:r(d)},null,8,["modelValue","disabled"])]),_:1}),o(D,{cols:"12"},{default:s(()=>[o(H,{modelValue:r(i).description,"onUpdate:modelValue":a[1]||(a[1]=h=>r(i).description=h),label:"Description",placeholder:"Enter note description...",rows:"6",disabled:r(d)},null,8,["modelValue","disabled"])]),_:1}),r(i).attachments&&r(i).attachments.length>0?(b(),v(D,{key:0,cols:"12"},{default:s(()=>[a[3]||(a[3]=p("h6",{class:"text-h6 mb-3"}," Existing Attachments ",-1)),o(T,null,{default:s(()=>[(b(!0),z(I,null,q(r(i).attachments,(h,S)=>(b(),v(D,{key:S,cols:"12"},{default:s(()=>[o(N,{variant:"tonal",class:"d-flex align-center pa-3"},{default:s(()=>[o(F,{icon:l(h.type),size:"32",class:"me-3"},null,8,["icon"]),p("div",le,[p("div",se,_(h.name),1),p("div",ie,_(A(h.size)),1)]),o(B,{icon:"",size:"small",variant:"text",color:"error",disabled:r(d),onClick:ge=>t(S)},{default:s(()=>[o(F,{icon:"tabler-trash"})]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1,__:[3]})):$("",!0),o(D,{cols:"12"},{default:s(()=>[o(te,{label:"Attachments",multiple:"","prepend-icon":"tabler-paperclip",placeholder:"Upload files",chips:"","show-size":"",disabled:r(d),onChange:C},null,8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),o(K),o(j,null,{default:s(()=>[o(X),o(B,{color:"secondary",variant:"tonal",disabled:r(d),onClick:m},{default:s(()=>a[4]||(a[4]=[E(" Cancel ")])),_:1,__:[4]},8,["disabled"]),o(B,{color:"primary",loading:r(d),disabled:r(d),onClick:n},{default:s(()=>a[5]||(a[5]=[E(" Update Note ")])),_:1,__:[5]},8,["loading","disabled"])]),_:1})]),_:1})):$("",!0)]),_:1},8,["modelValue"])}}}),ne={class:"mb-6"},re={class:"text-body-1 whitespace-pre-wrap"},de={class:"text-body-2 text-medium-emphasis"},ce={key:0},ue={class:"text-h6 mb-3"},me={class:"flex-grow-1 me-3"},fe={class:"text-body-2 font-weight-medium"},pe={class:"text-caption text-disabled"},be=M({__name:"ViewNoteDialog",props:{isDialogVisible:{type:Boolean},note:{}},emits:["update:isDialogVisible"],setup(y,{emit:k}){const c=y,V=k,i=x(new Set),u=W({get:()=>c.isDialogVisible,set:t=>V("update:isDialogVisible",t)}),d=t=>new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),g=t=>{if(t===0)return"0 Bytes";const n=1024,m=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(t)/Math.log(n));return`${Number.parseFloat((t/n**l).toFixed(2))} ${m[l]}`},C=async(t,n)=>{if(c.note){i.value.add(n);try{const m=Z("accessToken").value;if(!m){console.error("No access token found");return}const l=await fetch(`/api/v1/notes/${c.note.id}/attachments/${n}/download`,{method:"GET",headers:{Authorization:`Bearer ${m}`,Accept:"application/octet-stream","X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!l.ok){const w=await l.text();throw console.error("Download failed:",l.status,w),new Error(`Failed to download attachment: ${l.status}`)}const e=await l.blob(),a=window.URL.createObjectURL(e),f=document.createElement("a");f.href=a,f.download=t.name,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(a)}catch(m){console.error("Error downloading attachment:",m);const l=document.createElement("a");l.href=`/storage/${t.path}`,l.download=t.name,l.target="_blank",document.body.appendChild(l),l.click(),document.body.removeChild(l)}finally{i.value.delete(n)}}},A=t=>t.startsWith("image/")?"tabler-photo":t.startsWith("video/")?"tabler-video":t.startsWith("audio/")?"tabler-music":t.includes("pdf")?"tabler-file-type-pdf":t.includes("word")||t.includes("document")?"tabler-file-type-doc":t.includes("excel")||t.includes("spreadsheet")?"tabler-file-type-xls":t.includes("zip")||t.includes("compressed")?"tabler-file-zip":"tabler-file";return(t,n)=>{const m=L;return b(),v(R,{modelValue:r(u),"onUpdate:modelValue":n[2]||(n[2]=l=>G(u)?u.value=l:null),"max-width":"800"},{default:s(()=>[o(m,{onClick:n[0]||(n[0]=l=>u.value=!1)}),t.note?(b(),v(N,{key:0,title:"Note Details"},{default:s(()=>[o(O,null,{default:s(()=>[p("div",ne,[p("p",re,_(t.note.description),1),p("p",de," Created by "+_(t.note.createdBy)+" at "+_(d(t.note.createdAt)),1)]),t.note.attachments&&t.note.attachments.length>0?(b(),z("div",ce,[p("h6",ue," Attachments ("+_(t.note.attachments.length)+") ",1),o(T,null,{default:s(()=>[(b(!0),z(I,null,q(t.note.attachments,(l,e)=>(b(),v(D,{key:e,cols:"12"},{default:s(()=>[o(N,{variant:"tonal",class:"d-flex align-center pa-3"},{default:s(()=>[o(F,{icon:A(l.type),size:"32",class:"me-3"},null,8,["icon"]),p("div",me,[p("div",fe,_(l.name),1),p("div",pe,_(g(l.size)),1)]),o(B,{icon:"",size:"small",variant:"text",color:"primary",loading:r(i).has(e),onClick:a=>C(l,e)},{default:s(()=>[o(F,{icon:"tabler-download"})]),_:2},1032,["loading","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):$("",!0)]),_:1}),o(K),o(j,null,{default:s(()=>[o(X),o(B,{color:"secondary",variant:"tonal",onClick:n[1]||(n[1]=l=>u.value=!1)},{default:s(()=>n[3]||(n[3]=[E(" Close ")])),_:1,__:[3]})]),_:1})]),_:1})):$("",!0)]),_:1},8,["modelValue"])}}}),Ae=oe(be,[["__scopeId","data-v-b64598b0"]]),ze=M({__name:"DeleteNoteDialog",props:{isDialogVisible:{type:Boolean},noteId:{}},emits:["update:isDialogVisible","note-deleted"],setup(y,{emit:k}){const c=y,V=k,i=x(!1),u=async()=>{if(c.noteId!==null){i.value=!0;try{const d=await U.deleteNote(c.noteId);d.success?(V("note-deleted"),V("update:isDialogVisible",!1)):console.error("Failed to delete note:",d.message)}catch(d){console.error("Error deleting note:",d)}finally{i.value=!1}}};return(d,g)=>(b(),v(ae,{"is-dialog-visible":c.isDialogVisible,"onUpdate:isDialogVisible":g[0]||(g[0]=C=>c.isDialogVisible=C),title:"Confirm Delete Note",message:"Are you sure you want to delete this note? This action cannot be undone.",onConfirm:u},null,8,["is-dialog-visible"]))}});export{Ae as V,Ne as _,ze as a};
