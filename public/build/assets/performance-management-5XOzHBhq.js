import{m as re}from"./vue3-apexcharts-CXzrBlfB.js";import{d as X,g as p,O as j,a as O,o as m,k as s,y as e,l as t,q as g,t as n,av as y,a7 as B,a_ as P,aB as ne,w as de,E as ce,c as _,h as ue,br as me,F as J,r as Q,s as pe}from"./main-BPhS35rw.js";import{_ as ve,V as fe}from"./VDialog-DKkWp4GN.js";import{V as F,f as S,h as he,a as xe,d as ye,b as U}from"./VCard-BzA-_fsU.js";import{V as Z}from"./VDivider-D5TM1l_v.js";import{V as A,a as z}from"./VRow-BBpj0UHg.js";import{V as M}from"./VSelect-CMXFgzzc.js";import{V as ee}from"./VAlert-CiCDJoow.js";import{f as be}from"./formatters--UtN2sCw.js";import{V as _e}from"./VOverlay-DT_ig7Kx.js";import{a as ge,V as we}from"./VTabs-BmRwQEIl.js";import{V as q}from"./VRating-DOQDtNp9.js";import{V as Ve}from"./VChip-D4pF-Hih.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-CqkleIqs.js";import"./forwardRefs-B931MWyl.js";import"./scopeId-CVHpW26W.js";import"./VMenu-BFWVwuN9.js";/* empty css              */import"./VTextField-DVYvDh-5.js";import"./VField-Cw0SCwyI.js";import"./form-DOPuC2wB.js";import"./VInput-ChEAXyAR.js";import"./VList-BOGntWk4.js";import"./VCheckboxBtn-C2M95TWh.js";import"./VSelectionControl-BCX0I6pt.js";import"./VWindowItem-B3EKE9OE.js";import"./VSlideGroup-DN13h1yr.js";const ke={class:"text-body-2"},De="/v1/franchisor/performance-management",ze=X({__name:"ExportPerformanceDialog",props:{isDialogVisible:{type:Boolean},selectedPeriod:{},selectedUnit:{},exportDataTypeOptions:{},exportFormatOptions:{},periodOptions:{},franchiseeUnits:{}},emits:["update:isDialogVisible","exportCompleted"],setup(H,{emit:L}){const i=H,v=L,h=p("performance"),b=p("csv"),V=p(!1),w=j({get:()=>i.isDialogVisible,set:d=>v("update:isDialogVisible",d)}),E=async()=>{var d;V.value=!0;try{const o=i.selectedUnit==="all"?null:i.selectedUnit,f=await P(`${De}/export`,{query:{period_type:i.selectedPeriod,unit_id:o,export_type:h.value}});if(f.success){const r=new Date().toISOString().split("T")[0],x=((d=i.franchiseeUnits.find(c=>c.id===i.selectedUnit))==null?void 0:d.name)||"All Units";(h.value==="performance"||h.value==="all")&&await C(f.data.performance,r,x),(h.value==="stats"||h.value==="all")&&await $(f.data.stats,r),v("exportCompleted"),w.value=!1}}catch(o){console.error("Error exporting data:",o)}finally{V.value=!1}},C=async(d,o,f)=>{if(!d||d.length===0)return;const r=["Period Date","Branch Name","Revenue","Expenses","Royalties","Profit","Profit Margin","Customer Rating","Reviews","Growth Rate"],x=`performance-data-${f.replace(/\s+/g,"-").toLowerCase()}-${i.selectedPeriod}-${o}.${b.value}`;if(b.value==="csv"){const c=k(d,r);D(c,x,"text/csv")}},$=async(d,o)=>{`${o}${b.value}`,b.value==="csv"&&console.log("Exporting stats data:",d)},k=(d,o)=>{const f=[o.join(",")];for(const r of d){const x=o.map(c=>`"${r[c.toLowerCase().replace(/\s+/g,"_")]||""}"`);f.push(x.join(","))}return f.join(`
`)},D=(d,o,f)=>{const r=new Blob([d],{type:f}),x=window.URL.createObjectURL(r),c=document.createElement("a");c.href=x,c.download=o,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(x)};return(d,o)=>{const f=ve;return m(),O(fe,{modelValue:w.value,"onUpdate:modelValue":o[4]||(o[4]=r=>w.value=r),"max-width":"600"},{default:s(()=>[e(f,{onClick:o[0]||(o[0]=r=>w.value=!1)}),e(F,{title:"Export Data",class:"text-center px-6 py-8"},{default:s(()=>[e(Z,{class:"mb-6"}),e(S,{class:"text-start"},{default:s(()=>[e(A,null,{default:s(()=>[e(z,{cols:"12"},{default:s(()=>[e(M,{modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=r=>h.value=r),items:i.exportDataTypeOptions,"item-title":"title","item-value":"value",label:"Data Type",variant:"outlined",density:"comfortable","prepend-inner-icon":"tabler-database"},null,8,["modelValue","items"])]),_:1}),e(z,{cols:"12"},{default:s(()=>[e(M,{modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=r=>b.value=r),items:i.exportFormatOptions,"item-title":"title","item-value":"value",label:"Export Format",variant:"outlined",density:"comfortable","prepend-inner-icon":"tabler-file-type-csv"},null,8,["modelValue","items"])]),_:1})]),_:1}),e(ee,{type:"info",variant:"tonal",class:"mt-4",density:"compact"},{prepend:s(()=>[e(y,{icon:"tabler-info-circle"})]),default:s(()=>{var r,x;return[t("div",ke,[o[5]||(o[5]=t("strong",null,"Current Selection:",-1)),o[6]||(o[6]=t("br",null,null,-1)),g(" Period: "+n((r=i.periodOptions.find(c=>c.value===i.selectedPeriod))==null?void 0:r.title),1),o[7]||(o[7]=t("br",null,null,-1)),g(" Unit: "+n((x=i.franchiseeUnits.find(c=>c.id===i.selectedUnit))==null?void 0:x.name),1)])]}),_:1})]),_:1}),e(he,{class:"d-flex align-center justify-center gap-3 pt-4"},{default:s(()=>[e(B,{variant:"outlined",color:"secondary",onClick:o[3]||(o[3]=r=>w.value=!1)},{default:s(()=>o[8]||(o[8]=[g(" Cancel ")])),_:1,__:[8]}),e(B,{color:"primary","prepend-icon":"tabler-download",disabled:V.value,loading:V.value,onClick:E},{default:s(()=>o[9]||(o[9]=[g(" Export Data ")])),_:1,__:[9]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Ue={class:"d-flex justify-space-between align-center flex-wrap gap-4"},Ee={class:"d-flex gap-3 align-center flex-wrap"},Pe={style:{height:"400px",position:"relative"}},Fe={key:1,class:"d-flex align-center justify-center h-100"},Se={class:"text-center"},$e={class:"d-flex align-center justify-space-between mb-4"},Te={class:"text-body-2 text-medium-emphasis"},Re={class:"mt-4"},je={key:0},Oe={class:"d-flex align-center"},Ae={class:"text-caption font-weight-bold"},Be={class:"text-body-2 font-weight-medium"},Le={class:"text-caption text-medium-emphasis"},Ne={class:"text-end"},Ie={class:"text-body-2 font-weight-medium"},qe={class:"text-caption text-success"},Me={key:1,class:"text-center py-4"},He={class:"d-flex align-center justify-space-between mb-4"},Ge={class:"mt-4 text-center"},Ke={class:"d-flex align-center justify-center mb-3"},Ye={class:"text-h3 me-2 text-success"},Je={class:"text-body-2 text-medium-emphasis"},Qe={class:"text-body-2 text-medium-emphasis mb-2"},We={class:"d-flex align-center justify-space-between mb-4"},Xe={key:0,class:"mt-4 text-center"},Ze={class:"text-h6 font-weight-medium mb-1"},et={class:"text-body-2 text-medium-emphasis mb-3"},tt={class:"d-flex align-center justify-center mb-2"},at={class:"text-h4 me-2 text-warning"},st={class:"text-caption text-medium-emphasis"},ot={key:1,class:"mt-4 text-center"},lt={class:"d-flex align-center justify-space-between mb-4"},it={key:0,class:"mt-4 text-center"},rt={class:"text-h6 font-weight-medium mb-1"},nt={class:"text-body-2 text-medium-emphasis mb-3"},dt={class:"d-flex align-center justify-center mb-2"},ct={class:"text-h4 me-2 text-error"},ut={class:"text-caption text-medium-emphasis mb-3"},mt={key:1,class:"mt-4 text-center"},R="/api/v1/franchisor/performance",pt="rgba(var(--v-theme-on-background), var(--v-high-emphasis-opacity))",W="rgba(var(--v-theme-on-background), var(--v-medium-emphasis-opacity))",vt="rgba(var(--v-border-color), var(--v-border-opacity))",ft=X({__name:"performance-management",setup(H){const L=ne(),i=p("monthly"),v=p("all"),h=p(!1),b=p(null),V=p([]),w=p({periods:[],datasets:{}}),E=p([]),C=p({score:0,max_score:5,total_reviews:0,trend:"0"}),$=p({top_rated:null,lowest_rated:null}),k=j(()=>$.value.top_rated),D=j(()=>$.value.lowest_rated),d={primary:"#9155FD",warning:"#FFB400",success:"#56CA00",error:"#FF4C51"},o=L.computedThemes.value,f=j(()=>({chart:{type:"line",height:400,toolbar:{show:!1},zoom:{enabled:!1},parentHeightOffset:0},stroke:{curve:"smooth",width:3},xaxis:{categories:w.value.periods,labels:{style:{colors:W,fontSize:"13px"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:W,fontSize:"13px"},formatter:l=>`${(l/1e3).toFixed(0)}k SAR`}},legend:{show:!0,position:"top",horizontalAlign:"left",labels:{colors:pt}},colors:[d.primary,d.error,d.warning,d.success],grid:{borderColor:vt,strokeDashArray:5,padding:{top:-20,bottom:-10,left:0,right:0}},tooltip:{theme:o.dark?"dark":"light",y:{formatter:l=>be(l)}}})),r=j(()=>{const l=v.value==="all"?"all":v.value.toString(),a=w.value.datasets[l];return a?[{name:"Revenue",data:a.revenue},{name:"Expenses",data:a.expenses},{name:"Royalties",data:a.royalties},{name:"Profit",data:a.profit}]:[]}),x=async()=>{try{const l=await P(`${R}/units`);l.success&&(V.value=l.data,(!v.value||!l.data.find(a=>a.id===v.value))&&(v.value="all"))}catch(l){console.error("Error fetching units:",l),b.value="Failed to fetch units"}},c=async()=>{try{h.value=!0;const l=v.value==="all"?null:v.value,a=await P(`${R}/chart-data`,{query:{period_type:i.value,unit_id:l}});a.success&&(w.value=a.data)}catch(l){console.error("Error fetching chart data:",l),b.value="Failed to fetch chart data"}finally{h.value=!1}},N=async()=>{try{const l=await P(`${R}/top-performers`,{query:{period_type:i.value,limit:3}});l.success&&(E.value=l.data)}catch(l){console.error("Error fetching top performers:",l)}},G=async()=>{try{const l=await P(`${R}/customer-satisfaction`,{query:{period_type:i.value}});l.success&&(C.value=l.data)}catch(l){console.error("Error fetching customer satisfaction:",l)}},K=async()=>{try{const l=await P(`${R}/ratings`,{query:{period_type:i.value}});l.success&&($.value=l.data)}catch(l){console.error("Error fetching ratings:",l)}},te=async()=>{await Promise.all([x(),c(),N(),G(),K()])};de([i,v],()=>{c(),N(),G(),K()}),ce(()=>{te()});const I=p(!1);p("csv"),p("performance");const ae=[{title:"CSV Format",value:"csv"},{title:"Excel Format",value:"xlsx"}],se=[{title:"Performance Data",value:"performance"},{title:"Statistics Summary",value:"stats"},{title:"All Data",value:"all"}],oe=()=>{I.value=!0},le=()=>{console.log("Export completed successfully")},Y=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}];return(l,a)=>{const ie=re;return m(),_("section",null,[e(_e,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=u=>h.value=u),class:"align-center justify-center"},{default:s(()=>[e(me,{indeterminate:"",color:"primary",size:"64"}),a[5]||(a[5]=t("div",{class:"text-center mt-4"},[t("h4",{class:"text-h4"}," Loading Performance Data... "),t("p",{class:"text-body-1 text-medium-emphasis"}," Please wait while we fetch the latest metrics ")],-1))]),_:1,__:[5]},8,["modelValue"]),b.value?(m(),O(ee,{key:0,type:"error",class:"mb-4",dismissible:"","onClick:dismiss":a[1]||(a[1]=u=>b.value=null)},{default:s(()=>[g(n(b.value),1)]),_:1})):ue("",!0),e(A,{class:"mb-6"},{default:s(()=>[e(z,{cols:"12"},{default:s(()=>[t("div",Ue,[a[7]||(a[7]=t("div",null,[t("h4",{class:"text-h4 mb-1"}," Performance Management "),t("p",{class:"text-body-1 text-medium-emphasis"}," Monitor and analyze franchise performance across all locations ")],-1)),t("div",Ee,[e(M,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=u=>i.value=u),items:Y,"item-title":"title","item-value":"value",density:"compact",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"]),e(B,{color:"primary","prepend-icon":"tabler-download",disabled:h.value,onClick:oe},{default:s(()=>a[6]||(a[6]=[g(" Export ")])),_:1,__:[6]},8,["disabled"])])])]),_:1})]),_:1}),e(A,null,{default:s(()=>[e(z,{cols:"12"},{default:s(()=>[e(F,null,{default:s(()=>[e(xe,{class:"pb-4"},{append:s(()=>[e(ge,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=u=>v.value=u),density:"compact",color:"primary"},{default:s(()=>[(m(!0),_(J,null,Q(V.value,u=>(m(),O(we,{key:u.id,value:u.id,size:"small"},{default:s(()=>[g(n(u.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),default:s(()=>[e(ye,{class:"text-h6"},{default:s(()=>a[8]||(a[8]=[g(" Franchise Performance Overview ")])),_:1,__:[8]})]),_:1}),e(Z),e(S,null,{default:s(()=>[t("div",Pe,[r.value.length>0?(m(),O(ie,{key:0,type:"line",height:"400",options:f.value,series:r.value},null,8,["options","series"])):(m(),_("div",Fe,[t("div",Se,[e(y,{icon:"tabler-chart-line",size:"64",class:"text-medium-emphasis mb-4"}),a[9]||(a[9]=t("p",{class:"text-body-1 text-medium-emphasis"}," No data available for the selected period and unit ",-1))])]))])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,{class:"mt-6"},{default:s(()=>[e(z,{cols:"12",md:"3"},{default:s(()=>[e(F,{class:"h-100"},{default:s(()=>[e(S,null,{default:s(()=>[t("div",$e,[t("div",null,[a[10]||(a[10]=t("h6",{class:"text-h6 mb-1"}," Top 3 Performing Location ",-1)),t("div",Te," This "+n(i.value==="monthly"?"month":i.value==="yearly"?"year":"period"),1)]),e(U,{color:"primary",variant:"tonal",size:"40"},{default:s(()=>[e(y,{icon:"tabler-trophy"})]),_:1})]),t("div",Re,[E.value.length>0?(m(),_("div",je,[(m(!0),_(J,null,Q(E.value,(u,T)=>(m(),_("div",{key:T,class:pe(["d-flex align-center justify-space-between py-3",{"border-b":T<E.value.length-1}])},[t("div",Oe,[e(U,{color:T===0?"warning":T===1?"info":"success",size:"24",class:"me-3"},{default:s(()=>[t("span",Ae,n(T+1),1)]),_:2},1032,["color"]),t("div",null,[t("div",Be,n(u.name),1),t("div",Le,n(u.location),1)])]),t("div",Ne,[t("div",Ie,n(u.revenue),1),t("div",qe,n(u.growth),1)])],2))),128))])):(m(),_("div",Me,[e(y,{icon:"tabler-chart-bar",size:"48",class:"text-medium-emphasis mb-2"}),a[11]||(a[11]=t("p",{class:"text-body-2 text-medium-emphasis"}," No performance data available ",-1))]))])]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"3"},{default:s(()=>[e(F,{class:"h-100"},{default:s(()=>[e(S,null,{default:s(()=>[t("div",He,[a[12]||(a[12]=t("div",null,[t("h6",{class:"text-h6 mb-1"}," Customer Satisfaction Score "),t("div",{class:"text-body-2 text-medium-emphasis"}," Average rating ")],-1)),e(U,{color:"success",variant:"tonal",size:"40"},{default:s(()=>[e(y,{icon:"tabler-star"})]),_:1})]),t("div",Ge,[t("div",Ke,[t("h3",Ye,n(C.value.score),1),t("div",Je," / "+n(C.value.max_score),1)]),e(q,{"model-value":C.value.score,readonly:"",size:"small",color:"warning",class:"mb-3"},null,8,["model-value"]),t("div",Qe," Based on "+n(C.value.total_reviews.toLocaleString())+" reviews ",1),e(Ve,{color:"success",size:"small",variant:"tonal"},{default:s(()=>[e(y,{start:"",icon:"tabler-trending-up",size:"16"}),g(" "+n(C.value.trend)+" this month ",1)]),_:1})])]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"3"},{default:s(()=>[e(F,{class:"h-100"},{default:s(()=>[e(S,null,{default:s(()=>[t("div",We,[a[13]||(a[13]=t("div",null,[t("h6",{class:"text-h6 mb-1"}," Top-Rated Franchise "),t("div",{class:"text-body-2 text-medium-emphasis"}," Highest customer rating ")],-1)),e(U,{color:"warning",variant:"tonal",size:"40"},{default:s(()=>[e(y,{icon:"tabler-award"})]),_:1})]),k.value?(m(),_("div",Xe,[e(U,{color:"warning",size:"60",class:"mb-3"},{default:s(()=>[e(y,{icon:"tabler-building-store",size:"30"})]),_:1}),t("div",Ze,n(k.value.name),1),t("div",et,n(k.value.location),1),t("div",tt,[t("h4",at,n(k.value.rating),1),e(q,{"model-value":k.value.rating,readonly:"",size:"small",color:"warning"},null,8,["model-value"])]),t("div",st,n(k.value.reviews)+" reviews ",1)])):(m(),_("div",ot,[e(y,{icon:"tabler-star-off",size:"48",class:"text-medium-emphasis mb-2"}),a[14]||(a[14]=t("p",{class:"text-body-2 text-medium-emphasis"}," No rating data available ",-1))]))]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"3"},{default:s(()=>[e(F,{class:"h-100"},{default:s(()=>[e(S,null,{default:s(()=>[t("div",lt,[a[15]||(a[15]=t("div",null,[t("h6",{class:"text-h6 mb-1"}," Lowest-Rated Franchise "),t("div",{class:"text-body-2 text-medium-emphasis"}," Needs attention ")],-1)),e(U,{color:"error",variant:"tonal",size:"40"},{default:s(()=>[e(y,{icon:"tabler-alert-triangle"})]),_:1})]),D.value?(m(),_("div",it,[e(U,{color:"error",size:"60",class:"mb-3"},{default:s(()=>[e(y,{icon:"tabler-building-store",size:"30"})]),_:1}),t("div",rt,n(D.value.name),1),t("div",nt,n(D.value.location),1),t("div",dt,[t("h4",ct,n(D.value.rating),1),e(q,{"model-value":D.value.rating,readonly:"",size:"small",color:"warning"},null,8,["model-value"])]),t("div",ut,n(D.value.reviews)+" reviews ",1),e(B,{color:"error",variant:"tonal",size:"small",block:""},{default:s(()=>[e(y,{start:"",icon:"tabler-message",size:"16"}),a[16]||(a[16]=g(" Contact Unit "))]),_:1,__:[16]})])):(m(),_("div",mt,[e(y,{icon:"tabler-star",size:"48",class:"text-medium-emphasis mb-2"}),a[17]||(a[17]=t("p",{class:"text-body-2 text-medium-emphasis"}," No rating data available ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(ze,{"is-dialog-visible":I.value,"onUpdate:isDialogVisible":a[4]||(a[4]=u=>I.value=u),"selected-period":i.value,"selected-unit":v.value,"export-data-type-options":se,"export-format-options":ae,"period-options":Y,"franchisee-units":V.value,onExportCompleted:le},null,8,["is-dialog-visible","selected-period","selected-unit","franchisee-units"])])}}}),Mt=Ce(ft,[["__scopeId","data-v-ecb4fb3c"]]);export{Mt as default};
