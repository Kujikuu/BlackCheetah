import{_ as E,V as O}from"./VDialog-DfSbSDx0.js";import{d as P,g as T,O as N,w as S,a as b,o as D,k as l,y as a,b7 as M,aI as Y,i as e,a7 as H,q as U}from"./main-CXTwBoPG.js";import{u as z,a as G,P as K,S as L}from"./EditTaskDialog.vue_vue_type_script_setup_true_lang-CepmCKAh.js";import{u as j}from"./useValidationRules-C2RzPGx6.js";import{a as J}from"./tasksValidation-abvi6X_f.js";import{V as Q,f as W,g as X}from"./VCard-BpibMe8x.js";import{V as Z}from"./VForm-B1prIvr_.js";import{V as _,a as u}from"./VRow-C6mGZDJV.js";import{V as p}from"./VTextField-DJtBSbnc.js";import{V as h}from"./VTextarea-DFx4J8dr.js";import{V as f}from"./VSelect-BXStkybT.js";import{V as ee}from"./VDivider-xqR5VkgL.js";import{V as se}from"./VSpacer-CUe9wgn0.js";const fe=P({__name:"CreateTaskDialog",props:{isDialogVisible:{type:Boolean},currentTab:{},defaultAssignedTo:{},unitId:{},disableAssignedTo:{type:Boolean},isFranchisee:{type:Boolean}},emits:["update:isDialogVisible","taskCreated"],setup(A,{emit:I}){const i=A,v=I,{getUsersForSelect:q,initializeUsers:c,loading:w}=z(),k=T(),{backendErrors:d,setBackendErrors:F,clearError:n}=j(),m=J(),V=T(!1),r=T({title:"",description:"",category:null,assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}),$=N(()=>{const o=i.currentTab||"franchisee";return q(o)}),x=o=>!!o||"This field is required",g=o=>{v("update:isDialogVisible",o)},y=()=>{r.value={title:"",description:"",category:null,assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}},C=async()=>{const{valid:o}=await k.value.validate();if(o)try{const s={id:Date.now(),...r.value};v("taskCreated",s),y(),g(!1)}catch(s){F(s)}},R=()=>{y(),g(!1)};return S(()=>i.isDialogVisible,async o=>{if(o){const s=i.currentTab||"franchisee";await c(s),i.defaultAssignedTo&&(r.value.assignedTo=i.defaultAssignedTo)}else y()}),S(()=>i.currentTab,async o=>{i.isDialogVisible&&o&&(await c(o),r.value.assignedTo="")}),(o,s)=>{const B=E;return D(),b(O,{"model-value":i.isDialogVisible,"max-width":"600",persistent:"","onUpdate:modelValue":g},{default:l(()=>[a(B,{onClick:s[0]||(s[0]=t=>g(!1))}),a(Q,{title:"Create New Task"},{default:l(()=>[a(W,{class:"pa-6"},{default:l(()=>[a(Z,{ref_key:"formRef",ref:k,modelValue:e(V),"onUpdate:modelValue":s[20]||(s[20]=t=>Y(V)?V.value=t:null),onSubmit:M(C,["prevent"])},{default:l(()=>[a(_,null,{default:l(()=>[a(u,{cols:"12"},{default:l(()=>[a(p,{modelValue:e(r).title,"onUpdate:modelValue":s[1]||(s[1]=t=>e(r).title=t),label:"Task Title",placeholder:"Enter task title",rules:e(m).title,"error-messages":e(d).title,onInput:s[2]||(s[2]=t=>e(n)("title")),required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),a(u,{cols:"12"},{default:l(()=>[a(h,{modelValue:e(r).description,"onUpdate:modelValue":s[3]||(s[3]=t=>e(r).description=t),label:"Description",placeholder:"Enter task description",rows:"3",rules:e(m).description,"error-messages":e(d).description,onInput:s[4]||(s[4]=t=>e(n)("description")),required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:l(()=>[a(f,{modelValue:e(r).category,"onUpdate:modelValue":[s[5]||(s[5]=t=>e(r).category=t),s[6]||(s[6]=t=>e(n)("category"))],label:"Category",placeholder:"Select category",items:e(G),rules:e(m).category,"error-messages":e(d).category,required:""},null,8,["modelValue","items","rules","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:l(()=>[i.isFranchisee?(D(),b(p,{key:0,label:"Assigned To","model-value":"Your Franchisor (Automatic)",readonly:"",disabled:"","persistent-hint":"",hint:"Tasks are automatically assigned to your franchisor"})):(D(),b(f,{key:1,modelValue:e(r).assignedTo,"onUpdate:modelValue":s[7]||(s[7]=t=>e(r).assignedTo=t),label:"Assigned To",placeholder:"Select user",items:e($),loading:e(w),rules:i.isFranchisee?[]:[x],"item-title":"title","item-value":"value",disabled:i.disableAssignedTo,required:!i.isFranchisee},null,8,["modelValue","items","loading","rules","disabled","required"]))]),_:1}),a(u,{cols:"12",md:"6"},{default:l(()=>[a(p,{modelValue:e(r).startDate,"onUpdate:modelValue":s[8]||(s[8]=t=>e(r).startDate=t),label:"Start Date",type:"date",rules:e(m).startDate,"error-messages":e(d).startDate,onInput:s[9]||(s[9]=t=>e(n)("startDate")),required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:l(()=>[a(p,{modelValue:e(r).dueDate,"onUpdate:modelValue":s[10]||(s[10]=t=>e(r).dueDate=t),label:"Due Date",type:"date",rules:e(m).dueDate,"error-messages":e(d).dueDate,onInput:s[11]||(s[11]=t=>e(n)("dueDate")),required:""},null,8,["modelValue","rules","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:l(()=>[a(f,{modelValue:e(r).priority,"onUpdate:modelValue":[s[12]||(s[12]=t=>e(r).priority=t),s[13]||(s[13]=t=>e(n)("priority"))],label:"Priority",placeholder:"Select priority",items:e(K),rules:e(m).priority,"error-messages":e(d).priority,required:""},null,8,["modelValue","items","rules","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:l(()=>[a(f,{modelValue:e(r).status,"onUpdate:modelValue":[s[14]||(s[14]=t=>e(r).status=t),s[15]||(s[15]=t=>e(n)("status"))],label:"Status",placeholder:"Select status",items:e(L),rules:e(m).status,"error-messages":e(d).status,required:""},null,8,["modelValue","items","rules","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:l(()=>[a(p,{modelValue:e(r).estimatedHours,"onUpdate:modelValue":s[16]||(s[16]=t=>e(r).estimatedHours=t),label:"Estimated Hours",type:"number",min:"0",rules:e(m).estimatedHours,"error-messages":e(d).estimatedHours,onInput:s[17]||(s[17]=t=>e(n)("estimatedHours"))},null,8,["modelValue","rules","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:l(()=>[a(p,{modelValue:e(r).actualHours,"onUpdate:modelValue":s[18]||(s[18]=t=>e(r).actualHours=t),label:"Actual Hours",type:"number",min:"0",rules:e(m).actualHours,"error-messages":e(d).actualHours,onInput:s[19]||(s[19]=t=>e(n)("actualHours"))},null,8,["modelValue","rules","error-messages"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(ee),a(X,{class:"pa-6"},{default:l(()=>[a(se),a(H,{color:"error",variant:"text",onClick:R},{default:l(()=>s[21]||(s[21]=[U(" Cancel ")])),_:1,__:[21]}),a(H,{color:"primary",disabled:!e(V),onClick:C},{default:l(()=>s[22]||(s[22]=[U(" Create Task ")])),_:1,__:[22]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{fe as _};
