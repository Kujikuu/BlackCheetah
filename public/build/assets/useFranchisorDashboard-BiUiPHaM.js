import{g as s,O as M,bc as r}from"./main-BYpBSAj5.js";import{f as v}from"./franchise-Br-lDrzK.js";import{l as N}from"./lead-DghcLHrD.js";import{u as C}from"./users-BZOt9mxA.js";const _=()=>{const h=s(!1),m=s(null),d=s(null),n=s([]),p=s([]),o=s([]),f=s(null),i=s(!0),y=s(!1),g=e=>{if(!e)return"Unknown";const a=new Date(e);if(Number.isNaN(a.getTime()))return console.warn("Invalid date string:",e),"Unknown";const l=new Date().getTime()-a.getTime(),c=Math.floor(l/(1e3*60*60));if(c<1)return"Just now";if(c<24)return`${c} hours ago`;const u=Math.floor(c/24);return u===1?"1 day ago":u<7?`${u} days ago`:u<30?`${Math.floor(u/7)} weeks ago`:a.toLocaleDateString()},$=M(()=>y.value?!0:i.value),w=async()=>{try{h.value=!0,m.value=null;const e=await v.getDashboardStats();if(e.success&&e.data)d.value=e.data;else throw new Error("Failed to fetch dashboard stats")}catch(e){m.value=e.message||"Failed to fetch dashboard statistics",console.error("Dashboard stats error:",e)}finally{h.value=!1}},A=async()=>{try{const e=await C.getSalesAssociates();if(e.success&&e.data){const a=Array.isArray(e.data)?e.data:e.data.data||[];n.value=a.map(t=>({id:t.id,name:t.name,email:t.email,phone:t.phone||"",status:t.status||"active",leads_count:t.assignedLeads||0,created_at:t.created_at}))}else n.value=[]}catch(e){console.error("Sales associates error:",e),n.value=[]}},b=async(e=10)=>{try{const a=await N.getLeadsWithLimit(e);a.success&&a.data?o.value=a.data:o.value=[]}catch(a){console.error("Leads error:",a),o.value=[]}},D=async()=>{try{const e=await v.getProfileCompletionStatus();e.success&&e.data?(f.value=e.data,i.value=!0):(i.value=!1,f.value=null)}catch(e){e.status===404||e.data&&e.data.success===!1?(i.value=!1,f.value=null):(i.value=!0,console.error("Profile completion error:",e))}},k=()=>{y.value=!0},S=()=>{var a;const e=[];Array.isArray(o.value)&&o.value.length>0&&o.value.slice(0,3).forEach(t=>{const l=`${t.firstName||""} ${t.lastName||""}`.trim()||"Unknown Lead",c=new Date().toISOString();e.push({id:t.id,type:"lead",title:`New lead: ${l}`,time:g(c),icon:"tabler-user-plus",color:"primary"})}),Array.isArray(n.value)&&n.value.length>0&&n.value.slice(0,2).forEach(t=>{if(t.status==="active"){const l=t.created_at||new Date().toISOString();e.push({id:t.id,type:"team",title:`${t.name} is managing ${t.leads_count} leads`,time:g(l),icon:"tabler-user-check",color:"info"})}}),(a=d.value)!=null&&a.currentMonthRevenue&&e.push({id:Date.now(),type:"revenue",title:`Monthly revenue: $${d.value.currentMonthRevenue.toLocaleString()}`,time:"This month",icon:"tabler-currency-riyal",color:"warning"}),p.value=e.filter(t=>t.time!=="Invalid Date").slice(0,5)},L=async()=>{await Promise.all([w(),A(),b(10),D()]),S()},E=async()=>{await L()},I=async()=>{try{return(await v.getFranchiseData()).success===!0}catch(e){return e.status===404?!1:(console.error("Error checking franchise existence:",e),!0)}};return{isLoading:r(h),error:r(m),dashboardStats:r(d),salesAssociates:r(n),recentActivities:r(p),leads:r(o),profileCompletionStatus:r(f),isProfileComplete:r($),franchiseExists:r(i),fetchDashboardStats:w,fetchSalesAssociates:A,fetchLeads:b,fetchProfileCompletion:D,dismissBanner:k,initializeDashboard:L,refreshDashboard:E,generateRecentActivities:S,checkFranchiseExists:I}};export{_ as u};
