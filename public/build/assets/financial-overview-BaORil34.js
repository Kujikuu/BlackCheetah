import{_ as ne,V as ie}from"./VDialog-OMqAAEGv.js";import{d as re,g as m,a as N,o as U,k as l,y as a,l as r,a7 as x,q as c,t as y,i as v,O as d,E as Ue,c as z,av as se,h as j,b7 as Ae,F as Q}from"./main-BWNnj23H.js";import{f as I}from"./franchisee-dashboard-BKLnq6J6.js";import{u as qe,a as Pe}from"./useValidationRules-BeYNlCez.js";import{V as h,f as R,g as ue,b as Y}from"./VCard-Ds29YdWC.js";import{V as de}from"./VForm-DwjLFOlB.js";import{V as he}from"./VFileInput-BIjN3VsD.js";import{V as Re}from"./VSpacer-BtP19Y8C.js";import{f as _}from"./formatters-aoHiJebZ.js";import{a as g,V as M}from"./VRow-CswInaof.js";import{V as H}from"./VSelect-B_B1jWF9.js";import{S as Te}from"./saudi-riyal-DbG8xZFf.js";import{V as Ie,a as W,b as Oe,c as G}from"./VTabs-Bze-BGN5.js";import{V as O}from"./VTextField-DkMdNLCa.js";import{V as J}from"./VDataTable-09J7Hk6b.js";import{V as Me}from"./VChip-DvCJp9Wa.js";import{V as Ne}from"./VTextarea-JYKC0scZ.js";import"./VMenu-0AUhCnQP.js";import"./api-router-BuTofTy9.js";import"./form-BflAq2YC.js";import"./VField-Cl6ebA9i.js";import"./VInput-BQnO7MBM.js";/* empty css              */import"./VList-BBMGPuVo.js";import"./VDivider-UvFNvVgh.js";import"./VCheckboxBtn-4jdsQFwS.js";import"./VSelectionControl-Box3LWk_.js";import"./VWindowItem-CWPtnYQu.js";import"./VSlideGroup-BWKNT972.js";import"./VPagination-dF8V-on0.js";import"./VTable-Btj0kh65.js";const Be={class:"mb-4"},$e=re({__name:"ImportDataDialog",props:{isDialogVisible:{type:Boolean},title:{default:"Import Data"},fileAccept:{default:".csv"},exampleDownloadText:{default:"Download Example"},exampleFileName:{default:"example.csv"},exampleContent:{default:`Example,Data
Value1,Value2`}},emits:["update:isDialogVisible","import"],setup(K,{emit:V}){const f=K,n=V,w=m(),{backendErrors:A,setBackendErrors:b,clearError:B}=qe(),S=Pe(),p=m(null),E=s=>{const u=s.target;u.files&&u.files[0]&&(p.value=u.files[0])},F=()=>{const s=new Blob([f.exampleContent],{type:"text/csv"}),u=window.URL.createObjectURL(s),D=document.createElement("a");D.href=u,D.download=f.exampleFileName,D.click(),window.URL.revokeObjectURL(u)},q=async()=>{const{valid:s}=await w.value.validate();if(!(!s||!p.value))try{n("import",p.value),n("update:isDialogVisible",!1),p.value=null}catch(u){b(u)}},C=()=>{n("update:isDialogVisible",!1),p.value=null};return(s,u)=>{const D=ne;return U(),N(ie,{"model-value":s.isDialogVisible,"max-width":"600","onUpdate:modelValue":u[1]||(u[1]=k=>n("update:isDialogVisible",k))},{default:l(()=>[a(D,{onClick:C}),a(h,{title:s.title},{default:l(()=>[a(R,null,{default:l(()=>[r("div",Be,[a(x,{variant:"tonal",color:"secondary","prepend-icon":"tabler-download",onClick:F},{default:l(()=>[c(y(s.exampleDownloadText),1)]),_:1})]),a(de,{ref_key:"formRef",ref:w},{default:l(()=>[a(he,{"model-value":v(p),label:"Select File",accept:s.fileAccept,"prepend-icon":"tabler-file-upload","show-size":"",rules:[v(S).file("Please select a file")],"error-messages":v(A).file,"onUpdate:modelValue":u[0]||(u[0]=k=>{p.value=k,v(B)("file")}),onChange:E},null,8,["model-value","accept","rules","error-messages"])]),_:1},512)]),_:1}),a(ue,null,{default:l(()=>[a(Re),a(x,{color:"secondary",variant:"tonal",onClick:C},{default:l(()=>u[2]||(u[2]=[c(" Cancel ")])),_:1,__:[2]}),a(x,{color:"primary",disabled:!v(p),onClick:q},{default:l(()=>u[3]||(u[3]=[c(" Import ")])),_:1,__:[3]},8,["disabled"])]),_:1})]),_:1},8,["title"])]),_:1},8,["model-value"])}}}),Le={class:"d-flex justify-space-between align-center flex-wrap gap-4"},ze={class:"d-flex gap-3 align-center flex-wrap"},je={class:"text-h6 font-weight-medium"},Qe={class:"text-h6 font-weight-medium"},Ye={class:"text-h6 font-weight-medium"},He={class:"d-flex justify-space-between align-center mb-4"},We={class:"d-flex gap-2"},Ge={class:"font-weight-medium"},Je={class:"text-success font-weight-medium"},Ke={class:"text-error font-weight-medium"},Xe={class:"font-weight-medium"},Ze={class:"text-error"},et={class:"text-success font-weight-medium"},Pt=re({__name:"financial-overview",setup(K){const V=m("sales"),f=m(""),n=m([]),w=m(!1),A=m(!1),b=m("sales"),B=m("sales"),S=m(!1),p=m(!1),E=m(""),F=m("monthly"),q=m(null),C=m([]),s=m({product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""}),u=async()=>{S.value=!0;try{const t=await I.getFinancialOverview();t.success&&(q.value=t.data)}catch(t){console.error("Error loading financial data:",t)}finally{S.value=!1}},D=async()=>{try{const t=await I.getUnitProducts();t.success&&(C.value=t.data)}catch(t){console.error("Error loading unit products:",t)}},k=d(()=>{var t;return((t=q.value)==null?void 0:t.sales)||[]}),T=d(()=>{var t;return((t=q.value)==null?void 0:t.expenses)||[]}),$=d(()=>{var t;return((t=q.value)==null?void 0:t.profit)||[]});Ue(()=>{u(),D()});const me=d(()=>C.value.filter(t=>t.status==="active"&&t.stock>0).map(t=>({title:`${t.name} (${t.stock} in stock)`,value:t.name,stock:t.stock}))),P=d(()=>{if(!s.value.product)return 0;const t=C.value.find(e=>e.name===s.value.product);return(t==null?void 0:t.stock)||0}),X=d(()=>b.value!=="sales"?!0:s.value.quantitySold>0&&s.value.quantitySold<=P.value),Z=d(()=>s.value.product?s.value.quantitySold===0?"Quantity must be greater than 0":s.value.quantitySold>P.value?`Cannot exceed available stock (${P.value} units)`:"":""),pe=["Food Supplies","Utilities","Staff Wages","Marketing","Equipment Maintenance","Rent","Insurance","Cleaning Supplies","Office Supplies","Transportation"],ve=[{title:"Product",key:"product",sortable:!0},{title:"Date of Sale",key:"dateOfSale",sortable:!0},{title:"Unit Price (SAR)",key:"unitPrice",sortable:!0},{title:"Quantity Sold",key:"quantitySold",sortable:!0},{title:"Sale (SAR)",key:"sale",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],fe=[{title:"Expense Category",key:"expenseCategory",sortable:!0},{title:"Date of Expense",key:"dateOfExpense",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Description",key:"description",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],ce=[{title:"Date",key:"date",sortable:!0},{title:"Total Sales (SAR)",key:"totalSales",sortable:!0},{title:"Total Expenses (SAR)",key:"totalExpenses",sortable:!0},{title:"Profit (SAR)",key:"profit",sortable:!0}],ye=d(()=>f.value?k.value.filter(t=>t.product.toLowerCase().includes(f.value.toLowerCase())||t.dateOfSale.includes(f.value)):k.value),ge=d(()=>f.value?T.value.filter(t=>t.expenseCategory.toLowerCase().includes(f.value.toLowerCase())||t.description.toLowerCase().includes(f.value.toLowerCase())||t.dateOfExpense.includes(f.value)):T.value),L=t=>{const e=new Date(t),i=new Date;return F.value==="daily"?e.toDateString()===i.toDateString():F.value==="monthly"?e.getMonth()===i.getMonth()&&e.getFullYear()===i.getFullYear():F.value==="yearly"?e.getFullYear()===i.getFullYear():!0},xe=d(()=>k.value.filter(t=>L(t.dateOfSale))),Ve=d(()=>T.value.filter(t=>L(t.dateOfExpense))),ee=d(()=>$.value.filter(t=>L(t.date))),be=d(()=>{let t=ee.value;return f.value&&(t=t.filter(e=>e.date.includes(f.value))),t}),we=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],Se=d(()=>xe.value.reduce((t,e)=>t+e.sale,0)),Ce=d(()=>Ve.value.reduce((t,e)=>t+e.amount,0)),ke=d(()=>ee.value.reduce((t,e)=>t+e.profit,0)),te=()=>{s.value={product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""},p.value=!1,E.value=""},_e=t=>{b.value=t,p.value=!1,E.value="",te(),w.value=!0},ae=(t,e)=>{b.value=e,p.value=!0,E.value=t.id,e==="sales"?s.value={product:t.product,date:t.dateOfSale,quantitySold:t.quantitySold,expenseCategory:"",amount:0,description:""}:s.value={product:"",date:t.dateOfExpense,quantitySold:0,expenseCategory:t.expenseCategory,amount:t.amount,description:t.description||""},w.value=!0},le=async()=>{var t,e;if(!(b.value==="sales"&&!X.value)){S.value=!0;try{const i={category:b.value,date:s.value.date};b.value==="sales"?(i.product=s.value.product,i.quantitySold=s.value.quantitySold):(i.expenseCategory=s.value.expenseCategory,i.amount=s.value.amount,i.description=s.value.description);let o;p.value?o=await I.updateFinancialData(E.value,i):o=await I.addFinancialData(i),o.success&&(await u(),await D(),w.value=!1,te(),p.value=!1,E.value="")}catch(i){console.error("Error saving data:",i),(e=(t=i.response)==null?void 0:t.data)!=null&&e.message&&console.error("Submission error:",i.response.data.message)}finally{S.value=!1}}},oe=()=>{let t=[],e="";V.value==="sales"?(t=n.value.length>0?k.value.filter(i=>n.value.includes(i.id)):k.value,e="sales_data.csv"):V.value==="expense"?(t=n.value.length>0?T.value.filter(i=>n.value.includes(i.id)):T.value,e="expense_data.csv"):V.value==="profit"&&(t=n.value.length>0?$.value.filter(i=>n.value.includes(i.id)):$.value,e="profit_data.csv"),console.log("Exporting data:",t,"as",e)},De=async()=>{if(n.value.length!==0){S.value=!0;try{(await I.deleteFinancialData({category:V.value,ids:n.value})).success&&(await u(),n.value=[])}catch(t){console.error("Error deleting data:",t)}finally{S.value=!1}}},Ee=t=>{t&&(console.log("Importing file:",t.name,"for category:",B.value),A.value=!1)};return(t,e)=>{const i=ne;return U(),z(Q,null,[r("section",null,[a(M,{class:"mb-6"},{default:l(()=>[a(g,{cols:"12"},{default:l(()=>[r("div",Le,[e[22]||(e[22]=r("div",null,[r("h4",{class:"text-h4 mb-1"}," Financial Overview "),r("p",{class:"text-body-1 text-medium-emphasis"}," Track your franchise financial performance and metrics ")],-1)),r("div",ze,[a(x,{color:"primary",variant:"outlined","prepend-icon":"tabler-upload",onClick:e[0]||(e[0]=o=>A.value=!0)},{default:l(()=>e[20]||(e[20]=[c(" Import ")])),_:1,__:[20]}),a(x,{color:"primary","prepend-icon":"tabler-plus",onClick:e[1]||(e[1]=o=>_e(V.value))},{default:l(()=>e[21]||(e[21]=[c(" Add Data ")])),_:1,__:[21]}),a(H,{modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=o=>F.value=o),items:we,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(M,{class:"mb-6"},{default:l(()=>[a(g,{cols:"12",md:"4"},{default:l(()=>[a(h,null,{default:l(()=>[a(R,{class:"d-flex align-center"},{default:l(()=>[a(Y,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-4"},{default:l(()=>[a(v(Te))]),_:1}),r("div",null,[e[23]||(e[23]=r("span",{class:"text-sm text-medium-emphasis"},"Total Sales",-1)),r("div",je,y(v(_)(Se.value,"SAR",!1)),1)])]),_:1})]),_:1})]),_:1}),a(g,{cols:"12",md:"4"},{default:l(()=>[a(h,null,{default:l(()=>[a(R,{class:"d-flex align-center"},{default:l(()=>[a(Y,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-4"},{default:l(()=>[a(se,{size:"24",icon:"tabler-trending-down"})]),_:1}),r("div",null,[e[24]||(e[24]=r("span",{class:"text-sm text-medium-emphasis"},"Total Expenses",-1)),r("div",Qe,y(v(_)(Ce.value,"SAR",!1)),1)])]),_:1})]),_:1})]),_:1}),a(g,{cols:"12",md:"4"},{default:l(()=>[a(h,null,{default:l(()=>[a(R,{class:"d-flex align-center"},{default:l(()=>[a(Y,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-4"},{default:l(()=>[a(se,{size:"24",icon:"tabler-trending-up"})]),_:1}),r("div",null,[e[25]||(e[25]=r("span",{class:"text-sm text-medium-emphasis"},"Total Profit",-1)),r("div",Ye,y(v(_)(ke.value,"SAR",!1)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(M,null,{default:l(()=>[a(g,{cols:"12"},{default:l(()=>[a(h,null,{default:l(()=>[a(R,null,{default:l(()=>[a(Ie,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=o=>V.value=o),color:"primary",class:"mb-4"},{default:l(()=>[a(W,{value:"sales"},{default:l(()=>e[26]||(e[26]=[c(" Sales ")])),_:1,__:[26]}),a(W,{value:"expense"},{default:l(()=>e[27]||(e[27]=[c(" Expense ")])),_:1,__:[27]}),a(W,{value:"profit"},{default:l(()=>e[28]||(e[28]=[c(" Profit ")])),_:1,__:[28]})]),_:1},8,["modelValue"]),r("div",He,[a(O,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=o=>f.value=o),placeholder:"Search...","prepend-inner-icon":"tabler-search",variant:"outlined",density:"compact",style:{"max-width":"300px"},clearable:""},null,8,["modelValue"]),r("div",We,[n.value.length>0?(U(),N(x,{key:0,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:oe},{default:l(()=>[c(" Export Selected ("+y(n.value.length)+") ",1)]),_:1})):j("",!0),n.value.length>0?(U(),N(x,{key:1,color:"error",variant:"outlined","prepend-icon":"tabler-trash",onClick:De},{default:l(()=>[c(" Delete Selected ("+y(n.value.length)+") ",1)]),_:1})):j("",!0),n.value.length===0?(U(),N(x,{key:2,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:oe},{default:l(()=>e[29]||(e[29]=[c(" Export All ")])),_:1,__:[29]})):j("",!0)])]),a(Oe,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=o=>V.value=o)},{default:l(()=>[a(G,{value:"sales"},{default:l(()=>[a(J,{modelValue:n.value,"onUpdate:modelValue":e[5]||(e[5]=o=>n.value=o),headers:ve,items:ye.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.unitPrice":l(({item:o})=>[r("span",Ge,y(v(_)(Number(o.unitPrice))),1)]),"item.sale":l(({item:o})=>[r("span",Je,y(v(_)(Number(o.sale))),1)]),"item.actions":l(({item:o})=>[a(x,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:Fe=>ae(o,"sales")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),a(G,{value:"expense"},{default:l(()=>[a(J,{modelValue:n.value,"onUpdate:modelValue":e[6]||(e[6]=o=>n.value=o),headers:fe,items:ge.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.amount":l(({item:o})=>[r("span",Ke,y(v(_)(Number(o.amount))),1)]),"item.expenseCategory":l(({item:o})=>[a(Me,{size:"small",variant:"tonal",color:"primary"},{default:l(()=>[c(y(o.expenseCategory),1)]),_:2},1024)]),"item.actions":l(({item:o})=>[a(x,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:Fe=>ae(o,"expense")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),a(G,{value:"profit"},{default:l(()=>[a(J,{modelValue:n.value,"onUpdate:modelValue":e[7]||(e[7]=o=>n.value=o),headers:ce,items:be.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.totalSales":l(({item:o})=>[r("span",Xe,y(v(_)(Number(o.totalSales))),1)]),"item.totalExpenses":l(({item:o})=>[r("span",Ze,y(v(_)(Number(o.totalExpenses))),1)]),"item.profit":l(({item:o})=>[r("span",et,y(v(_)(Number(o.profit))),1)]),_:1},8,["modelValue","items"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),a(ie,{modelValue:w.value,"onUpdate:modelValue":e[18]||(e[18]=o=>w.value=o),"max-width":"600"},{default:l(()=>[a(i,{onClick:e[9]||(e[9]=o=>w.value=!1)}),a(h,{title:p.value?"Edit":"Add"+(b.value==="sales"?"Sales":"Expense")+" Data"},{default:l(()=>[a(R,null,{default:l(()=>[a(de,{onSubmit:Ae(le,["prevent"])},{default:l(()=>[a(M,null,{default:l(()=>[b.value==="sales"?(U(),z(Q,{key:0},[a(g,{cols:"12"},{default:l(()=>[a(H,{modelValue:s.value.product,"onUpdate:modelValue":e[10]||(e[10]=o=>s.value.product=o),items:me.value,label:"Product",variant:"outlined","item-title":"title","item-value":"value",loading:C.value.length===0,disabled:C.value.length===0,hint:C.value.length===0?"No products available in stock":"","persistent-hint":"",required:""},null,8,["modelValue","items","loading","disabled","hint"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(O,{modelValue:s.value.date,"onUpdate:modelValue":e[11]||(e[11]=o=>s.value.date=o),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(O,{modelValue:s.value.quantitySold,"onUpdate:modelValue":e[12]||(e[12]=o=>s.value.quantitySold=o),modelModifiers:{number:!0},label:"Quantity Sold",type:"number",variant:"outlined",required:"",min:1,max:P.value,error:!!Z.value,"error-messages":Z.value,hint:P.value>0?`Available stock: ${P.value} units`:"","persistent-hint":"",disabled:!s.value.product},null,8,["modelValue","max","error","error-messages","hint","disabled"])]),_:1})],64)):(U(),z(Q,{key:1},[a(g,{cols:"12"},{default:l(()=>[a(H,{modelValue:s.value.expenseCategory,"onUpdate:modelValue":e[13]||(e[13]=o=>s.value.expenseCategory=o),items:pe,label:"Expense Category",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(O,{modelValue:s.value.date,"onUpdate:modelValue":e[14]||(e[14]=o=>s.value.date=o),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(O,{modelValue:s.value.amount,"onUpdate:modelValue":e[15]||(e[15]=o=>s.value.amount=o),modelModifiers:{number:!0},label:"Amount (SAR)",type:"number",step:"0.01",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(Ne,{modelValue:s.value.description,"onUpdate:modelValue":e[16]||(e[16]=o=>s.value.description=o),label:"Note/Description",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})],64))]),_:1})]),_:1})]),_:1}),a(ue,{class:"d-flex justify-end gap-2 pa-4"},{default:l(()=>[a(x,{variant:"tonal",color:"secondary",onClick:e[17]||(e[17]=o=>w.value=!1)},{default:l(()=>e[30]||(e[30]=[c(" Cancel ")])),_:1,__:[30]}),a(x,{disabled:b.value==="sales"&&!X.value,loading:S.value,onClick:le},{default:l(()=>e[31]||(e[31]=[c(" Save ")])),_:1,__:[31]},8,["disabled","loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),a($e,{"is-dialog-visible":A.value,"onUpdate:isDialogVisible":e[19]||(e[19]=o=>A.value=o),title:"Import Financial Data",label:"Choose CSV file",accept:".csv",onImport:Ee},null,8,["is-dialog-visible"])],64)}}});export{Pt as default};
