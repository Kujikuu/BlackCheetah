import{_ as U,V as F}from"./VDialog-Dm5b9lpN.js";import{a_ as f,d as O,g as k,O as I,w as N,a as h,o as C,k as l,y as e,b7 as G,i as n,l as s,a7 as S,q as x,h as T,t as u,av as w}from"./main-Cv9YYIc_.js";import{g as H}from"./api-router-BAfqMgbq.js";import{u as J,a as X}from"./useValidationRules-dsq88lKM.js";import{V,f as M,g as j}from"./VCard-BzCAkRO7.js";import{V as K}from"./VForm-C-dasJkp.js";import{V as E,a as d}from"./VRow-BEiqwRCB.js";import{V as P}from"./VTextField-C5rooSv7.js";import{V as Q}from"./VSelect-D-9BdSsL.js";import{V as W}from"./VFileInput-CB1VMy9a.js";import{V as q}from"./VSpacer-efKXpdHI.js";import{f as $}from"./formatters-aoHiJebZ.js";import{V as B}from"./VDivider-DT1g3bUq.js";import{V as Y}from"./VChip-DOUJ0437.js";import{V as Z}from"./VTable-DdhoxFzT.js";class ee{getBaseUrl(){return H("royalties")}async getRoyalties(i){return await f(this.getBaseUrl(),{params:i})}async getRoyalty(i){return await f(`${this.getBaseUrl()}/${i}`)}async getStatistics(i){return await f(`${this.getBaseUrl()}/statistics`,{params:i})}async markAsPaid(i,a){const r=new FormData;return r.append("amount_paid",(a.amount_paid||0).toString()),r.append("payment_date",a.payment_date||""),r.append("payment_method",a.payment_type||""),a.payment_reference&&r.append("payment_reference",a.payment_reference),a.notes&&r.append("notes",a.notes),a.attachment&&r.append("attachment",a.attachment),r.append("_method","PATCH"),await f(`${this.getBaseUrl()}/${i}/mark-paid`,{method:"POST",body:r,headers:{"Content-Type":void 0}})}async exportRoyalties(i){return await f(`${this.getBaseUrl()}/export`,{params:i,parseResponse:a=>a})}async createRoyalty(i){return await f(`${this.getBaseUrl()}`,{method:"POST",body:i})}async updateRoyalty(i,a){return await f(`${this.getBaseUrl()}/${i}`,{method:"PUT",body:a})}async deleteRoyalty(i){await f(`${this.getBaseUrl()}/${i}`,{method:"DELETE"})}async addAdjustment(i,a,r){return await f(`${this.getBaseUrl()}/${i}/adjustments`,{method:"POST",body:{adjustment_amount:a,adjustment_reason:r}})}async calculateLateFee(i){return await f(`${this.getBaseUrl()}/${i}/late-fee`,{method:"POST"})}}const te=new ee,je=O({__name:"MarkCompletedRoyaltyDialog",props:{isDialogVisible:{type:Boolean},selectedRoyalty:{},paymentTypeOptions:{}},emits:["update:isDialogVisible","paymentSubmitted"],setup(R,{emit:i}){const a=R,r=i,g=k(),{backendErrors:_,setBackendErrors:D,clearError:b}=J(),m=X(),t=k(!1),p=k({amount_paid:0,payment_date:"",payment_type:"",attachment:null}),c=I({get:()=>a.isDialogVisible,set:v=>r("update:isDialogVisible",v)});N(()=>a.selectedRoyalty,v=>{v&&(p.value={amount_paid:v.amount,payment_date:new Date().toISOString().split("T")[0],payment_type:"",attachment:null})},{immediate:!0});const A=async()=>{if(!a.selectedRoyalty)return;const{valid:v}=await g.value.validate();if(v){t.value=!0;try{await te.markAsPaid(a.selectedRoyalty.id,p.value),r("paymentSubmitted"),c.value=!1,p.value={amount_paid:0,payment_date:"",payment_type:"",attachment:null}}catch(o){console.error("Error submitting payment:",o),D(o)}finally{t.value=!1}}},L=v=>{const o=v.target;o.files&&o.files[0]&&(p.value.attachment=o.files[0])};return(v,o)=>{const z=U;return C(),h(F,{modelValue:c.value,"onUpdate:modelValue":o[9]||(o[9]=y=>c.value=y),"max-width":"600"},{default:l(()=>[e(z,{onClick:o[0]||(o[0]=y=>c.value=!1)}),e(V,{title:"Mark Royalty as Completed"},{default:l(()=>[e(M,null,{default:l(()=>[e(K,{ref_key:"formRef",ref:g,onSubmit:G(A,["prevent"])},{default:l(()=>[e(E,null,{default:l(()=>[e(d,{cols:"12",md:"6"},{default:l(()=>[e(P,{modelValue:p.value.amount_paid,"onUpdate:modelValue":o[1]||(o[1]=y=>p.value.amount_paid=y),modelModifiers:{number:!0},label:"Amount Paid (SAR)",type:"number",variant:"outlined",density:"compact",rules:[n(m).required("Amount is required"),n(m).numeric("Amount must be numeric"),n(m).min(0,"Amount must be positive")],"error-messages":n(_).amountPaid,onInput:o[2]||(o[2]=y=>n(b)("amountPaid"))},null,8,["modelValue","rules","error-messages"])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[e(P,{modelValue:p.value.payment_date,"onUpdate:modelValue":o[3]||(o[3]=y=>p.value.payment_date=y),label:"Payment Date",type:"date",variant:"outlined",density:"compact",rules:[n(m).required("Payment date is required"),n(m).date("Invalid date format")],"error-messages":n(_).paymentDate,onInput:o[4]||(o[4]=y=>n(b)("paymentDate"))},null,8,["modelValue","rules","error-messages"])]),_:1}),e(d,{cols:"12"},{default:l(()=>[e(Q,{modelValue:p.value.payment_type,"onUpdate:modelValue":[o[5]||(o[5]=y=>p.value.payment_type=y),o[6]||(o[6]=y=>n(b)("paymentType"))],items:a.paymentTypeOptions,"item-title":"title","item-value":"value",label:"Payment Type",variant:"outlined",density:"compact",rules:[n(m).required("Payment type is required")],"error-messages":n(_).paymentType},null,8,["modelValue","items","rules","error-messages"])]),_:1}),e(d,{cols:"12"},{default:l(()=>[e(W,{label:"Attachment (Optional)",variant:"outlined",density:"compact",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",rules:[n(m).fileType(["pdf","jpg","jpeg","png","doc","docx"],"Invalid file type"),n(m).fileSize(5,"File must be less than 5MB")],"error-messages":n(_).attachment,onChange:L,"onUpdate:modelValue":o[7]||(o[7]=y=>n(b)("attachment"))},null,8,["rules","error-messages"]),o[10]||(o[10]=s("div",{class:"text-caption text-medium-emphasis mt-1"}," Supported formats: PDF, JPG, PNG, DOC, DOCX ",-1))]),_:1,__:[10]})]),_:1})]),_:1},512)]),_:1}),e(j,null,{default:l(()=>[e(q),e(S,{color:"secondary",variant:"tonal",onClick:o[8]||(o[8]=y=>c.value=!1)},{default:l(()=>o[11]||(o[11]=[x(" Cancel ")])),_:1,__:[11]}),e(S,{color:"primary",loading:t.value,onClick:A},{default:l(()=>o[12]||(o[12]=[x(" Mark as Completed ")])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),ae={class:"mb-4"},se={class:"font-weight-medium"},le={class:"mb-4"},oe={class:"font-weight-medium"},ie={class:"mb-4"},ne={class:"font-weight-medium text-primary"},de={class:"mb-4"},re={class:"font-weight-medium"},me={class:"text-center"},ue={class:"text-h6 font-weight-bold"},ye={class:"text-center"},pe={class:"text-h6 font-weight-bold"},fe={class:"text-center"},ce={class:"text-h6 font-weight-bold"},ve={class:"mb-4"},ge={class:"mb-4"},_e={class:"font-weight-medium"},be={class:"text-end"},we={class:"text-end"},Ve={class:"text-end"},xe={class:"bg-primary-lighten-5"},Re={class:"text-end font-weight-bold text-primary"},Ee=O({__name:"ViewRoyaltyDetailsDialog",props:{isDialogVisible:{type:Boolean},viewedRoyalty:{}},emits:["update:isDialogVisible","markAsCompleted"],setup(R,{emit:i}){const a=R,r=i,g=I({get:()=>a.isDialogVisible,set:m=>r("update:isDialogVisible",m)}),_=m=>new Date(m).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),D=m=>{switch(m){case"paid":return"success";case"pending":return"warning";case"overdue":return"error";default:return"default"}},b=()=>{a.viewedRoyalty&&(r("markAsCompleted",a.viewedRoyalty),g.value=!1)};return(m,t)=>{const p=U;return C(),h(F,{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=c=>g.value=c),"max-width":"600"},{default:l(()=>[e(p,{onClick:t[0]||(t[0]=c=>g.value=!1)}),a.viewedRoyalty?(C(),h(V,{key:0,title:"Royalty Details"},{default:l(()=>[e(M,null,{default:l(()=>[e(E,null,{default:l(()=>[e(d,{cols:"12"},{default:l(()=>t[3]||(t[3]=[s("h6",{class:"text-h6 mb-4 text-primary"}," Basic Information ",-1)])),_:1,__:[3]}),e(d,{cols:"12",md:"6"},{default:l(()=>[s("div",ae,[t[4]||(t[4]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Billing Period ",-1)),s("div",se,u(a.viewedRoyalty.billing_period),1)])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[s("div",le,[t[5]||(t[5]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Due Date ",-1)),s("div",oe,u(_(a.viewedRoyalty.due_date)),1)])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[s("div",ie,[t[6]||(t[6]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Franchisee Name ",-1)),s("div",ne,u(a.viewedRoyalty.franchisee_name),1)])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[s("div",de,[t[7]||(t[7]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Store Location ",-1)),s("div",re,u(a.viewedRoyalty.store_location),1)])]),_:1}),e(d,{cols:"12"},{default:l(()=>[e(B,{class:"my-4"}),t[8]||(t[8]=s("h6",{class:"text-h6 mb-4 text-primary"}," Financial Details ",-1))]),_:1,__:[8]}),e(d,{cols:"12",md:"4"},{default:l(()=>[e(V,{variant:"tonal",color:"info",class:"pa-4"},{default:l(()=>[s("div",me,[e(w,{icon:"tabler-chart-line",size:"32",class:"mb-2"}),t[9]||(t[9]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Gross Sales ",-1)),s("div",ue,u(n($)(a.viewedRoyalty.gross_sales||0,"SAR",!1)),1)])]),_:1})]),_:1}),e(d,{cols:"12",md:"4"},{default:l(()=>[e(V,{variant:"tonal",color:"primary",class:"pa-4"},{default:l(()=>[s("div",ye,[e(w,{icon:"tabler-percentage",size:"32",class:"mb-2"}),t[10]||(t[10]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Rate ",-1)),s("div",pe,u(a.viewedRoyalty.royalty_percentage)+"% ",1)])]),_:1})]),_:1}),e(d,{cols:"12",md:"4"},{default:l(()=>[e(V,{variant:"tonal",color:"success",class:"pa-4"},{default:l(()=>[s("div",fe,[e(w,{icon:"tabler-coins",size:"32",class:"mb-2"}),t[11]||(t[11]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Amount ",-1)),s("div",ce,u(n($)(a.viewedRoyalty.amount||0,"SAR",!1)),1)])]),_:1})]),_:1}),e(d,{cols:"12"},{default:l(()=>[e(B,{class:"my-4"}),t[12]||(t[12]=s("h6",{class:"text-h6 mb-4 text-primary"}," Status Information ",-1))]),_:1,__:[12]}),e(d,{cols:"12",md:"6"},{default:l(()=>[s("div",ve,[t[13]||(t[13]=s("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Payment Status ",-1)),e(Y,{color:D(a.viewedRoyalty.status),size:"large",variant:"tonal",class:"text-capitalize"},{default:l(()=>[e(w,{icon:a.viewedRoyalty.status==="paid"?"tabler-check":a.viewedRoyalty.status==="pending"?"tabler-clock":"tabler-alert-triangle",class:"me-2"},null,8,["icon"]),x(" "+u(a.viewedRoyalty.status),1)]),_:1},8,["color"])])]),_:1}),e(d,{cols:"12",md:"6"},{default:l(()=>[s("div",ge,[t[14]||(t[14]=s("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Days Until Due ",-1)),s("div",_e,u(Math.ceil((new Date(a.viewedRoyalty.due_date).getTime()-new Date().getTime())/(1e3*60*60*24)))+" days ",1)])]),_:1}),e(d,{cols:"12"},{default:l(()=>[e(B,{class:"my-4"}),t[15]||(t[15]=s("h6",{class:"text-h6 mb-4 text-primary"}," Calculation Breakdown ",-1))]),_:1,__:[15]}),e(d,{cols:"12"},{default:l(()=>[e(Z,{density:"compact"},{default:l(()=>[s("tbody",null,[s("tr",null,[t[16]||(t[16]=s("td",{class:"font-weight-medium"}," Gross Sales: ",-1)),s("td",be,u(n($)(a.viewedRoyalty.gross_sales||0,"SAR",!1)),1)]),s("tr",null,[t[17]||(t[17]=s("td",{class:"font-weight-medium"}," Royalty Rate: ",-1)),s("td",we,u(a.viewedRoyalty.royalty_percentage)+"% ",1)]),s("tr",null,[t[18]||(t[18]=s("td",{class:"font-weight-medium"}," Calculation: ",-1)),s("td",Ve,u((a.viewedRoyalty.gross_sales||0).toLocaleString())+" × "+u(a.viewedRoyalty.royalty_percentage)+"% ",1)]),s("tr",xe,[t[19]||(t[19]=s("td",{class:"font-weight-bold text-primary"}," Total Royalty Amount: ",-1)),s("td",Re,u((a.viewedRoyalty.amount||0).toLocaleString())+" SAR ",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(j,null,{default:l(()=>[e(q),e(S,{color:"secondary",variant:"tonal",onClick:t[1]||(t[1]=c=>g.value=!1)},{default:l(()=>t[20]||(t[20]=[x(" Close ")])),_:1,__:[20]}),a.viewedRoyalty.status!=="paid"?(C(),h(S,{key:0,color:"primary",onClick:b},{default:l(()=>[e(w,{icon:"tabler-check",class:"me-2"}),t[21]||(t[21]=x(" Mark as Completed "))]),_:1,__:[21]})):T("",!0)]),_:1})]),_:1})):T("",!0)]),_:1},8,["modelValue"])}}});export{je as _,Ee as a,te as r};
