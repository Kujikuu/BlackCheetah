import{_ as ne,V as ie}from"./VDialog-DKkWp4GN.js";import{d as re,g as v,a as R,o as _,k as l,y as a,l as r,a7 as b,q as c,t as y,i as x,O as d,E as Ue,c as L,av as se,h as z,b5 as Fe,F as j}from"./main-BPhS35rw.js";import{f as T}from"./franchisee-dashboard-spBS2_GQ.js";import{V as A,f as q,h as ue,b as Q}from"./VCard-BzA-_fsU.js";import{V as Ae}from"./VFileInput-C4-YBSvt.js";import{V as qe}from"./VSpacer-BZoddywn.js";import{f as D}from"./formatters--UtN2sCw.js";import{a as g,V as O}from"./VRow-BBpj0UHg.js";import{V as Y}from"./VSelect-CMXFgzzc.js";import{S as he}from"./saudi-riyal-DymAW43Z.js";import{a as Pe,V as H,b as Te,c as W}from"./VTabs-BmRwQEIl.js";import{V as I}from"./VTextField-DVYvDh-5.js";import{V as G}from"./VDataTable-CpPkgXjX.js";import{V as Ie}from"./VChip-D4pF-Hih.js";import{V as Oe}from"./VForm-DfkEz1YK.js";import{V as Re}from"./VTextarea-BMZlRSe-.js";import"./VOverlay-DT_ig7Kx.js";import"./forwardRefs-B931MWyl.js";import"./scopeId-CVHpW26W.js";import"./VMenu-BFWVwuN9.js";import"./api-router-DNaOhggD.js";import"./VField-Cw0SCwyI.js";import"./form-DOPuC2wB.js";import"./VInput-ChEAXyAR.js";/* empty css              */import"./VList-BOGntWk4.js";import"./VDivider-D5TM1l_v.js";import"./VCheckboxBtn-C2M95TWh.js";import"./VSelectionControl-BCX0I6pt.js";import"./VWindowItem-B3EKE9OE.js";import"./VSlideGroup-DN13h1yr.js";import"./VTable-CjdTM1xT.js";const Me={class:"mb-4"},Ne=re({__name:"ImportDataDialog",props:{isDialogVisible:{type:Boolean},title:{default:"Import Data"},fileAccept:{default:".csv"},exampleDownloadText:{default:"Download Example"},exampleFileName:{default:"example.csv"},exampleContent:{default:`Example,Data
Value1,Value2`}},emits:["update:isDialogVisible","import"],setup(J,{emit:V}){const f=J,n=V,p=v(null),E=m=>{const u=m.target;u.files&&u.files[0]&&(p.value=u.files[0])},w=()=>{const m=new Blob([f.exampleContent],{type:"text/csv"}),u=window.URL.createObjectURL(m),S=document.createElement("a");S.href=u,S.download=f.exampleFileName,S.click(),window.URL.revokeObjectURL(u)},M=()=>{n("import",p.value),n("update:isDialogVisible",!1),p.value=null},C=()=>{n("update:isDialogVisible",!1),p.value=null};return(m,u)=>{const S=ne;return _(),R(ie,{"model-value":m.isDialogVisible,"max-width":"600","onUpdate:modelValue":u[1]||(u[1]=k=>n("update:isDialogVisible",k))},{default:l(()=>[a(S,{onClick:C}),a(A,{title:m.title},{default:l(()=>[a(q,null,{default:l(()=>[r("div",Me,[a(b,{variant:"tonal",color:"secondary","prepend-icon":"tabler-download",onClick:w},{default:l(()=>[c(y(m.exampleDownloadText),1)]),_:1})]),a(Ae,{"model-value":x(p),label:"Select File",accept:m.fileAccept,"prepend-icon":"tabler-file-upload","show-size":"","onUpdate:modelValue":u[0]||(u[0]=k=>p.value=k),onChange:E},null,8,["model-value","accept"])]),_:1}),a(ue,null,{default:l(()=>[a(qe),a(b,{color:"secondary",variant:"tonal",onClick:C},{default:l(()=>u[2]||(u[2]=[c(" Cancel ")])),_:1,__:[2]}),a(b,{color:"primary",disabled:!x(p),onClick:M},{default:l(()=>u[3]||(u[3]=[c(" Import ")])),_:1,__:[3]},8,["disabled"])]),_:1})]),_:1},8,["title"])]),_:1},8,["model-value"])}}}),$e={class:"d-flex justify-space-between align-center flex-wrap gap-4"},Be={class:"d-flex gap-3 align-center flex-wrap"},Le={class:"text-h6 font-weight-medium"},ze={class:"text-h6 font-weight-medium"},je={class:"text-h6 font-weight-medium"},Qe={class:"d-flex justify-space-between align-center mb-4"},Ye={class:"d-flex gap-2"},He={class:"font-weight-medium"},We={class:"text-success font-weight-medium"},Ge={class:"text-error font-weight-medium"},Je={class:"font-weight-medium"},Ke={class:"text-error"},Xe={class:"text-success font-weight-medium"},qt=re({__name:"financial-overview",setup(J){const V=v("sales"),f=v(""),n=v([]),p=v(!1),E=v(!1),w=v("sales"),M=v("sales"),C=v(!1),m=v(!1),u=v(""),S=v("monthly"),k=v(null),U=v([]),s=v({product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""}),N=async()=>{C.value=!0;try{const t=await T.getFinancialOverview();t.success&&(k.value=t.data)}catch(t){console.error("Error loading financial data:",t)}finally{C.value=!1}},K=async()=>{try{const t=await T.getUnitProducts();t.success&&(U.value=t.data)}catch(t){console.error("Error loading unit products:",t)}},h=d(()=>{var t;return((t=k.value)==null?void 0:t.sales)||[]}),P=d(()=>{var t;return((t=k.value)==null?void 0:t.expenses)||[]}),$=d(()=>{var t;return((t=k.value)==null?void 0:t.profit)||[]});Ue(()=>{N(),K()});const de=d(()=>U.value.filter(t=>t.status==="active"&&t.stock>0).map(t=>({title:`${t.name} (${t.stock} in stock)`,value:t.name,stock:t.stock}))),F=d(()=>{if(!s.value.product)return 0;const t=U.value.find(e=>e.name===s.value.product);return(t==null?void 0:t.stock)||0}),X=d(()=>w.value!=="sales"?!0:s.value.quantitySold>0&&s.value.quantitySold<=F.value),Z=d(()=>s.value.product?s.value.quantitySold===0?"Quantity must be greater than 0":s.value.quantitySold>F.value?`Cannot exceed available stock (${F.value} units)`:"":""),pe=["Food Supplies","Utilities","Staff Wages","Marketing","Equipment Maintenance","Rent","Insurance","Cleaning Supplies","Office Supplies","Transportation"],me=[{title:"Product",key:"product",sortable:!0},{title:"Date of Sale",key:"dateOfSale",sortable:!0},{title:"Unit Price (SAR)",key:"unitPrice",sortable:!0},{title:"Quantity Sold",key:"quantitySold",sortable:!0},{title:"Sale (SAR)",key:"sale",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],ve=[{title:"Expense Category",key:"expenseCategory",sortable:!0},{title:"Date of Expense",key:"dateOfExpense",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Description",key:"description",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],fe=[{title:"Date",key:"date",sortable:!0},{title:"Total Sales (SAR)",key:"totalSales",sortable:!0},{title:"Total Expenses (SAR)",key:"totalExpenses",sortable:!0},{title:"Profit (SAR)",key:"profit",sortable:!0}],ce=d(()=>f.value?h.value.filter(t=>t.product.toLowerCase().includes(f.value.toLowerCase())||t.dateOfSale.includes(f.value)):h.value),ye=d(()=>f.value?P.value.filter(t=>t.expenseCategory.toLowerCase().includes(f.value.toLowerCase())||t.description.toLowerCase().includes(f.value.toLowerCase())||t.dateOfExpense.includes(f.value)):P.value),B=t=>{const e=new Date(t),i=new Date;return S.value==="daily"?e.toDateString()===i.toDateString():S.value==="monthly"?e.getMonth()===i.getMonth()&&e.getFullYear()===i.getFullYear():S.value==="yearly"?e.getFullYear()===i.getFullYear():!0},ge=d(()=>h.value.filter(t=>B(t.dateOfSale))),xe=d(()=>P.value.filter(t=>B(t.dateOfExpense))),ee=d(()=>$.value.filter(t=>B(t.date))),be=d(()=>{let t=ee.value;return f.value&&(t=t.filter(e=>e.date.includes(f.value))),t}),Ve=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],we=d(()=>ge.value.reduce((t,e)=>t+e.sale,0)),Se=d(()=>xe.value.reduce((t,e)=>t+e.amount,0)),Ce=d(()=>ee.value.reduce((t,e)=>t+e.profit,0)),te=()=>{s.value={product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""},m.value=!1,u.value=""},De=t=>{w.value=t,m.value=!1,u.value="",te(),p.value=!0},ae=(t,e)=>{w.value=e,m.value=!0,u.value=t.id,e==="sales"?s.value={product:t.product,date:t.dateOfSale,quantitySold:t.quantitySold,expenseCategory:"",amount:0,description:""}:s.value={product:"",date:t.dateOfExpense,quantitySold:0,expenseCategory:t.expenseCategory,amount:t.amount,description:t.description||""},p.value=!0},le=async()=>{var t,e;if(!(w.value==="sales"&&!X.value)){C.value=!0;try{const i={category:w.value,date:s.value.date};w.value==="sales"?(i.product=s.value.product,i.quantitySold=s.value.quantitySold):(i.expenseCategory=s.value.expenseCategory,i.amount=s.value.amount,i.description=s.value.description);let o;m.value?o=await T.updateFinancialData(u.value,i):o=await T.addFinancialData(i),o.success&&(await N(),await K(),p.value=!1,te(),m.value=!1,u.value="")}catch(i){console.error("Error saving data:",i),(e=(t=i.response)==null?void 0:t.data)!=null&&e.message&&console.error("Submission error:",i.response.data.message)}finally{C.value=!1}}},oe=()=>{let t=[],e="";V.value==="sales"?(t=n.value.length>0?h.value.filter(i=>n.value.includes(i.id)):h.value,e="sales_data.csv"):V.value==="expense"?(t=n.value.length>0?P.value.filter(i=>n.value.includes(i.id)):P.value,e="expense_data.csv"):V.value==="profit"&&(t=n.value.length>0?$.value.filter(i=>n.value.includes(i.id)):$.value,e="profit_data.csv"),console.log("Exporting data:",t,"as",e)},ke=async()=>{if(n.value.length!==0){C.value=!0;try{(await T.deleteFinancialData({category:V.value,ids:n.value})).success&&(await N(),n.value=[])}catch(t){console.error("Error deleting data:",t)}finally{C.value=!1}}},_e=t=>{t&&(console.log("Importing file:",t.name,"for category:",M.value),E.value=!1)};return(t,e)=>{const i=ne;return _(),L(j,null,[r("section",null,[a(O,{class:"mb-6"},{default:l(()=>[a(g,{cols:"12"},{default:l(()=>[r("div",$e,[e[22]||(e[22]=r("div",null,[r("h4",{class:"text-h4 mb-1"}," Financial Overview "),r("p",{class:"text-body-1 text-medium-emphasis"}," Track your franchise financial performance and metrics ")],-1)),r("div",Be,[a(b,{color:"primary",variant:"outlined","prepend-icon":"tabler-upload",onClick:e[0]||(e[0]=o=>E.value=!0)},{default:l(()=>e[20]||(e[20]=[c(" Import ")])),_:1,__:[20]}),a(b,{color:"primary","prepend-icon":"tabler-plus",onClick:e[1]||(e[1]=o=>De(V.value))},{default:l(()=>e[21]||(e[21]=[c(" Add Data ")])),_:1,__:[21]}),a(Y,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=o=>S.value=o),items:Ve,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(O,{class:"mb-6"},{default:l(()=>[a(g,{cols:"12",md:"4"},{default:l(()=>[a(A,null,{default:l(()=>[a(q,{class:"d-flex align-center"},{default:l(()=>[a(Q,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-4"},{default:l(()=>[a(x(he))]),_:1}),r("div",null,[e[23]||(e[23]=r("span",{class:"text-sm text-medium-emphasis"},"Total Sales",-1)),r("div",Le,y(x(D)(we.value,"SAR",!1)),1)])]),_:1})]),_:1})]),_:1}),a(g,{cols:"12",md:"4"},{default:l(()=>[a(A,null,{default:l(()=>[a(q,{class:"d-flex align-center"},{default:l(()=>[a(Q,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-4"},{default:l(()=>[a(se,{size:"24",icon:"tabler-trending-down"})]),_:1}),r("div",null,[e[24]||(e[24]=r("span",{class:"text-sm text-medium-emphasis"},"Total Expenses",-1)),r("div",ze,y(x(D)(Se.value,"SAR",!1)),1)])]),_:1})]),_:1})]),_:1}),a(g,{cols:"12",md:"4"},{default:l(()=>[a(A,null,{default:l(()=>[a(q,{class:"d-flex align-center"},{default:l(()=>[a(Q,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-4"},{default:l(()=>[a(se,{size:"24",icon:"tabler-trending-up"})]),_:1}),r("div",null,[e[25]||(e[25]=r("span",{class:"text-sm text-medium-emphasis"},"Total Profit",-1)),r("div",je,y(x(D)(Ce.value,"SAR",!1)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(O,null,{default:l(()=>[a(g,{cols:"12"},{default:l(()=>[a(A,null,{default:l(()=>[a(q,null,{default:l(()=>[a(Pe,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=o=>V.value=o),color:"primary",class:"mb-4"},{default:l(()=>[a(H,{value:"sales"},{default:l(()=>e[26]||(e[26]=[c(" Sales ")])),_:1,__:[26]}),a(H,{value:"expense"},{default:l(()=>e[27]||(e[27]=[c(" Expense ")])),_:1,__:[27]}),a(H,{value:"profit"},{default:l(()=>e[28]||(e[28]=[c(" Profit ")])),_:1,__:[28]})]),_:1},8,["modelValue"]),r("div",Qe,[a(I,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=o=>f.value=o),placeholder:"Search...","prepend-inner-icon":"tabler-search",variant:"outlined",density:"compact",style:{"max-width":"300px"},clearable:""},null,8,["modelValue"]),r("div",Ye,[n.value.length>0?(_(),R(b,{key:0,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:oe},{default:l(()=>[c(" Export Selected ("+y(n.value.length)+") ",1)]),_:1})):z("",!0),n.value.length>0?(_(),R(b,{key:1,color:"error",variant:"outlined","prepend-icon":"tabler-trash",onClick:ke},{default:l(()=>[c(" Delete Selected ("+y(n.value.length)+") ",1)]),_:1})):z("",!0),n.value.length===0?(_(),R(b,{key:2,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:oe},{default:l(()=>e[29]||(e[29]=[c(" Export All ")])),_:1,__:[29]})):z("",!0)])]),a(Te,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=o=>V.value=o)},{default:l(()=>[a(W,{value:"sales"},{default:l(()=>[a(G,{modelValue:n.value,"onUpdate:modelValue":e[5]||(e[5]=o=>n.value=o),headers:me,items:ce.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.unitPrice":l(({item:o})=>[r("span",He,y(x(D)(Number(o.unitPrice))),1)]),"item.sale":l(({item:o})=>[r("span",We,y(x(D)(Number(o.sale))),1)]),"item.actions":l(({item:o})=>[a(b,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:Ee=>ae(o,"sales")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),a(W,{value:"expense"},{default:l(()=>[a(G,{modelValue:n.value,"onUpdate:modelValue":e[6]||(e[6]=o=>n.value=o),headers:ve,items:ye.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.amount":l(({item:o})=>[r("span",Ge,y(x(D)(Number(o.amount))),1)]),"item.expenseCategory":l(({item:o})=>[a(Ie,{size:"small",variant:"tonal",color:"primary"},{default:l(()=>[c(y(o.expenseCategory),1)]),_:2},1024)]),"item.actions":l(({item:o})=>[a(b,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:Ee=>ae(o,"expense")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),a(W,{value:"profit"},{default:l(()=>[a(G,{modelValue:n.value,"onUpdate:modelValue":e[7]||(e[7]=o=>n.value=o),headers:fe,items:be.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.totalSales":l(({item:o})=>[r("span",Je,y(x(D)(Number(o.totalSales))),1)]),"item.totalExpenses":l(({item:o})=>[r("span",Ke,y(x(D)(Number(o.totalExpenses))),1)]),"item.profit":l(({item:o})=>[r("span",Xe,y(x(D)(Number(o.profit))),1)]),_:1},8,["modelValue","items"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),a(ie,{modelValue:p.value,"onUpdate:modelValue":e[18]||(e[18]=o=>p.value=o),"max-width":"600"},{default:l(()=>[a(i,{onClick:e[9]||(e[9]=o=>p.value=!1)}),a(A,{title:m.value?"Edit":"Add"+(w.value==="sales"?"Sales":"Expense")+" Data"},{default:l(()=>[a(q,null,{default:l(()=>[a(Oe,{onSubmit:Fe(le,["prevent"])},{default:l(()=>[a(O,null,{default:l(()=>[w.value==="sales"?(_(),L(j,{key:0},[a(g,{cols:"12"},{default:l(()=>[a(Y,{modelValue:s.value.product,"onUpdate:modelValue":e[10]||(e[10]=o=>s.value.product=o),items:de.value,label:"Product",variant:"outlined","item-title":"title","item-value":"value",loading:U.value.length===0,disabled:U.value.length===0,hint:U.value.length===0?"No products available in stock":"","persistent-hint":"",required:""},null,8,["modelValue","items","loading","disabled","hint"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(I,{modelValue:s.value.date,"onUpdate:modelValue":e[11]||(e[11]=o=>s.value.date=o),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(I,{modelValue:s.value.quantitySold,"onUpdate:modelValue":e[12]||(e[12]=o=>s.value.quantitySold=o),modelModifiers:{number:!0},label:"Quantity Sold",type:"number",variant:"outlined",required:"",min:1,max:F.value,error:!!Z.value,"error-messages":Z.value,hint:F.value>0?`Available stock: ${F.value} units`:"","persistent-hint":"",disabled:!s.value.product},null,8,["modelValue","max","error","error-messages","hint","disabled"])]),_:1})],64)):(_(),L(j,{key:1},[a(g,{cols:"12"},{default:l(()=>[a(Y,{modelValue:s.value.expenseCategory,"onUpdate:modelValue":e[13]||(e[13]=o=>s.value.expenseCategory=o),items:pe,label:"Expense Category",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(I,{modelValue:s.value.date,"onUpdate:modelValue":e[14]||(e[14]=o=>s.value.date=o),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(I,{modelValue:s.value.amount,"onUpdate:modelValue":e[15]||(e[15]=o=>s.value.amount=o),modelModifiers:{number:!0},label:"Amount (SAR)",type:"number",step:"0.01",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(Re,{modelValue:s.value.description,"onUpdate:modelValue":e[16]||(e[16]=o=>s.value.description=o),label:"Note/Description",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})],64))]),_:1})]),_:1})]),_:1}),a(ue,{class:"d-flex justify-end gap-2 pa-4"},{default:l(()=>[a(b,{variant:"tonal",color:"secondary",onClick:e[17]||(e[17]=o=>p.value=!1)},{default:l(()=>e[30]||(e[30]=[c(" Cancel ")])),_:1,__:[30]}),a(b,{disabled:w.value==="sales"&&!X.value,loading:C.value,onClick:le},{default:l(()=>e[31]||(e[31]=[c(" Save ")])),_:1,__:[31]},8,["disabled","loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),a(Ne,{"is-dialog-visible":E.value,"onUpdate:isDialogVisible":e[19]||(e[19]=o=>E.value=o),title:"Import Financial Data",label:"Choose CSV file",accept:".csv",onImport:_e},null,8,["is-dialog-visible"])],64)}}});export{qt as default};
