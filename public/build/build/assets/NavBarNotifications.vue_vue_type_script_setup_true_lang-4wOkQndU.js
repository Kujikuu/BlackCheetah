import{a as M}from"./formatters-WDr9EcLN.js";import{d as F,P as R,a as D,g as C,o as f,f as i,b as o,q as U,aa as x,J as N,t as V,v as g,m as k,K as T,c as A,F as z,i as H,l as S,e as y,aM as L,x as G,a3 as I,r as E,aN as $,aO as m,G as J}from"./main-BrAmouoN.js";import{C as O}from"./vue3-perfect-scrollbar-DbZQmMYO.js";import{V as q}from"./VBadge-Clv3YrHo.js";import{V as K}from"./VMenu-CMwE0TEA.js";import{V as Y,a as j,b as Q}from"./VCard-DApPZHvP.js";import{V as W}from"./VChip-CbwyjT0Z.js";import{V as X}from"./VTooltip-DmtihZGD.js";import{V as P}from"./VDivider-Ch4oqZye.js";import{V as Z,a as B,b as tt}from"./VList--MpM1GQQ.js";import{V as et}from"./VAvatar-DNG0Nmgh.js";import{V as at}from"./VImg-BoI76u4Q.js";import{V as ot}from"./VSpacer-BZy6xYJS.js";import{V as it}from"./VCardText-CsVBN6BO.js";const rt={class:"d-flex align-start gap-3"},st={key:0},nt={class:"text-sm font-weight-medium mb-1"},lt={class:"text-body-2 mb-2",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},ct={class:"text-sm text-disabled mb-0",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},dt={class:"d-flex flex-column align-end"},mt=F({__name:"Notifications",props:{notifications:{},badgeProps:{default:void 0},location:{default:"bottom end"}},emits:["read","unread","remove","click:notification"],setup(l,{emit:u}){const s=l,d=u,p=R(()=>s.notifications.some(r=>r.isSeen===!1)),w=()=>{const r=s.notifications.map(n=>n.id);p.value?d("read",r):d("unread",r)},c=R(()=>s.notifications.filter(r=>r.isSeen===!1).length),v=(r,n)=>{r?d("unread",[n]):d("read",[n])};return(r,n)=>{const _=D("IconBtn");return f(),C(_,{id:"notification-btn"},{default:i(()=>[o(q,U(s.badgeProps,{"model-value":s.notifications.some(a=>!a.isSeen),color:"error",dot:"","offset-x":"2","offset-y":"3"}),{default:i(()=>[o(x,{icon:"tabler-bell"})]),_:1},16,["model-value"]),o(K,{activator:"parent",width:"380px",location:s.location,offset:"12px","close-on-content-click":!1},{default:i(()=>[o(Y,{class:"d-flex flex-column"},{default:i(()=>[o(j,{class:"notification-section"},{append:i(()=>[N(o(W,{size:"small",color:"primary",class:"me-2"},{default:i(()=>[V(g(k(c))+" New ",1)]),_:1},512),[[T,s.notifications.some(a=>!a.isSeen)]]),N(o(_,{size:"34",onClick:w},{default:i(()=>[o(x,{size:"20",color:"high-emphasis",icon:k(p)?"tabler-mail-opened":"tabler-mail"},null,8,["icon"]),o(X,{activator:"parent",location:"start"},{default:i(()=>[V(g(k(p)?"Mark all as read":"Mark all as unread"),1)]),_:1})]),_:1},512),[[T,s.notifications.length]])]),default:i(()=>[o(Q,{class:"text-h6"},{default:i(()=>n[0]||(n[0]=[V(" Notifications ")])),_:1,__:[0]})]),_:1}),o(P),o(k(O),{options:{wheelPropagation:!1},style:{"max-block-size":"23.75rem"}},{default:i(()=>[o(Z,{class:"notification-list rounded-0 py-0"},{default:i(()=>[(f(!0),A(z,null,H(s.notifications,(a,t)=>(f(),A(z,{key:a.title},[t>0?(f(),C(P,{key:0})):S("",!0),o(B,{link:"",lines:"one","min-height":"66px",class:"list-item-hover-class",onClick:e=>r.$emit("click:notification",a)},{default:i(()=>[y("div",rt,[o(et,{color:a.color&&!a.img?a.color:void 0,variant:a.img?void 0:"tonal"},{default:i(()=>[a.text?(f(),A("span",st,g(("avatarText"in r?r.avatarText:k(M))(a.text)),1)):S("",!0),a.img?(f(),C(at,{key:1,src:a.img},null,8,["src"])):S("",!0),a.icon?(f(),C(x,{key:2,icon:a.icon},null,8,["icon"])):S("",!0)]),_:2},1032,["color","variant"]),y("div",null,[y("p",nt,g(a.title),1),y("p",lt,g(a.subtitle),1),y("p",ct,g(a.time),1)]),o(ot),y("div",dt,[o(x,{size:"10",icon:"tabler-circle-filled",color:a.isSeen?"#a8aaae":"primary",class:G([`${a.isSeen?"visible-in-hover":""}`,"mb-2"]),onClick:L(e=>v(a.isSeen,a.id),["stop"])},null,8,["color","class","onClick"]),o(x,{size:"20",icon:"tabler-x",class:"visible-in-hover",onClick:e=>r.$emit("remove",a.id)},null,8,["onClick"])])])]),_:2},1032,["onClick"])],64))),128)),N(o(B,{class:"text-center text-medium-emphasis",style:{"block-size":"56px"}},{default:i(()=>[o(tt,null,{default:i(()=>n[1]||(n[1]=[V("No Notification Found!")])),_:1,__:[1]})]),_:1},512),[[T,!s.notifications.length]])]),_:1})]),_:1}),o(P),N(o(it,{class:"pa-4"},{default:i(()=>[o(I,{block:"",size:"small"},{default:i(()=>n[2]||(n[2]=[V(" View All Notifications ")])),_:1,__:[2]})]),_:1},512),[[T,s.notifications.length]])]),_:1})]),_:1},8,["location"])]),_:1})}}}),ft=()=>{const l=E([]),u=E(!1),s=E({total:0,unread:0,read:0}),d=t=>{const e=t.data||{};return{id:t.id,title:e.title||"Notification",subtitle:e.subtitle||"",time:p(t.created_at),color:e.color||"primary",isSeen:!!t.read_at,icon:e.icon,img:e.img,text:e.text}},p=t=>{const e=new Date(t),b=Math.floor((new Date().getTime()-e.getTime())/(1e3*60*60));return b<1?"Just now":b<24?`${b}h ago`:b<48?"Yesterday":e.toLocaleDateString()},w=async(t=!1)=>{try{u.value=!0;const h=await m("/v1/notifications",{method:"GET",params:t?{unread_only:!0}:{}});return l.value=h.data.data.map(d),h.data}catch(e){throw console.error("Error fetching notifications:",e),e}finally{u.value=!1}},c=async()=>{try{const t=await m("/v1/notifications/stats",{method:"GET"});return s.value=t.data,t.data}catch(t){throw console.error("Error fetching notification stats:",t),t}},v=async t=>{try{t.length===1?await m(`/v1/notifications/${t[0]}/read`,{method:"PATCH"}):await m("/v1/notifications/mark-multiple-read",{method:"PATCH",body:{notification_ids:t}}),l.value.forEach(e=>{t.includes(e.id)&&(e.isSeen=!0)}),await c()}catch(e){throw console.error("Error marking notifications as read:",e),e}},r=async t=>{try{t.length===1?await m(`/v1/notifications/${t[0]}/unread`,{method:"PATCH"}):await m("/v1/notifications/mark-multiple-unread",{method:"PATCH",body:{notification_ids:t}}),l.value.forEach(e=>{t.includes(e.id)&&(e.isSeen=!1)}),await c()}catch(e){throw console.error("Error marking notifications as unread:",e),e}},n=async()=>{try{await m("/v1/notifications/mark-all-read",{method:"PATCH"}),l.value.forEach(t=>{t.isSeen=!0}),await c()}catch(t){throw console.error("Error marking all notifications as read:",t),t}},_=async t=>{try{await m(`/v1/notifications/${t}`,{method:"DELETE"});const e=l.value.findIndex(h=>h.id===t);e>-1&&l.value.splice(e,1),await c()}catch(e){throw console.error("Error removing notification:",e),e}},a=async t=>{t.isSeen||await v([t.id])};return{notifications:$(l),loading:$(u),stats:$(s),fetchNotifications:w,fetchStats:c,markAsRead:v,markAsUnread:r,markAllAsRead:n,removeNotification:_,handleNotificationClick:a}},Tt=F({__name:"NavBarNotifications",setup(l){const{notifications:u,fetchNotifications:s,fetchStats:d,markAsRead:p,markAsUnread:w,removeNotification:c,handleNotificationClick:v}=ft();J(async()=>{try{await s(),await d()}catch(t){console.error("Failed to load notifications:",t)}});const r=async t=>{try{await c(t)}catch(e){console.error("Failed to remove notification:",e)}},n=async t=>{try{await p(t)}catch(e){console.error("Failed to mark notifications as read:",e)}},_=async t=>{try{await w(t)}catch(e){console.error("Failed to mark notifications as unread:",e)}},a=async t=>{try{await v(t)}catch(e){console.error("Failed to handle notification click:",e)}};return(t,e)=>{const h=mt;return f(),C(h,{notifications:k(u),onRemove:r,onRead:n,onUnread:_,"onClick:notification":a},null,8,["notifications"])}}});export{Tt as _};
