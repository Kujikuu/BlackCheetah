import{V as x,_ as U}from"./VDialog-6C-NQXCx.js";import{b5 as m,b2 as h,d as B,r as v,P,w as N,g as y,f as l,aR as b,m as d,b as r,l as E,e as V,v as C,t as g,a9 as _,o as f}from"./main-gemCwVks.js";import{V as S}from"./VDivider-B4ry9pxl.js";import{V as R}from"./VCardText-BD5AHO-w.js";import{V as A}from"./VChip-DlNApjyg.js";import{V as G}from"./VSelect-C9dxRhag.js";import{d as q,V as z}from"./VCard-DJ82mpnW.js";import{V as H}from"./VSpacer-Cpeayo2U.js";const k=()=>{const o=h("userData").value,t=o==null?void 0:o.role;return t==="sales"?"/v1/sales/tasks":t==="franchisor"?"/v1/franchisor/tasks":"/v1/tasks"},L={async getMyTasks(a){const o=k(),t=new URLSearchParams;a!=null&&a.status&&t.append("status",a.status),a!=null&&a.priority&&t.append("priority",a.priority),a!=null&&a.category&&t.append("category",a.category),a!=null&&a.page&&t.append("page",a.page.toString()),a!=null&&a.perPage&&t.append("per_page",a.perPage.toString());const p=t.toString(),n=p?`${o}?${p}`:o;return await m(n,{method:"GET"})},async getStatistics(){const a=k();return await m(`${a}/statistics`,{method:"GET"})},async updateTaskStatus(a,o){const t=k();return await m(`${t}/${a}/status`,{method:"PATCH",body:{status:o}})},async getTask(a){const o=k();return await m(`${o}/${a}`,{method:"GET"})}},O={class:"mb-4"},F={class:"text-base font-weight-medium mb-2"},I={class:"text-body-2 text-disabled"},aa=B({__name:"StatusChangeTaskDialog",props:{isDialogVisible:{type:Boolean},task:{}},emits:["update:isDialogVisible","status-updated"],setup(a,{emit:o}){const t=a,p=o,n=v(""),c=v(!1),u=P({get:()=>t.isDialogVisible,set:e=>{p("update:isDialogVisible",e),e||(n.value="")}});N(()=>{var e;return(e=t.task)==null?void 0:e.status},e=>{e&&(n.value=e)},{immediate:!0});const w=[{title:"Pending",value:"pending"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"},{title:"Cancelled",value:"cancelled"},{title:"On Hold",value:"on_hold"}],T=e=>e==="completed"?"success":e==="in_progress"?"warning":e==="pending"?"info":e==="cancelled"?"error":"secondary",D=async()=>{if(!(!t.task||!n.value)){c.value=!0;try{const e=await L.updateTaskStatus(t.task.id,n.value);if(e.success){const s={...t.task,status:n.value};p("status-updated",s),u.value=!1}else console.error("Failed to update task status:",e.message)}catch(e){console.error("Error updating task status:",e)}finally{c.value=!1}}};return(e,s)=>{const $=U;return f(),y(x,{modelValue:d(u),"onUpdate:modelValue":s[3]||(s[3]=i=>b(u)?u.value=i:null),"max-width":"600"},{default:l(()=>[r($,{onClick:s[0]||(s[0]=i=>u.value=!1)}),r(z,{title:"Change Task Status"},{default:l(()=>[r(S),t.task?(f(),y(R,{key:0,class:"pa-6"},{default:l(()=>[V("div",O,[V("h6",F,C(t.task.title),1),V("div",I,[s[4]||(s[4]=g(" Current Status: ")),r(A,{color:T(t.task.status),size:"small",label:"",class:"text-capitalize ml-2"},{default:l(()=>[g(C(t.task.status),1)]),_:1},8,["color"])])]),r(G,{modelValue:d(n),"onUpdate:modelValue":s[1]||(s[1]=i=>b(n)?n.value=i:null),label:"New Status",items:w,"item-title":"title","item-value":"value",required:""},null,8,["modelValue"])]),_:1})):E("",!0),r(S),r(q,{class:"pa-6"},{default:l(()=>{var i;return[r(H),r(_,{color:"secondary",variant:"tonal",onClick:s[2]||(s[2]=M=>u.value=!1)},{default:l(()=>s[5]||(s[5]=[g(" Cancel ")])),_:1,__:[5]}),r(_,{color:"primary",disabled:!d(n)||d(n)===((i=t.task)==null?void 0:i.status)||d(c),loading:d(c),onClick:D},{default:l(()=>s[6]||(s[6]=[g(" Update Status ")])),_:1,__:[6]},8,["disabled","loading"])]}),_:1})]),_:1})]),_:1},8,["modelValue"])}}});export{aa as _,L as t};
