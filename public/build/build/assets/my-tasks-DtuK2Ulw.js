import{aO as T,aL as Z,d as tt,r as _,P as C,G as st,c as at,b as t,g as $,l as I,f as s,m as o,au as L,j as et,o as S,e,aa as v,v as u,t as m,a3 as U}from"./main-CpsWdFYr.js";import{V as M,a as p}from"./VRow-Bk9_G6aB.js";import{V as lt}from"./VAlert-DRT0ey_A.js";import{V as k,a as ot,b as R,d as N}from"./VCard-D_XCsLRw.js";import{V as G}from"./VDialog-ChyOvTE6.js";import{V as y}from"./VCardText-j0JBfbAe.js";import{V as w}from"./VAvatar-CzxzJOWa.js";import{V as x}from"./VDivider-BP0aNN7O.js";import{q as it}from"./VDataTable-BZUXZCW2.js";import{V as rt}from"./VMenu-PCh5aX_y.js";import{V as dt,a as q,b as F}from"./VList-DZrW6fib.js";import{V}from"./VChip-yrA_M1tP.js";import{V as H}from"./VSpacer-D_nZvJpN.js";import{V as nt}from"./VSelect-CtqI8NsY.js";/* empty css              */import"./VImg-DCJkd1LN.js";import"./VOverlay-BGEfXIrC.js";import"./easing-Bybner-F.js";import"./lazy-C2iFJq6n.js";import"./scopeId-D-NoPJiR.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-D456YNVX.js";import"./VPagination-CUSlXpHq.js";import"./VCheckboxBtn-D9UFBLvW.js";import"./VSelectionControl-BJqGXIsn.js";import"./form-DyYLQJyt.js";import"./VTable-CKwy69H0.js";import"./filter-jIliInNJ.js";import"./ssrBoot-BhGqyhmX.js";import"./VSlideGroup-93CEUUHa.js";import"./VTextField-CUOQrd4S.js";/* empty css                   */import"./VCounter-CbUu5J9F.js";import"./VField-DDq05bP2.js";import"./VInput-B4TWBtjL.js";const z=()=>{const c=Z("userData").value,n=c==null?void 0:c.role;return n==="sales"?"/v1/sales/tasks":n==="franchisor"?"/v1/franchisor/tasks":"/v1/tasks"},A={async getMyTasks(l){const c=z(),n=new URLSearchParams;l!=null&&l.status&&n.append("status",l.status),l!=null&&l.priority&&n.append("priority",l.priority),l!=null&&l.category&&n.append("category",l.category),l!=null&&l.page&&n.append("page",l.page.toString()),l!=null&&l.perPage&&n.append("per_page",l.perPage.toString());const i=n.toString(),b=i?`${c}?${i}`:c;return await T(b,{method:"GET"})},async getStatistics(){const l=z();return await T(`${l}/statistics`,{method:"GET"})},async updateTaskStatus(l,c){const n=z();return await T(`${n}/${l}/status`,{method:"PATCH",body:{status:c}})},async getTask(l){const c=z();return await T(`${c}/${l}`,{method:"GET"})}},ut={class:"ms-4"},ct={class:"text-h4"},mt={class:"ms-4"},pt={class:"text-h4"},ft={class:"ms-4"},_t={class:"text-h4"},vt={class:"ms-4"},kt={class:"text-h4"},bt={class:"text-base font-weight-medium"},yt={class:"text-body-2 text-disabled"},gt={class:"text-h6 mb-2"},xt={class:"text-body-1 mb-4"},Vt={class:"text-body-1"},Tt={class:"text-body-1"},Ct={class:"text-body-1"},St={class:"mb-4"},wt={class:"text-base font-weight-medium mb-2"},zt={class:"text-body-2 text-disabled"},ns=tt({__name:"my-tasks",setup(l){et();const c=_(!1),n=_(!1),i=_(null),b=_([]),g=_({totalTasks:0,completedTasks:0,inProgressTasks:0,dueTasks:0}),D=_(!1),f=_(null),j=C(()=>g.value.totalTasks),O=C(()=>g.value.completedTasks),J=C(()=>g.value.inProgressTasks),K=C(()=>g.value.dueTasks),B=async()=>{try{D.value=!0,f.value=null;const[r,a]=await Promise.all([A.getMyTasks(),A.getStatistics()]);r.success&&(b.value=r.data),a.success&&(g.value=a.data)}catch(r){console.error("Error fetching tasks:",r),f.value=r.message||"Failed to load tasks"}finally{D.value=!1}};st(()=>{B()});const h=r=>r==="completed"?"success":r==="in_progress"?"warning":r==="pending"?"info":"secondary",E=r=>r==="high"?"error":r==="medium"?"warning":r==="low"?"info":"secondary",Q=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],W=r=>{i.value=r,c.value=!0},X=r=>{i.value={...r},n.value=!0},Y=async r=>{if(i.value)try{const a=await A.updateTaskStatus(i.value.id,r);if(a.success){const d=b.value.findIndex(P=>P.id===i.value.id);d!==-1&&(b.value[d].status=r),await B(),n.value=!1,i.value=null}else f.value=a.message||"Failed to update task status"}catch(a){console.error("Error updating task status:",a),f.value=a.message||"Failed to update task status"}};return(r,a)=>(S(),at("section",null,[t(M,{class:"mb-6"},{default:s(()=>[t(p,{cols:"12"},{default:s(()=>a[5]||(a[5]=[e("div",null,[e("h2",{class:"text-h2 mb-1"}," My Tasks "),e("p",{class:"text-body-1 text-medium-emphasis"}," Track and manage tasks assigned to you ")],-1)])),_:1,__:[5]})]),_:1}),t(M,{class:"mb-6"},{default:s(()=>[t(p,{cols:"12",md:"3"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"d-flex align-center"},{default:s(()=>[t(w,{size:"44",rounded:"",color:"primary",variant:"tonal"},{default:s(()=>[t(v,{icon:"tabler-checklist",size:"26"})]),_:1}),e("div",ut,[a[6]||(a[6]=e("div",{class:"text-body-2 text-disabled"}," Total Tasks ",-1)),e("h4",ct,u(o(j)),1)])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"3"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"d-flex align-center"},{default:s(()=>[t(w,{size:"44",rounded:"",color:"success",variant:"tonal"},{default:s(()=>[t(v,{icon:"tabler-check",size:"26"})]),_:1}),e("div",mt,[a[7]||(a[7]=e("div",{class:"text-body-2 text-disabled"}," Completed ",-1)),e("h4",pt,u(o(O)),1)])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"3"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"d-flex align-center"},{default:s(()=>[t(w,{size:"44",rounded:"",color:"warning",variant:"tonal"},{default:s(()=>[t(v,{icon:"tabler-clock",size:"26"})]),_:1}),e("div",ft,[a[8]||(a[8]=e("div",{class:"text-body-2 text-disabled"}," In Progress ",-1)),e("h4",_t,u(o(J)),1)])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"3"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"d-flex align-center"},{default:s(()=>[t(w,{size:"44",rounded:"",color:"error",variant:"tonal"},{default:s(()=>[t(v,{icon:"tabler-alert-circle",size:"26"})]),_:1}),e("div",vt,[a[9]||(a[9]=e("div",{class:"text-body-2 text-disabled"}," Due ",-1)),e("h4",kt,u(o(K)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(f)?(S(),$(lt,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-6","onClick:close":a[0]||(a[0]=d=>f.value=null)},{default:s(()=>[m(u(o(f)),1)]),_:1})):I("",!0),t(k,null,{default:s(()=>[t(ot,{class:"pb-4"},{default:s(()=>[t(R,null,{default:s(()=>a[10]||(a[10]=[m("My Tasks")])),_:1,__:[10]})]),_:1}),t(x),t(it,{items:o(b),headers:Q,loading:o(D),class:"text-no-wrap","item-value":"id"},{"item.taskInfo":s(({item:d})=>[e("div",null,[e("h6",bt,u(d.title),1),e("div",yt,u(d.description),1)])]),"item.priority":s(({item:d})=>[t(V,{color:E(d.priority),size:"small",label:"",class:"text-capitalize"},{default:s(()=>[m(u(d.priority),1)]),_:2},1032,["color"])]),"item.status":s(({item:d})=>[t(V,{color:h(d.status),size:"small",label:"",class:"text-capitalize"},{default:s(()=>[m(u(d.status),1)]),_:2},1032,["color"])]),"item.actions":s(({item:d})=>[t(U,{icon:"",variant:"text",color:"medium-emphasis",size:"small"},{default:s(()=>[t(v,{icon:"tabler-dots-vertical"}),t(rt,{activator:"parent"},{default:s(()=>[t(dt,null,{default:s(()=>[t(q,{onClick:P=>W(d)},{prepend:s(()=>[t(v,{icon:"tabler-eye"})]),default:s(()=>[t(F,null,{default:s(()=>a[11]||(a[11]=[m("View")])),_:1,__:[11]})]),_:2},1032,["onClick"]),t(q,{onClick:P=>X(d)},{prepend:s(()=>[t(v,{icon:"tabler-refresh"})]),default:s(()=>[t(F,null,{default:s(()=>a[12]||(a[12]=[m("Change Status")])),_:1,__:[12]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["items","loading"])]),_:1}),t(G,{modelValue:o(c),"onUpdate:modelValue":a[2]||(a[2]=d=>L(c)?c.value=d:null),"max-width":"600"},{default:s(()=>[t(k,null,{default:s(()=>[t(R,{class:"text-h5 pa-6 pb-4"},{default:s(()=>a[13]||(a[13]=[m(" Task Details ")])),_:1,__:[13]}),t(x),o(i)?(S(),$(y,{key:0,class:"pa-6"},{default:s(()=>[t(M,null,{default:s(()=>[t(p,{cols:"12"},{default:s(()=>[e("h6",gt,u(o(i).title),1),e("p",xt,u(o(i).description),1)]),_:1}),t(p,{cols:"12",md:"6"},{default:s(()=>[a[14]||(a[14]=e("div",{class:"text-body-2 text-disabled mb-1"}," Category ",-1)),e("div",Vt,u(o(i).category),1)]),_:1,__:[14]}),t(p,{cols:"12",md:"6"},{default:s(()=>[a[15]||(a[15]=e("div",{class:"text-body-2 text-disabled mb-1"}," Start Date ",-1)),e("div",Tt,u(o(i).startDate),1)]),_:1,__:[15]}),t(p,{cols:"12",md:"6"},{default:s(()=>[a[16]||(a[16]=e("div",{class:"text-body-2 text-disabled mb-1"}," Due Date ",-1)),e("div",Ct,u(o(i).dueDate),1)]),_:1,__:[16]}),t(p,{cols:"12",md:"6"},{default:s(()=>[a[17]||(a[17]=e("div",{class:"text-body-2 text-disabled mb-1"}," Priority ",-1)),t(V,{color:E(o(i).priority),size:"small",label:"",class:"text-capitalize"},{default:s(()=>[m(u(o(i).priority),1)]),_:1},8,["color"])]),_:1,__:[17]}),t(p,{cols:"12",md:"6"},{default:s(()=>[a[18]||(a[18]=e("div",{class:"text-body-2 text-disabled mb-1"}," Status ",-1)),t(V,{color:h(o(i).status),size:"small",label:"",class:"text-capitalize"},{default:s(()=>[m(u(o(i).status),1)]),_:1},8,["color"])]),_:1,__:[18]})]),_:1})]),_:1})):I("",!0),t(x),t(N,{class:"pa-6"},{default:s(()=>[t(H),t(U,{color:"secondary",variant:"tonal",onClick:a[1]||(a[1]=d=>c.value=!1)},{default:s(()=>a[19]||(a[19]=[m(" Close ")])),_:1,__:[19]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(G,{modelValue:o(n),"onUpdate:modelValue":a[4]||(a[4]=d=>L(n)?n.value=d:null),"max-width":"400"},{default:s(()=>[t(k,null,{default:s(()=>[t(R,{class:"text-h5 pa-6 pb-4"},{default:s(()=>a[20]||(a[20]=[m(" Change Task Status ")])),_:1,__:[20]}),t(x),o(i)?(S(),$(y,{key:0,class:"pa-6"},{default:s(()=>[e("div",St,[e("h6",wt,u(o(i).title),1),e("div",zt,[a[21]||(a[21]=m(" Current Status: ")),t(V,{color:h(o(i).status),size:"small",label:"",class:"text-capitalize ml-2"},{default:s(()=>[m(u(o(i).status),1)]),_:1},8,["color"])])]),t(nt,{label:"New Status",items:[{title:"Pending",value:"pending"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],"model-value":o(i).status,required:"","onUpdate:modelValue":Y},null,8,["model-value"])]),_:1})):I("",!0),t(x),t(N,{class:"pa-6"},{default:s(()=>[t(H),t(U,{color:"secondary",variant:"tonal",onClick:a[3]||(a[3]=d=>n.value=!1)},{default:s(()=>a[22]||(a[22]=[m(" Cancel ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}});export{ns as default};
