import{r as y,aN as D,aO as w,d as q,P as x,w as h,g as A,f as r,b as e,t as C,aM as I,m as t,au as O,a3 as F,o as _}from"./main-D0PmdS1Y.js";import{V as N}from"./VDialog-sZu71cKP.js";import{b as R,d as E,V as M}from"./VCard-B7UpWRaQ.js";import{V as H}from"./VDivider-BtoRnDHG.js";import{V as B}from"./VCardText-CIwjKnf_.js";import{V as $}from"./VForm-aksOmHMd.js";import{V as z,a as c}from"./VRow-Cak-Lgex.js";import{V as b}from"./VTextField-B880wQkJ.js";import{V as K}from"./VTextarea-l0aNL8-w.js";import{V as S}from"./VSelect-RqmmXubD.js";import{V as L}from"./VSpacer-CdkRG-y7.js";const G=["Operations","Training","Maintenance","Marketing","Finance","HR","Quality Control","Customer Service"],Q=[{title:"Low",value:"low"},{title:"Medium",value:"medium"},{title:"High",value:"high"}],Y=[{title:"Pending",value:"pending"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],re=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Assigned To",key:"assignedTo"},{title:"Unit",key:"unitName"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],j=()=>{const p=y([]),f=y([]),d=y(!1),V=y(null),T=async()=>{var u,o;try{d.value=!0,V.value=null;const s=await w("/v1/franchisor/franchisees");s.success&&((u=s.data)!=null&&u.data)?p.value=s.data.data.map(m=>({id:m.id,name:m.name,email:m.email,role:"franchisee",status:m.status})):p.value=[]}catch(s){console.error("Failed to fetch franchisees:",s),V.value=((o=s==null?void 0:s.data)==null?void 0:o.message)||"Failed to fetch franchisees",p.value=[]}finally{d.value=!1}},v=async()=>{var u;try{d.value=!0,V.value=null;const o=await w("/v1/franchisor/sales-associates");o.success&&o.data?f.value=o.data.map(s=>({id:s.id,name:s.name,email:s.email,role:"sales",status:s.status})):f.value=[]}catch(o){console.error("Failed to fetch sales users:",o),V.value=((u=o==null?void 0:o.data)==null?void 0:u.message)||"Failed to fetch sales users",f.value=[]}finally{d.value=!1}},U=u=>(u==="franchisee"?p.value:f.value).filter(s=>s.status==="active").map(s=>({title:`${s.name} (${s.email})`,value:s.id,subtitle:s.role})),l=(u,o)=>{const m=(o==="franchisee"?p.value:f.value).find(k=>k.id===u);return m?m.name:"Unknown User"},g=async(u="both")=>{(u==="franchisee"||u==="both")&&await T(),(u==="sales"||u==="both")&&await v()};return{franchisees:D(p),salesUsers:D(f),loading:D(d),error:D(V),fetchFranchisees:T,fetchSalesUsers:v,getUsersForSelect:U,getUserNameById:l,initializeUsers:g}},ue=q({__name:"CreateTaskModal",props:{isDialogVisible:{type:Boolean},currentTab:{}},emits:["update:isDialogVisible","taskCreated"],setup(p,{emit:f}){const d=p,V=f,{getUsersForSelect:T,initializeUsers:v,loading:U}=j(),l=y({title:"",description:"",category:"",assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}),g=y(!1),u=x(()=>{const n=d.currentTab||"franchisee";return T(n)}),o=n=>!!n||"This field is required",s=n=>{V("update:isDialogVisible",n)},m=()=>{l.value={title:"",description:"",category:"",assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}},k=()=>{if(g.value){const n={id:Date.now(),...l.value};V("taskCreated",n),m(),s(!1)}},P=()=>{m(),s(!1)};return h(()=>d.isDialogVisible,async n=>{if(n){const a=d.currentTab||"franchisee";await v(a)}else m()}),h(()=>d.currentTab,async n=>{d.isDialogVisible&&n&&(await v(n),l.value.assignedTo="")}),(n,a)=>(_(),A(N,{"model-value":d.isDialogVisible,"max-width":"600",persistent:"","onUpdate:modelValue":s},{default:r(()=>[e(M,null,{default:r(()=>[e(R,{class:"text-h5 pa-6 pb-4"},{default:r(()=>a[11]||(a[11]=[C(" Create New Task ")])),_:1,__:[11]}),e(H),e(B,{class:"pa-6"},{default:r(()=>[e($,{modelValue:t(g),"onUpdate:modelValue":a[10]||(a[10]=i=>O(g)?g.value=i:null),onSubmit:I(k,["prevent"])},{default:r(()=>[e(z,null,{default:r(()=>[e(c,{cols:"12"},{default:r(()=>[e(b,{modelValue:t(l).title,"onUpdate:modelValue":a[0]||(a[0]=i=>t(l).title=i),label:"Task Title",placeholder:"Enter task title",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12"},{default:r(()=>[e(K,{modelValue:t(l).description,"onUpdate:modelValue":a[1]||(a[1]=i=>t(l).description=i),label:"Description",placeholder:"Enter task description",rows:"3",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(S,{modelValue:t(l).category,"onUpdate:modelValue":a[2]||(a[2]=i=>t(l).category=i),label:"Category",placeholder:"Select category",items:t(G),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(S,{modelValue:t(l).assignedTo,"onUpdate:modelValue":a[3]||(a[3]=i=>t(l).assignedTo=i),label:"Assigned To",placeholder:"Select user",items:t(u),loading:t(U),rules:[o],"item-title":"title","item-value":"value",required:""},null,8,["modelValue","items","loading","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(b,{modelValue:t(l).startDate,"onUpdate:modelValue":a[4]||(a[4]=i=>t(l).startDate=i),label:"Start Date",type:"date",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(b,{modelValue:t(l).dueDate,"onUpdate:modelValue":a[5]||(a[5]=i=>t(l).dueDate=i),label:"Due Date",type:"date",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(S,{modelValue:t(l).priority,"onUpdate:modelValue":a[6]||(a[6]=i=>t(l).priority=i),label:"Priority",placeholder:"Select priority",items:t(Q),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(S,{modelValue:t(l).status,"onUpdate:modelValue":a[7]||(a[7]=i=>t(l).status=i),label:"Status",placeholder:"Select status",items:t(Y),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(b,{modelValue:t(l).estimatedHours,"onUpdate:modelValue":a[8]||(a[8]=i=>t(l).estimatedHours=i),label:"Estimated Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(b,{modelValue:t(l).actualHours,"onUpdate:modelValue":a[9]||(a[9]=i=>t(l).actualHours=i),label:"Actual Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(H),e(E,{class:"pa-6"},{default:r(()=>[e(L),e(F,{color:"error",variant:"text",onClick:P},{default:r(()=>a[12]||(a[12]=[C(" Cancel ")])),_:1,__:[12]}),e(F,{color:"primary",disabled:!t(g),onClick:k},{default:r(()=>a[13]||(a[13]=[C(" Create Task ")])),_:1,__:[13]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}});export{Q as P,Y as S,re as T,ue as _,G as a,j as u};
