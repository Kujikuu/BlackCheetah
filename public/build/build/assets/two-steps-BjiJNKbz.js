import{L as Y,M as G,bP as J,Q as X,bc as Z,P,r as V,aB as ee,ac as g,w as I,N as te,R as ae,b as a,F as le,q as N,aF as se,bY as oe,bT as ne,bE as L,ag as ue,d as ie,bt as re,j as de,b2 as x,a as ce,c as fe,o as j,e as m,aW as O,m as u,f as i,H as M,v as q,b3 as me,g as pe,l as ve,t as E,aR as be,a9 as ye,x as he,b5 as ge,cU as Ve}from"./main-ZX0RELSf.js";import{a as _e,b as ke}from"./auth-v1-top-shape-gPxasD3d.js";import{V as B}from"./VNodeRenderer-BikkbM0P.js";import{a as we,b as xe,V as Re}from"./VCard-BPtOKe4P.js";import{V as H}from"./VCardText-DO_FRZge.js";import{V as Ce}from"./VForm-CMcQHaRk.js";import{V as Ae,a as R}from"./VRow-Cqbjxu10.js";import{V as De}from"./VAlert-DtX8sKY_.js";import{V as Te,m as Fe}from"./VField-D__vLB60.js";import{a as Pe}from"./VOverlay-B0AA_Njd.js";import{u as Be,m as Se}from"./form-BPJFMOHG.js";import"./VAvatar-Dwbi0l9K.js";import"./VImg-BhWA0TmX.js";import"./forwardRefs--KQCZfKO.js";/* empty css              */import"./scopeId-B6sKQhYQ.js";const Ie=G({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...ne(),...Se(),...oe(Fe({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),Ne=Y()({name:"VOtpInput",props:Ie(),emits:{finish:t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,C){let{attrs:b,emit:_,slots:r}=C;const{dimensionStyles:p}=J(t),{isFocused:w,focus:A,blur:D}=Be(t),n=X(t,"modelValue","",e=>e==null?[]:String(e).split(""),e=>e.join("")),{t:l}=Z(),v=P(()=>Number(t.length)),y=P(()=>Array(v.value).fill(0)),f=V(-1),T=V(),h=V([]),F=P(()=>h.value[f.value]);function U(){if(S(F.value.value)){F.value.value="";return}const e=n.value.slice(),s=F.value.value;e[f.value]=s;let d=null;f.value>n.value.length?d=n.value.length+1:f.value+1!==v.value&&(d="next"),n.value=e,d&&L(T.value,d)}function z(e){const s=n.value.slice(),d=f.value;let c=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(e.key)&&(e.preventDefault(),e.key==="ArrowLeft"?c="prev":e.key==="ArrowRight"?c="next":["Backspace","Delete"].includes(e.key)&&(s[f.value]="",n.value=s,f.value>0&&e.key==="Backspace"?c="prev":requestAnimationFrame(()=>{var o;(o=h.value[d])==null||o.select()})),requestAnimationFrame(()=>{c!=null&&L(T.value,c)}))}function K(e,s){var c,o;s.preventDefault(),s.stopPropagation();const d=((c=s==null?void 0:s.clipboardData)==null?void 0:c.getData("Text").slice(0,v.value))??"";S(d)||(n.value=d.split(""),(o=h.value)==null||o[e].blur())}function W(){n.value=[]}function $(e,s){A(),f.value=s}function Q(){D(),f.value=-1}function S(e){return t.type==="number"&&/[^0-9]/g.test(e)}return ee({VField:{color:g(()=>t.color),bgColor:g(()=>t.color),baseColor:g(()=>t.baseColor),disabled:g(()=>t.disabled),error:g(()=>t.error),variant:g(()=>t.variant)}},{scoped:!0}),I(n,e=>{e.length===v.value&&_("finish",e.join(""))},{deep:!0}),I(f,e=>{e<0||ue(()=>{var s;(s=h.value[e])==null||s.select()})}),te(()=>{var d;const[e,s]=ae(b);return a("div",N({class:["v-otp-input",{"v-otp-input--divided":!!t.divider},t.class],style:[t.style]},e),[a("div",{ref:T,class:"v-otp-input__content",style:[p.value]},[y.value.map((c,o)=>a(le,null,[t.divider&&o!==0&&a("span",{class:"v-otp-input__divider"},[t.divider]),a(Te,{focused:w.value&&t.focusAll||f.value===o,key:o},{...r,loader:void 0,default:()=>a("input",{ref:k=>h.value[o]=k,"aria-label":l(t.label,o+1),autofocus:o===0&&t.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],disabled:t.disabled,inputmode:t.type==="number"?"numeric":"text",min:t.type==="number"?0:void 0,maxlength:o===0?v.value:"1",placeholder:t.placeholder,type:t.type==="number"?"text":t.type,value:n.value[o],onInput:U,onFocus:k=>$(k,o),onBlur:Q,onKeydown:z,onPaste:k=>K(o,k)},null)})])),a("input",N({class:"v-otp-input-input",type:"hidden"},s,{value:n.value.join("")}),null),a(Pe,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!t.loading,persistent:!0},{default:()=>{var c;return[((c=r.loader)==null?void 0:c.call(r))??a(se,{color:typeof t.loading=="boolean"?void 0:t.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(d=r.default)==null?void 0:d.call(r)])])}),{blur:()=>{var e;(e=h.value)==null||e.some(s=>s.blur())},focus:()=>{var e;(e=h.value)==null||e[0].focus()},reset:W,isFocused:w}}}),Le={class:"auth-wrapper d-flex align-center justify-center pa-4"},je={class:"position-relative my-sm-16"},Oe={class:"app-logo"},Me={class:"app-logo-title"},at=ie({__name:"two-steps",setup(t){const{smAndUp:C}=re(),b=de(),_=V(""),r=V(!1),p=V(null),w=x("userData"),{updateAbility:A}=Ve(),D=async()=>{var n;r.value=!0,p.value="Verifying code...";try{await new Promise(y=>setTimeout(y,800));const l=await ge("/auth/login",{method:"POST",body:{email:(n=w.value)==null?void 0:n.email,password:"password"}});switch(x("accessToken").value=l.accessToken,x("userData").value=l.userData,x("userAbilityRules").value=l.userAbilityRules,A(l.userAbilityRules),p.value="Code verified successfully. Redirecting...",await new Promise(y=>setTimeout(y,1200)),p.value=null,l.userData.role){case"admin":b.push("/admin/dashboard");break;case"franchisor":b.push("/franchisor");break;case"franchisee":b.push("/franchisee/dashboard/sales");break;case"sales":b.push("/sales/lead-management");break;default:b.push("/")}}catch{p.value="Verification failed. Please try again.",r.value=!1}};return(n,l)=>{const v=ce("RouterLink");return j(),fe("div",Le,[m("div",je,[a(u(B),{nodes:O("div",{innerHTML:u(_e)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),a(u(B),{nodes:O("div",{innerHTML:u(ke)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),a(Re,{class:he(["auth-card",u(C)?"pa-6":"pa-0"]),"max-width":"460"},{default:i(()=>[a(we,{class:"justify-center"},{default:i(()=>[a(xe,null,{default:i(()=>[a(v,{to:"/"},{default:i(()=>[m("div",Oe,[a(u(B),{nodes:u(M).app.logo},null,8,["nodes"]),m("h1",Me,q(u(M).app.title),1)])]),_:1})]),_:1})]),_:1}),a(H,null,{default:i(()=>l[1]||(l[1]=[m("h4",{class:"text-h4 mb-1"}," Two Step Verification ðŸ’¬ ",-1),m("p",{class:"mb-1"}," We sent a verification code to your mobile. Enter the code from the mobile in the field below. ",-1),m("h6",{class:"text-h6"}," ******1234 ",-1)])),_:1,__:[1]}),a(H,null,{default:i(()=>[a(Ce,{onSubmit:me(()=>{},["prevent"])},{default:i(()=>[a(Ae,null,{default:i(()=>[a(R,{cols:"12"},{default:i(()=>[u(p)?(j(),pe(De,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:i(()=>[E(q(u(p)),1)]),_:1})):ve("",!0)]),_:1}),a(R,{cols:"12"},{default:i(()=>[l[2]||(l[2]=m("h6",{class:"text-body-1"}," Type your 6 digit security code ",-1)),a(Ne,{modelValue:u(_),"onUpdate:modelValue":l[0]||(l[0]=y=>be(_)?_.value=y:null),disabled:u(r),type:"number",class:"pa-0",onFinish:D},null,8,["modelValue","disabled"])]),_:1,__:[2]}),a(R,{cols:"12"},{default:i(()=>[a(ye,{loading:u(r),disabled:u(r),block:"",type:"submit"},{default:i(()=>l[3]||(l[3]=[E(" Verify my account ")])),_:1,__:[3]},8,["loading","disabled"])]),_:1}),a(R,{cols:"12"},{default:i(()=>l[4]||(l[4]=[m("div",{class:"d-flex justify-center align-center flex-wrap"},[m("span",{class:"me-1"},"Didn't get the code?"),m("a",{href:"#"},"Resend")],-1)])),_:1,__:[4]})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])}}});export{at as default};
