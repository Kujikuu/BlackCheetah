import{V as P,_ as $}from"./VDialog-6C-NQXCx.js";import{b5 as y,b2 as I,d as T,r as D,P as L,w as M,g as x,f as o,b as e,b3 as N,e as a,a9 as h,t as V,o as C,l as k,v as m,ax as g}from"./main-gemCwVks.js";import{V as U}from"./VCardText-BD5AHO-w.js";import{V as j}from"./VForm-FUZpY-zG.js";import{V as B,a as d}from"./VRow-DiX7eN30.js";import{V as A}from"./VTextField-BhxF6EAD.js";import{V as E}from"./VSelect-C9dxRhag.js";import{V as z}from"./VFileInput-CB0ItP4X.js";import{d as F,V as w}from"./VCard-DJ82mpnW.js";import{V as O}from"./VSpacer-Cpeayo2U.js";import{V as S}from"./VDivider-B4ry9pxl.js";import{V as G}from"./VChip-DlNApjyg.js";import{V as q}from"./VTable-0Z68chLt.js";const H="/v1/franchisor/royalties",J="/v1/unit-manager/royalties",c=()=>{var s;return((s=I("userData").value)==null?void 0:s.role)==="franchisor"?H:J},X={async getRoyalties(l){return await y(c(),{params:l})},async getRoyalty(l){return await y(`${c()}/${l}`)},async getStatistics(l){return await y(`${c()}/statistics`,{params:l})},async markAsPaid(l,n){const s=new FormData;return s.append("amount_paid",(n.amount_paid||0).toString()),s.append("payment_date",n.payment_date||""),s.append("payment_method",n.payment_type||""),n.payment_reference&&s.append("payment_reference",n.payment_reference),n.notes&&s.append("notes",n.notes),n.attachment&&s.append("attachment",n.attachment),s.append("_method","PATCH"),await y(`${c()}/${l}/mark-paid`,{method:"POST",body:s,headers:{"Content-Type":void 0}})},async exportRoyalties(l){return await y(`${c()}/export`,{params:l,parseResponse:n=>n})},async createRoyalty(l){return await y("/api/v1/royalties",{method:"POST",body:l})},async updateRoyalty(l,n){return await y(`${c()}/${l}`,{method:"PUT",body:n})},async deleteRoyalty(l){await y(`${c()}/${l}`,{method:"DELETE"})},async addAdjustment(l,n,s){return await y(`${c()}/${l}/adjustments`,{method:"POST",body:{adjustment_amount:n,adjustment_reason:s}})},async calculateLateFee(l){return await y(`${c()}/${l}/late-fee`,{method:"POST"})}},Pt=T({__name:"MarkCompletedRoyaltyDialog",props:{isDialogVisible:{type:Boolean},selectedRoyalty:{},paymentTypeOptions:{}},emits:["update:isDialogVisible","paymentSubmitted"],setup(l,{emit:n}){const s=l,v=n,p=D(!1),u=D({amount_paid:0,payment_date:"",payment_type:"",attachment:null}),_=L({get:()=>s.isDialogVisible,set:t=>v("update:isDialogVisible",t)});M(()=>s.selectedRoyalty,t=>{t&&(u.value={amount_paid:t.amount,payment_date:new Date().toISOString().split("T")[0],payment_type:"",attachment:null})},{immediate:!0});const R=async()=>{if(s.selectedRoyalty){p.value=!0;try{await X.markAsPaid(s.selectedRoyalty.id,u.value),v("paymentSubmitted"),_.value=!1,u.value={amount_paid:0,payment_date:"",payment_type:"",attachment:null}}catch(t){console.error("Error submitting payment:",t)}finally{p.value=!1}}},f=t=>{const i=t.target;i.files&&i.files[0]&&(u.value.attachment=i.files[0])};return(t,i)=>{const b=$;return C(),x(P,{modelValue:_.value,"onUpdate:modelValue":i[5]||(i[5]=r=>_.value=r),"max-width":"600"},{default:o(()=>[e(b,{onClick:i[0]||(i[0]=r=>_.value=!1)}),e(w,{title:"Mark Royalty as Completed"},{default:o(()=>[e(U,null,{default:o(()=>[e(j,{onSubmit:N(R,["prevent"])},{default:o(()=>[e(B,null,{default:o(()=>[e(d,{cols:"12",md:"6"},{default:o(()=>[e(A,{modelValue:u.value.amount_paid,"onUpdate:modelValue":i[1]||(i[1]=r=>u.value.amount_paid=r),modelModifiers:{number:!0},label:"Amount Paid (SAR)",type:"number",variant:"outlined",density:"compact",rules:[r=>!!r||"Amount is required"]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"6"},{default:o(()=>[e(A,{modelValue:u.value.payment_date,"onUpdate:modelValue":i[2]||(i[2]=r=>u.value.payment_date=r),label:"Payment Date",type:"date",variant:"outlined",density:"compact",rules:[r=>!!r||"Payment date is required"]},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12"},{default:o(()=>[e(E,{modelValue:u.value.payment_type,"onUpdate:modelValue":i[3]||(i[3]=r=>u.value.payment_type=r),items:s.paymentTypeOptions,"item-title":"title","item-value":"value",label:"Payment Type",variant:"outlined",density:"compact",rules:[r=>!!r||"Payment type is required"]},null,8,["modelValue","items","rules"])]),_:1}),e(d,{cols:"12"},{default:o(()=>[e(z,{label:"Attachment (Optional)",variant:"outlined",density:"compact",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:f}),i[6]||(i[6]=a("div",{class:"text-caption text-medium-emphasis mt-1"}," Supported formats: PDF, JPG, PNG, DOC, DOCX ",-1))]),_:1,__:[6]})]),_:1})]),_:1})]),_:1}),e(F,null,{default:o(()=>[e(O),e(h,{color:"secondary",variant:"tonal",onClick:i[4]||(i[4]=r=>_.value=!1)},{default:o(()=>i[7]||(i[7]=[V(" Cancel ")])),_:1,__:[7]}),e(h,{color:"primary",loading:p.value,onClick:R},{default:o(()=>i[8]||(i[8]=[V(" Mark as Completed ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),K={class:"mb-4"},Q={class:"font-weight-medium"},W={class:"mb-4"},Y={class:"font-weight-medium"},Z={class:"mb-4"},tt={class:"font-weight-medium text-primary"},et={class:"mb-4"},at={class:"font-weight-medium"},st={class:"text-center"},ot={class:"text-h6 font-weight-bold"},lt={class:"text-center"},it={class:"text-h6 font-weight-bold"},nt={class:"text-center"},dt={class:"text-h6 font-weight-bold"},rt={class:"mb-4"},mt={class:"mb-4"},ut={class:"font-weight-medium"},yt={class:"text-end"},pt={class:"text-end"},ct={class:"text-end"},ft={class:"bg-primary-lighten-5"},_t={class:"text-end font-weight-bold text-primary"},$t=T({__name:"ViewRoyaltyDetailsDialog",props:{isDialogVisible:{type:Boolean},viewedRoyalty:{}},emits:["update:isDialogVisible","markAsCompleted"],setup(l,{emit:n}){const s=l,v=n,p=L({get:()=>s.isDialogVisible,set:f=>v("update:isDialogVisible",f)}),u=f=>new Date(f).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),_=f=>{switch(f){case"paid":return"success";case"pending":return"warning";case"overdue":return"error";default:return"default"}},R=()=>{s.viewedRoyalty&&(v("markAsCompleted",s.viewedRoyalty),p.value=!1)};return(f,t)=>{const i=$;return C(),x(P,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=b=>p.value=b),"max-width":"600"},{default:o(()=>[e(i,{onClick:t[0]||(t[0]=b=>p.value=!1)}),s.viewedRoyalty?(C(),x(w,{key:0,title:"Royalty Details"},{default:o(()=>[e(U,null,{default:o(()=>[e(B,null,{default:o(()=>[e(d,{cols:"12"},{default:o(()=>t[3]||(t[3]=[a("h6",{class:"text-h6 mb-4 text-primary"}," Basic Information ",-1)])),_:1,__:[3]}),e(d,{cols:"12",md:"6"},{default:o(()=>[a("div",K,[t[4]||(t[4]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Billing Period ",-1)),a("div",Q,m(s.viewedRoyalty.billing_period),1)])]),_:1}),e(d,{cols:"12",md:"6"},{default:o(()=>[a("div",W,[t[5]||(t[5]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Due Date ",-1)),a("div",Y,m(u(s.viewedRoyalty.due_date)),1)])]),_:1}),e(d,{cols:"12",md:"6"},{default:o(()=>[a("div",Z,[t[6]||(t[6]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Franchisee Name ",-1)),a("div",tt,m(s.viewedRoyalty.franchisee_name),1)])]),_:1}),e(d,{cols:"12",md:"6"},{default:o(()=>[a("div",et,[t[7]||(t[7]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Store Location ",-1)),a("div",at,m(s.viewedRoyalty.store_location),1)])]),_:1}),e(d,{cols:"12"},{default:o(()=>[e(S,{class:"my-4"}),t[8]||(t[8]=a("h6",{class:"text-h6 mb-4 text-primary"}," Financial Details ",-1))]),_:1,__:[8]}),e(d,{cols:"12",md:"4"},{default:o(()=>[e(w,{variant:"tonal",color:"info",class:"pa-4"},{default:o(()=>[a("div",st,[e(g,{icon:"tabler-chart-line",size:"32",class:"mb-2"}),t[9]||(t[9]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Gross Sales ",-1)),a("div",ot,m((s.viewedRoyalty.gross_sales||0).toLocaleString())+" SAR ",1)])]),_:1})]),_:1}),e(d,{cols:"12",md:"4"},{default:o(()=>[e(w,{variant:"tonal",color:"primary",class:"pa-4"},{default:o(()=>[a("div",lt,[e(g,{icon:"tabler-percentage",size:"32",class:"mb-2"}),t[10]||(t[10]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Rate ",-1)),a("div",it,m(s.viewedRoyalty.royalty_percentage)+"% ",1)])]),_:1})]),_:1}),e(d,{cols:"12",md:"4"},{default:o(()=>[e(w,{variant:"tonal",color:"success",class:"pa-4"},{default:o(()=>[a("div",nt,[e(g,{icon:"tabler-coins",size:"32",class:"mb-2"}),t[11]||(t[11]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Amount ",-1)),a("div",dt,m((s.viewedRoyalty.amount||0).toLocaleString())+" SAR ",1)])]),_:1})]),_:1}),e(d,{cols:"12"},{default:o(()=>[e(S,{class:"my-4"}),t[12]||(t[12]=a("h6",{class:"text-h6 mb-4 text-primary"}," Status Information ",-1))]),_:1,__:[12]}),e(d,{cols:"12",md:"6"},{default:o(()=>[a("div",rt,[t[13]||(t[13]=a("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Payment Status ",-1)),e(G,{color:_(s.viewedRoyalty.status),size:"large",variant:"tonal",class:"text-capitalize"},{default:o(()=>[e(g,{icon:s.viewedRoyalty.status==="paid"?"tabler-check":s.viewedRoyalty.status==="pending"?"tabler-clock":"tabler-alert-triangle",class:"me-2"},null,8,["icon"]),V(" "+m(s.viewedRoyalty.status),1)]),_:1},8,["color"])])]),_:1}),e(d,{cols:"12",md:"6"},{default:o(()=>[a("div",mt,[t[14]||(t[14]=a("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Days Until Due ",-1)),a("div",ut,m(Math.ceil((new Date(s.viewedRoyalty.due_date).getTime()-new Date().getTime())/(1e3*60*60*24)))+" days ",1)])]),_:1}),e(d,{cols:"12"},{default:o(()=>[e(S,{class:"my-4"}),t[15]||(t[15]=a("h6",{class:"text-h6 mb-4 text-primary"}," Calculation Breakdown ",-1))]),_:1,__:[15]}),e(d,{cols:"12"},{default:o(()=>[e(q,{density:"compact"},{default:o(()=>[a("tbody",null,[a("tr",null,[t[16]||(t[16]=a("td",{class:"font-weight-medium"}," Gross Sales: ",-1)),a("td",yt,m((s.viewedRoyalty.gross_sales||0).toLocaleString())+" SAR ",1)]),a("tr",null,[t[17]||(t[17]=a("td",{class:"font-weight-medium"}," Royalty Rate: ",-1)),a("td",pt,m(s.viewedRoyalty.royalty_percentage)+"% ",1)]),a("tr",null,[t[18]||(t[18]=a("td",{class:"font-weight-medium"}," Calculation: ",-1)),a("td",ct,m((s.viewedRoyalty.gross_sales||0).toLocaleString())+" × "+m(s.viewedRoyalty.royalty_percentage)+"% ",1)]),a("tr",ft,[t[19]||(t[19]=a("td",{class:"font-weight-bold text-primary"}," Total Royalty Amount: ",-1)),a("td",_t,m((s.viewedRoyalty.amount||0).toLocaleString())+" SAR ",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(F,null,{default:o(()=>[e(O),e(h,{color:"secondary",variant:"tonal",onClick:t[1]||(t[1]=b=>p.value=!1)},{default:o(()=>t[20]||(t[20]=[V(" Close ")])),_:1,__:[20]}),s.viewedRoyalty.status!=="paid"?(C(),x(h,{key:0,color:"primary",onClick:R},{default:o(()=>[e(g,{icon:"tabler-check",class:"me-2"}),t[21]||(t[21]=V(" Mark as Completed "))]),_:1,__:[21]})):k("",!0)]),_:1})]),_:1})):k("",!0)]),_:1},8,["modelValue"])}}});export{Pt as _,$t as a,X as r};
