import{r as a,P as M,aN as r,aO as l}from"./main-DeJzYu26.js";const P=()=>{const d=a(!1),h=a(null),u=a(null),v=a([]),p=a([]),m=a([]),f=a(null),o=a(!0),k=M(()=>D.value?!0:o.value),w=async()=>{try{d.value=!0,h.value=null;const e=await l("/v1/franchisor/dashboard/stats");if(e.success)u.value=e.data;else throw new Error("Failed to fetch dashboard stats")}catch(e){h.value=e.message||"Failed to fetch dashboard statistics",console.error("Dashboard stats error:",e)}finally{d.value=!1}},y=async()=>{try{const e=await l("/v1/franchisor/sales-associates");e.success&&(v.value=e.data)}catch(e){console.error("Sales associates error:",e)}},g=async(e=10)=>{try{const t=await l(`/v1/franchisor/leads?limit=${e}`);t.success&&(m.value=t.data)}catch(t){console.error("Leads error:",t)}},b=async()=>{try{const e=await l("/v1/franchisor/profile/completion-status");e.success?(f.value=e.data,o.value=!0):(o.value=!1,f.value=null)}catch(e){e.status===404||e.data&&e.data.success===!1?(o.value=!1,f.value=null):(o.value=!0,console.error("Profile completion error:",e))}},D=a(!1),E=()=>{D.value=!0},$=()=>{var t;const e=[];m.value.slice(0,3).forEach(s=>{const i=`${s.firstName||""} ${s.lastName||""}`.trim()||"Unknown Lead",n=s.created_at||new Date().toISOString();e.push({id:s.id,type:"lead",title:`New lead: ${i}`,time:S(n),icon:"tabler-user-plus",color:"primary"})}),v.value.slice(0,2).forEach(s=>{if(s.status==="active"){const i=s.created_at||new Date().toISOString();e.push({id:s.id,type:"team",title:`${s.name} is managing ${s.leads_count} leads`,time:S(i),icon:"tabler-user-check",color:"info"})}}),(t=u.value)!=null&&t.currentMonthRevenue&&e.push({id:Date.now(),type:"revenue",title:`Monthly revenue: $${u.value.currentMonthRevenue.toLocaleString()}`,time:"This month",icon:"tabler-currency-riyal",color:"warning"}),p.value=e.filter(s=>s.time!=="Invalid Date").slice(0,5)},S=e=>{if(!e)return"Unknown";const t=new Date(e);if(isNaN(t.getTime()))return console.warn("Invalid date string:",e),"Unknown";const i=new Date().getTime()-t.getTime(),n=Math.floor(i/(1e3*60*60));if(n<1)return"Just now";if(n<24)return`${n} hours ago`;const c=Math.floor(n/24);return c===1?"1 day ago":c<7?`${c} days ago`:c<30?`${Math.floor(c/7)} weeks ago`:t.toLocaleDateString()},A=async()=>{await Promise.all([w(),y(),g(10),b()]),$()},I=async()=>{await A()},L=async()=>{try{return(await l("/v1/franchisor/profile/completion-status")).success===!0}catch(e){return e.status===404?!1:(console.error("Error checking franchise existence:",e),!0)}};return{isLoading:r(d),error:r(h),dashboardStats:r(u),salesAssociates:r(v),recentActivities:r(p),leads:r(m),profileCompletionStatus:r(f),isProfileComplete:r(k),franchiseExists:r(o),fetchDashboardStats:w,fetchSalesAssociates:y,fetchLeads:g,fetchProfileCompletion:b,dismissBanner:E,initializeDashboard:A,refreshDashboard:I,generateRecentActivities:$,checkFranchiseExists:L}};export{P as u};
