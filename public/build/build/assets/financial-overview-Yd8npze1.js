import{d as ke,r as d,P as n,G as _e,c as L,e as r,b as l,f as o,F as $,o as C,a3 as f,t as u,m as De,v as m,aa as ae,g as z,l as B,aM as Ee}from"./main-C3-SOPYs.js";import{f as P}from"./franchisee-dashboard-CvQqDQo9.js";import{V as T,a as p}from"./VRow-B0gP2GFy.js";import{V as le}from"./VDialog-BCAw06ZB.js";import{V as M}from"./VSelect-C8HOAYKp.js";import{V as w,b as oe,d as se}from"./VCard-CoFtOtzl.js";import{V as k}from"./VCardText-gJE2FZ-X.js";import{V as Q}from"./VAvatar-DaCLSk-0.js";import{S as Ae}from"./saudi-riyal-DtwTLcGW.js";import{a as Fe,V as Y,b as qe,c as j}from"./VTabs-B_qmBq2O.js";import{V as U}from"./VTextField-Dh9Jn9l4.js";import{q as H}from"./VDataTable-Bzs64nEH.js";import{V as Pe}from"./VChip-B1b-jhkP.js";import{V as Ue}from"./VForm-DwZfyU6l.js";import{V as Re}from"./VTextarea-d7kFTZRm.js";import{V as Te}from"./VFileInput-BtdLNTDr.js";/* empty css              */import"./VOverlay-BUy4HRci.js";import"./easing-Bybner-F.js";import"./lazy-Dg4IFEOh.js";import"./scopeId-DlDW9TaM.js";import"./VImg-DGmz0H4K.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition--yy6PSnQ.js";import"./form-Byy7mIuz.js";import"./VList-aiwrjFdO.js";import"./ssrBoot-BIjc9Qlg.js";import"./VDivider-UG-1iRGQ.js";import"./VMenu-C67K7Qaw.js";import"./VCheckboxBtn-D7mH8e-9.js";import"./VSelectionControl-BNnDiK64.js";import"./VWindowItem-BJYBdumP.js";import"./VSlideGroup-DuXa1Bxs.js";/* empty css                   */import"./VCounter-DSzXIg7-.js";import"./VField-C57WoLXE.js";import"./VInput-CuHkYGdD.js";import"./VPagination-C_9tn9Rm.js";import"./VTable-BJ9dGI66.js";import"./filter-C6D1KYvK.js";const Me={class:"d-flex justify-space-between align-center flex-wrap gap-4"},he={class:"d-flex gap-3 align-center flex-wrap"},Oe={class:"text-h6 font-weight-medium"},Ie={class:"text-h6 font-weight-medium"},Ne={class:"text-h6 font-weight-medium"},Le={class:"d-flex justify-space-between align-center mb-4"},$e={class:"d-flex gap-2"},ze={class:"font-weight-medium"},Be={class:"text-success font-weight-medium"},Qe={class:"text-error font-weight-medium"},Ye={class:"font-weight-medium"},je={class:"text-error"},He={class:"text-success font-weight-medium"},Mt=ke({__name:"financial-overview",setup(We){const c=d("sales"),v=d(""),i=d([]),g=d(!1),_=d(!1),y=d("sales"),h=d("sales"),x=d(!1),V=d(!1),D=d(""),E=d("monthly"),R=d(null),b=d([]),s=d({product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""}),O=async()=>{x.value=!0;try{const t=await P.getFinancialOverview();t.success&&(R.value=t.data)}catch(t){console.error("Error loading financial data:",t)}finally{x.value=!1}},W=async()=>{try{const t=await P.getUnitProducts();t.success&&(b.value=t.data)}catch(t){console.error("Error loading unit products:",t)}},A=n(()=>{var t;return((t=R.value)==null?void 0:t.sales)||[]}),F=n(()=>{var t;return((t=R.value)==null?void 0:t.expenses)||[]}),I=n(()=>{var t;return((t=R.value)==null?void 0:t.profit)||[]});_e(()=>{O(),W()});const re=n(()=>b.value.filter(t=>t.status==="active"&&t.stock>0).map(t=>({title:`${t.name} (${t.stock} in stock)`,value:t.name,stock:t.stock}))),S=n(()=>{if(!s.value.product)return 0;const t=b.value.find(e=>e.name===s.value.product);return(t==null?void 0:t.stock)||0}),G=n(()=>y.value!=="sales"?!0:s.value.quantitySold>0&&s.value.quantitySold<=S.value),J=n(()=>s.value.product?s.value.quantitySold===0?"Quantity must be greater than 0":s.value.quantitySold>S.value?`Cannot exceed available stock (${S.value} units)`:"":""),ie=["Food Supplies","Utilities","Staff Wages","Marketing","Equipment Maintenance","Rent","Insurance","Cleaning Supplies","Office Supplies","Transportation"],ne=[{title:"Sales",value:"sales"},{title:"Expense",value:"expense"}],ue=[{title:"Product",key:"product",sortable:!0},{title:"Date of Sale",key:"dateOfSale",sortable:!0},{title:"Unit Price (SAR)",key:"unitPrice",sortable:!0},{title:"Quantity Sold",key:"quantitySold",sortable:!0},{title:"Sale (SAR)",key:"sale",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],de=[{title:"Expense Category",key:"expenseCategory",sortable:!0},{title:"Date of Expense",key:"dateOfExpense",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Description",key:"description",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],me=[{title:"Date",key:"date",sortable:!0},{title:"Total Sales (SAR)",key:"totalSales",sortable:!0},{title:"Total Expenses (SAR)",key:"totalExpenses",sortable:!0},{title:"Profit (SAR)",key:"profit",sortable:!0}],pe=n(()=>v.value?A.value.filter(t=>t.product.toLowerCase().includes(v.value.toLowerCase())||t.dateOfSale.includes(v.value)):A.value),ve=n(()=>v.value?F.value.filter(t=>t.expenseCategory.toLowerCase().includes(v.value.toLowerCase())||t.description.toLowerCase().includes(v.value.toLowerCase())||t.dateOfExpense.includes(v.value)):F.value),fe=n(()=>{let t=K.value;return v.value&&(t=t.filter(e=>e.date.includes(v.value))),t}),ce=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],N=t=>{const e=new Date(t),a=new Date;return E.value==="daily"?e.toDateString()===a.toDateString():E.value==="monthly"?e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear():E.value==="yearly"?e.getFullYear()===a.getFullYear():!0},ye=n(()=>A.value.filter(t=>N(t.dateOfSale))),xe=n(()=>F.value.filter(t=>N(t.dateOfExpense))),K=n(()=>I.value.filter(t=>N(t.date))),ge=n(()=>ye.value.reduce((t,e)=>t+e.sale,0)),Ve=n(()=>xe.value.reduce((t,e)=>t+e.amount,0)),be=n(()=>K.value.reduce((t,e)=>t+e.profit,0)),Se=t=>{y.value=t,V.value=!1,D.value="",Z(),g.value=!0},X=(t,e)=>{y.value=e,V.value=!0,D.value=t.id,e==="sales"?s.value={product:t.product,date:t.dateOfSale,quantitySold:t.quantitySold,expenseCategory:"",amount:0,description:""}:s.value={product:"",date:t.dateOfExpense,quantitySold:0,expenseCategory:t.expenseCategory,amount:t.amount,description:t.description||""},g.value=!0},Z=()=>{s.value={product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""},V.value=!1,D.value=""},ee=async()=>{var t,e;if(!(y.value==="sales"&&!G.value)){x.value=!0;try{const a={category:y.value,date:s.value.date};y.value==="sales"?(a.product=s.value.product,a.quantitySold=s.value.quantitySold):(a.expenseCategory=s.value.expenseCategory,a.amount=s.value.amount,a.description=s.value.description);let q;V.value?q=await P.updateFinancialData(D.value,a):q=await P.addFinancialData(a),q.success&&(await O(),await W(),g.value=!1,Z(),V.value=!1,D.value="")}catch(a){console.error("Error saving data:",a),(e=(t=a.response)==null?void 0:t.data)!=null&&e.message&&alert(a.response.data.message)}finally{x.value=!1}}},te=()=>{let t=[],e="";c.value==="sales"?(t=i.value.length>0?A.value.filter(a=>i.value.includes(a.id)):A.value,e="sales_data.csv"):c.value==="expense"?(t=i.value.length>0?F.value.filter(a=>i.value.includes(a.id)):F.value,e="expense_data.csv"):c.value==="profit"&&(t=i.value.length>0?I.value.filter(a=>i.value.includes(a.id)):I.value,e="profit_data.csv"),console.log("Exporting data:",t,"as",e)},Ce=async()=>{if(i.value.length!==0){x.value=!0;try{(await P.deleteFinancialData({category:c.value,ids:i.value})).success&&(await O(),i.value=[])}catch(t){console.error("Error deleting data:",t)}finally{x.value=!1}}},we=()=>{console.log("Importing data for category:",h.value),_.value=!1};return(t,e)=>(C(),L($,null,[r("section",null,[l(T,{class:"mb-6"},{default:o(()=>[l(p,{cols:"12"},{default:o(()=>[r("div",Me,[e[23]||(e[23]=r("div",null,[r("h4",{class:"text-h4 mb-1"}," Financial Overview "),r("p",{class:"text-body-1 text-medium-emphasis"}," Track your franchise financial performance and metrics ")],-1)),r("div",he,[l(f,{color:"primary",variant:"outlined","prepend-icon":"tabler-upload",onClick:e[0]||(e[0]=a=>_.value=!0)},{default:o(()=>e[21]||(e[21]=[u(" Import ")])),_:1,__:[21]}),l(f,{color:"primary","prepend-icon":"tabler-plus",onClick:e[1]||(e[1]=a=>Se(c.value))},{default:o(()=>e[22]||(e[22]=[u(" Add Data ")])),_:1,__:[22]}),l(M,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=a=>E.value=a),items:ce,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(T,{class:"mb-6"},{default:o(()=>[l(p,{cols:"12",md:"4"},{default:o(()=>[l(w,null,{default:o(()=>[l(k,{class:"d-flex align-center"},{default:o(()=>[l(Q,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-4"},{default:o(()=>[l(De(Ae))]),_:1}),r("div",null,[e[24]||(e[24]=r("span",{class:"text-sm text-medium-emphasis"},"Total Sales",-1)),r("div",Oe,m(ge.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"4"},{default:o(()=>[l(w,null,{default:o(()=>[l(k,{class:"d-flex align-center"},{default:o(()=>[l(Q,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-4"},{default:o(()=>[l(ae,{size:"24",icon:"tabler-trending-down"})]),_:1}),r("div",null,[e[25]||(e[25]=r("span",{class:"text-sm text-medium-emphasis"},"Total Expenses",-1)),r("div",Ie,m(Ve.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"4"},{default:o(()=>[l(w,null,{default:o(()=>[l(k,{class:"d-flex align-center"},{default:o(()=>[l(Q,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-4"},{default:o(()=>[l(ae,{size:"24",icon:"tabler-trending-up"})]),_:1}),r("div",null,[e[26]||(e[26]=r("span",{class:"text-sm text-medium-emphasis"},"Total Profit",-1)),r("div",Ne,m(be.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(T,null,{default:o(()=>[l(p,{cols:"12"},{default:o(()=>[l(w,null,{default:o(()=>[l(k,null,{default:o(()=>[l(Fe,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),color:"primary",class:"mb-4"},{default:o(()=>[l(Y,{value:"sales"},{default:o(()=>e[27]||(e[27]=[u(" Sales ")])),_:1,__:[27]}),l(Y,{value:"expense"},{default:o(()=>e[28]||(e[28]=[u(" Expense ")])),_:1,__:[28]}),l(Y,{value:"profit"},{default:o(()=>e[29]||(e[29]=[u(" Profit ")])),_:1,__:[29]})]),_:1},8,["modelValue"]),r("div",Le,[l(U,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),placeholder:"Search...","prepend-inner-icon":"tabler-search",variant:"outlined",density:"compact",style:{"max-width":"300px"},clearable:""},null,8,["modelValue"]),r("div",$e,[i.value.length>0?(C(),z(f,{key:0,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:te},{default:o(()=>[u(" Export Selected ("+m(i.value.length)+") ",1)]),_:1})):B("",!0),i.value.length>0?(C(),z(f,{key:1,color:"error",variant:"outlined","prepend-icon":"tabler-trash",onClick:Ce},{default:o(()=>[u(" Delete Selected ("+m(i.value.length)+") ",1)]),_:1})):B("",!0),i.value.length===0?(C(),z(f,{key:2,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:te},{default:o(()=>e[30]||(e[30]=[u(" Export All ")])),_:1,__:[30]})):B("",!0)])]),l(qe,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value=a)},{default:o(()=>[l(j,{value:"sales"},{default:o(()=>[l(H,{modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value=a),headers:ue,items:pe.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.unitPrice":o(({item:a})=>[r("span",ze,m(Number(a.unitPrice).toFixed(2))+" SAR ",1)]),"item.sale":o(({item:a})=>[r("span",Be,m(Number(a.sale).toFixed(2))+" SAR ",1)]),"item.actions":o(({item:a})=>[l(f,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:q=>X(a,"sales")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),l(j,{value:"expense"},{default:o(()=>[l(H,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value=a),headers:de,items:ve.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.amount":o(({item:a})=>[r("span",Qe,m(Number(a.amount).toFixed(2))+" SAR ",1)]),"item.expenseCategory":o(({item:a})=>[l(Pe,{size:"small",variant:"tonal",color:"primary"},{default:o(()=>[u(m(a.expenseCategory),1)]),_:2},1024)]),"item.actions":o(({item:a})=>[l(f,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:q=>X(a,"expense")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),l(j,{value:"profit"},{default:o(()=>[l(H,{modelValue:i.value,"onUpdate:modelValue":e[7]||(e[7]=a=>i.value=a),headers:me,items:fe.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.totalSales":o(({item:a})=>[r("span",Ye,m(Number(a.totalSales).toFixed(2))+" SAR ",1)]),"item.totalExpenses":o(({item:a})=>[r("span",je,m(Number(a.totalExpenses).toFixed(2))+" SAR ",1)]),"item.profit":o(({item:a})=>[r("span",He,m(Number(a.profit).toFixed(2))+" SAR ",1)]),_:1},8,["modelValue","items"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),l(le,{modelValue:g.value,"onUpdate:modelValue":e[17]||(e[17]=a=>g.value=a),"max-width":"500"},{default:o(()=>[l(w,null,{default:o(()=>[l(oe,{class:"text-h6 font-weight-medium"},{default:o(()=>[u(m(V.value?"Edit":"Add")+" "+m(y.value==="sales"?"Sales":"Expense")+" Data ",1)]),_:1}),l(k,null,{default:o(()=>[l(Ue,{onSubmit:Ee(ee,["prevent"])},{default:o(()=>[l(T,null,{default:o(()=>[y.value==="sales"?(C(),L($,{key:0},[l(p,{cols:"12"},{default:o(()=>[l(M,{modelValue:s.value.product,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.product=a),items:re.value,label:"Product",variant:"outlined","item-title":"title","item-value":"value",loading:b.value.length===0,disabled:b.value.length===0,hint:b.value.length===0?"No products available in stock":"","persistent-hint":"",required:""},null,8,["modelValue","items","loading","disabled","hint"])]),_:1}),l(p,{cols:"12"},{default:o(()=>[l(U,{modelValue:s.value.date,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.date=a),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:o(()=>[l(U,{modelValue:s.value.quantitySold,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.quantitySold=a),modelModifiers:{number:!0},label:"Quantity Sold",type:"number",variant:"outlined",required:"",min:1,max:S.value,error:!!J.value,"error-messages":J.value,hint:S.value>0?`Available stock: ${S.value} units`:"","persistent-hint":"",disabled:!s.value.product},null,8,["modelValue","max","error","error-messages","hint","disabled"])]),_:1})],64)):(C(),L($,{key:1},[l(p,{cols:"12"},{default:o(()=>[l(M,{modelValue:s.value.expenseCategory,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.expenseCategory=a),items:ie,label:"Expense Category",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:o(()=>[l(U,{modelValue:s.value.date,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.date=a),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:o(()=>[l(U,{modelValue:s.value.amount,"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.amount=a),modelModifiers:{number:!0},label:"Amount (SAR)",type:"number",step:"0.01",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12"},{default:o(()=>[l(Re,{modelValue:s.value.description,"onUpdate:modelValue":e[15]||(e[15]=a=>s.value.description=a),label:"Note/Description",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})],64))]),_:1})]),_:1})]),_:1}),l(se,{class:"d-flex justify-end gap-2 pa-4"},{default:o(()=>[l(f,{variant:"outlined",onClick:e[16]||(e[16]=a=>g.value=!1)},{default:o(()=>e[31]||(e[31]=[u(" Cancel ")])),_:1,__:[31]}),l(f,{color:"primary",onClick:ee,disabled:y.value==="sales"&&!G.value,loading:x.value},{default:o(()=>e[32]||(e[32]=[u(" Save ")])),_:1,__:[32]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(le,{modelValue:_.value,"onUpdate:modelValue":e[20]||(e[20]=a=>_.value=a),"max-width":"400"},{default:o(()=>[l(w,null,{default:o(()=>[l(oe,{class:"text-h6 font-weight-medium"},{default:o(()=>e[33]||(e[33]=[u(" Import Data ")])),_:1,__:[33]}),l(k,null,{default:o(()=>[l(M,{modelValue:h.value,"onUpdate:modelValue":e[18]||(e[18]=a=>h.value=a),items:ne,label:"Select Category",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),l(Te,{label:"Choose CSV file",variant:"outlined",accept:".csv","prepend-icon":"tabler-file-upload"})]),_:1}),l(se,{class:"d-flex justify-end gap-2 pa-4"},{default:o(()=>[l(f,{variant:"outlined",onClick:e[19]||(e[19]=a=>_.value=!1)},{default:o(()=>e[34]||(e[34]=[u(" Cancel ")])),_:1,__:[34]}),l(f,{color:"primary",onClick:we},{default:o(()=>e[35]||(e[35]=[u(" Import ")])),_:1,__:[35]})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{Mt as default};
