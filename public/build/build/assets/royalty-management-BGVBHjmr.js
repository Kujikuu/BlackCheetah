import{V as tt,_ as et}from"./VDialog-6C-NQXCx.js";import{_ as at,a as lt,r as k}from"./ViewRoyaltyDetailsDialog.vue_vue_type_script_setup_true_lang-DcVXU_5y.js";import{V as f,a as p}from"./VRow-DiX7eN30.js";import{V as U}from"./VSelect-C9dxRhag.js";import{d as ot,r as i,P as z,G as st,c as it,b as e,f as a,o as L,e as o,a9 as y,t as n,ax as _,v as r,m as nt,g as rt,l as ut}from"./main-gemCwVks.js";import{V as g,a as dt,b as mt,c as ct}from"./VCard-DJ82mpnW.js";import{V as b}from"./VCardText-BD5AHO-w.js";import{V as M}from"./VAvatar-12xz6mHy.js";import{S as pt}from"./saudi-riyal-DZyktURw.js";import{V as yt}from"./VDivider-B4ry9pxl.js";import{V as vt}from"./VDataTable-C-SlKz4P.js";import{V as P}from"./VTooltip-CVtgTmoh.js";import{V as $}from"./VChip-DlNApjyg.js";import{V as ft}from"./VAlert-RufLsxZw.js";import"./VOverlay-p8m6-W96.js";import"./forwardRefs--KQCZfKO.js";import"./scopeId-BgtgI3QF.js";import"./VImg-DSB6m92Q.js";import"./dialog-transition-C9rYmnXC.js";import"./VForm-FUZpY-zG.js";import"./form-DjHlhIbZ.js";import"./VTextField-BhxF6EAD.js";import"./VField-CsHfcJSz.js";import"./VInput-B3GinL-f.js";import"./VFileInput-CB0ItP4X.js";import"./VSpacer-Cpeayo2U.js";/* empty css              */import"./VTable-0Z68chLt.js";import"./VList-MyW-iB3v.js";import"./VMenu-CeaiRCNz.js";import"./VCheckboxBtn-ZAK0D-Rf.js";import"./VSelectionControl-COVpGwiX.js";import"./VSlideGroup-CEWgOBQJ.js";const _t={class:"d-flex justify-space-between align-center flex-wrap gap-4"},gt={class:"d-flex gap-3 align-center flex-wrap"},bt={class:"d-flex align-center justify-space-between"},xt={class:"text-h4 text-success"},Vt={class:"d-flex align-center justify-space-between"},Ct={class:"text-h4 text-warning"},wt={class:"font-weight-medium"},kt={class:"text-body-2"},St={class:"font-weight-medium text-info"},Dt={class:"font-weight-medium text-success"},Rt={class:"d-flex gap-2"},Tt={class:"text-body-2"},ue=ot({__name:"royalty-management",setup(At){const S=i(!1),D=i(!1),u=i("monthly"),m=i(!1),v=i(!1),x=i(!1),V=i(null),R=i(null),c=i("csv"),T=i("all"),B=i({amount_paid:0,payment_date:"",payment_type:"",attachment:null}),A=i([]),C=i({royalty_collected_till_date:0,upcoming_royalties:0,total_royalties:0,pending_amount:0,paid_amount:0,overdue_amount:0,overdue_count:0}),j=z(()=>C.value.royalty_collected_till_date),F=z(()=>C.value.upcoming_royalties),I=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],N=[{title:"CSV",value:"csv"},{title:"Excel",value:"excel"}],G=[{title:"All Royalties",value:"all"},{title:"Paid Only",value:"paid"},{title:"Pending Only",value:"pending"},{title:"Overdue Only",value:"overdue"}],H=[{title:"Bank Transfer",value:"bank_transfer"},{title:"Credit Card",value:"credit_card"},{title:"Mada",value:"mada"},{title:"STC Pay",value:"stc_pay"},{title:"SADAD",value:"sadad"},{title:"Check",value:"check"},{title:"Cash",value:"cash"},{title:"Online Payment",value:"online_payment"}],Y=[{title:"Billing Period",key:"billing_period",sortable:!0},{title:"Due Date",key:"due_date",sortable:!0},{title:"Gross Sales (SAR)",key:"gross_sales",sortable:!0},{title:"Royalty %",key:"royalty_percentage",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],h=async()=>{try{S.value=!0;const s=await k.getRoyalties({period:u.value});A.value=s.data.data}catch(s){console.error("Error fetching royalties:",s)}finally{S.value=!1}},E=async()=>{try{D.value=!0;const s=await k.getStatistics({period:u.value});C.value=s.data}catch(s){console.error("Error fetching statistics:",s)}finally{D.value=!1}},q=()=>{m.value=!0},J=async()=>{try{const s=await k.exportRoyalties({format:c.value,data_type:T.value,period:u.value}),t=window.URL.createObjectURL(s),d=document.createElement("a");d.href=t,d.download=`royalty-data-${u.value}-${new Date().toISOString().split("T")[0]}.${c.value==="csv"?"csv":"xlsx"}`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(t),m.value=!1}catch(s){console.error("Error exporting royalties:",s)}},K=s=>{R.value=s,x.value=!0},O=s=>{V.value=s,B.value={amount_paid:s.amount,payment_date:new Date().toISOString().split("T")[0],payment_type:"",attachment:null},v.value=!0},Q=async()=>{await h(),await E(),v.value=!1,V.value=null},W=s=>{O(s)},X=s=>{switch(s){case"paid":return"success";case"pending":return"warning";case"overdue":return"error";default:return"default"}},Z=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return st(()=>{h(),E()}),(s,t)=>{const d=et;return L(),it("section",null,[e(f,{class:"mb-6"},{default:a(()=>[e(p,{cols:"12"},{default:a(()=>[o("div",_t,[t[8]||(t[8]=o("div",null,[o("h4",{class:"text-h4 mb-1"}," Royalty Management "),o("p",{class:"text-body-1 text-medium-emphasis"}," Track and manage royalty payments from all franchise units ")],-1)),o("div",gt,[e(U,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=l=>u.value=l),items:I,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"]),e(y,{color:"primary",variant:"elevated",onClick:q},{default:a(()=>[e(_,{icon:"tabler-download",class:"me-2"}),t[7]||(t[7]=n(" Export "))]),_:1,__:[7]})])])]),_:1})]),_:1}),e(f,{class:"mb-6"},{default:a(()=>[e(p,{cols:"12",md:"6"},{default:a(()=>[e(g,null,{default:a(()=>[e(b,null,{default:a(()=>[o("div",bt,[o("div",null,[t[9]||(t[9]=o("h6",{class:"text-h6 mb-1"}," Royalty Collected Till Date ",-1)),t[10]||(t[10]=o("div",{class:"text-body-2 text-medium-emphasis mb-3"}," Total payments received ",-1)),o("h4",xt,r((j.value||0).toLocaleString())+" SAR ",1)]),e(M,{color:"success",variant:"tonal",size:"56"},{default:a(()=>[e(nt(pt),{size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1}),e(p,{cols:"12",md:"6"},{default:a(()=>[e(g,null,{default:a(()=>[e(b,null,{default:a(()=>[o("div",Vt,[o("div",null,[t[11]||(t[11]=o("h6",{class:"text-h6 mb-1"}," Upcoming Royalties ",-1)),t[12]||(t[12]=o("div",{class:"text-body-2 text-medium-emphasis mb-3"}," Pending payments due ",-1)),o("h4",Ct,r((F.value||0).toLocaleString())+" SAR ",1)]),e(M,{color:"warning",variant:"tonal",size:"56"},{default:a(()=>[e(_,{icon:"tabler-clock",size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(p,{cols:"12"},{default:a(()=>[e(g,null,{default:a(()=>[e(dt,{class:"pb-4"},{default:a(()=>[e(mt,{class:"text-h6"},{default:a(()=>t[13]||(t[13]=[n(" Royalty Records ")])),_:1,__:[13]}),e(ct,{class:"text-body-2"},{default:a(()=>t[14]||(t[14]=[n(" Manage royalty payments and track collection status ")])),_:1,__:[14]})]),_:1}),e(yt),e(vt,{headers:Y,items:A.value,"items-per-page":10,class:"text-no-wrap"},{"item.billing_period":a(({item:l})=>[o("div",wt,r(l.billing_period),1)]),"item.due_date":a(({item:l})=>[o("div",kt,r(Z(l.due_date)),1)]),"item.gross_sales":a(({item:l})=>[o("div",St,r((l.gross_sales||0).toLocaleString()),1)]),"item.royalty_percentage":a(({item:l})=>[e($,{size:"small",variant:"tonal",color:"primary"},{default:a(()=>[n(r(l.royalty_percentage)+"% ",1)]),_:2},1024)]),"item.amount":a(({item:l})=>[o("div",Dt,r((l.amount||0).toLocaleString()),1)]),"item.status":a(({item:l})=>[e($,{color:X(l.status),size:"small",variant:"tonal",class:"text-capitalize"},{default:a(()=>[n(r(l.status),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[o("div",Rt,[e(y,{icon:"",size:"small",color:"info",variant:"text",onClick:w=>K(l)},{default:a(()=>[e(_,{icon:"tabler-eye",size:"20"}),e(P,{activator:"parent",location:"top"},{default:a(()=>t[15]||(t[15]=[n(" View Details ")])),_:1,__:[15]})]),_:2},1032,["onClick"]),l.status!=="paid"?(L(),rt(y,{key:0,icon:"",size:"small",color:"success",variant:"text",onClick:w=>O(l)},{default:a(()=>[e(_,{icon:"tabler-check",size:"20"}),e(P,{activator:"parent",location:"top"},{default:a(()=>t[16]||(t[16]=[n(" Mark as Completed ")])),_:1,__:[16]})]),_:2},1032,["onClick"])):ut("",!0)])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),e(tt,{modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=l=>m.value=l),"max-width":"600"},{default:a(()=>[e(d,{onClick:t[1]||(t[1]=l=>m.value=!1)}),e(g,{title:"Export Royalty Data"},{default:a(()=>[e(b,null,{default:a(()=>[e(f,null,{default:a(()=>[e(p,{cols:"12"},{default:a(()=>[e(U,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=l=>c.value=l),items:N,"item-title":"title","item-value":"value",label:"Export Format",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(ft,{type:"info",variant:"tonal",class:"mt-4"},{default:a(()=>{var l;return[o("div",Tt,[t[17]||(t[17]=o("strong",null,"Current Selection:",-1)),t[18]||(t[18]=o("br",null,null,-1)),n(" Period: "+r(u.value.charAt(0).toUpperCase()+u.value.slice(1)),1),t[19]||(t[19]=o("br",null,null,-1)),n(" Data Type: "+r((l=G.find(w=>w.value===T.value))==null?void 0:l.title),1),t[20]||(t[20]=o("br",null,null,-1)),n(" Format: "+r(c.value.toUpperCase()),1)])]}),_:1})]),_:1}),e(b,{class:"d-flex align-center justify-center gap-4"},{default:a(()=>[e(y,{color:"error",variant:"outlined",onClick:t[3]||(t[3]=l=>m.value=!1)},{default:a(()=>t[21]||(t[21]=[n(" Cancel ")])),_:1,__:[21]}),e(y,{color:"primary",variant:"elevated",onClick:J},{default:a(()=>t[22]||(t[22]=[n(" Export Data ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(at,{"is-dialog-visible":v.value,"onUpdate:isDialogVisible":t[5]||(t[5]=l=>v.value=l),"selected-royalty":V.value,"payment-type-options":H,onPaymentSubmitted:Q},null,8,["is-dialog-visible","selected-royalty"]),e(lt,{"is-dialog-visible":x.value,"onUpdate:isDialogVisible":t[6]||(t[6]=l=>x.value=l),"viewed-royalty":R.value,onMarkAsCompleted:W},null,8,["is-dialog-visible","viewed-royalty"])])}}});export{ue as default};
