import{V as ce,_ as pe}from"./VDataTableServer-BtX-meTD.js";import{_ as fe}from"./AppTextField.vue_vue_type_script_setup_true_lang-C1QkJzRA.js";import{_ as ve}from"./AppSelect.vue_vue_type_script_setup_true_lang-Dmp4G9dU.js";import{d as _e,r as p,w as ge,P as J,G as be,c as K,e as s,b as t,f as l,au as g,m as o,a as Ve,o as w,F as xe,i as ye,g as U,v as r,x as Ce,aa as $,t as m,l as N,a3 as b,aM as Le}from"./main-CmF9Tu9X.js";import{u as we}from"./useApi-DjcwJnBv.js";import{V as A,a as f}from"./VRow-CHcR5qvn.js";import{V as S,a as E,b as T,d as M}from"./VCard-BaQ80E-1.js";import{V as F}from"./VDialog-d18aDjvw.js";import{V as h}from"./VCardText-C80XsO14.js";import{V as X}from"./VAvatar-BtKH23RP.js";import{V as Y}from"./VDivider-Bg3_3YcA.js";import{V as P}from"./VSpacer-BvvuRniz.js";import{V as he}from"./VMenu-B8DK95Ht.js";import{V as ke,a as Se,b as De}from"./VList-CAsLa3ZS.js";import{V as Z}from"./VChip-C8np5did.js";import{V as Ue}from"./VForm-DZliotcg.js";import"./VPagination-rT13uSSZ.js";import"./VDataTable-B4xDoe1z.js";import"./VSelect-DtFFpYD6.js";import"./VTextField-aisKyR0y.js";/* empty css                   */import"./VCounter-BFtCiXsp.js";import"./VImg-DCfN5bGZ.js";import"./VField-CBysmnBE.js";import"./form-0sOYWFNG.js";import"./easing-Bybner-F.js";import"./VInput-D3l3p6I4.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-Dt_2P4kD.js";import"./VOverlay-26Lm7od8.js";import"./lazy-X6OUuNhY.js";import"./scopeId-nZWRusZv.js";import"./VCheckboxBtn-oyTmTyVr.js";import"./VSelectionControl-D8diO4uz.js";import"./VTable-BuP0AM6H.js";import"./filter-ChgAgoSm.js";/* empty css              */import"./ssrBoot-XEleUk5n.js";import"./VSlideGroup-rtSzF4dh.js";const $e={class:"d-flex mb-6"},Ae={class:"d-flex justify-space-between"},Ee={class:"d-flex flex-column gap-y-1"},Te={class:"text-body-1 text-high-emphasis"},Pe={class:"d-flex gap-x-2 align-center"},ze={class:"text-h4"},Be={class:"text-sm"},Ie={class:"me-3 d-flex gap-3"},Re={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Ne={style:{"inline-size":"15.625rem"}},Me={class:"d-flex align-center gap-x-4"},Fe={class:"d-flex flex-column"},je={class:"text-base font-weight-medium"},We={class:"text-body-1"},Oe={class:"text-body-1"},Ge={class:"text-body-1 text-capitalize"},Qe={class:"text-body-1"},qe={class:"mb-4"},He={class:"text-body-1 font-weight-medium"},Je={class:"mb-4"},Ke={class:"text-body-1"},Xe={class:"mb-4"},Ye={class:"text-body-1"},Ze={class:"mb-4"},et={class:"text-body-1 text-capitalize"},tt={class:"mb-4"},lt={class:"mb-4"},at={class:"text-body-1"},Gt=_e({__name:"leads",setup(ot){const{data:ee,execute:te,isFetching:st}=we("/v1/franchisor/dashboard/leads"),z=p(""),B=p(),I=p(),x=p(10),y=p(1),le=p(),ae=p(),_=p([]),oe=d=>{var e,u;le.value=(e=d.sortBy[0])==null?void 0:e.key,ae.value=(u=d.sortBy[0])==null?void 0:u.order},se=[{title:"Lead Name",key:"name"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Source",key:"source"},{title:"Status",key:"status"},{title:"Created Date",key:"createdDate"},{title:"Actions",key:"actions",sortable:!1}],V=p({leads:[],totalLeads:0}),j=p([{title:"Total Leads",value:"0",change:0,desc:"All time leads",icon:"tabler-users",iconColor:"primary"},{title:"Closed and Won",value:"0",change:0,desc:"Converted leads",icon:"tabler-trophy",iconColor:"success"},{title:"Closed and Lost",value:"0",change:0,desc:"Lost opportunities",icon:"tabler-x",iconColor:"error"},{title:"Pending Leads",value:"0",change:0,desc:"Active leads",icon:"tabler-clock",iconColor:"warning"}]);ge(ee,d=>{var u;const e=d;if(e!=null&&e.success&&(e!=null&&e.data)){const c=e.data;V.value={leads:Array.isArray(c.leads)?c.leads.map(i=>({id:i.id,name:`${i.first_name||""} ${i.last_name||""}`.trim(),email:i.email,phone:i.phone,source:i.lead_source,status:i.status,createdDate:new Date(i.created_at).toLocaleDateString()})):[],totalLeads:((u=c.pagination)==null?void 0:u.total)||(Array.isArray(c.leads)?c.leads.length:0)};const v=c.stats||{total_leads:0,total_leads_change:0,won_leads:0,won_leads_change:0,lost_leads:0,lost_leads_change:0,pending_leads:0,pending_leads_change:0};j.value=[{title:"Total Leads",value:v.total_leads.toLocaleString(),change:v.total_leads_change,desc:"All time leads",icon:"tabler-users",iconColor:"primary"},{title:"Closed and Won",value:v.won_leads.toLocaleString(),change:v.won_leads_change,desc:"Converted leads",icon:"tabler-trophy",iconColor:"success"},{title:"Closed and Lost",value:v.lost_leads.toLocaleString(),change:v.lost_leads_change,desc:"Lost opportunities",icon:"tabler-x",iconColor:"error"},{title:"Pending Leads",value:v.pending_leads.toLocaleString(),change:v.pending_leads_change,desc:"Active leads",icon:"tabler-clock",iconColor:"warning"}]}},{immediate:!0});const R=J(()=>V.value.leads),W=J(()=>V.value.totalLeads);be(()=>{te()});const O=[{title:"Website",value:"website"},{title:"Referral",value:"referral"},{title:"Social Media",value:"social_media"},{title:"Email Campaign",value:"email"}],G=[{title:"Pending",value:"pending"},{title:"Won",value:"won"},{title:"Lost",value:"lost"}],Q=d=>{const e=d.toLowerCase();return e==="pending"?"warning":e==="won"?"success":e==="lost"?"error":"primary"},D=p(!1),C=p(!1),L=p(!1),n=p(null),k=p(null),ne=d=>{n.value={...d},C.value=!0},de=d=>{k.value=d,L.value=!0},ie=async()=>{if(k.value===null)return;const d=V.value.leads.findIndex(u=>u.id===k.value);d!==-1&&V.value.leads.splice(d,1);const e=_.value.findIndex(u=>u===k.value);e!==-1&&_.value.splice(e,1),L.value=!1,k.value=null},q=async()=>{if(!n.value)return;const d=V.value.leads.findIndex(e=>e.id===n.value.id);d!==-1&&(V.value.leads[d]={...n.value}),C.value=!1,n.value=null},re=()=>{const e=["Name,Email,Phone,Source,Status,Created Date",...(_.value.length>0?R.value.filter(i=>_.value.includes(i.id)):R.value).map(i=>`"${i.name}","${i.email}","${i.phone}","${i.source}","${i.status}","${i.createdDate}"`)].join(`
`),u=new Blob([e],{type:"text/csv"}),c=window.URL.createObjectURL(u),v=document.createElement("a");v.href=c,v.download=`leads_${_.value.length>0?"selected":"all"}_${new Date().toISOString().split("T")[0]}.csv`,v.click(),window.URL.revokeObjectURL(c)},ue=d=>d>0?`+${d}`:`${d}`,me=d=>d.split(" ").map(e=>e[0]).join("").toUpperCase();return(d,e)=>{const u=ve,c=fe,v=Ve("RouterLink"),i=pe;return w(),K("section",null,[s("div",$e,[t(A,null,{default:l(()=>[(w(!0),K(xe,null,ye(o(j),(a,H)=>(w(),U(f,{key:H,cols:"12",md:"3",sm:"6"},{default:l(()=>[t(S,null,{default:l(()=>[t(h,null,{default:l(()=>[s("div",Ae,[s("div",Ee,[s("div",Te,r(a.title),1),s("div",Pe,[s("h4",ze,r(a.value),1),s("div",{class:Ce(["text-base",a.change>0?"text-success":"text-error"])}," ("+r(ue(a.change))+"%) ",3)]),s("div",Be,r(a.desc),1)]),t(X,{color:a.iconColor,variant:"tonal",rounded:"",size:"42"},{default:l(()=>[t($,{icon:a.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),t(S,{class:"mb-6"},{default:l(()=>[t(E,{class:"pb-4"},{default:l(()=>[t(T,null,{default:l(()=>e[21]||(e[21]=[m("Filters")])),_:1,__:[21]})]),_:1}),t(h,null,{default:l(()=>[t(A,null,{default:l(()=>[t(f,{cols:"12",sm:"6"},{default:l(()=>[t(u,{modelValue:o(I),"onUpdate:modelValue":e[0]||(e[0]=a=>g(I)?I.value=a:null),placeholder:"Select Source",items:O,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",sm:"6"},{default:l(()=>[t(u,{modelValue:o(B),"onUpdate:modelValue":e[1]||(e[1]=a=>g(B)?B.value=a:null),placeholder:"Select Status",items:G,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(Y),t(h,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[s("div",Ie,[t(u,{"model-value":o(x),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[2]||(e[2]=a=>x.value=parseInt(String(a),10))},null,8,["model-value"]),o(_).length>0?(w(),U(b,{key:0,variant:"tonal",color:"error",onClick:d.bulkDelete},{default:l(()=>[t($,{icon:"tabler-trash",class:"me-2"}),m(" Delete Selected ("+r(o(_).length)+") ",1)]),_:1},8,["onClick"])):N("",!0)]),t(P),s("div",Re,[s("div",Ne,[t(c,{modelValue:o(z),"onUpdate:modelValue":e[3]||(e[3]=a=>g(z)?z.value=a:null),placeholder:"Search Lead"},null,8,["modelValue"])]),t(b,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload",onClick:re},{default:l(()=>[m(" Export "+r(o(_).length>0?`(${o(_).length})`:"All"),1)]),_:1})])]),_:1}),t(Y),t(ce,{"items-per-page":o(x),"onUpdate:itemsPerPage":e[5]||(e[5]=a=>g(x)?x.value=a:null),"model-value":o(_),"onUpdate:modelValue":e[6]||(e[6]=a=>g(_)?_.value=a:null),page:o(y),"onUpdate:page":e[7]||(e[7]=a=>g(y)?y.value=a:null),items:o(R),"item-value":"id","items-length":o(W),headers:se,class:"text-no-wrap","show-select":"","onUpdate:options":oe},{"item.name":l(({item:a})=>[s("div",Me,[t(X,{size:"34",variant:"tonal",color:"primary"},{default:l(()=>[s("span",null,r(me(a.name)),1)]),_:2},1024),s("div",Fe,[s("h6",je,[t(v,{to:{name:"franchisor-leads-id",params:{id:a.id}},class:"text-link"},{default:l(()=>[m(r(a.name),1)]),_:2},1032,["to"])])])])]),"item.email":l(({item:a})=>[s("div",We,r(a.email),1)]),"item.phone":l(({item:a})=>[s("div",Oe,r(a.phone),1)]),"item.source":l(({item:a})=>[s("div",Ge,r(a.source),1)]),"item.status":l(({item:a})=>[t(Z,{color:Q(a.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[m(r(a.status),1)]),_:2},1032,["color"])]),"item.createdDate":l(({item:a})=>[s("div",Qe,r(a.createdDate),1)]),"item.actions":l(({item:a})=>[t(b,{icon:"",variant:"text",color:"medium-emphasis"},{default:l(()=>[t($,{icon:"tabler-dots-vertical"}),t(he,{activator:"parent"},{default:l(()=>[t(ke,null,{default:l(()=>[t(Se,{onClick:H=>de(a.id)},{prepend:l(()=>[t($,{icon:"tabler-trash"})]),default:l(()=>[t(De,null,{default:l(()=>e[22]||(e[22]=[m("Delete")])),_:1,__:[22]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:l(()=>[t(i,{page:o(y),"onUpdate:page":e[4]||(e[4]=a=>g(y)?y.value=a:null),"items-per-page":o(x),"total-items":o(W)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1}),t(F,{modelValue:o(D),"onUpdate:modelValue":e[10]||(e[10]=a=>g(D)?D.value=a:null),"max-width":"600"},{default:l(()=>[o(n)?(w(),U(S,{key:0},{default:l(()=>[t(E,null,{default:l(()=>[t(T,null,{default:l(()=>e[23]||(e[23]=[m("Lead Details")])),_:1,__:[23]})]),_:1}),t(h,null,{default:l(()=>[t(A,null,{default:l(()=>[t(f,{cols:"12",md:"6"},{default:l(()=>[s("div",qe,[e[24]||(e[24]=s("div",{class:"text-sm text-disabled mb-1"}," Name ",-1)),s("div",He,r(o(n).name),1)])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[s("div",Je,[e[25]||(e[25]=s("div",{class:"text-sm text-disabled mb-1"}," Email ",-1)),s("div",Ke,r(o(n).email),1)])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[s("div",Xe,[e[26]||(e[26]=s("div",{class:"text-sm text-disabled mb-1"}," Phone ",-1)),s("div",Ye,r(o(n).phone),1)])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[s("div",Ze,[e[27]||(e[27]=s("div",{class:"text-sm text-disabled mb-1"}," Source ",-1)),s("div",et,r(o(n).source),1)])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[s("div",tt,[e[28]||(e[28]=s("div",{class:"text-sm text-disabled mb-1"}," Status ",-1)),t(Z,{color:Q(o(n).status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[m(r(o(n).status),1)]),_:1},8,["color"])])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[s("div",lt,[e[29]||(e[29]=s("div",{class:"text-sm text-disabled mb-1"}," Created Date ",-1)),s("div",at,r(o(n).createdDate),1)])]),_:1})]),_:1})]),_:1}),t(M,null,{default:l(()=>[t(P),t(b,{color:"secondary",variant:"tonal",onClick:e[8]||(e[8]=a=>D.value=!1)},{default:l(()=>e[30]||(e[30]=[m(" Close ")])),_:1,__:[30]}),t(b,{color:"primary",onClick:e[9]||(e[9]=a=>ne(o(n)))},{default:l(()=>e[31]||(e[31]=[m(" Edit ")])),_:1,__:[31]})]),_:1})]),_:1})):N("",!0)]),_:1},8,["modelValue"]),t(F,{modelValue:o(C),"onUpdate:modelValue":e[18]||(e[18]=a=>g(C)?C.value=a:null),"max-width":"700"},{default:l(()=>[o(n)?(w(),U(S,{key:0},{default:l(()=>[t(E,null,{default:l(()=>[t(T,null,{default:l(()=>e[32]||(e[32]=[m("Edit Lead")])),_:1,__:[32]})]),_:1}),t(h,null,{default:l(()=>[t(Ue,{onSubmit:Le(q,["prevent"])},{default:l(()=>[t(A,null,{default:l(()=>[t(f,{cols:"12",md:"6"},{default:l(()=>[t(c,{modelValue:o(n).name,"onUpdate:modelValue":e[11]||(e[11]=a=>o(n).name=a),label:"Name",placeholder:"Enter lead name"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[t(c,{modelValue:o(n).email,"onUpdate:modelValue":e[12]||(e[12]=a=>o(n).email=a),label:"Email",type:"email",placeholder:"Enter email address"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[t(c,{modelValue:o(n).phone,"onUpdate:modelValue":e[13]||(e[13]=a=>o(n).phone=a),label:"Phone",placeholder:"+966 50 123 4567"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[t(u,{modelValue:o(n).source,"onUpdate:modelValue":e[14]||(e[14]=a=>o(n).source=a),label:"Source",items:O,placeholder:"Select source"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[t(u,{modelValue:o(n).status,"onUpdate:modelValue":e[15]||(e[15]=a=>o(n).status=a),label:"Status",items:G,placeholder:"Select status"},null,8,["modelValue"])]),_:1}),t(f,{cols:"12",md:"6"},{default:l(()=>[t(c,{modelValue:o(n).createdDate,"onUpdate:modelValue":e[16]||(e[16]=a=>o(n).createdDate=a),label:"Created Date",type:"date"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(M,null,{default:l(()=>[t(P),t(b,{color:"secondary",variant:"tonal",onClick:e[17]||(e[17]=a=>C.value=!1)},{default:l(()=>e[33]||(e[33]=[m(" Cancel ")])),_:1,__:[33]}),t(b,{color:"primary",onClick:q},{default:l(()=>e[34]||(e[34]=[m(" Save Changes ")])),_:1,__:[34]})]),_:1})]),_:1})):N("",!0)]),_:1},8,["modelValue"]),t(F,{modelValue:o(L),"onUpdate:modelValue":e[20]||(e[20]=a=>g(L)?L.value=a:null),"max-width":"500"},{default:l(()=>[t(S,null,{default:l(()=>[t(E,null,{default:l(()=>[t(T,null,{default:l(()=>e[35]||(e[35]=[m("Confirm Delete")])),_:1,__:[35]})]),_:1}),t(h,null,{default:l(()=>e[36]||(e[36]=[m(" Are you sure you want to delete this lead? This action cannot be undone. ")])),_:1,__:[36]}),t(M,null,{default:l(()=>[t(P),t(b,{color:"secondary",variant:"tonal",onClick:e[19]||(e[19]=a=>L.value=!1)},{default:l(()=>e[37]||(e[37]=[m(" Cancel ")])),_:1,__:[37]}),t(b,{color:"error",onClick:ie},{default:l(()=>e[38]||(e[38]=[m(" Delete ")])),_:1,__:[38]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{Gt as default};
