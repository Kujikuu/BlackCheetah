import{_ as se,V as ie}from"./VDialog-DNQTNeT1.js";import{d as ne,g as v,a as T,o as D,k as l,y as a,l as r,a7 as x,q as f,t as y,i as W,O as d,E as Ee,c as N,av as oe,h as $,bb as Fe,F as B}from"./main-CJoUlw71.js";import{f as R}from"./franchisee-dashboard-CfAqfQfD.js";import{V as F,f as A,h as re,b as z}from"./VCard-D0Kr6jJ3.js";import{V as Ae}from"./VFileInput-CLfIo29r.js";import{V as Ue}from"./VSpacer-CqgjN_yM.js";import{a as g,V as P}from"./VRow-I0aFN3ft.js";import{V as j}from"./VSelect-DrBKrWpC.js";import{S as qe}from"./saudi-riyal-CW9kKWrq.js";import{a as Re,V as Q,b as he,c as Y}from"./VTabs-CPaS4mMT.js";import{V as h}from"./VTextField-D8E1qX-C.js";import{V as H}from"./VDataTable-bPHraWWW.js";import{V as Pe}from"./VChip-B4nRRsDL.js";import{V as Te}from"./VForm-MxPZnCnL.js";import{V as Ie}from"./VTextarea-DlMZvYlN.js";import"./VOverlay-DNweL6TL.js";import"./forwardRefs-B931MWyl.js";import"./scopeId-BW4ci1pC.js";import"./VMenu-ChdF8Fzb.js";import"./api-router-CWf8jKcZ.js";import"./VField-BK8GYuQp.js";import"./form-TZVfOcgQ.js";import"./VInput-ljW8JGQT.js";/* empty css              */import"./VList-dBGtPQa1.js";import"./VDivider-BaGqyL8B.js";import"./VCheckboxBtn-ClRj4-k1.js";import"./VSelectionControl-DPYfPVD0.js";import"./VWindowItem-Sru_LTmb.js";import"./VSlideGroup-CFd1UCPD.js";import"./VTable-Z6ii9VWQ.js";const Oe={class:"mb-4"},Me=ne({__name:"ImportDataDialog",props:{isDialogVisible:{type:Boolean},title:{default:"Import Data"},fileAccept:{default:".csv"},exampleDownloadText:{default:"Download Example"},exampleFileName:{default:"example.csv"},exampleContent:{default:`Example,Data
Value1,Value2`}},emits:["update:isDialogVisible","import"],setup(G,{emit:b}){const c=G,i=b,p=v(null),k=m=>{const u=m.target;u.files&&u.files[0]&&(p.value=u.files[0])},V=()=>{const m=new Blob([c.exampleContent],{type:"text/csv"}),u=window.URL.createObjectURL(m),S=document.createElement("a");S.href=u,S.download=c.exampleFileName,S.click(),window.URL.revokeObjectURL(u)},I=()=>{i("import",p.value),i("update:isDialogVisible",!1),p.value=null},w=()=>{i("update:isDialogVisible",!1),p.value=null};return(m,u)=>{const S=se;return D(),T(ie,{"model-value":m.isDialogVisible,"max-width":"600","onUpdate:modelValue":u[1]||(u[1]=C=>i("update:isDialogVisible",C))},{default:l(()=>[a(S,{onClick:w}),a(F,{title:m.title},{default:l(()=>[a(A,null,{default:l(()=>[r("div",Oe,[a(x,{variant:"tonal",color:"secondary","prepend-icon":"tabler-download",onClick:V},{default:l(()=>[f(y(m.exampleDownloadText),1)]),_:1})]),a(Ae,{"model-value":W(p),label:"Select File",accept:m.fileAccept,"prepend-icon":"tabler-file-upload","show-size":"","onUpdate:modelValue":u[0]||(u[0]=C=>p.value=C),onChange:k},null,8,["model-value","accept"])]),_:1}),a(re,null,{default:l(()=>[a(Ue),a(x,{color:"secondary",variant:"tonal",onClick:w},{default:l(()=>u[2]||(u[2]=[f(" Cancel ")])),_:1,__:[2]}),a(x,{color:"primary",disabled:!W(p),onClick:I},{default:l(()=>u[3]||(u[3]=[f(" Import ")])),_:1,__:[3]},8,["disabled"])]),_:1})]),_:1},8,["title"])]),_:1},8,["model-value"])}}}),Le={class:"d-flex justify-space-between align-center flex-wrap gap-4"},Ne={class:"d-flex gap-3 align-center flex-wrap"},$e={class:"text-h6 font-weight-medium"},Be={class:"text-h6 font-weight-medium"},ze={class:"text-h6 font-weight-medium"},je={class:"d-flex justify-space-between align-center mb-4"},Qe={class:"d-flex gap-2"},Ye={class:"font-weight-medium"},He={class:"text-success font-weight-medium"},We={class:"text-error font-weight-medium"},Ge={class:"font-weight-medium"},Je={class:"text-error"},Ke={class:"text-success font-weight-medium"},At=ne({__name:"financial-overview",setup(G){const b=v("sales"),c=v(""),i=v([]),p=v(!1),k=v(!1),V=v("sales"),I=v("sales"),w=v(!1),m=v(!1),u=v(""),S=v("monthly"),C=v(null),_=v([]),s=v({product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""}),O=async()=>{w.value=!0;try{const t=await R.getFinancialOverview();t.success&&(C.value=t.data)}catch(t){console.error("Error loading financial data:",t)}finally{w.value=!1}},J=async()=>{try{const t=await R.getUnitProducts();t.success&&(_.value=t.data)}catch(t){console.error("Error loading unit products:",t)}},U=d(()=>{var t;return((t=C.value)==null?void 0:t.sales)||[]}),q=d(()=>{var t;return((t=C.value)==null?void 0:t.expenses)||[]}),M=d(()=>{var t;return((t=C.value)==null?void 0:t.profit)||[]});Ee(()=>{O(),J()});const ue=d(()=>_.value.filter(t=>t.status==="active"&&t.stock>0).map(t=>({title:`${t.name} (${t.stock} in stock)`,value:t.name,stock:t.stock}))),E=d(()=>{if(!s.value.product)return 0;const t=_.value.find(e=>e.name===s.value.product);return(t==null?void 0:t.stock)||0}),K=d(()=>V.value!=="sales"?!0:s.value.quantitySold>0&&s.value.quantitySold<=E.value),X=d(()=>s.value.product?s.value.quantitySold===0?"Quantity must be greater than 0":s.value.quantitySold>E.value?`Cannot exceed available stock (${E.value} units)`:"":""),de=["Food Supplies","Utilities","Staff Wages","Marketing","Equipment Maintenance","Rent","Insurance","Cleaning Supplies","Office Supplies","Transportation"],pe=[{title:"Product",key:"product",sortable:!0},{title:"Date of Sale",key:"dateOfSale",sortable:!0},{title:"Unit Price (SAR)",key:"unitPrice",sortable:!0},{title:"Quantity Sold",key:"quantitySold",sortable:!0},{title:"Sale (SAR)",key:"sale",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],me=[{title:"Expense Category",key:"expenseCategory",sortable:!0},{title:"Date of Expense",key:"dateOfExpense",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Description",key:"description",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],ve=[{title:"Date",key:"date",sortable:!0},{title:"Total Sales (SAR)",key:"totalSales",sortable:!0},{title:"Total Expenses (SAR)",key:"totalExpenses",sortable:!0},{title:"Profit (SAR)",key:"profit",sortable:!0}],ce=d(()=>c.value?U.value.filter(t=>t.product.toLowerCase().includes(c.value.toLowerCase())||t.dateOfSale.includes(c.value)):U.value),fe=d(()=>c.value?q.value.filter(t=>t.expenseCategory.toLowerCase().includes(c.value.toLowerCase())||t.description.toLowerCase().includes(c.value.toLowerCase())||t.dateOfExpense.includes(c.value)):q.value),L=t=>{const e=new Date(t),n=new Date;return S.value==="daily"?e.toDateString()===n.toDateString():S.value==="monthly"?e.getMonth()===n.getMonth()&&e.getFullYear()===n.getFullYear():S.value==="yearly"?e.getFullYear()===n.getFullYear():!0},ye=d(()=>U.value.filter(t=>L(t.dateOfSale))),ge=d(()=>q.value.filter(t=>L(t.dateOfExpense))),Z=d(()=>M.value.filter(t=>L(t.date))),xe=d(()=>{let t=Z.value;return c.value&&(t=t.filter(e=>e.date.includes(c.value))),t}),be=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],Ve=d(()=>ye.value.reduce((t,e)=>t+e.sale,0)),Se=d(()=>ge.value.reduce((t,e)=>t+e.amount,0)),we=d(()=>Z.value.reduce((t,e)=>t+e.profit,0)),ee=()=>{s.value={product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""},m.value=!1,u.value=""},Ce=t=>{V.value=t,m.value=!1,u.value="",ee(),p.value=!0},te=(t,e)=>{V.value=e,m.value=!0,u.value=t.id,e==="sales"?s.value={product:t.product,date:t.dateOfSale,quantitySold:t.quantitySold,expenseCategory:"",amount:0,description:""}:s.value={product:"",date:t.dateOfExpense,quantitySold:0,expenseCategory:t.expenseCategory,amount:t.amount,description:t.description||""},p.value=!0},ae=async()=>{var t,e;if(!(V.value==="sales"&&!K.value)){w.value=!0;try{const n={category:V.value,date:s.value.date};V.value==="sales"?(n.product=s.value.product,n.quantitySold=s.value.quantitySold):(n.expenseCategory=s.value.expenseCategory,n.amount=s.value.amount,n.description=s.value.description);let o;m.value?o=await R.updateFinancialData(u.value,n):o=await R.addFinancialData(n),o.success&&(await O(),await J(),p.value=!1,ee(),m.value=!1,u.value="")}catch(n){console.error("Error saving data:",n),(e=(t=n.response)==null?void 0:t.data)!=null&&e.message&&console.error("Submission error:",n.response.data.message)}finally{w.value=!1}}},le=()=>{let t=[],e="";b.value==="sales"?(t=i.value.length>0?U.value.filter(n=>i.value.includes(n.id)):U.value,e="sales_data.csv"):b.value==="expense"?(t=i.value.length>0?q.value.filter(n=>i.value.includes(n.id)):q.value,e="expense_data.csv"):b.value==="profit"&&(t=i.value.length>0?M.value.filter(n=>i.value.includes(n.id)):M.value,e="profit_data.csv"),console.log("Exporting data:",t,"as",e)},De=async()=>{if(i.value.length!==0){w.value=!0;try{(await R.deleteFinancialData({category:b.value,ids:i.value})).success&&(await O(),i.value=[])}catch(t){console.error("Error deleting data:",t)}finally{w.value=!1}}},ke=t=>{t&&(console.log("Importing file:",t.name,"for category:",I.value),k.value=!1)};return(t,e)=>{const n=se;return D(),N(B,null,[r("section",null,[a(P,{class:"mb-6"},{default:l(()=>[a(g,{cols:"12"},{default:l(()=>[r("div",Le,[e[22]||(e[22]=r("div",null,[r("h4",{class:"text-h4 mb-1"}," Financial Overview "),r("p",{class:"text-body-1 text-medium-emphasis"}," Track your franchise financial performance and metrics ")],-1)),r("div",Ne,[a(x,{color:"primary",variant:"outlined","prepend-icon":"tabler-upload",onClick:e[0]||(e[0]=o=>k.value=!0)},{default:l(()=>e[20]||(e[20]=[f(" Import ")])),_:1,__:[20]}),a(x,{color:"primary","prepend-icon":"tabler-plus",onClick:e[1]||(e[1]=o=>Ce(b.value))},{default:l(()=>e[21]||(e[21]=[f(" Add Data ")])),_:1,__:[21]}),a(j,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=o=>S.value=o),items:be,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(P,{class:"mb-6"},{default:l(()=>[a(g,{cols:"12",md:"4"},{default:l(()=>[a(F,null,{default:l(()=>[a(A,{class:"d-flex align-center"},{default:l(()=>[a(z,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-4"},{default:l(()=>[a(W(qe))]),_:1}),r("div",null,[e[23]||(e[23]=r("span",{class:"text-sm text-medium-emphasis"},"Total Sales",-1)),r("div",$e,y(Ve.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1}),a(g,{cols:"12",md:"4"},{default:l(()=>[a(F,null,{default:l(()=>[a(A,{class:"d-flex align-center"},{default:l(()=>[a(z,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-4"},{default:l(()=>[a(oe,{size:"24",icon:"tabler-trending-down"})]),_:1}),r("div",null,[e[24]||(e[24]=r("span",{class:"text-sm text-medium-emphasis"},"Total Expenses",-1)),r("div",Be,y(Se.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1}),a(g,{cols:"12",md:"4"},{default:l(()=>[a(F,null,{default:l(()=>[a(A,{class:"d-flex align-center"},{default:l(()=>[a(z,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-4"},{default:l(()=>[a(oe,{size:"24",icon:"tabler-trending-up"})]),_:1}),r("div",null,[e[25]||(e[25]=r("span",{class:"text-sm text-medium-emphasis"},"Total Profit",-1)),r("div",ze,y(we.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(P,null,{default:l(()=>[a(g,{cols:"12"},{default:l(()=>[a(F,null,{default:l(()=>[a(A,null,{default:l(()=>[a(Re,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=o=>b.value=o),color:"primary",class:"mb-4"},{default:l(()=>[a(Q,{value:"sales"},{default:l(()=>e[26]||(e[26]=[f(" Sales ")])),_:1,__:[26]}),a(Q,{value:"expense"},{default:l(()=>e[27]||(e[27]=[f(" Expense ")])),_:1,__:[27]}),a(Q,{value:"profit"},{default:l(()=>e[28]||(e[28]=[f(" Profit ")])),_:1,__:[28]})]),_:1},8,["modelValue"]),r("div",je,[a(h,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=o=>c.value=o),placeholder:"Search...","prepend-inner-icon":"tabler-search",variant:"outlined",density:"compact",style:{"max-width":"300px"},clearable:""},null,8,["modelValue"]),r("div",Qe,[i.value.length>0?(D(),T(x,{key:0,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:le},{default:l(()=>[f(" Export Selected ("+y(i.value.length)+") ",1)]),_:1})):$("",!0),i.value.length>0?(D(),T(x,{key:1,color:"error",variant:"outlined","prepend-icon":"tabler-trash",onClick:De},{default:l(()=>[f(" Delete Selected ("+y(i.value.length)+") ",1)]),_:1})):$("",!0),i.value.length===0?(D(),T(x,{key:2,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:le},{default:l(()=>e[29]||(e[29]=[f(" Export All ")])),_:1,__:[29]})):$("",!0)])]),a(he,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=o=>b.value=o)},{default:l(()=>[a(Y,{value:"sales"},{default:l(()=>[a(H,{modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=o=>i.value=o),headers:pe,items:ce.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.unitPrice":l(({item:o})=>[r("span",Ye,y(Number(o.unitPrice).toFixed(2))+" SAR ",1)]),"item.sale":l(({item:o})=>[r("span",He,y(Number(o.sale).toFixed(2))+" SAR ",1)]),"item.actions":l(({item:o})=>[a(x,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:_e=>te(o,"sales")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),a(Y,{value:"expense"},{default:l(()=>[a(H,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=o=>i.value=o),headers:me,items:fe.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.amount":l(({item:o})=>[r("span",We,y(Number(o.amount).toFixed(2))+" SAR ",1)]),"item.expenseCategory":l(({item:o})=>[a(Pe,{size:"small",variant:"tonal",color:"primary"},{default:l(()=>[f(y(o.expenseCategory),1)]),_:2},1024)]),"item.actions":l(({item:o})=>[a(x,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:_e=>te(o,"expense")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),a(Y,{value:"profit"},{default:l(()=>[a(H,{modelValue:i.value,"onUpdate:modelValue":e[7]||(e[7]=o=>i.value=o),headers:ve,items:xe.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.totalSales":l(({item:o})=>[r("span",Ge,y(Number(o.totalSales).toFixed(2))+" SAR ",1)]),"item.totalExpenses":l(({item:o})=>[r("span",Je,y(Number(o.totalExpenses).toFixed(2))+" SAR ",1)]),"item.profit":l(({item:o})=>[r("span",Ke,y(Number(o.profit).toFixed(2))+" SAR ",1)]),_:1},8,["modelValue","items"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),a(ie,{modelValue:p.value,"onUpdate:modelValue":e[18]||(e[18]=o=>p.value=o),"max-width":"600"},{default:l(()=>[a(n,{onClick:e[9]||(e[9]=o=>p.value=!1)}),a(F,{title:m.value?"Edit":"Add"+(V.value==="sales"?"Sales":"Expense")+" Data"},{default:l(()=>[a(A,null,{default:l(()=>[a(Te,{onSubmit:Fe(ae,["prevent"])},{default:l(()=>[a(P,null,{default:l(()=>[V.value==="sales"?(D(),N(B,{key:0},[a(g,{cols:"12"},{default:l(()=>[a(j,{modelValue:s.value.product,"onUpdate:modelValue":e[10]||(e[10]=o=>s.value.product=o),items:ue.value,label:"Product",variant:"outlined","item-title":"title","item-value":"value",loading:_.value.length===0,disabled:_.value.length===0,hint:_.value.length===0?"No products available in stock":"","persistent-hint":"",required:""},null,8,["modelValue","items","loading","disabled","hint"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(h,{modelValue:s.value.date,"onUpdate:modelValue":e[11]||(e[11]=o=>s.value.date=o),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(h,{modelValue:s.value.quantitySold,"onUpdate:modelValue":e[12]||(e[12]=o=>s.value.quantitySold=o),modelModifiers:{number:!0},label:"Quantity Sold",type:"number",variant:"outlined",required:"",min:1,max:E.value,error:!!X.value,"error-messages":X.value,hint:E.value>0?`Available stock: ${E.value} units`:"","persistent-hint":"",disabled:!s.value.product},null,8,["modelValue","max","error","error-messages","hint","disabled"])]),_:1})],64)):(D(),N(B,{key:1},[a(g,{cols:"12"},{default:l(()=>[a(j,{modelValue:s.value.expenseCategory,"onUpdate:modelValue":e[13]||(e[13]=o=>s.value.expenseCategory=o),items:de,label:"Expense Category",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(h,{modelValue:s.value.date,"onUpdate:modelValue":e[14]||(e[14]=o=>s.value.date=o),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(h,{modelValue:s.value.amount,"onUpdate:modelValue":e[15]||(e[15]=o=>s.value.amount=o),modelModifiers:{number:!0},label:"Amount (SAR)",type:"number",step:"0.01",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(g,{cols:"12"},{default:l(()=>[a(Ie,{modelValue:s.value.description,"onUpdate:modelValue":e[16]||(e[16]=o=>s.value.description=o),label:"Note/Description",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})],64))]),_:1})]),_:1})]),_:1}),a(re,{class:"d-flex justify-end gap-2 pa-4"},{default:l(()=>[a(x,{variant:"tonal",color:"secondary",onClick:e[17]||(e[17]=o=>p.value=!1)},{default:l(()=>e[30]||(e[30]=[f(" Cancel ")])),_:1,__:[30]}),a(x,{disabled:V.value==="sales"&&!K.value,loading:w.value,onClick:ae},{default:l(()=>e[31]||(e[31]=[f(" Save ")])),_:1,__:[31]},8,["disabled","loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),a(Me,{"is-dialog-visible":k.value,"onUpdate:isDialogVisible":e[19]||(e[19]=o=>k.value=o),title:"Import Financial Data",label:"Choose CSV file",accept:".csv",onImport:ke},null,8,["is-dialog-visible"])],64)}}});export{At as default};
