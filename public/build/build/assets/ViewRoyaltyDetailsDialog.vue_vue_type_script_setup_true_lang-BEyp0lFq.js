import{_ as B,V as $}from"./VDialog-DNQTNeT1.js";import{b2 as y,d as A,g as S,O as U,w as F,a as x,o as R,k as l,y as e,bb as M,l as s,a7 as h,q as b,h as D,t as m,av as v}from"./main-CJoUlw71.js";import{g as j}from"./api-router-CWf8jKcZ.js";import{V as g,f as P,h as T}from"./VCard-D0Kr6jJ3.js";import{V as N}from"./VForm-MxPZnCnL.js";import{V as O,a as n}from"./VRow-I0aFN3ft.js";import{V as k}from"./VTextField-D8E1qX-C.js";import{V as z}from"./VSelect-DrBKrWpC.js";import{V as E}from"./VFileInput-CLfIo29r.js";import{V as L}from"./VSpacer-CqgjN_yM.js";import{V as C}from"./VDivider-BaGqyL8B.js";import{V as I}from"./VChip-B4nRRsDL.js";import{V as q}from"./VTable-Z6ii9VWQ.js";class G{getBaseUrl(){return j("royalties")}async getRoyalties(i){return await y(this.getBaseUrl(),{params:i})}async getRoyalty(i){return await y(`${this.getBaseUrl()}/${i}`)}async getStatistics(i){return await y(`${this.getBaseUrl()}/statistics`,{params:i})}async markAsPaid(i,a){const d=new FormData;return d.append("amount_paid",(a.amount_paid||0).toString()),d.append("payment_date",a.payment_date||""),d.append("payment_method",a.payment_type||""),a.payment_reference&&d.append("payment_reference",a.payment_reference),a.notes&&d.append("notes",a.notes),a.attachment&&d.append("attachment",a.attachment),d.append("_method","PATCH"),await y(`${this.getBaseUrl()}/${i}/mark-paid`,{method:"POST",body:d,headers:{"Content-Type":void 0}})}async exportRoyalties(i){return await y(`${this.getBaseUrl()}/export`,{params:i,parseResponse:a=>a})}async createRoyalty(i){return await y(`${this.getBaseUrl()}`,{method:"POST",body:i})}async updateRoyalty(i,a){return await y(`${this.getBaseUrl()}/${i}`,{method:"PUT",body:a})}async deleteRoyalty(i){await y(`${this.getBaseUrl()}/${i}`,{method:"DELETE"})}async addAdjustment(i,a,d){return await y(`${this.getBaseUrl()}/${i}/adjustments`,{method:"POST",body:{adjustment_amount:a,adjustment_reason:d}})}async calculateLateFee(i){return await y(`${this.getBaseUrl()}/${i}/late-fee`,{method:"POST"})}}const H=new G,kt=A({__name:"MarkCompletedRoyaltyDialog",props:{isDialogVisible:{type:Boolean},selectedRoyalty:{},paymentTypeOptions:{}},emits:["update:isDialogVisible","paymentSubmitted"],setup(w,{emit:i}){const a=w,d=i,p=S(!1),u=S({amount_paid:0,payment_date:"",payment_type:"",attachment:null}),f=U({get:()=>a.isDialogVisible,set:t=>d("update:isDialogVisible",t)});F(()=>a.selectedRoyalty,t=>{t&&(u.value={amount_paid:t.amount,payment_date:new Date().toISOString().split("T")[0],payment_type:"",attachment:null})},{immediate:!0});const V=async()=>{if(a.selectedRoyalty){p.value=!0;try{await H.markAsPaid(a.selectedRoyalty.id,u.value),d("paymentSubmitted"),f.value=!1,u.value={amount_paid:0,payment_date:"",payment_type:"",attachment:null}}catch(t){console.error("Error submitting payment:",t)}finally{p.value=!1}}},c=t=>{const o=t.target;o.files&&o.files[0]&&(u.value.attachment=o.files[0])};return(t,o)=>{const _=B;return R(),x($,{modelValue:f.value,"onUpdate:modelValue":o[5]||(o[5]=r=>f.value=r),"max-width":"600"},{default:l(()=>[e(_,{onClick:o[0]||(o[0]=r=>f.value=!1)}),e(g,{title:"Mark Royalty as Completed"},{default:l(()=>[e(P,null,{default:l(()=>[e(N,{onSubmit:M(V,["prevent"])},{default:l(()=>[e(O,null,{default:l(()=>[e(n,{cols:"12",md:"6"},{default:l(()=>[e(k,{modelValue:u.value.amount_paid,"onUpdate:modelValue":o[1]||(o[1]=r=>u.value.amount_paid=r),modelModifiers:{number:!0},label:"Amount Paid (SAR)",type:"number",variant:"outlined",density:"compact",rules:[r=>!!r||"Amount is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[e(k,{modelValue:u.value.payment_date,"onUpdate:modelValue":o[2]||(o[2]=r=>u.value.payment_date=r),label:"Payment Date",type:"date",variant:"outlined",density:"compact",rules:[r=>!!r||"Payment date is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(z,{modelValue:u.value.payment_type,"onUpdate:modelValue":o[3]||(o[3]=r=>u.value.payment_type=r),items:a.paymentTypeOptions,"item-title":"title","item-value":"value",label:"Payment Type",variant:"outlined",density:"compact",rules:[r=>!!r||"Payment type is required"]},null,8,["modelValue","items","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(E,{label:"Attachment (Optional)",variant:"outlined",density:"compact",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:c}),o[6]||(o[6]=s("div",{class:"text-caption text-medium-emphasis mt-1"}," Supported formats: PDF, JPG, PNG, DOC, DOCX ",-1))]),_:1,__:[6]})]),_:1})]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(L),e(h,{color:"secondary",variant:"tonal",onClick:o[4]||(o[4]=r=>f.value=!1)},{default:l(()=>o[7]||(o[7]=[b(" Cancel ")])),_:1,__:[7]}),e(h,{color:"primary",loading:p.value,onClick:V},{default:l(()=>o[8]||(o[8]=[b(" Mark as Completed ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),J={class:"mb-4"},X={class:"font-weight-medium"},K={class:"mb-4"},Q={class:"font-weight-medium"},W={class:"mb-4"},Y={class:"font-weight-medium text-primary"},Z={class:"mb-4"},tt={class:"font-weight-medium"},et={class:"text-center"},at={class:"text-h6 font-weight-bold"},st={class:"text-center"},lt={class:"text-h6 font-weight-bold"},ot={class:"text-center"},it={class:"text-h6 font-weight-bold"},nt={class:"mb-4"},dt={class:"mb-4"},rt={class:"font-weight-medium"},mt={class:"text-end"},ut={class:"text-end"},yt={class:"text-end"},pt={class:"bg-primary-lighten-5"},ct={class:"text-end font-weight-bold text-primary"},Bt=A({__name:"ViewRoyaltyDetailsDialog",props:{isDialogVisible:{type:Boolean},viewedRoyalty:{}},emits:["update:isDialogVisible","markAsCompleted"],setup(w,{emit:i}){const a=w,d=i,p=U({get:()=>a.isDialogVisible,set:c=>d("update:isDialogVisible",c)}),u=c=>new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),f=c=>{switch(c){case"paid":return"success";case"pending":return"warning";case"overdue":return"error";default:return"default"}},V=()=>{a.viewedRoyalty&&(d("markAsCompleted",a.viewedRoyalty),p.value=!1)};return(c,t)=>{const o=B;return R(),x($,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=_=>p.value=_),"max-width":"600"},{default:l(()=>[e(o,{onClick:t[0]||(t[0]=_=>p.value=!1)}),a.viewedRoyalty?(R(),x(g,{key:0,title:"Royalty Details"},{default:l(()=>[e(P,null,{default:l(()=>[e(O,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>t[3]||(t[3]=[s("h6",{class:"text-h6 mb-4 text-primary"}," Basic Information ",-1)])),_:1,__:[3]}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",J,[t[4]||(t[4]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Billing Period ",-1)),s("div",X,m(a.viewedRoyalty.billing_period),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",K,[t[5]||(t[5]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Due Date ",-1)),s("div",Q,m(u(a.viewedRoyalty.due_date)),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",W,[t[6]||(t[6]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Franchisee Name ",-1)),s("div",Y,m(a.viewedRoyalty.franchisee_name),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",Z,[t[7]||(t[7]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Store Location ",-1)),s("div",tt,m(a.viewedRoyalty.store_location),1)])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(C,{class:"my-4"}),t[8]||(t[8]=s("h6",{class:"text-h6 mb-4 text-primary"}," Financial Details ",-1))]),_:1,__:[8]}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(g,{variant:"tonal",color:"info",class:"pa-4"},{default:l(()=>[s("div",et,[e(v,{icon:"tabler-chart-line",size:"32",class:"mb-2"}),t[9]||(t[9]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Gross Sales ",-1)),s("div",at,m((a.viewedRoyalty.gross_sales||0).toLocaleString())+" SAR ",1)])]),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(g,{variant:"tonal",color:"primary",class:"pa-4"},{default:l(()=>[s("div",st,[e(v,{icon:"tabler-percentage",size:"32",class:"mb-2"}),t[10]||(t[10]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Rate ",-1)),s("div",lt,m(a.viewedRoyalty.royalty_percentage)+"% ",1)])]),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(g,{variant:"tonal",color:"success",class:"pa-4"},{default:l(()=>[s("div",ot,[e(v,{icon:"tabler-coins",size:"32",class:"mb-2"}),t[11]||(t[11]=s("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Amount ",-1)),s("div",it,m((a.viewedRoyalty.amount||0).toLocaleString())+" SAR ",1)])]),_:1})]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(C,{class:"my-4"}),t[12]||(t[12]=s("h6",{class:"text-h6 mb-4 text-primary"}," Status Information ",-1))]),_:1,__:[12]}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",nt,[t[13]||(t[13]=s("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Payment Status ",-1)),e(I,{color:f(a.viewedRoyalty.status),size:"large",variant:"tonal",class:"text-capitalize"},{default:l(()=>[e(v,{icon:a.viewedRoyalty.status==="paid"?"tabler-check":a.viewedRoyalty.status==="pending"?"tabler-clock":"tabler-alert-triangle",class:"me-2"},null,8,["icon"]),b(" "+m(a.viewedRoyalty.status),1)]),_:1},8,["color"])])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[s("div",dt,[t[14]||(t[14]=s("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Days Until Due ",-1)),s("div",rt,m(Math.ceil((new Date(a.viewedRoyalty.due_date).getTime()-new Date().getTime())/(1e3*60*60*24)))+" days ",1)])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(C,{class:"my-4"}),t[15]||(t[15]=s("h6",{class:"text-h6 mb-4 text-primary"}," Calculation Breakdown ",-1))]),_:1,__:[15]}),e(n,{cols:"12"},{default:l(()=>[e(q,{density:"compact"},{default:l(()=>[s("tbody",null,[s("tr",null,[t[16]||(t[16]=s("td",{class:"font-weight-medium"}," Gross Sales: ",-1)),s("td",mt,m((a.viewedRoyalty.gross_sales||0).toLocaleString())+" SAR ",1)]),s("tr",null,[t[17]||(t[17]=s("td",{class:"font-weight-medium"}," Royalty Rate: ",-1)),s("td",ut,m(a.viewedRoyalty.royalty_percentage)+"% ",1)]),s("tr",null,[t[18]||(t[18]=s("td",{class:"font-weight-medium"}," Calculation: ",-1)),s("td",yt,m((a.viewedRoyalty.gross_sales||0).toLocaleString())+" × "+m(a.viewedRoyalty.royalty_percentage)+"% ",1)]),s("tr",pt,[t[19]||(t[19]=s("td",{class:"font-weight-bold text-primary"}," Total Royalty Amount: ",-1)),s("td",ct,m((a.viewedRoyalty.amount||0).toLocaleString())+" SAR ",1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(L),e(h,{color:"secondary",variant:"tonal",onClick:t[1]||(t[1]=_=>p.value=!1)},{default:l(()=>t[20]||(t[20]=[b(" Close ")])),_:1,__:[20]}),a.viewedRoyalty.status!=="paid"?(R(),x(h,{key:0,color:"primary",onClick:V},{default:l(()=>[e(v,{icon:"tabler-check",class:"me-2"}),t[21]||(t[21]=b(" Mark as Completed "))]),_:1,__:[21]})):D("",!0)]),_:1})]),_:1})):D("",!0)]),_:1},8,["modelValue"])}}});export{kt as _,Bt as a,H as r};
