import{V as A,_ as nt}from"./VDialog-CEq2jzbd.js";import{d as rt,r as u,P as H,G as dt,c as ut,b as e,f as l,o as S,e as a,a9 as c,t as d,ax as v,v as i,m as mt,g as T,l as P,b3 as pt}from"./main-B8QbR-yS.js";import{r as R}from"./royalty-BtcUV0cC.js";import{V as w,a as n}from"./VRow-LlT6Azsr.js";import{V as U}from"./VSelect-GSzN3Qps.js";import{V as y,a as ct,b as vt,c as yt}from"./VCard-D9PhtsJ0.js";import{V as _}from"./VCardText-Cbtr6Qhr.js";import{V as J}from"./VAvatar-87LH5tAk.js";import{S as ft}from"./saudi-riyal-DBg1zXmT.js";import{V as D}from"./VDivider-DOfIMbJY.js";import{V as _t}from"./VDataTable-FYAU2aQJ.js";import{V as X}from"./VTooltip-D-apmXOm.js";import{V as L}from"./VChip-CgHwmC-k.js";import{V as bt}from"./VAlert-DpqH6FXl.js";import{V as gt}from"./VForm-C9sxpau4.js";import{V as Y}from"./VTextField-C7_y5spr.js";import{V as xt}from"./VFileInput-Ip2n4ssl.js";import{V as Vt}from"./VTable-CgkStP3y.js";import"./VOverlay-B3La6Ajr.js";import"./forwardRefs--KQCZfKO.js";import"./scopeId-DyQ6a1uN.js";import"./VImg-Ceu2Mboj.js";import"./dialog-transition-Dy2Gj1XO.js";/* empty css              */import"./form-Dt-W1fp6.js";import"./VList-BJCgULVd.js";import"./VMenu-TQcmpCCv.js";import"./VCheckboxBtn-CWPoGbRz.js";import"./VSelectionControl-DDEVNAf7.js";import"./VSlideGroup-BuNiGLv2.js";import"./VField-Bw51LFql.js";import"./VInput-DB3XZUVb.js";const wt={class:"d-flex justify-space-between align-center flex-wrap gap-4"},Ct={class:"d-flex gap-3 align-center flex-wrap"},kt={class:"d-flex align-center justify-space-between"},St={class:"text-h4 text-success"},Rt={class:"d-flex align-center justify-space-between"},Dt={class:"text-h4 text-warning"},ht={class:"font-weight-medium"},At={class:"text-body-2"},Tt={class:"font-weight-medium text-info"},Pt={class:"font-weight-medium text-success"},Ut={class:"d-flex gap-2"},Lt={class:"text-body-2"},zt={class:"mb-4"},Ot={class:"font-weight-medium"},Et={class:"mb-4"},Mt={class:"font-weight-medium"},$t={class:"mb-4"},Bt={class:"font-weight-medium text-primary"},Ft={class:"mb-4"},jt={class:"font-weight-medium"},It={class:"text-center"},Gt={class:"text-h6 font-weight-bold"},Nt={class:"text-center"},qt={class:"text-h6 font-weight-bold"},Ht={class:"text-center"},Jt={class:"text-h6 font-weight-bold"},Xt={class:"mb-4"},Yt={class:"mb-4"},Kt={class:"font-weight-medium"},Qt={class:"text-end"},Wt={class:"text-end"},Zt={class:"text-end"},te={class:"bg-primary-lighten-5"},ee={class:"text-end font-weight-bold text-primary"},Oe=rt({__name:"royalty-management",setup(le){const z=u(!1),O=u(!1),f=u("monthly"),b=u(!1),g=u(!1),x=u(!1),k=u(null),r=u(null),C=u("csv"),E=u("all"),m=u({amount_paid:0,payment_date:"",payment_type:"",attachment:null}),M=u([]),h=u({royalty_collected_till_date:0,upcoming_royalties:0,total_royalties:0,pending_amount:0,paid_amount:0,overdue_amount:0,overdue_count:0}),K=H(()=>h.value.royalty_collected_till_date),Q=H(()=>h.value.upcoming_royalties),W=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],Z=[{title:"CSV",value:"csv"},{title:"Excel",value:"excel"}],tt=[{title:"All Royalties",value:"all"},{title:"Paid Only",value:"paid"},{title:"Pending Only",value:"pending"},{title:"Overdue Only",value:"overdue"}],et=[{title:"Bank Transfer",value:"bank_transfer"},{title:"Credit Card",value:"credit_card"},{title:"Mada",value:"mada"},{title:"STC Pay",value:"stc_pay"},{title:"SADAD",value:"sadad"},{title:"Check",value:"check"},{title:"Cash",value:"cash"},{title:"Online Payment",value:"online_payment"}],lt=[{title:"Billing Period",key:"billing_period",sortable:!0},{title:"Due Date",key:"due_date",sortable:!0},{title:"Gross Sales (SAR)",key:"gross_sales",sortable:!0},{title:"Royalty %",key:"royalty_percentage",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],$=async()=>{try{z.value=!0;const s=await R.getRoyalties({period:f.value});M.value=s.data.data}catch(s){console.error("Error fetching royalties:",s)}finally{z.value=!1}},B=async()=>{try{O.value=!0;const s=await R.getStatistics({period:f.value});h.value=s.data}catch(s){console.error("Error fetching statistics:",s)}finally{O.value=!1}},at=()=>{b.value=!0},ot=async()=>{try{const s=await R.exportRoyalties({format:C.value,data_type:E.value,period:f.value}),t=window.URL.createObjectURL(s),p=document.createElement("a");p.href=t,p.download=`royalty-data-${f.value}-${new Date().toISOString().split("T")[0]}.${C.value==="csv"?"csv":"xlsx"}`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(t),b.value=!1}catch(s){console.error("Error exporting royalties:",s)}},st=s=>{r.value=s,x.value=!0},F=s=>{k.value=s,m.value={amount_paid:s.amount,payment_date:new Date().toISOString().split("T")[0],payment_type:"",attachment:null},g.value=!0},j=async()=>{if(k.value)try{await R.markAsPaid(k.value.id,m.value),await $(),await B(),g.value=!1,k.value=null,m.value={amount_paid:0,payment_date:"",payment_type:"",attachment:null}}catch(s){console.error("Error marking royalty as paid:",s)}},it=s=>{const t=s.target;t.files&&t.files[0]&&(m.value.attachment=t.files[0])},I=s=>{switch(s){case"paid":return"success";case"pending":return"warning";case"overdue":return"error";default:return"default"}},G=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return dt(()=>{$(),B()}),(s,t)=>{const p=nt;return S(),ut("section",null,[e(w,{class:"mb-6"},{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[a("div",wt,[t[16]||(t[16]=a("div",null,[a("h4",{class:"text-h4 mb-1"}," Royalty Management "),a("p",{class:"text-body-1 text-medium-emphasis"}," Track and manage royalty payments from all franchise units ")],-1)),a("div",Ct,[e(U,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=o=>f.value=o),items:W,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"]),e(c,{color:"primary",variant:"elevated",onClick:at},{default:l(()=>[e(v,{icon:"tabler-download",class:"me-2"}),t[15]||(t[15]=d(" Export "))]),_:1,__:[15]})])])]),_:1})]),_:1}),e(w,{class:"mb-6"},{default:l(()=>[e(n,{cols:"12",md:"6"},{default:l(()=>[e(y,null,{default:l(()=>[e(_,null,{default:l(()=>[a("div",kt,[a("div",null,[t[17]||(t[17]=a("h6",{class:"text-h6 mb-1"}," Royalty Collected Till Date ",-1)),t[18]||(t[18]=a("div",{class:"text-body-2 text-medium-emphasis mb-3"}," Total payments received ",-1)),a("h4",St,i((K.value||0).toLocaleString())+" SAR ",1)]),e(J,{color:"success",variant:"tonal",size:"56"},{default:l(()=>[e(mt(ft),{size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[e(y,null,{default:l(()=>[e(_,null,{default:l(()=>[a("div",Rt,[a("div",null,[t[19]||(t[19]=a("h6",{class:"text-h6 mb-1"}," Upcoming Royalties ",-1)),t[20]||(t[20]=a("div",{class:"text-body-2 text-medium-emphasis mb-3"}," Pending payments due ",-1)),a("h4",Dt,i((Q.value||0).toLocaleString())+" SAR ",1)]),e(J,{color:"warning",variant:"tonal",size:"56"},{default:l(()=>[e(v,{icon:"tabler-clock",size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(ct,{class:"pb-4"},{default:l(()=>[e(vt,{class:"text-h6"},{default:l(()=>t[21]||(t[21]=[d(" Royalty Records ")])),_:1,__:[21]}),e(yt,{class:"text-body-2"},{default:l(()=>t[22]||(t[22]=[d(" Manage royalty payments and track collection status ")])),_:1,__:[22]})]),_:1}),e(D),e(_t,{headers:lt,items:M.value,"items-per-page":10,class:"text-no-wrap"},{"item.billing_period":l(({item:o})=>[a("div",ht,i(o.billing_period),1)]),"item.due_date":l(({item:o})=>[a("div",At,i(G(o.due_date)),1)]),"item.gross_sales":l(({item:o})=>[a("div",Tt,i((o.gross_sales||0).toLocaleString()),1)]),"item.royalty_percentage":l(({item:o})=>[e(L,{size:"small",variant:"tonal",color:"primary"},{default:l(()=>[d(i(o.royalty_percentage)+"% ",1)]),_:2},1024)]),"item.amount":l(({item:o})=>[a("div",Pt,i((o.amount||0).toLocaleString()),1)]),"item.status":l(({item:o})=>[e(L,{color:I(o.status),size:"small",variant:"tonal",class:"text-capitalize"},{default:l(()=>[d(i(o.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:o})=>[a("div",Ut,[e(c,{icon:"",size:"small",color:"info",variant:"text",onClick:V=>st(o)},{default:l(()=>[e(v,{icon:"tabler-eye",size:"20"}),e(X,{activator:"parent",location:"top"},{default:l(()=>t[23]||(t[23]=[d(" View Details ")])),_:1,__:[23]})]),_:2},1032,["onClick"]),o.status!=="paid"?(S(),T(c,{key:0,icon:"",size:"small",color:"success",variant:"text",onClick:V=>F(o)},{default:l(()=>[e(v,{icon:"tabler-check",size:"20"}),e(X,{activator:"parent",location:"top"},{default:l(()=>t[24]||(t[24]=[d(" Mark as Completed ")])),_:1,__:[24]})]),_:2},1032,["onClick"])):P("",!0)])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),e(A,{modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=o=>b.value=o),"max-width":"600"},{default:l(()=>[e(p,{onClick:t[1]||(t[1]=o=>b.value=!1)}),e(y,{title:"Export Royalty Data"},{default:l(()=>[e(_,null,{default:l(()=>[e(w,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[e(U,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=o=>C.value=o),items:Z,"item-title":"title","item-value":"value",label:"Export Format",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(bt,{type:"info",variant:"tonal",class:"mt-4"},{default:l(()=>{var o;return[a("div",Lt,[t[25]||(t[25]=a("strong",null,"Current Selection:",-1)),t[26]||(t[26]=a("br",null,null,-1)),d(" Period: "+i(f.value.charAt(0).toUpperCase()+f.value.slice(1)),1),t[27]||(t[27]=a("br",null,null,-1)),d(" Data Type: "+i((o=tt.find(V=>V.value===E.value))==null?void 0:o.title),1),t[28]||(t[28]=a("br",null,null,-1)),d(" Format: "+i(C.value.toUpperCase()),1)])]}),_:1})]),_:1}),e(_,{class:"d-flex align-center justify-center gap-4"},{default:l(()=>[e(c,{color:"error",variant:"outlined",onClick:t[3]||(t[3]=o=>b.value=!1)},{default:l(()=>t[29]||(t[29]=[d(" Cancel ")])),_:1,__:[29]}),e(c,{color:"primary",variant:"elevated",onClick:ot},{default:l(()=>t[30]||(t[30]=[d(" Export Data ")])),_:1,__:[30]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(A,{modelValue:g.value,"onUpdate:modelValue":t[10]||(t[10]=o=>g.value=o),"max-width":"600"},{default:l(()=>[e(p,{onClick:t[5]||(t[5]=o=>g.value=!1)}),e(y,{title:"Mark Royalty as Completed"},{default:l(()=>[e(_,null,{default:l(()=>[e(gt,{onSubmit:pt(j,["prevent"])},{default:l(()=>[e(w,null,{default:l(()=>[e(n,{cols:"12",md:"6"},{default:l(()=>[e(Y,{modelValue:m.value.amount_paid,"onUpdate:modelValue":t[6]||(t[6]=o=>m.value.amount_paid=o),modelModifiers:{number:!0},label:"Amount Paid (SAR)",type:"number",variant:"outlined",density:"compact",rules:[o=>!!o||"Amount is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[e(Y,{modelValue:m.value.payment_date,"onUpdate:modelValue":t[7]||(t[7]=o=>m.value.payment_date=o),label:"Payment Date",type:"date",variant:"outlined",density:"compact",rules:[o=>!!o||"Payment date is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(U,{modelValue:m.value.payment_type,"onUpdate:modelValue":t[8]||(t[8]=o=>m.value.payment_type=o),items:et,"item-title":"title","item-value":"value",label:"Payment Type",variant:"outlined",density:"compact",rules:[o=>!!o||"Payment type is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(xt,{label:"Attachment (Optional)",variant:"outlined",density:"compact",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:it}),t[31]||(t[31]=a("div",{class:"text-caption text-medium-emphasis mt-1"}," Supported formats: PDF, JPG, PNG, DOC, DOCX ",-1))]),_:1,__:[31]})]),_:1})]),_:1})]),_:1}),e(_,{class:"d-flex align-center justify-end gap-4"},{default:l(()=>[e(c,{color:"error",variant:"outlined",onClick:t[9]||(t[9]=o=>g.value=!1)},{default:l(()=>t[32]||(t[32]=[d(" Cancel ")])),_:1,__:[32]}),e(c,{color:"success",variant:"elevated",onClick:j},{default:l(()=>t[33]||(t[33]=[d(" Mark as Completed ")])),_:1,__:[33]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(A,{modelValue:x.value,"onUpdate:modelValue":t[14]||(t[14]=o=>x.value=o),"max-width":"600"},{default:l(()=>[e(p,{onClick:t[11]||(t[11]=o=>x.value=!1)}),r.value?(S(),T(y,{key:0,title:"Royalty Details"},{default:l(()=>[e(_,null,{default:l(()=>[e(w,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>t[34]||(t[34]=[a("h6",{class:"text-h6 mb-4 text-primary"}," Basic Information ",-1)])),_:1,__:[34]}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",zt,[t[35]||(t[35]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Billing Period ",-1)),a("div",Ot,i(r.value.billing_period),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",Et,[t[36]||(t[36]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Due Date ",-1)),a("div",Mt,i(G(r.value.due_date)),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",$t,[t[37]||(t[37]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Franchisee Name ",-1)),a("div",Bt,i(r.value.franchisee_name),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",Ft,[t[38]||(t[38]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Store Location ",-1)),a("div",jt,i(r.value.store_location),1)])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(D,{class:"my-4"}),t[39]||(t[39]=a("h6",{class:"text-h6 mb-4 text-primary"}," Financial Details ",-1))]),_:1,__:[39]}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(y,{variant:"tonal",color:"info",class:"pa-4"},{default:l(()=>{var o;return[a("div",It,[e(v,{icon:"tabler-chart-line",size:"32",class:"mb-2"}),t[40]||(t[40]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Gross Sales ",-1)),a("div",Gt,i((((o=r.value)==null?void 0:o.gross_sales)||0).toLocaleString())+" SAR ",1)])]}),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(y,{variant:"tonal",color:"primary",class:"pa-4"},{default:l(()=>[a("div",Nt,[e(v,{icon:"tabler-percentage",size:"32",class:"mb-2"}),t[41]||(t[41]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Rate ",-1)),a("div",qt,i(r.value.royalty_percentage)+"% ",1)])]),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(y,{variant:"tonal",color:"success",class:"pa-4"},{default:l(()=>{var o;return[a("div",Ht,[e(v,{icon:"tabler-coins",size:"32",class:"mb-2"}),t[42]||(t[42]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Amount ",-1)),a("div",Jt,i((((o=r.value)==null?void 0:o.amount)||0).toLocaleString())+" SAR ",1)])]}),_:1})]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(D,{class:"my-4"}),t[43]||(t[43]=a("h6",{class:"text-h6 mb-4 text-primary"}," Status Information ",-1))]),_:1,__:[43]}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",Xt,[t[44]||(t[44]=a("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Payment Status ",-1)),e(L,{color:I(r.value.status),size:"large",variant:"tonal",class:"text-capitalize"},{default:l(()=>[e(v,{icon:r.value.status==="paid"?"tabler-check":r.value.status==="pending"?"tabler-clock":"tabler-alert-triangle",class:"me-2"},null,8,["icon"]),d(" "+i(r.value.status),1)]),_:1},8,["color"])])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",Yt,[t[45]||(t[45]=a("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Days Until Due ",-1)),a("div",Kt,i(Math.ceil((new Date(r.value.due_date).getTime()-new Date().getTime())/(1e3*60*60*24)))+" days ",1)])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(D,{class:"my-4"}),t[46]||(t[46]=a("h6",{class:"text-h6 mb-4 text-primary"}," Calculation Breakdown ",-1))]),_:1,__:[46]}),e(n,{cols:"12"},{default:l(()=>[e(Vt,{density:"compact"},{default:l(()=>{var o,V,N,q;return[a("tbody",null,[a("tr",null,[t[47]||(t[47]=a("td",{class:"font-weight-medium"}," Gross Sales: ",-1)),a("td",Qt,i((((o=r.value)==null?void 0:o.gross_sales)||0).toLocaleString())+" SAR ",1)]),a("tr",null,[t[48]||(t[48]=a("td",{class:"font-weight-medium"}," Royalty Rate: ",-1)),a("td",Wt,i(r.value.royalty_percentage)+"% ",1)]),a("tr",null,[t[49]||(t[49]=a("td",{class:"font-weight-medium"}," Calculation: ",-1)),a("td",Zt,i((((V=r.value)==null?void 0:V.gross_sales)||0).toLocaleString())+" × "+i(((N=r.value)==null?void 0:N.royalty_percentage)||0)+"% ",1)]),a("tr",te,[t[50]||(t[50]=a("td",{class:"font-weight-bold text-primary"}," Total Royalty Amount: ",-1)),a("td",ee,i((((q=r.value)==null?void 0:q.amount)||0).toLocaleString())+" SAR ",1)])])]}),_:1})]),_:1})]),_:1})]),_:1}),e(_,{class:"d-flex align-center justify-end gap-4 pt-4"},{default:l(()=>[e(c,{color:"primary",variant:"outlined",onClick:t[12]||(t[12]=o=>x.value=!1)},{default:l(()=>t[51]||(t[51]=[d(" Close ")])),_:1,__:[51]}),r.value.status!=="paid"?(S(),T(c,{key:0,color:"success",variant:"elevated",onClick:t[13]||(t[13]=o=>{F(r.value),x.value=!1})},{default:l(()=>[e(v,{icon:"tabler-check",class:"me-2"}),t[52]||(t[52]=d(" Mark as Completed "))]),_:1,__:[52]})):P("",!0)]),_:1})]),_:1})):P("",!0)]),_:1},8,["modelValue"])])}}});export{Oe as default};
