import{V as Le,_ as xe}from"./VDataTableServer-COePLmJb.js";import{_ as se}from"./AppTextField.vue_vue_type_script_setup_true_lang-DBBt0k22.js";import{_ as oe}from"./AppSelect.vue_vue_type_script_setup_true_lang-BPi_8I55.js";import{_ as he}from"./DeleteLeadDialog.vue_vue_type_script_setup_true_lang-rzVOLfgM.js";import{_ as ie,V as ne}from"./VDialog-DNQTNeT1.js";import{V as I,f as N,h as de,b as Z,a as ye,d as Ce}from"./VCard-D0Kr6jJ3.js";import{V as M,a as b}from"./VRow-I0aFN3ft.js";import{V as re}from"./VChip-B4nRRsDL.js";import{V as q}from"./VSpacer-CqgjN_yM.js";import{d as Q,O as j,a as U,o as w,k as t,y as e,h as G,l as o,t as m,q as x,a7 as $,g as p,w as ue,bb as De,E as ee,aU as we,c as te,F as Se,r as ke,i as r,s as $e,av as R,aM as h}from"./main-CJoUlw71.js";import{V as Ue}from"./VForm-MxPZnCnL.js";import{f as Ee}from"./franchise-CaBrEO2E.js";import{l as le}from"./lead-CW0oUHwc.js";import{V as ae}from"./VDivider-BaGqyL8B.js";import{V as Ae}from"./VMenu-ChdF8Fzb.js";import{V as Te,a as Be,b as Ne}from"./VList-dBGtPQa1.js";import"./VDataTable-bPHraWWW.js";import"./VSelect-DrBKrWpC.js";import"./VTextField-D8E1qX-C.js";import"./VField-BK8GYuQp.js";import"./form-TZVfOcgQ.js";import"./forwardRefs-B931MWyl.js";import"./VInput-ljW8JGQT.js";import"./VOverlay-DNweL6TL.js";import"./scopeId-BW4ci1pC.js";import"./VCheckboxBtn-ClRj4-k1.js";import"./VSelectionControl-DPYfPVD0.js";import"./VTable-Z6ii9VWQ.js";/* empty css              */import"./VSlideGroup-CFd1UCPD.js";import"./api-router-CWf8jKcZ.js";const Pe={class:"mb-4"},ze={class:"text-body-1 font-weight-medium"},Re={class:"mb-4"},Ie={class:"text-body-1"},Me={class:"mb-4"},je={class:"text-body-1"},Fe={class:"mb-4"},Oe={class:"text-body-1 text-capitalize"},We={class:"mb-4"},qe={class:"mb-4"},Qe={class:"text-body-1"},Ge=Q({__name:"ViewLeadDialog",props:{isDialogVisible:{type:Boolean},selectedLead:{}},emits:["update:isDialogVisible","editLead"],setup(P,{emit:S}){const y=P,C=S,V=j({get:()=>y.isDialogVisible,set:d=>C("update:isDialogVisible",d)}),u=d=>{const s=d.toLowerCase();return s==="pending"?"warning":s==="won"?"success":s==="lost"?"error":"primary"},D=()=>{y.selectedLead&&(C("editLead",y.selectedLead),V.value=!1)},L=()=>{V.value=!1};return(d,s)=>{const E=ie;return w(),U(ne,{modelValue:V.value,"onUpdate:modelValue":s[0]||(s[0]=c=>V.value=c),"max-width":"600"},{default:t(()=>[e(E,{onClick:L}),d.selectedLead?(w(),U(I,{key:0,title:"Lead Details"},{default:t(()=>[e(N,null,{default:t(()=>[e(M,null,{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[o("div",Pe,[s[1]||(s[1]=o("div",{class:"text-sm text-disabled mb-1"}," Name ",-1)),o("div",ze,m(d.selectedLead.name),1)])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[o("div",Re,[s[2]||(s[2]=o("div",{class:"text-sm text-disabled mb-1"}," Email ",-1)),o("div",Ie,m(d.selectedLead.email),1)])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[o("div",Me,[s[3]||(s[3]=o("div",{class:"text-sm text-disabled mb-1"}," Phone ",-1)),o("div",je,m(d.selectedLead.phone),1)])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[o("div",Fe,[s[4]||(s[4]=o("div",{class:"text-sm text-disabled mb-1"}," Source ",-1)),o("div",Oe,m(d.selectedLead.source),1)])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[o("div",We,[s[5]||(s[5]=o("div",{class:"text-sm text-disabled mb-1"}," Status ",-1)),e(re,{color:u(d.selectedLead.status),size:"small",label:"",class:"text-capitalize"},{default:t(()=>[x(m(d.selectedLead.status),1)]),_:1},8,["color"])])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[o("div",qe,[s[6]||(s[6]=o("div",{class:"text-sm text-disabled mb-1"}," Created Date ",-1)),o("div",Qe,m(d.selectedLead.createdDate),1)])]),_:1})]),_:1})]),_:1}),e(de,null,{default:t(()=>[e(q),e($,{color:"secondary",variant:"tonal",onClick:L},{default:t(()=>s[7]||(s[7]=[x(" Close ")])),_:1,__:[7]}),e($,{color:"primary",onClick:D},{default:t(()=>s[8]||(s[8]=[x(" Edit ")])),_:1,__:[8]})]),_:1})]),_:1})):G("",!0)]),_:1},8,["modelValue"])}}}),He=Q({__name:"EditLeadDialog",props:{isDialogVisible:{type:Boolean},selectedLead:{},sources:{},statuses:{}},emits:["update:isDialogVisible","saveLead"],setup(P,{emit:S}){const y=P,C=S,V=j({get:()=>y.isDialogVisible,set:d=>C("update:isDialogVisible",d)}),u=p(null);ue(()=>y.selectedLead,d=>{d&&(u.value={...d})},{immediate:!0});const D=()=>{u.value&&(C("saveLead",u.value),V.value=!1)},L=()=>{V.value=!1};return(d,s)=>{const E=ie,c=se,z=oe;return w(),U(ne,{modelValue:V.value,"onUpdate:modelValue":s[6]||(s[6]=_=>V.value=_),"max-width":"600"},{default:t(()=>[e(E,{onClick:L}),u.value?(w(),U(I,{key:0,title:"Edit Lead"},{default:t(()=>[e(N,null,{default:t(()=>[e(Ue,{onSubmit:De(D,["prevent"])},{default:t(()=>[e(M,null,{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(c,{modelValue:u.value.name,"onUpdate:modelValue":s[0]||(s[0]=_=>u.value.name=_),label:"Name",placeholder:"Enter lead name"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(c,{modelValue:u.value.email,"onUpdate:modelValue":s[1]||(s[1]=_=>u.value.email=_),label:"Email",type:"email",placeholder:"Enter email address"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(c,{modelValue:u.value.phone,"onUpdate:modelValue":s[2]||(s[2]=_=>u.value.phone=_),label:"Phone",placeholder:"+966 50 123 4567"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(z,{modelValue:u.value.source,"onUpdate:modelValue":s[3]||(s[3]=_=>u.value.source=_),label:"Source",items:d.sources,placeholder:"Select source"},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(z,{modelValue:u.value.status,"onUpdate:modelValue":s[4]||(s[4]=_=>u.value.status=_),label:"Status",items:d.statuses,placeholder:"Select status"},null,8,["modelValue","items"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(c,{modelValue:u.value.createdDate,"onUpdate:modelValue":s[5]||(s[5]=_=>u.value.createdDate=_),label:"Created Date",type:"date"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(de,null,{default:t(()=>[e(q),e($,{color:"secondary",variant:"tonal",onClick:L},{default:t(()=>s[7]||(s[7]=[x(" Cancel ")])),_:1,__:[7]}),e($,{color:"primary",onClick:D},{default:t(()=>s[8]||(s[8]=[x(" Save Changes ")])),_:1,__:[8]})]),_:1})]),_:1})):G("",!0)]),_:1},8,["modelValue"])}}}),Je={class:"d-flex mb-6"},Ke={class:"d-flex justify-space-between"},Xe={class:"d-flex flex-column gap-y-1"},Ye={class:"text-body-1 text-high-emphasis"},Ze={class:"d-flex gap-x-2 align-center"},et={class:"text-h4"},tt={class:"text-sm"},lt={class:"me-3 d-flex gap-3"},at={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},st={style:{"inline-size":"15.625rem"}},ot={class:"d-flex align-center gap-x-4"},it={class:"d-flex flex-column"},nt={class:"text-base font-weight-medium"},dt={class:"text-body-1"},rt={class:"text-body-1"},ut={class:"text-body-1 text-capitalize"},ct={class:"text-body-1"},Ot=Q({__name:"leads",setup(P){const S=p(null),y=p(!1),C=async()=>{y.value=!0;try{const i=await Ee.getDashboardLeads();S.value=i}catch(i){console.error("Error fetching leads data:",i),S.value=null}finally{y.value=!1}},V=p(""),u=p(),D=p(),L=p(10),d=p(1),s=p(),E=p(),c=p([]),z=i=>{var l,v;s.value=(l=i.sortBy[0])==null?void 0:l.key,E.value=(v=i.sortBy[0])==null?void 0:v.order},_=[{title:"Lead Name",key:"name"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Source",key:"source"},{title:"Status",key:"status"},{title:"Created Date",key:"createdDate"},{title:"Actions",key:"actions",sortable:!1}],k=p({leads:[],totalLeads:0}),H=p([{title:"Total Leads",value:"0",change:0,desc:"All time leads",icon:"tabler-users",iconColor:"primary"},{title:"Closed and Won",value:"0",change:0,desc:"Converted leads",icon:"tabler-trophy",iconColor:"success"},{title:"Closed and Lost",value:"0",change:0,desc:"Lost opportunities",icon:"tabler-x",iconColor:"error"},{title:"Pending Leads",value:"0",change:0,desc:"Active leads",icon:"tabler-clock",iconColor:"warning"}]);ue(S,i=>{var v;const l=i;if(l!=null&&l.success&&(l!=null&&l.data)){const g=l.data;k.value={leads:Array.isArray(g.leads)?g.leads.map(n=>({id:n.id,name:`${n.first_name||""} ${n.last_name||""}`.trim(),email:n.email,phone:n.phone,source:n.lead_source,status:n.status,createdDate:new Date(n.created_at).toLocaleDateString()})):[],totalLeads:((v=g.pagination)==null?void 0:v.total)||(Array.isArray(g.leads)?g.leads.length:0)};const f=g.stats||{total_leads:0,total_leads_change:0,won_leads:0,won_leads_change:0,lost_leads:0,lost_leads_change:0,pending_leads:0,pending_leads_change:0};H.value=[{title:"Total Leads",value:f.total_leads.toLocaleString(),change:f.total_leads_change,desc:"All time leads",icon:"tabler-users",iconColor:"primary"},{title:"Closed and Won",value:f.won_leads.toLocaleString(),change:f.won_leads_change,desc:"Converted leads",icon:"tabler-trophy",iconColor:"success"},{title:"Closed and Lost",value:f.lost_leads.toLocaleString(),change:f.lost_leads_change,desc:"Lost opportunities",icon:"tabler-x",iconColor:"error"},{title:"Pending Leads",value:f.pending_leads.toLocaleString(),change:f.pending_leads_change,desc:"Active leads",icon:"tabler-clock",iconColor:"warning"}]}},{immediate:!0});const F=j(()=>k.value.leads),J=j(()=>k.value.totalLeads);ee(()=>{C()});const K=[{title:"Website",value:"website"},{title:"Referral",value:"referral"},{title:"Social Media",value:"social_media"},{title:"Email Campaign",value:"email"}],X=[{title:"Pending",value:"pending"},{title:"Won",value:"won"},{title:"Lost",value:"lost"}],ce=i=>{const l=i.toLowerCase();return l==="pending"?"warning":l==="won"?"success":l==="lost"?"error":"primary"},O=p(!1),A=p(!1),T=p(!1),B=p(null),W=p(null),me=i=>{B.value={...i},A.value=!0},pe=i=>{W.value=i,T.value=!0},ve=async()=>{if(c.value.length!==0)try{for(const i of c.value)await le.deleteLead(i);c.value.forEach(i=>{const l=k.value.leads.findIndex(v=>v.id===i);l!==-1&&k.value.leads.splice(l,1)}),c.value=[]}catch(i){console.error("Error bulk deleting leads:",i)}},fe=async i=>{const l=i||B.value;if(l){try{const v={firstName:l.name.split(" ")[0]||"",lastName:l.name.split(" ").slice(1).join(" ")||"",email:l.email,phone:l.phone,source:l.source,status:l.status},g=await le.updateLead(l.id,v);if(g.success&&g.data){const f=k.value.leads.findIndex(n=>n.id===l.id);if(f!==-1){const n=g.data;k.value.leads[f]={id:n.id,name:`${n.firstName} ${n.lastName}`.trim(),email:n.email,phone:n.phone,source:n.source,status:n.status,createdDate:l.createdDate}}}}catch(v){console.error("Error updating lead:",v)}A.value=!1,B.value=null}},_e=()=>{const l=["Name,Email,Phone,Source,Status,Created Date",...(c.value.length>0?F.value.filter(n=>c.value.includes(n.id)):F.value).map(n=>`"${n.name}","${n.email}","${n.phone}","${n.source}","${n.status}","${n.createdDate}"`)].join(`
`),v=new Blob([l],{type:"text/csv"}),g=window.URL.createObjectURL(v),f=document.createElement("a");f.href=g,f.download=`leads_${c.value.length>0?"selected":"all"}_${new Date().toISOString().split("T")[0]}.csv`,f.click(),window.URL.revokeObjectURL(g)},ge=i=>i>0?`+${i}`:`${i}`,be=i=>i.split(" ").map(l=>l[0]).join("").toUpperCase(),Ve=async()=>{await C(),T.value=!1,W.value=null};return ee(()=>{C()}),(i,l)=>{const v=oe,g=se,f=we("RouterLink"),n=xe;return w(),te("section",null,[o("div",Je,[e(M,null,{default:t(()=>[(w(!0),te(Se,null,ke(r(H),(a,Y)=>(w(),U(b,{key:Y,cols:"12",md:"3",sm:"6"},{default:t(()=>[e(I,null,{default:t(()=>[e(N,null,{default:t(()=>[o("div",Ke,[o("div",Xe,[o("div",Ye,m(a.title),1),o("div",Ze,[o("h4",et,m(a.value),1),o("div",{class:$e(["text-base",a.change>0?"text-success":"text-error"])}," ("+m(ge(a.change))+"%) ",3)]),o("div",tt,m(a.desc),1)]),e(Z,{color:a.iconColor,variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(R,{icon:a.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),e(I,{class:"mb-6"},{default:t(()=>[e(ye,{class:"pb-4"},{default:t(()=>[e(Ce,null,{default:t(()=>l[11]||(l[11]=[x("Filters")])),_:1,__:[11]})]),_:1}),e(N,null,{default:t(()=>[e(M,null,{default:t(()=>[e(b,{cols:"12",sm:"6"},{default:t(()=>[e(v,{modelValue:r(D),"onUpdate:modelValue":l[0]||(l[0]=a=>h(D)?D.value=a:null),placeholder:"Select Source",items:K,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",sm:"6"},{default:t(()=>[e(v,{modelValue:r(u),"onUpdate:modelValue":l[1]||(l[1]=a=>h(u)?u.value=a:null),placeholder:"Select Status",items:X,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ae),e(N,{class:"d-flex flex-wrap gap-4"},{default:t(()=>[o("div",lt,[e(v,{"model-value":r(L),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":l[2]||(l[2]=a=>L.value=parseInt(String(a),10))},null,8,["model-value"]),r(c).length>0?(w(),U($,{key:0,variant:"tonal",color:"error",onClick:ve},{default:t(()=>[e(R,{icon:"tabler-trash",class:"me-2"}),x(" Delete Selected ("+m(r(c).length)+") ",1)]),_:1})):G("",!0)]),e(q),o("div",at,[o("div",st,[e(g,{modelValue:r(V),"onUpdate:modelValue":l[3]||(l[3]=a=>h(V)?V.value=a:null),placeholder:"Search Lead"},null,8,["modelValue"])]),e($,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload",onClick:_e},{default:t(()=>[x(" Export "+m(r(c).length>0?`(${r(c).length})`:"All"),1)]),_:1})])]),_:1}),e(ae),e(Le,{"items-per-page":r(L),"onUpdate:itemsPerPage":l[5]||(l[5]=a=>h(L)?L.value=a:null),"model-value":r(c),"onUpdate:modelValue":l[6]||(l[6]=a=>h(c)?c.value=a:null),page:r(d),"onUpdate:page":l[7]||(l[7]=a=>h(d)?d.value=a:null),items:r(F),"item-value":"id","items-length":r(J),headers:_,class:"text-no-wrap","show-select":"","onUpdate:options":z},{"item.name":t(({item:a})=>[o("div",ot,[e(Z,{size:"34",variant:"tonal",color:"primary"},{default:t(()=>[o("span",null,m(be(a.name)),1)]),_:2},1024),o("div",it,[o("h6",nt,[e(f,{to:{name:"franchisor-leads-id",params:{id:a.id}},class:"text-link"},{default:t(()=>[x(m(a.name),1)]),_:2},1032,["to"])])])])]),"item.email":t(({item:a})=>[o("div",dt,m(a.email),1)]),"item.phone":t(({item:a})=>[o("div",rt,m(a.phone),1)]),"item.source":t(({item:a})=>[o("div",ut,m(a.source),1)]),"item.status":t(({item:a})=>[e(re,{color:ce(a.status),size:"small",label:"",class:"text-capitalize"},{default:t(()=>[x(m(a.status),1)]),_:2},1032,["color"])]),"item.createdDate":t(({item:a})=>[o("div",ct,m(a.createdDate),1)]),"item.actions":t(({item:a})=>[e($,{icon:"",variant:"text",color:"medium-emphasis"},{default:t(()=>[e(R,{icon:"tabler-dots-vertical"}),e(Ae,{activator:"parent"},{default:t(()=>[e(Te,null,{default:t(()=>[e(Be,{onClick:Y=>pe(a.id)},{prepend:t(()=>[e(R,{icon:"tabler-trash"})]),default:t(()=>[e(Ne,null,{default:t(()=>l[12]||(l[12]=[x("Delete")])),_:1,__:[12]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:t(()=>[e(n,{page:r(d),"onUpdate:page":l[4]||(l[4]=a=>h(d)?d.value=a:null),"items-per-page":r(L),"total-items":r(J)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1}),e(Ge,{"is-dialog-visible":r(O),"onUpdate:isDialogVisible":l[8]||(l[8]=a=>h(O)?O.value=a:null),"selected-lead":r(B),onEditLead:me},null,8,["is-dialog-visible","selected-lead"]),e(He,{"is-dialog-visible":r(A),"onUpdate:isDialogVisible":l[9]||(l[9]=a=>h(A)?A.value=a:null),"selected-lead":r(B),sources:K,statuses:X,onSaveLead:fe},null,8,["is-dialog-visible","selected-lead"]),e(he,{"is-dialog-visible":r(T),"onUpdate:isDialogVisible":l[10]||(l[10]=a=>h(T)?T.value=a:null),"lead-id":r(W),onLeadDeleted:Ve},null,8,["is-dialog-visible","lead-id"])])}}});export{Ot as default};
