import{V as ge,_ as be}from"./VDataTableServer-CCw8wB-D.js";import{_ as le}from"./AppTextField.vue_vue_type_script_setup_true_lang-DSmTBduk.js";import{_ as ae}from"./AppSelect.vue_vue_type_script_setup_true_lang-B5FICR3b.js";import{_ as Ve}from"./DeleteLeadDialog.vue_vue_type_script_setup_true_lang-ixBhJX-s.js";import{V as se,_ as oe}from"./VDialog-6C-NQXCx.js";import{V as F,d as ie,a as xe,b as Le}from"./VCard-DJ82mpnW.js";import{V as I,a as f}from"./VRow-DiX7eN30.js";import{V as de}from"./VChip-DlNApjyg.js";import{V as P}from"./VCardText-BD5AHO-w.js";import{V as G}from"./VSpacer-Cpeayo2U.js";import{d as Q,P as M,g as k,f as t,b as e,l as q,e as o,v as c,t as L,a9 as w,o as D,r as p,w as ne,b3 as Ce,G as ye,c as Z,m as d,aR as C,a as he,F as De,i as we,x as Se,ax as N}from"./main-gemCwVks.js";import{V as ke}from"./VForm-FUZpY-zG.js";import{u as $e}from"./useApi-D_y4oFWX.js";import{V as ee}from"./VAvatar-12xz6mHy.js";import{V as te}from"./VDivider-B4ry9pxl.js";import{V as Ue}from"./VMenu-CeaiRCNz.js";import{V as Ae,a as Ee,b as Te}from"./VList-MyW-iB3v.js";import"./VDataTable-C-SlKz4P.js";import"./VSelect-C9dxRhag.js";import"./VTextField-BhxF6EAD.js";import"./VImg-DSB6m92Q.js";import"./VField-CsHfcJSz.js";import"./form-DjHlhIbZ.js";import"./forwardRefs--KQCZfKO.js";import"./VInput-B3GinL-f.js";import"./dialog-transition-C9rYmnXC.js";import"./VOverlay-p8m6-W96.js";import"./scopeId-BgtgI3QF.js";import"./VCheckboxBtn-ZAK0D-Rf.js";import"./VSelectionControl-COVpGwiX.js";import"./VTable-0Z68chLt.js";import"./lead-DnsW79oj.js";/* empty css              */import"./VSlideGroup-CEWgOBQJ.js";const Be={class:"mb-4"},Pe={class:"text-body-1 font-weight-medium"},ze={class:"mb-4"},Re={class:"text-body-1"},Ne={class:"mb-4"},Fe={class:"text-body-1"},Ie={class:"mb-4"},Me={class:"text-body-1 text-capitalize"},je={class:"mb-4"},We={class:"mb-4"},Oe={class:"text-body-1"},Ge=Q({__name:"ViewLeadDialog",props:{isDialogVisible:{type:Boolean},selectedLead:{}},emits:["update:isDialogVisible","editLead"],setup(z,{emit:$}){const y=z,S=$,b=M({get:()=>y.isDialogVisible,set:i=>S("update:isDialogVisible",i)}),n=i=>{const s=i.toLowerCase();return s==="pending"?"warning":s==="won"?"success":s==="lost"?"error":"primary"},h=()=>{y.selectedLead&&(S("editLead",y.selectedLead),b.value=!1)},x=()=>{b.value=!1};return(i,s)=>{const U=oe;return D(),k(se,{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=m=>b.value=m),"max-width":"600"},{default:t(()=>[e(U,{onClick:x}),i.selectedLead?(D(),k(F,{key:0,title:"Lead Details"},{default:t(()=>[e(P,null,{default:t(()=>[e(I,null,{default:t(()=>[e(f,{cols:"12",md:"6"},{default:t(()=>[o("div",Be,[s[1]||(s[1]=o("div",{class:"text-sm text-disabled mb-1"}," Name ",-1)),o("div",Pe,c(i.selectedLead.name),1)])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[o("div",ze,[s[2]||(s[2]=o("div",{class:"text-sm text-disabled mb-1"}," Email ",-1)),o("div",Re,c(i.selectedLead.email),1)])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[o("div",Ne,[s[3]||(s[3]=o("div",{class:"text-sm text-disabled mb-1"}," Phone ",-1)),o("div",Fe,c(i.selectedLead.phone),1)])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[o("div",Ie,[s[4]||(s[4]=o("div",{class:"text-sm text-disabled mb-1"}," Source ",-1)),o("div",Me,c(i.selectedLead.source),1)])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[o("div",je,[s[5]||(s[5]=o("div",{class:"text-sm text-disabled mb-1"}," Status ",-1)),e(de,{color:n(i.selectedLead.status),size:"small",label:"",class:"text-capitalize"},{default:t(()=>[L(c(i.selectedLead.status),1)]),_:1},8,["color"])])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[o("div",We,[s[6]||(s[6]=o("div",{class:"text-sm text-disabled mb-1"}," Created Date ",-1)),o("div",Oe,c(i.selectedLead.createdDate),1)])]),_:1})]),_:1})]),_:1}),e(ie,null,{default:t(()=>[e(G),e(w,{color:"secondary",variant:"tonal",onClick:x},{default:t(()=>s[7]||(s[7]=[L(" Close ")])),_:1,__:[7]}),e(w,{color:"primary",onClick:h},{default:t(()=>s[8]||(s[8]=[L(" Edit ")])),_:1,__:[8]})]),_:1})]),_:1})):q("",!0)]),_:1},8,["modelValue"])}}}),Qe=Q({__name:"EditLeadDialog",props:{isDialogVisible:{type:Boolean},selectedLead:{},sources:{},statuses:{}},emits:["update:isDialogVisible","saveLead"],setup(z,{emit:$}){const y=z,S=$,b=M({get:()=>y.isDialogVisible,set:i=>S("update:isDialogVisible",i)}),n=p(null);ne(()=>y.selectedLead,i=>{i&&(n.value={...i})},{immediate:!0});const h=()=>{n.value&&(S("saveLead",n.value),b.value=!1)},x=()=>{b.value=!1};return(i,s)=>{const U=oe,m=le,R=ae;return D(),k(se,{modelValue:b.value,"onUpdate:modelValue":s[6]||(s[6]=v=>b.value=v),"max-width":"600"},{default:t(()=>[e(U,{onClick:x}),n.value?(D(),k(F,{key:0,title:"Edit Lead"},{default:t(()=>[e(P,null,{default:t(()=>[e(ke,{onSubmit:Ce(h,["prevent"])},{default:t(()=>[e(I,null,{default:t(()=>[e(f,{cols:"12",md:"6"},{default:t(()=>[e(m,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=v=>n.value.name=v),label:"Name",placeholder:"Enter lead name"},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(m,{modelValue:n.value.email,"onUpdate:modelValue":s[1]||(s[1]=v=>n.value.email=v),label:"Email",type:"email",placeholder:"Enter email address"},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(m,{modelValue:n.value.phone,"onUpdate:modelValue":s[2]||(s[2]=v=>n.value.phone=v),label:"Phone",placeholder:"+966 50 123 4567"},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(R,{modelValue:n.value.source,"onUpdate:modelValue":s[3]||(s[3]=v=>n.value.source=v),label:"Source",items:i.sources,placeholder:"Select source"},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(R,{modelValue:n.value.status,"onUpdate:modelValue":s[4]||(s[4]=v=>n.value.status=v),label:"Status",items:i.statuses,placeholder:"Select status"},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12",md:"6"},{default:t(()=>[e(m,{modelValue:n.value.createdDate,"onUpdate:modelValue":s[5]||(s[5]=v=>n.value.createdDate=v),label:"Created Date",type:"date"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ie,null,{default:t(()=>[e(G),e(w,{color:"secondary",variant:"tonal",onClick:x},{default:t(()=>s[7]||(s[7]=[L(" Cancel ")])),_:1,__:[7]}),e(w,{color:"primary",onClick:h},{default:t(()=>s[8]||(s[8]=[L(" Save Changes ")])),_:1,__:[8]})]),_:1})]),_:1})):q("",!0)]),_:1},8,["modelValue"])}}}),qe={class:"d-flex mb-6"},He={class:"d-flex justify-space-between"},Je={class:"d-flex flex-column gap-y-1"},Ke={class:"text-body-1 text-high-emphasis"},Xe={class:"d-flex gap-x-2 align-center"},Ye={class:"text-h4"},Ze={class:"text-sm"},et={class:"me-3 d-flex gap-3"},tt={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},lt={style:{"inline-size":"15.625rem"}},at={class:"d-flex align-center gap-x-4"},st={class:"d-flex flex-column"},ot={class:"text-base font-weight-medium"},it={class:"text-body-1"},dt={class:"text-body-1"},nt={class:"text-body-1 text-capitalize"},rt={class:"text-body-1"},Ot=Q({__name:"leads",setup(z){const{data:$,execute:y,isFetching:S}=$e("/v1/franchisor/dashboard/leads"),b=p(""),n=p(),h=p(),x=p(10),i=p(1),s=p(),U=p(),m=p([]),R=r=>{var l,_;s.value=(l=r.sortBy[0])==null?void 0:l.key,U.value=(_=r.sortBy[0])==null?void 0:_.order},v=[{title:"Lead Name",key:"name"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Source",key:"source"},{title:"Status",key:"status"},{title:"Created Date",key:"createdDate"},{title:"Actions",key:"actions",sortable:!1}],A=p({leads:[],totalLeads:0}),H=p([{title:"Total Leads",value:"0",change:0,desc:"All time leads",icon:"tabler-users",iconColor:"primary"},{title:"Closed and Won",value:"0",change:0,desc:"Converted leads",icon:"tabler-trophy",iconColor:"success"},{title:"Closed and Lost",value:"0",change:0,desc:"Lost opportunities",icon:"tabler-x",iconColor:"error"},{title:"Pending Leads",value:"0",change:0,desc:"Active leads",icon:"tabler-clock",iconColor:"warning"}]);ne($,r=>{var _;const l=r;if(l!=null&&l.success&&(l!=null&&l.data)){const V=l.data;A.value={leads:Array.isArray(V.leads)?V.leads.map(u=>({id:u.id,name:`${u.first_name||""} ${u.last_name||""}`.trim(),email:u.email,phone:u.phone,source:u.lead_source,status:u.status,createdDate:new Date(u.created_at).toLocaleDateString()})):[],totalLeads:((_=V.pagination)==null?void 0:_.total)||(Array.isArray(V.leads)?V.leads.length:0)};const g=V.stats||{total_leads:0,total_leads_change:0,won_leads:0,won_leads_change:0,lost_leads:0,lost_leads_change:0,pending_leads:0,pending_leads_change:0};H.value=[{title:"Total Leads",value:g.total_leads.toLocaleString(),change:g.total_leads_change,desc:"All time leads",icon:"tabler-users",iconColor:"primary"},{title:"Closed and Won",value:g.won_leads.toLocaleString(),change:g.won_leads_change,desc:"Converted leads",icon:"tabler-trophy",iconColor:"success"},{title:"Closed and Lost",value:g.lost_leads.toLocaleString(),change:g.lost_leads_change,desc:"Lost opportunities",icon:"tabler-x",iconColor:"error"},{title:"Pending Leads",value:g.pending_leads.toLocaleString(),change:g.pending_leads_change,desc:"Active leads",icon:"tabler-clock",iconColor:"warning"}]}},{immediate:!0});const j=M(()=>A.value.leads),J=M(()=>A.value.totalLeads);ye(()=>{y()});const K=[{title:"Website",value:"website"},{title:"Referral",value:"referral"},{title:"Social Media",value:"social_media"},{title:"Email Campaign",value:"email"}],X=[{title:"Pending",value:"pending"},{title:"Won",value:"won"},{title:"Lost",value:"lost"}],re=r=>{const l=r.toLowerCase();return l==="pending"?"warning":l==="won"?"success":l==="lost"?"error":"primary"},W=p(!1),E=p(!1),T=p(!1),B=p(null),O=p(null),ue=r=>{B.value={...r},E.value=!0},ce=r=>{O.value=r,T.value=!0},me=async r=>{const l=r||B.value;if(!l)return;const _=A.value.leads.findIndex(V=>V.id===l.id);_!==-1&&(A.value.leads[_]={...l}),E.value=!1,B.value=null},pe=()=>{const l=["Name,Email,Phone,Source,Status,Created Date",...(m.value.length>0?j.value.filter(u=>m.value.includes(u.id)):j.value).map(u=>`"${u.name}","${u.email}","${u.phone}","${u.source}","${u.status}","${u.createdDate}"`)].join(`
`),_=new Blob([l],{type:"text/csv"}),V=window.URL.createObjectURL(_),g=document.createElement("a");g.href=V,g.download=`leads_${m.value.length>0?"selected":"all"}_${new Date().toISOString().split("T")[0]}.csv`,g.click(),window.URL.revokeObjectURL(V)},ve=r=>r>0?`+${r}`:`${r}`,fe=r=>r.split(" ").map(l=>l[0]).join("").toUpperCase(),_e=async()=>{await y(),T.value=!1,O.value=null};return(r,l)=>{const _=ae,V=le,g=he("RouterLink"),u=be;return D(),Z("section",null,[o("div",qe,[e(I,null,{default:t(()=>[(D(!0),Z(De,null,we(d(H),(a,Y)=>(D(),k(f,{key:Y,cols:"12",md:"3",sm:"6"},{default:t(()=>[e(F,null,{default:t(()=>[e(P,null,{default:t(()=>[o("div",He,[o("div",Je,[o("div",Ke,c(a.title),1),o("div",Xe,[o("h4",Ye,c(a.value),1),o("div",{class:Se(["text-base",a.change>0?"text-success":"text-error"])}," ("+c(ve(a.change))+"%) ",3)]),o("div",Ze,c(a.desc),1)]),e(ee,{color:a.iconColor,variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(N,{icon:a.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),e(F,{class:"mb-6"},{default:t(()=>[e(xe,{class:"pb-4"},{default:t(()=>[e(Le,null,{default:t(()=>l[11]||(l[11]=[L("Filters")])),_:1,__:[11]})]),_:1}),e(P,null,{default:t(()=>[e(I,null,{default:t(()=>[e(f,{cols:"12",sm:"6"},{default:t(()=>[e(_,{modelValue:d(h),"onUpdate:modelValue":l[0]||(l[0]=a=>C(h)?h.value=a:null),placeholder:"Select Source",items:K,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",sm:"6"},{default:t(()=>[e(_,{modelValue:d(n),"onUpdate:modelValue":l[1]||(l[1]=a=>C(n)?n.value=a:null),placeholder:"Select Status",items:X,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(te),e(P,{class:"d-flex flex-wrap gap-4"},{default:t(()=>[o("div",et,[e(_,{"model-value":d(x),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":l[2]||(l[2]=a=>x.value=parseInt(String(a),10))},null,8,["model-value"]),d(m).length>0?(D(),k(w,{key:0,variant:"tonal",color:"error",onClick:r.bulkDelete},{default:t(()=>[e(N,{icon:"tabler-trash",class:"me-2"}),L(" Delete Selected ("+c(d(m).length)+") ",1)]),_:1},8,["onClick"])):q("",!0)]),e(G),o("div",tt,[o("div",lt,[e(V,{modelValue:d(b),"onUpdate:modelValue":l[3]||(l[3]=a=>C(b)?b.value=a:null),placeholder:"Search Lead"},null,8,["modelValue"])]),e(w,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload",onClick:pe},{default:t(()=>[L(" Export "+c(d(m).length>0?`(${d(m).length})`:"All"),1)]),_:1})])]),_:1}),e(te),e(ge,{"items-per-page":d(x),"onUpdate:itemsPerPage":l[5]||(l[5]=a=>C(x)?x.value=a:null),"model-value":d(m),"onUpdate:modelValue":l[6]||(l[6]=a=>C(m)?m.value=a:null),page:d(i),"onUpdate:page":l[7]||(l[7]=a=>C(i)?i.value=a:null),items:d(j),"item-value":"id","items-length":d(J),headers:v,class:"text-no-wrap","show-select":"","onUpdate:options":R},{"item.name":t(({item:a})=>[o("div",at,[e(ee,{size:"34",variant:"tonal",color:"primary"},{default:t(()=>[o("span",null,c(fe(a.name)),1)]),_:2},1024),o("div",st,[o("h6",ot,[e(g,{to:{name:"franchisor-leads-id",params:{id:a.id}},class:"text-link"},{default:t(()=>[L(c(a.name),1)]),_:2},1032,["to"])])])])]),"item.email":t(({item:a})=>[o("div",it,c(a.email),1)]),"item.phone":t(({item:a})=>[o("div",dt,c(a.phone),1)]),"item.source":t(({item:a})=>[o("div",nt,c(a.source),1)]),"item.status":t(({item:a})=>[e(de,{color:re(a.status),size:"small",label:"",class:"text-capitalize"},{default:t(()=>[L(c(a.status),1)]),_:2},1032,["color"])]),"item.createdDate":t(({item:a})=>[o("div",rt,c(a.createdDate),1)]),"item.actions":t(({item:a})=>[e(w,{icon:"",variant:"text",color:"medium-emphasis"},{default:t(()=>[e(N,{icon:"tabler-dots-vertical"}),e(Ue,{activator:"parent"},{default:t(()=>[e(Ae,null,{default:t(()=>[e(Ee,{onClick:Y=>ce(a.id)},{prepend:t(()=>[e(N,{icon:"tabler-trash"})]),default:t(()=>[e(Te,null,{default:t(()=>l[12]||(l[12]=[L("Delete")])),_:1,__:[12]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:t(()=>[e(u,{page:d(i),"onUpdate:page":l[4]||(l[4]=a=>C(i)?i.value=a:null),"items-per-page":d(x),"total-items":d(J)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1}),e(Ge,{"is-dialog-visible":d(W),"onUpdate:isDialogVisible":l[8]||(l[8]=a=>C(W)?W.value=a:null),"selected-lead":d(B),onEditLead:ue},null,8,["is-dialog-visible","selected-lead"]),e(Qe,{"is-dialog-visible":d(E),"onUpdate:isDialogVisible":l[9]||(l[9]=a=>C(E)?E.value=a:null),"selected-lead":d(B),sources:K,statuses:X,onSaveLead:me},null,8,["is-dialog-visible","selected-lead"]),e(Ve,{"is-dialog-visible":d(T),"onUpdate:isDialogVisible":l[10]||(l[10]=a=>C(T)?T.value=a:null),"lead-id":d(O),onLeadDeleted:_e},null,8,["is-dialog-visible","lead-id"])])}}});export{Ot as default};
