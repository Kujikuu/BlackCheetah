import{r as v,aN as D,aO as w,d as O,P,w as h,g as q,f as r,b as e,t as C,aM as x,m as t,au as I,a3 as A,o as _}from"./main-45BFB2jp.js";import{V as N}from"./VDialog-BZIWHDEG.js";import{b as E,d as M,V as R}from"./VCard-COfvtJ32.js";import{V as F}from"./VDivider-NExkuXUC.js";import{V as B}from"./VCardText-Vvg7knIC.js";import{V as $}from"./VForm--QCb8Zkn.js";import{V as z,a as c}from"./VRow-CtphHea4.js";import{V as b}from"./VTextField-DJAsS4Xq.js";import{V as K}from"./VTextarea-BTQOz3vp.js";import{V as U}from"./VSelect-D74GJW4T.js";import{V as L}from"./VSpacer-BAhzcD_4.js";const G=()=>{const p=v([]),f=v([]),n=v(!1),V=v(null),T=async()=>{var u,o;try{n.value=!0,V.value=null;const s=await w("/v1/franchisor/franchisees");s.success&&((u=s.data)!=null&&u.data)?p.value=s.data.data.map(m=>({id:m.id,name:m.name,email:m.email,role:"franchisee",status:m.status})):p.value=[]}catch(s){console.error("Failed to fetch franchisees:",s),V.value=((o=s==null?void 0:s.data)==null?void 0:o.message)||"Failed to fetch franchisees",p.value=[]}finally{n.value=!1}},y=async()=>{var u;try{n.value=!0,V.value=null;const o=await w("/v1/franchisor/sales-associates");o.success&&o.data?f.value=o.data.map(s=>({id:s.id,name:s.name,email:s.email,role:"sales",status:s.status})):f.value=[]}catch(o){console.error("Failed to fetch sales users:",o),V.value=((u=o==null?void 0:o.data)==null?void 0:u.message)||"Failed to fetch sales users",f.value=[]}finally{n.value=!1}},S=u=>(u==="franchisee"?p.value:f.value).filter(s=>s.status==="active").map(s=>({title:`${s.name} (${s.email})`,value:s.id,subtitle:s.role})),l=(u,o)=>{const m=(o==="franchisee"?p.value:f.value).find(k=>k.id===u);return m?m.name:"Unknown User"},g=async(u="both")=>{(u==="franchisee"||u==="both")&&await T(),(u==="sales"||u==="both")&&await y()};return{franchisees:D(p),salesUsers:D(f),loading:D(n),error:D(V),fetchFranchisees:T,fetchSalesUsers:y,getUsersForSelect:S,getUserNameById:l,initializeUsers:g}},Y=["Onboarding","Training","Compliance","Maintenance","Marketing","Operations","Finance","Support","Other"],j=[{title:"Low",value:"low"},{title:"Medium",value:"medium"},{title:"High",value:"high"},{title:"Urgent",value:"urgent"}],J=[{title:"Pending",value:"pending"},{title:"On Hold",value:"on_hold"},{title:"Cancelled",value:"cancelled"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],re=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Assigned To",key:"assignedTo"},{title:"Unit",key:"unitName"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],ue=O({__name:"CreateTaskModal",props:{isDialogVisible:{type:Boolean},currentTab:{},defaultAssignedTo:{},unitId:{},disableAssignedTo:{type:Boolean}},emits:["update:isDialogVisible","taskCreated"],setup(p,{emit:f}){const n=p,V=f,{getUsersForSelect:T,initializeUsers:y,loading:S}=G(),l=v({title:"",description:"",category:"",assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}),g=v(!1),u=P(()=>{const d=n.currentTab||"franchisee";return T(d)}),o=d=>!!d||"This field is required",s=d=>{V("update:isDialogVisible",d)},m=()=>{l.value={title:"",description:"",category:"",assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}},k=()=>{if(g.value){const d={id:Date.now(),...l.value};V("taskCreated",d),m(),s(!1)}},H=()=>{m(),s(!1)};return h(()=>n.isDialogVisible,async d=>{if(d){const a=n.currentTab||"franchisee";await y(a),n.defaultAssignedTo&&(l.value.assignedTo=n.defaultAssignedTo)}else m()}),h(()=>n.currentTab,async d=>{n.isDialogVisible&&d&&(await y(d),l.value.assignedTo="")}),(d,a)=>(_(),q(N,{"model-value":n.isDialogVisible,"max-width":"600",persistent:"","onUpdate:modelValue":s},{default:r(()=>[e(R,null,{default:r(()=>[e(E,{class:"text-h5 pa-6 pb-4"},{default:r(()=>a[11]||(a[11]=[C(" Create New Task ")])),_:1,__:[11]}),e(F),e(B,{class:"pa-6"},{default:r(()=>[e($,{modelValue:t(g),"onUpdate:modelValue":a[10]||(a[10]=i=>I(g)?g.value=i:null),onSubmit:x(k,["prevent"])},{default:r(()=>[e(z,null,{default:r(()=>[e(c,{cols:"12"},{default:r(()=>[e(b,{modelValue:t(l).title,"onUpdate:modelValue":a[0]||(a[0]=i=>t(l).title=i),label:"Task Title",placeholder:"Enter task title",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12"},{default:r(()=>[e(K,{modelValue:t(l).description,"onUpdate:modelValue":a[1]||(a[1]=i=>t(l).description=i),label:"Description",placeholder:"Enter task description",rows:"3",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(U,{modelValue:t(l).category,"onUpdate:modelValue":a[2]||(a[2]=i=>t(l).category=i),label:"Category",placeholder:"Select category",items:t(Y),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(U,{modelValue:t(l).assignedTo,"onUpdate:modelValue":a[3]||(a[3]=i=>t(l).assignedTo=i),label:"Assigned To",placeholder:"Select user",items:t(u),loading:t(S),rules:[o],"item-title":"title","item-value":"value",disabled:n.disableAssignedTo,required:""},null,8,["modelValue","items","loading","rules","disabled"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(b,{modelValue:t(l).startDate,"onUpdate:modelValue":a[4]||(a[4]=i=>t(l).startDate=i),label:"Start Date",type:"date",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(b,{modelValue:t(l).dueDate,"onUpdate:modelValue":a[5]||(a[5]=i=>t(l).dueDate=i),label:"Due Date",type:"date",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(U,{modelValue:t(l).priority,"onUpdate:modelValue":a[6]||(a[6]=i=>t(l).priority=i),label:"Priority",placeholder:"Select priority",items:t(j),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(U,{modelValue:t(l).status,"onUpdate:modelValue":a[7]||(a[7]=i=>t(l).status=i),label:"Status",placeholder:"Select status",items:t(J),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(b,{modelValue:t(l).estimatedHours,"onUpdate:modelValue":a[8]||(a[8]=i=>t(l).estimatedHours=i),label:"Estimated Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(b,{modelValue:t(l).actualHours,"onUpdate:modelValue":a[9]||(a[9]=i=>t(l).actualHours=i),label:"Actual Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(F),e(M,{class:"pa-6"},{default:r(()=>[e(L),e(A,{color:"error",variant:"text",onClick:H},{default:r(()=>a[12]||(a[12]=[C(" Cancel ")])),_:1,__:[12]}),e(A,{color:"primary",disabled:!t(g),onClick:k},{default:r(()=>a[13]||(a[13]=[C(" Create Task ")])),_:1,__:[13]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}});export{j as P,J as S,re as T,ue as _,Y as a,G as u};
