import{V as I,_ as me}from"./VDialog-CEq2jzbd.js";import{V as ce,_ as pe}from"./VDataTableServer-2Q8oqYfo.js";import{_ as ve}from"./AppTextField.vue_vue_type_script_setup_true_lang-Dp8jGCw7.js";import{_ as fe}from"./AppSelect.vue_vue_type_script_setup_true_lang-DOrgpFkU.js";import{d as _e,r as c,w as ge,P as H,G as be,c as J,e as o,b as t,f as l,aR as g,m as s,a as xe,o as w,F as Ve,i as Ce,g as $,v as r,x as ye,ax as U,t as f,l as N,a9 as b,b3 as Le}from"./main-B8QbR-yS.js";import{u as we}from"./useApi-CCD9E6_s.js";import{V as A,a as p}from"./VRow-LlT6Azsr.js";import{V as D,a as ke,b as he,d as F}from"./VCard-D9PhtsJ0.js";import{V as k}from"./VCardText-Cbtr6Qhr.js";import{V as K}from"./VAvatar-87LH5tAk.js";import{V as X}from"./VDivider-DOfIMbJY.js";import{V as E}from"./VSpacer-BSXBFFTK.js";import{V as Se}from"./VMenu-TQcmpCCv.js";import{V as De,a as $e,b as Ue}from"./VList-BJCgULVd.js";import{V as Y}from"./VChip-CgHwmC-k.js";import{V as Ae}from"./VForm-C9sxpau4.js";import"./VOverlay-B3La6Ajr.js";import"./forwardRefs--KQCZfKO.js";import"./scopeId-DyQ6a1uN.js";import"./VImg-Ceu2Mboj.js";import"./dialog-transition-Dy2Gj1XO.js";import"./VDataTable-FYAU2aQJ.js";import"./VSelect-GSzN3Qps.js";import"./VTextField-C7_y5spr.js";import"./VField-Bw51LFql.js";import"./form-Dt-W1fp6.js";import"./VInput-DB3XZUVb.js";import"./VCheckboxBtn-CWPoGbRz.js";import"./VSelectionControl-DDEVNAf7.js";import"./VTable-CgkStP3y.js";/* empty css              */import"./VSlideGroup-BuNiGLv2.js";const Ee={class:"d-flex mb-6"},Te={class:"d-flex justify-space-between"},Pe={class:"d-flex flex-column gap-y-1"},ze={class:"text-body-1 text-high-emphasis"},Be={class:"d-flex gap-x-2 align-center"},Re={class:"text-h4"},Ie={class:"text-sm"},Ne={class:"me-3 d-flex gap-3"},Fe={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Me={style:{"inline-size":"15.625rem"}},je={class:"d-flex align-center gap-x-4"},We={class:"d-flex flex-column"},Oe={class:"text-base font-weight-medium"},Ge={class:"text-body-1"},Qe={class:"text-body-1"},qe={class:"text-body-1 text-capitalize"},He={class:"text-body-1"},Je={class:"mb-4"},Ke={class:"text-body-1 font-weight-medium"},Xe={class:"mb-4"},Ye={class:"text-body-1"},Ze={class:"mb-4"},et={class:"text-body-1"},tt={class:"mb-4"},lt={class:"text-body-1 text-capitalize"},at={class:"mb-4"},st={class:"mb-4"},ot={class:"text-body-1"},Ft=_e({__name:"leads",setup(nt){const{data:Z,execute:ee,isFetching:dt}=we("/v1/franchisor/dashboard/leads"),T=c(""),P=c(),z=c(),y=c(10),L=c(1),te=c(),le=c(),_=c([]),ae=d=>{var e,u;te.value=(e=d.sortBy[0])==null?void 0:e.key,le.value=(u=d.sortBy[0])==null?void 0:u.order},se=[{title:"Lead Name",key:"name"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Source",key:"source"},{title:"Status",key:"status"},{title:"Created Date",key:"createdDate"},{title:"Actions",key:"actions",sortable:!1}],x=c({leads:[],totalLeads:0}),M=c([{title:"Total Leads",value:"0",change:0,desc:"All time leads",icon:"tabler-users",iconColor:"primary"},{title:"Closed and Won",value:"0",change:0,desc:"Converted leads",icon:"tabler-trophy",iconColor:"success"},{title:"Closed and Lost",value:"0",change:0,desc:"Lost opportunities",icon:"tabler-x",iconColor:"error"},{title:"Pending Leads",value:"0",change:0,desc:"Active leads",icon:"tabler-clock",iconColor:"warning"}]);ge(Z,d=>{var u;const e=d;if(e!=null&&e.success&&(e!=null&&e.data)){const m=e.data;x.value={leads:Array.isArray(m.leads)?m.leads.map(i=>({id:i.id,name:`${i.first_name||""} ${i.last_name||""}`.trim(),email:i.email,phone:i.phone,source:i.lead_source,status:i.status,createdDate:new Date(i.created_at).toLocaleDateString()})):[],totalLeads:((u=m.pagination)==null?void 0:u.total)||(Array.isArray(m.leads)?m.leads.length:0)};const v=m.stats||{total_leads:0,total_leads_change:0,won_leads:0,won_leads_change:0,lost_leads:0,lost_leads_change:0,pending_leads:0,pending_leads_change:0};M.value=[{title:"Total Leads",value:v.total_leads.toLocaleString(),change:v.total_leads_change,desc:"All time leads",icon:"tabler-users",iconColor:"primary"},{title:"Closed and Won",value:v.won_leads.toLocaleString(),change:v.won_leads_change,desc:"Converted leads",icon:"tabler-trophy",iconColor:"success"},{title:"Closed and Lost",value:v.lost_leads.toLocaleString(),change:v.lost_leads_change,desc:"Lost opportunities",icon:"tabler-x",iconColor:"error"},{title:"Pending Leads",value:v.pending_leads.toLocaleString(),change:v.pending_leads_change,desc:"Active leads",icon:"tabler-clock",iconColor:"warning"}]}},{immediate:!0});const B=H(()=>x.value.leads),j=H(()=>x.value.totalLeads);be(()=>{ee()});const W=[{title:"Website",value:"website"},{title:"Referral",value:"referral"},{title:"Social Media",value:"social_media"},{title:"Email Campaign",value:"email"}],O=[{title:"Pending",value:"pending"},{title:"Won",value:"won"},{title:"Lost",value:"lost"}],G=d=>{const e=d.toLowerCase();return e==="pending"?"warning":e==="won"?"success":e==="lost"?"error":"primary"},h=c(!1),V=c(!1),C=c(!1),n=c(null),S=c(null),oe=d=>{n.value={...d},V.value=!0},ne=d=>{S.value=d,C.value=!0},de=async()=>{if(S.value===null)return;const d=x.value.leads.findIndex(u=>u.id===S.value);d!==-1&&x.value.leads.splice(d,1);const e=_.value.findIndex(u=>u===S.value);e!==-1&&_.value.splice(e,1),C.value=!1,S.value=null},Q=async()=>{if(!n.value)return;const d=x.value.leads.findIndex(e=>e.id===n.value.id);d!==-1&&(x.value.leads[d]={...n.value}),V.value=!1,n.value=null},ie=()=>{const e=["Name,Email,Phone,Source,Status,Created Date",...(_.value.length>0?B.value.filter(i=>_.value.includes(i.id)):B.value).map(i=>`"${i.name}","${i.email}","${i.phone}","${i.source}","${i.status}","${i.createdDate}"`)].join(`
`),u=new Blob([e],{type:"text/csv"}),m=window.URL.createObjectURL(u),v=document.createElement("a");v.href=m,v.download=`leads_${_.value.length>0?"selected":"all"}_${new Date().toISOString().split("T")[0]}.csv`,v.click(),window.URL.revokeObjectURL(m)},re=d=>d>0?`+${d}`:`${d}`,ue=d=>d.split(" ").map(e=>e[0]).join("").toUpperCase();return(d,e)=>{const u=fe,m=ve,v=xe("RouterLink"),i=pe,R=me;return w(),J("section",null,[o("div",Ee,[t(A,null,{default:l(()=>[(w(!0),J(Ve,null,Ce(s(M),(a,q)=>(w(),$(p,{key:q,cols:"12",md:"3",sm:"6"},{default:l(()=>[t(D,null,{default:l(()=>[t(k,null,{default:l(()=>[o("div",Te,[o("div",Pe,[o("div",ze,r(a.title),1),o("div",Be,[o("h4",Re,r(a.value),1),o("div",{class:ye(["text-base",a.change>0?"text-success":"text-error"])}," ("+r(re(a.change))+"%) ",3)]),o("div",Ie,r(a.desc),1)]),t(K,{color:a.iconColor,variant:"tonal",rounded:"",size:"42"},{default:l(()=>[t(U,{icon:a.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),t(D,{class:"mb-6"},{default:l(()=>[t(ke,{class:"pb-4"},{default:l(()=>[t(he,null,{default:l(()=>e[24]||(e[24]=[f("Filters")])),_:1,__:[24]})]),_:1}),t(k,null,{default:l(()=>[t(A,null,{default:l(()=>[t(p,{cols:"12",sm:"6"},{default:l(()=>[t(u,{modelValue:s(z),"onUpdate:modelValue":e[0]||(e[0]=a=>g(z)?z.value=a:null),placeholder:"Select Source",items:W,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",sm:"6"},{default:l(()=>[t(u,{modelValue:s(P),"onUpdate:modelValue":e[1]||(e[1]=a=>g(P)?P.value=a:null),placeholder:"Select Status",items:O,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(X),t(k,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[o("div",Ne,[t(u,{"model-value":s(y),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=parseInt(String(a),10))},null,8,["model-value"]),s(_).length>0?(w(),$(b,{key:0,variant:"tonal",color:"error",onClick:d.bulkDelete},{default:l(()=>[t(U,{icon:"tabler-trash",class:"me-2"}),f(" Delete Selected ("+r(s(_).length)+") ",1)]),_:1},8,["onClick"])):N("",!0)]),t(E),o("div",Fe,[o("div",Me,[t(m,{modelValue:s(T),"onUpdate:modelValue":e[3]||(e[3]=a=>g(T)?T.value=a:null),placeholder:"Search Lead"},null,8,["modelValue"])]),t(b,{variant:"tonal",color:"secondary","prepend-icon":"tabler-upload",onClick:ie},{default:l(()=>[f(" Export "+r(s(_).length>0?`(${s(_).length})`:"All"),1)]),_:1})])]),_:1}),t(X),t(ce,{"items-per-page":s(y),"onUpdate:itemsPerPage":e[5]||(e[5]=a=>g(y)?y.value=a:null),"model-value":s(_),"onUpdate:modelValue":e[6]||(e[6]=a=>g(_)?_.value=a:null),page:s(L),"onUpdate:page":e[7]||(e[7]=a=>g(L)?L.value=a:null),items:s(B),"item-value":"id","items-length":s(j),headers:se,class:"text-no-wrap","show-select":"","onUpdate:options":ae},{"item.name":l(({item:a})=>[o("div",je,[t(K,{size:"34",variant:"tonal",color:"primary"},{default:l(()=>[o("span",null,r(ue(a.name)),1)]),_:2},1024),o("div",We,[o("h6",Oe,[t(v,{to:{name:"franchisor-leads-id",params:{id:a.id}},class:"text-link"},{default:l(()=>[f(r(a.name),1)]),_:2},1032,["to"])])])])]),"item.email":l(({item:a})=>[o("div",Ge,r(a.email),1)]),"item.phone":l(({item:a})=>[o("div",Qe,r(a.phone),1)]),"item.source":l(({item:a})=>[o("div",qe,r(a.source),1)]),"item.status":l(({item:a})=>[t(Y,{color:G(a.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[f(r(a.status),1)]),_:2},1032,["color"])]),"item.createdDate":l(({item:a})=>[o("div",He,r(a.createdDate),1)]),"item.actions":l(({item:a})=>[t(b,{icon:"",variant:"text",color:"medium-emphasis"},{default:l(()=>[t(U,{icon:"tabler-dots-vertical"}),t(Se,{activator:"parent"},{default:l(()=>[t(De,null,{default:l(()=>[t($e,{onClick:q=>ne(a.id)},{prepend:l(()=>[t(U,{icon:"tabler-trash"})]),default:l(()=>[t(Ue,null,{default:l(()=>e[25]||(e[25]=[f("Delete")])),_:1,__:[25]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:l(()=>[t(i,{page:s(L),"onUpdate:page":e[4]||(e[4]=a=>g(L)?L.value=a:null),"items-per-page":s(y),"total-items":s(j)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1}),t(I,{modelValue:s(h),"onUpdate:modelValue":e[11]||(e[11]=a=>g(h)?h.value=a:null),"max-width":"600"},{default:l(()=>[t(R,{onClick:e[8]||(e[8]=a=>h.value=!1)}),s(n)?(w(),$(D,{key:0,title:"Lead Details"},{default:l(()=>[t(k,null,{default:l(()=>[t(A,null,{default:l(()=>[t(p,{cols:"12",md:"6"},{default:l(()=>[o("div",Je,[e[26]||(e[26]=o("div",{class:"text-sm text-disabled mb-1"}," Name ",-1)),o("div",Ke,r(s(n).name),1)])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[o("div",Xe,[e[27]||(e[27]=o("div",{class:"text-sm text-disabled mb-1"}," Email ",-1)),o("div",Ye,r(s(n).email),1)])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[o("div",Ze,[e[28]||(e[28]=o("div",{class:"text-sm text-disabled mb-1"}," Phone ",-1)),o("div",et,r(s(n).phone),1)])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[o("div",tt,[e[29]||(e[29]=o("div",{class:"text-sm text-disabled mb-1"}," Source ",-1)),o("div",lt,r(s(n).source),1)])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[o("div",at,[e[30]||(e[30]=o("div",{class:"text-sm text-disabled mb-1"}," Status ",-1)),t(Y,{color:G(s(n).status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[f(r(s(n).status),1)]),_:1},8,["color"])])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[o("div",st,[e[31]||(e[31]=o("div",{class:"text-sm text-disabled mb-1"}," Created Date ",-1)),o("div",ot,r(s(n).createdDate),1)])]),_:1})]),_:1})]),_:1}),t(F,null,{default:l(()=>[t(E),t(b,{color:"secondary",variant:"tonal",onClick:e[9]||(e[9]=a=>h.value=!1)},{default:l(()=>e[32]||(e[32]=[f(" Close ")])),_:1,__:[32]}),t(b,{color:"primary",onClick:e[10]||(e[10]=a=>oe(s(n)))},{default:l(()=>e[33]||(e[33]=[f(" Edit ")])),_:1,__:[33]})]),_:1})]),_:1})):N("",!0)]),_:1},8,["modelValue"]),t(I,{modelValue:s(V),"onUpdate:modelValue":e[20]||(e[20]=a=>g(V)?V.value=a:null),"max-width":"600"},{default:l(()=>[t(R,{onClick:e[12]||(e[12]=a=>V.value=!1)}),s(n)?(w(),$(D,{key:0,title:"Edit Lead"},{default:l(()=>[t(k,null,{default:l(()=>[t(Ae,{onSubmit:Le(Q,["prevent"])},{default:l(()=>[t(A,null,{default:l(()=>[t(p,{cols:"12",md:"6"},{default:l(()=>[t(m,{modelValue:s(n).name,"onUpdate:modelValue":e[13]||(e[13]=a=>s(n).name=a),label:"Name",placeholder:"Enter lead name"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[t(m,{modelValue:s(n).email,"onUpdate:modelValue":e[14]||(e[14]=a=>s(n).email=a),label:"Email",type:"email",placeholder:"Enter email address"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[t(m,{modelValue:s(n).phone,"onUpdate:modelValue":e[15]||(e[15]=a=>s(n).phone=a),label:"Phone",placeholder:"+966 50 123 4567"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[t(u,{modelValue:s(n).source,"onUpdate:modelValue":e[16]||(e[16]=a=>s(n).source=a),label:"Source",items:W,placeholder:"Select source"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[t(u,{modelValue:s(n).status,"onUpdate:modelValue":e[17]||(e[17]=a=>s(n).status=a),label:"Status",items:O,placeholder:"Select status"},null,8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[t(m,{modelValue:s(n).createdDate,"onUpdate:modelValue":e[18]||(e[18]=a=>s(n).createdDate=a),label:"Created Date",type:"date"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(F,null,{default:l(()=>[t(E),t(b,{color:"secondary",variant:"tonal",onClick:e[19]||(e[19]=a=>V.value=!1)},{default:l(()=>e[34]||(e[34]=[f(" Cancel ")])),_:1,__:[34]}),t(b,{color:"primary",onClick:Q},{default:l(()=>e[35]||(e[35]=[f(" Save Changes ")])),_:1,__:[35]})]),_:1})]),_:1})):N("",!0)]),_:1},8,["modelValue"]),t(I,{modelValue:s(C),"onUpdate:modelValue":e[23]||(e[23]=a=>g(C)?C.value=a:null),"max-width":"600"},{default:l(()=>[t(R,{onClick:e[21]||(e[21]=a=>C.value=!1)}),t(D,{title:"Confirm Delete"},{default:l(()=>[t(k,null,{default:l(()=>e[36]||(e[36]=[f(" Are you sure you want to delete this lead? This action cannot be undone. ")])),_:1,__:[36]}),t(F,null,{default:l(()=>[t(E),t(b,{color:"secondary",variant:"tonal",onClick:e[22]||(e[22]=a=>C.value=!1)},{default:l(()=>e[37]||(e[37]=[f(" Cancel ")])),_:1,__:[37]}),t(b,{color:"error",onClick:de},{default:l(()=>e[38]||(e[38]=[f(" Delete ")])),_:1,__:[38]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{Ft as default};
