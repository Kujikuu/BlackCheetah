import{d as ke,r as d,P as r,G as _e,c as $,e as i,b as l,f as o,F as z,o as C,a3 as f,t as u,aa as B,v as p,g as N,l as Q,aM as De}from"./main-D0PmdS1Y.js";import{f as P}from"./franchisee-dashboard-CUn-A5lG.js";import{V as R,a as m}from"./VRow-Cak-Lgex.js";import{V as le}from"./VDialog-sZu71cKP.js";import{V as M}from"./VSelect-RqmmXubD.js";import{V as w,b as oe,d as se}from"./VCard-B7UpWRaQ.js";import{V as k}from"./VCardText-CIwjKnf_.js";import{V as Y}from"./VAvatar-CxHe0yBd.js";import{a as Ee,V as j,b as Ae,c as H}from"./VTabs-vqvC9gYI.js";import{V as U}from"./VTextField-B880wQkJ.js";import{q as W}from"./VDataTable-CPa50lFd.js";import{V as Fe}from"./VChip-DdEqOyic.js";import{V as qe}from"./VForm-aksOmHMd.js";import{V as Pe}from"./VTextarea-l0aNL8-w.js";import{V as Ue}from"./VFileInput-CNXbIWfi.js";/* empty css              */import"./VOverlay-B9QLNbJM.js";import"./easing-Bybner-F.js";import"./lazy-D5mATHLk.js";import"./scopeId-BKGdYQgZ.js";import"./VImg-jjfUM9_b.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-CIZ4lwe7.js";import"./form-BAdaD-wq.js";import"./VList-pUfpgzrf.js";import"./ssrBoot-BefThYZR.js";import"./VDivider-BtoRnDHG.js";import"./VMenu-DOD60N4z.js";import"./VCheckboxBtn-Zi_PB_hu.js";import"./VSelectionControl-mXH6gVlO.js";import"./VWindowItem-DulLYl-I.js";import"./VSlideGroup-CFIWL1zD.js";/* empty css                   */import"./VCounter-DBvBtD1O.js";import"./VField-D5-MFzvq.js";import"./VInput-DP_kSFGC.js";import"./VPagination-DkAbFOUn.js";import"./VTable-CN_P_eEe.js";import"./filter-L-0-N-uW.js";const Te={class:"d-flex justify-space-between align-center flex-wrap gap-4"},Re={class:"d-flex gap-3 align-center flex-wrap"},Me={class:"text-h6 font-weight-medium"},he={class:"text-h6 font-weight-medium"},Oe={class:"text-h6 font-weight-medium"},Ie={class:"d-flex justify-space-between align-center mb-4"},Le={class:"d-flex gap-2"},$e={class:"font-weight-medium"},ze={class:"text-success font-weight-medium"},Be={class:"text-error font-weight-medium"},Ne={class:"font-weight-medium"},Qe={class:"text-error"},Ye={class:"text-success font-weight-medium"},Ut=ke({__name:"financial-overview",setup(je){const c=d("sales"),v=d(""),n=d([]),g=d(!1),_=d(!1),y=d("sales"),h=d("sales"),x=d(!1),V=d(!1),D=d(""),E=d("monthly"),T=d(null),b=d([]),s=d({product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""}),O=async()=>{x.value=!0;try{const t=await P.getFinancialOverview();t.success&&(T.value=t.data)}catch(t){console.error("Error loading financial data:",t)}finally{x.value=!1}},G=async()=>{try{const t=await P.getUnitProducts();t.success&&(b.value=t.data)}catch(t){console.error("Error loading unit products:",t)}},A=r(()=>{var t;return((t=T.value)==null?void 0:t.sales)||[]}),F=r(()=>{var t;return((t=T.value)==null?void 0:t.expenses)||[]}),I=r(()=>{var t;return((t=T.value)==null?void 0:t.profit)||[]});_e(()=>{O(),G()});const ie=r(()=>b.value.filter(t=>t.status==="active"&&t.stock>0).map(t=>({title:`${t.name} (${t.stock} in stock)`,value:t.name,stock:t.stock}))),S=r(()=>{if(!s.value.product)return 0;const t=b.value.find(e=>e.name===s.value.product);return(t==null?void 0:t.stock)||0}),J=r(()=>y.value!=="sales"?!0:s.value.quantitySold>0&&s.value.quantitySold<=S.value),K=r(()=>s.value.product?s.value.quantitySold===0?"Quantity must be greater than 0":s.value.quantitySold>S.value?`Cannot exceed available stock (${S.value} units)`:"":""),ne=["Food Supplies","Utilities","Staff Wages","Marketing","Equipment Maintenance","Rent","Insurance","Cleaning Supplies","Office Supplies","Transportation"],re=[{title:"Sales",value:"sales"},{title:"Expense",value:"expense"}],ue=[{title:"Product",key:"product",sortable:!0},{title:"Date of Sale",key:"dateOfSale",sortable:!0},{title:"Unit Price (SAR)",key:"unitPrice",sortable:!0},{title:"Quantity Sold",key:"quantitySold",sortable:!0},{title:"Sale (SAR)",key:"sale",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],de=[{title:"Expense Category",key:"expenseCategory",sortable:!0},{title:"Date of Expense",key:"dateOfExpense",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Description",key:"description",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],pe=[{title:"Date",key:"date",sortable:!0},{title:"Total Sales (SAR)",key:"totalSales",sortable:!0},{title:"Total Expenses (SAR)",key:"totalExpenses",sortable:!0},{title:"Profit (SAR)",key:"profit",sortable:!0}],me=r(()=>v.value?A.value.filter(t=>t.product.toLowerCase().includes(v.value.toLowerCase())||t.dateOfSale.includes(v.value)):A.value),ve=r(()=>v.value?F.value.filter(t=>t.expenseCategory.toLowerCase().includes(v.value.toLowerCase())||t.description.toLowerCase().includes(v.value.toLowerCase())||t.dateOfExpense.includes(v.value)):F.value),fe=r(()=>{let t=X.value;return v.value&&(t=t.filter(e=>e.date.includes(v.value))),t}),ce=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],L=t=>{const e=new Date(t),a=new Date;return E.value==="daily"?e.toDateString()===a.toDateString():E.value==="monthly"?e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear():E.value==="yearly"?e.getFullYear()===a.getFullYear():!0},ye=r(()=>A.value.filter(t=>L(t.dateOfSale))),xe=r(()=>F.value.filter(t=>L(t.dateOfExpense))),X=r(()=>I.value.filter(t=>L(t.date))),ge=r(()=>ye.value.reduce((t,e)=>t+e.sale,0)),Ve=r(()=>xe.value.reduce((t,e)=>t+e.amount,0)),be=r(()=>X.value.reduce((t,e)=>t+e.profit,0)),Se=t=>{y.value=t,V.value=!1,D.value="",ee(),g.value=!0},Z=(t,e)=>{y.value=e,V.value=!0,D.value=t.id,e==="sales"?s.value={product:t.product,date:t.dateOfSale,quantitySold:t.quantitySold,expenseCategory:"",amount:0,description:""}:s.value={product:"",date:t.dateOfExpense,quantitySold:0,expenseCategory:t.expenseCategory,amount:t.amount,description:t.description||""},g.value=!0},ee=()=>{s.value={product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""},V.value=!1,D.value=""},te=async()=>{var t,e;if(!(y.value==="sales"&&!J.value)){x.value=!0;try{const a={category:y.value,date:s.value.date};y.value==="sales"?(a.product=s.value.product,a.quantitySold=s.value.quantitySold):(a.expenseCategory=s.value.expenseCategory,a.amount=s.value.amount,a.description=s.value.description);let q;V.value?q=await P.updateFinancialData(D.value,a):q=await P.addFinancialData(a),q.success&&(await O(),await G(),g.value=!1,ee(),V.value=!1,D.value="")}catch(a){console.error("Error saving data:",a),(e=(t=a.response)==null?void 0:t.data)!=null&&e.message&&alert(a.response.data.message)}finally{x.value=!1}}},ae=()=>{let t=[],e="";c.value==="sales"?(t=n.value.length>0?A.value.filter(a=>n.value.includes(a.id)):A.value,e="sales_data.csv"):c.value==="expense"?(t=n.value.length>0?F.value.filter(a=>n.value.includes(a.id)):F.value,e="expense_data.csv"):c.value==="profit"&&(t=n.value.length>0?I.value.filter(a=>n.value.includes(a.id)):I.value,e="profit_data.csv"),console.log("Exporting data:",t,"as",e)},Ce=async()=>{if(n.value.length!==0){x.value=!0;try{(await P.deleteFinancialData({category:c.value,ids:n.value})).success&&(await O(),n.value=[])}catch(t){console.error("Error deleting data:",t)}finally{x.value=!1}}},we=()=>{console.log("Importing data for category:",h.value),_.value=!1};return(t,e)=>(C(),$(z,null,[i("section",null,[l(R,{class:"mb-6"},{default:o(()=>[l(m,{cols:"12"},{default:o(()=>[i("div",Te,[e[23]||(e[23]=i("div",null,[i("h4",{class:"text-h4 mb-1"}," Financial Overview "),i("p",{class:"text-body-1 text-medium-emphasis"}," Track your franchise financial performance and metrics ")],-1)),i("div",Re,[l(f,{color:"primary",variant:"outlined","prepend-icon":"tabler-upload",onClick:e[0]||(e[0]=a=>_.value=!0)},{default:o(()=>e[21]||(e[21]=[u(" Import ")])),_:1,__:[21]}),l(f,{color:"primary","prepend-icon":"tabler-plus",onClick:e[1]||(e[1]=a=>Se(c.value))},{default:o(()=>e[22]||(e[22]=[u(" Add Data ")])),_:1,__:[22]}),l(M,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=a=>E.value=a),items:ce,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(R,{class:"mb-6"},{default:o(()=>[l(m,{cols:"12",md:"4"},{default:o(()=>[l(w,null,{default:o(()=>[l(k,{class:"d-flex align-center"},{default:o(()=>[l(Y,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-4"},{default:o(()=>[l(B,{size:"24",icon:"tabler-currency-riyal"})]),_:1}),i("div",null,[e[24]||(e[24]=i("span",{class:"text-sm text-medium-emphasis"},"Total Sales",-1)),i("div",Me,p(ge.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1}),l(m,{cols:"12",md:"4"},{default:o(()=>[l(w,null,{default:o(()=>[l(k,{class:"d-flex align-center"},{default:o(()=>[l(Y,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-4"},{default:o(()=>[l(B,{size:"24",icon:"tabler-trending-down"})]),_:1}),i("div",null,[e[25]||(e[25]=i("span",{class:"text-sm text-medium-emphasis"},"Total Expenses",-1)),i("div",he,p(Ve.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1}),l(m,{cols:"12",md:"4"},{default:o(()=>[l(w,null,{default:o(()=>[l(k,{class:"d-flex align-center"},{default:o(()=>[l(Y,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-4"},{default:o(()=>[l(B,{size:"24",icon:"tabler-trending-up"})]),_:1}),i("div",null,[e[26]||(e[26]=i("span",{class:"text-sm text-medium-emphasis"},"Total Profit",-1)),i("div",Oe,p(be.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(R,null,{default:o(()=>[l(m,{cols:"12"},{default:o(()=>[l(w,null,{default:o(()=>[l(k,null,{default:o(()=>[l(Ee,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),color:"primary",class:"mb-4"},{default:o(()=>[l(j,{value:"sales"},{default:o(()=>e[27]||(e[27]=[u(" Sales ")])),_:1,__:[27]}),l(j,{value:"expense"},{default:o(()=>e[28]||(e[28]=[u(" Expense ")])),_:1,__:[28]}),l(j,{value:"profit"},{default:o(()=>e[29]||(e[29]=[u(" Profit ")])),_:1,__:[29]})]),_:1},8,["modelValue"]),i("div",Ie,[l(U,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),placeholder:"Search...","prepend-inner-icon":"tabler-search",variant:"outlined",density:"compact",style:{"max-width":"300px"},clearable:""},null,8,["modelValue"]),i("div",Le,[n.value.length>0?(C(),N(f,{key:0,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:ae},{default:o(()=>[u(" Export Selected ("+p(n.value.length)+") ",1)]),_:1})):Q("",!0),n.value.length>0?(C(),N(f,{key:1,color:"error",variant:"outlined","prepend-icon":"tabler-trash",onClick:Ce},{default:o(()=>[u(" Delete Selected ("+p(n.value.length)+") ",1)]),_:1})):Q("",!0),n.value.length===0?(C(),N(f,{key:2,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:ae},{default:o(()=>e[30]||(e[30]=[u(" Export All ")])),_:1,__:[30]})):Q("",!0)])]),l(Ae,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value=a)},{default:o(()=>[l(H,{value:"sales"},{default:o(()=>[l(W,{modelValue:n.value,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value=a),headers:ue,items:me.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.unitPrice":o(({item:a})=>[i("span",$e,p(a.unitPrice.toFixed(2))+" SAR ",1)]),"item.sale":o(({item:a})=>[i("span",ze,p(a.sale.toFixed(2))+" SAR ",1)]),"item.actions":o(({item:a})=>[l(f,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:q=>Z(a,"sales")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),l(H,{value:"expense"},{default:o(()=>[l(W,{modelValue:n.value,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value=a),headers:de,items:ve.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.amount":o(({item:a})=>[i("span",Be,p(a.amount.toFixed(2))+" SAR ",1)]),"item.expenseCategory":o(({item:a})=>[l(Fe,{size:"small",variant:"tonal",color:"primary"},{default:o(()=>[u(p(a.expenseCategory),1)]),_:2},1024)]),"item.actions":o(({item:a})=>[l(f,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:q=>Z(a,"expense")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),l(H,{value:"profit"},{default:o(()=>[l(W,{modelValue:n.value,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value=a),headers:pe,items:fe.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.totalSales":o(({item:a})=>[i("span",Ne,p(a.totalSales.toFixed(2))+" SAR ",1)]),"item.totalExpenses":o(({item:a})=>[i("span",Qe,p(a.totalExpenses.toFixed(2))+" SAR ",1)]),"item.profit":o(({item:a})=>[i("span",Ye,p(a.profit.toFixed(2))+" SAR ",1)]),_:1},8,["modelValue","items"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),l(le,{modelValue:g.value,"onUpdate:modelValue":e[17]||(e[17]=a=>g.value=a),"max-width":"500"},{default:o(()=>[l(w,null,{default:o(()=>[l(oe,{class:"text-h6 font-weight-medium"},{default:o(()=>[u(p(V.value?"Edit":"Add")+" "+p(y.value==="sales"?"Sales":"Expense")+" Data ",1)]),_:1}),l(k,null,{default:o(()=>[l(qe,{onSubmit:De(te,["prevent"])},{default:o(()=>[l(R,null,{default:o(()=>[y.value==="sales"?(C(),$(z,{key:0},[l(m,{cols:"12"},{default:o(()=>[l(M,{modelValue:s.value.product,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.product=a),items:ie.value,label:"Product",variant:"outlined","item-title":"title","item-value":"value",loading:b.value.length===0,disabled:b.value.length===0,hint:b.value.length===0?"No products available in stock":"","persistent-hint":"",required:""},null,8,["modelValue","items","loading","disabled","hint"])]),_:1}),l(m,{cols:"12"},{default:o(()=>[l(U,{modelValue:s.value.date,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.date=a),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),l(m,{cols:"12"},{default:o(()=>[l(U,{modelValue:s.value.quantitySold,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.quantitySold=a),modelModifiers:{number:!0},label:"Quantity Sold",type:"number",variant:"outlined",required:"",min:1,max:S.value,error:!!K.value,"error-messages":K.value,hint:S.value>0?`Available stock: ${S.value} units`:"","persistent-hint":"",disabled:!s.value.product},null,8,["modelValue","max","error","error-messages","hint","disabled"])]),_:1})],64)):(C(),$(z,{key:1},[l(m,{cols:"12"},{default:o(()=>[l(M,{modelValue:s.value.expenseCategory,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.expenseCategory=a),items:ne,label:"Expense Category",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),l(m,{cols:"12"},{default:o(()=>[l(U,{modelValue:s.value.date,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.date=a),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),l(m,{cols:"12"},{default:o(()=>[l(U,{modelValue:s.value.amount,"onUpdate:modelValue":e[14]||(e[14]=a=>s.value.amount=a),modelModifiers:{number:!0},label:"Amount (SAR)",type:"number",step:"0.01",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),l(m,{cols:"12"},{default:o(()=>[l(Pe,{modelValue:s.value.description,"onUpdate:modelValue":e[15]||(e[15]=a=>s.value.description=a),label:"Note/Description",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})],64))]),_:1})]),_:1})]),_:1}),l(se,{class:"d-flex justify-end gap-2 pa-4"},{default:o(()=>[l(f,{variant:"outlined",onClick:e[16]||(e[16]=a=>g.value=!1)},{default:o(()=>e[31]||(e[31]=[u(" Cancel ")])),_:1,__:[31]}),l(f,{color:"primary",onClick:te,disabled:y.value==="sales"&&!J.value,loading:x.value},{default:o(()=>e[32]||(e[32]=[u(" Save ")])),_:1,__:[32]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(le,{modelValue:_.value,"onUpdate:modelValue":e[20]||(e[20]=a=>_.value=a),"max-width":"400"},{default:o(()=>[l(w,null,{default:o(()=>[l(oe,{class:"text-h6 font-weight-medium"},{default:o(()=>e[33]||(e[33]=[u(" Import Data ")])),_:1,__:[33]}),l(k,null,{default:o(()=>[l(M,{modelValue:h.value,"onUpdate:modelValue":e[18]||(e[18]=a=>h.value=a),items:re,label:"Select Category",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),l(Ue,{label:"Choose CSV file",variant:"outlined",accept:".csv","prepend-icon":"tabler-file-upload"})]),_:1}),l(se,{class:"d-flex justify-end gap-2 pa-4"},{default:o(()=>[l(f,{variant:"outlined",onClick:e[19]||(e[19]=a=>_.value=!1)},{default:o(()=>e[34]||(e[34]=[u(" Cancel ")])),_:1,__:[34]}),l(f,{color:"primary",onClick:we},{default:o(()=>e[35]||(e[35]=[u(" Import ")])),_:1,__:[35]})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{Ut as default};
