import{V as ae,_ as ke}from"./VDialog-CEq2jzbd.js";import{d as _e,r as d,P as u,G as De,c as L,e as r,b as a,f as l,F as h,o as k,a9 as c,t as m,m as Ee,v as p,ax as le,g as B,l as z,b3 as Ae}from"./main-B8QbR-yS.js";import{f as P}from"./franchisee-dashboard-CYv47Cko.js";import{V as T,a as v}from"./VRow-LlT6Azsr.js";import{V as M}from"./VSelect-GSzN3Qps.js";import{V as _,d as oe}from"./VCard-D9PhtsJ0.js";import{V as D}from"./VCardText-Cbtr6Qhr.js";import{V as Q}from"./VAvatar-87LH5tAk.js";import{S as Fe}from"./saudi-riyal-DBg1zXmT.js";import{a as qe,V as Y,b as Pe,c as j}from"./VTabs-DXRKnteB.js";import{V as U}from"./VTextField-C7_y5spr.js";import{V as H}from"./VDataTable-FYAU2aQJ.js";import{V as Ue}from"./VChip-CgHwmC-k.js";import{V as Re}from"./VForm-C9sxpau4.js";import{V as Te}from"./VTextarea-1ursQqQ2.js";import{V as Me}from"./VFileInput-Ip2n4ssl.js";import"./VOverlay-B3La6Ajr.js";import"./forwardRefs--KQCZfKO.js";import"./scopeId-DyQ6a1uN.js";import"./VImg-Ceu2Mboj.js";import"./dialog-transition-Dy2Gj1XO.js";/* empty css              */import"./form-Dt-W1fp6.js";import"./VList-BJCgULVd.js";import"./VDivider-DOfIMbJY.js";import"./VMenu-TQcmpCCv.js";import"./VCheckboxBtn-CWPoGbRz.js";import"./VSelectionControl-DDEVNAf7.js";import"./VWindowItem-CHtlO5gs.js";import"./VSlideGroup-BuNiGLv2.js";import"./VField-Bw51LFql.js";import"./VInput-DB3XZUVb.js";import"./VTable-CgkStP3y.js";const Oe={class:"d-flex justify-space-between align-center flex-wrap gap-4"},Ie={class:"d-flex gap-3 align-center flex-wrap"},$e={class:"text-h6 font-weight-medium"},Ne={class:"text-h6 font-weight-medium"},Le={class:"text-h6 font-weight-medium"},he={class:"d-flex justify-space-between align-center mb-4"},Be={class:"d-flex gap-2"},ze={class:"font-weight-medium"},Qe={class:"text-success font-weight-medium"},Ye={class:"text-error font-weight-medium"},je={class:"font-weight-medium"},He={class:"text-error"},We={class:"text-success font-weight-medium"},Ft=_e({__name:"financial-overview",setup(Ge){const y=d("sales"),f=d(""),i=d([]),g=d(!1),b=d(!1),x=d("sales"),O=d("sales"),V=d(!1),S=d(!1),E=d(""),A=d("monthly"),R=d(null),C=d([]),s=d({product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""}),I=async()=>{V.value=!0;try{const t=await P.getFinancialOverview();t.success&&(R.value=t.data)}catch(t){console.error("Error loading financial data:",t)}finally{V.value=!1}},W=async()=>{try{const t=await P.getUnitProducts();t.success&&(C.value=t.data)}catch(t){console.error("Error loading unit products:",t)}},F=u(()=>{var t;return((t=R.value)==null?void 0:t.sales)||[]}),q=u(()=>{var t;return((t=R.value)==null?void 0:t.expenses)||[]}),$=u(()=>{var t;return((t=R.value)==null?void 0:t.profit)||[]});De(()=>{I(),W()});const se=u(()=>C.value.filter(t=>t.status==="active"&&t.stock>0).map(t=>({title:`${t.name} (${t.stock} in stock)`,value:t.name,stock:t.stock}))),w=u(()=>{if(!s.value.product)return 0;const t=C.value.find(e=>e.name===s.value.product);return(t==null?void 0:t.stock)||0}),G=u(()=>x.value!=="sales"?!0:s.value.quantitySold>0&&s.value.quantitySold<=w.value),J=u(()=>s.value.product?s.value.quantitySold===0?"Quantity must be greater than 0":s.value.quantitySold>w.value?`Cannot exceed available stock (${w.value} units)`:"":""),ne=["Food Supplies","Utilities","Staff Wages","Marketing","Equipment Maintenance","Rent","Insurance","Cleaning Supplies","Office Supplies","Transportation"],re=[{title:"Sales",value:"sales"},{title:"Expense",value:"expense"}],ie=[{title:"Product",key:"product",sortable:!0},{title:"Date of Sale",key:"dateOfSale",sortable:!0},{title:"Unit Price (SAR)",key:"unitPrice",sortable:!0},{title:"Quantity Sold",key:"quantitySold",sortable:!0},{title:"Sale (SAR)",key:"sale",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],ue=[{title:"Expense Category",key:"expenseCategory",sortable:!0},{title:"Date of Expense",key:"dateOfExpense",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Description",key:"description",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],de=[{title:"Date",key:"date",sortable:!0},{title:"Total Sales (SAR)",key:"totalSales",sortable:!0},{title:"Total Expenses (SAR)",key:"totalExpenses",sortable:!0},{title:"Profit (SAR)",key:"profit",sortable:!0}],me=u(()=>f.value?F.value.filter(t=>t.product.toLowerCase().includes(f.value.toLowerCase())||t.dateOfSale.includes(f.value)):F.value),pe=u(()=>f.value?q.value.filter(t=>t.expenseCategory.toLowerCase().includes(f.value.toLowerCase())||t.description.toLowerCase().includes(f.value.toLowerCase())||t.dateOfExpense.includes(f.value)):q.value),N=t=>{const e=new Date(t),n=new Date;return A.value==="daily"?e.toDateString()===n.toDateString():A.value==="monthly"?e.getMonth()===n.getMonth()&&e.getFullYear()===n.getFullYear():A.value==="yearly"?e.getFullYear()===n.getFullYear():!0},ve=u(()=>F.value.filter(t=>N(t.dateOfSale))),fe=u(()=>q.value.filter(t=>N(t.dateOfExpense))),K=u(()=>$.value.filter(t=>N(t.date))),ce=u(()=>{let t=K.value;return f.value&&(t=t.filter(e=>e.date.includes(f.value))),t}),ye=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],xe=u(()=>ve.value.reduce((t,e)=>t+e.sale,0)),ge=u(()=>fe.value.reduce((t,e)=>t+e.amount,0)),Ve=u(()=>K.value.reduce((t,e)=>t+e.profit,0)),X=()=>{s.value={product:"",date:"",quantitySold:0,expenseCategory:"",amount:0,description:""},S.value=!1,E.value=""},be=t=>{x.value=t,S.value=!1,E.value="",X(),g.value=!0},Z=(t,e)=>{x.value=e,S.value=!0,E.value=t.id,e==="sales"?s.value={product:t.product,date:t.dateOfSale,quantitySold:t.quantitySold,expenseCategory:"",amount:0,description:""}:s.value={product:"",date:t.dateOfExpense,quantitySold:0,expenseCategory:t.expenseCategory,amount:t.amount,description:t.description||""},g.value=!0},ee=async()=>{var t,e;if(!(x.value==="sales"&&!G.value)){V.value=!0;try{const n={category:x.value,date:s.value.date};x.value==="sales"?(n.product=s.value.product,n.quantitySold=s.value.quantitySold):(n.expenseCategory=s.value.expenseCategory,n.amount=s.value.amount,n.description=s.value.description);let o;S.value?o=await P.updateFinancialData(E.value,n):o=await P.addFinancialData(n),o.success&&(await I(),await W(),g.value=!1,X(),S.value=!1,E.value="")}catch(n){console.error("Error saving data:",n),(e=(t=n.response)==null?void 0:t.data)!=null&&e.message&&console.error("Submission error:",n.response.data.message)}finally{V.value=!1}}},te=()=>{let t=[],e="";y.value==="sales"?(t=i.value.length>0?F.value.filter(n=>i.value.includes(n.id)):F.value,e="sales_data.csv"):y.value==="expense"?(t=i.value.length>0?q.value.filter(n=>i.value.includes(n.id)):q.value,e="expense_data.csv"):y.value==="profit"&&(t=i.value.length>0?$.value.filter(n=>i.value.includes(n.id)):$.value,e="profit_data.csv"),console.log("Exporting data:",t,"as",e)},Se=async()=>{if(i.value.length!==0){V.value=!0;try{(await P.deleteFinancialData({category:y.value,ids:i.value})).success&&(await I(),i.value=[])}catch(t){console.error("Error deleting data:",t)}finally{V.value=!1}}},Ce=()=>{console.log("Importing data for category:",O.value),b.value=!1};return(t,e)=>{const n=ke;return k(),L(h,null,[r("section",null,[a(T,{class:"mb-6"},{default:l(()=>[a(v,{cols:"12"},{default:l(()=>[r("div",Oe,[e[25]||(e[25]=r("div",null,[r("h4",{class:"text-h4 mb-1"}," Financial Overview "),r("p",{class:"text-body-1 text-medium-emphasis"}," Track your franchise financial performance and metrics ")],-1)),r("div",Ie,[a(c,{color:"primary",variant:"outlined","prepend-icon":"tabler-upload",onClick:e[0]||(e[0]=o=>b.value=!0)},{default:l(()=>e[23]||(e[23]=[m(" Import ")])),_:1,__:[23]}),a(c,{color:"primary","prepend-icon":"tabler-plus",onClick:e[1]||(e[1]=o=>be(y.value))},{default:l(()=>e[24]||(e[24]=[m(" Add Data ")])),_:1,__:[24]}),a(M,{modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=o=>A.value=o),items:ye,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(T,{class:"mb-6"},{default:l(()=>[a(v,{cols:"12",md:"4"},{default:l(()=>[a(_,null,{default:l(()=>[a(D,{class:"d-flex align-center"},{default:l(()=>[a(Q,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-4"},{default:l(()=>[a(Ee(Fe))]),_:1}),r("div",null,[e[26]||(e[26]=r("span",{class:"text-sm text-medium-emphasis"},"Total Sales",-1)),r("div",$e,p(xe.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1}),a(v,{cols:"12",md:"4"},{default:l(()=>[a(_,null,{default:l(()=>[a(D,{class:"d-flex align-center"},{default:l(()=>[a(Q,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-4"},{default:l(()=>[a(le,{size:"24",icon:"tabler-trending-down"})]),_:1}),r("div",null,[e[27]||(e[27]=r("span",{class:"text-sm text-medium-emphasis"},"Total Expenses",-1)),r("div",Ne,p(ge.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1}),a(v,{cols:"12",md:"4"},{default:l(()=>[a(_,null,{default:l(()=>[a(D,{class:"d-flex align-center"},{default:l(()=>[a(Q,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-4"},{default:l(()=>[a(le,{size:"24",icon:"tabler-trending-up"})]),_:1}),r("div",null,[e[28]||(e[28]=r("span",{class:"text-sm text-medium-emphasis"},"Total Profit",-1)),r("div",Le,p(Ve.value.toLocaleString())+" SAR ",1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(T,null,{default:l(()=>[a(v,{cols:"12"},{default:l(()=>[a(_,null,{default:l(()=>[a(D,null,{default:l(()=>[a(qe,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=o=>y.value=o),color:"primary",class:"mb-4"},{default:l(()=>[a(Y,{value:"sales"},{default:l(()=>e[29]||(e[29]=[m(" Sales ")])),_:1,__:[29]}),a(Y,{value:"expense"},{default:l(()=>e[30]||(e[30]=[m(" Expense ")])),_:1,__:[30]}),a(Y,{value:"profit"},{default:l(()=>e[31]||(e[31]=[m(" Profit ")])),_:1,__:[31]})]),_:1},8,["modelValue"]),r("div",he,[a(U,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=o=>f.value=o),placeholder:"Search...","prepend-inner-icon":"tabler-search",variant:"outlined",density:"compact",style:{"max-width":"300px"},clearable:""},null,8,["modelValue"]),r("div",Be,[i.value.length>0?(k(),B(c,{key:0,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:te},{default:l(()=>[m(" Export Selected ("+p(i.value.length)+") ",1)]),_:1})):z("",!0),i.value.length>0?(k(),B(c,{key:1,color:"error",variant:"outlined","prepend-icon":"tabler-trash",onClick:Se},{default:l(()=>[m(" Delete Selected ("+p(i.value.length)+") ",1)]),_:1})):z("",!0),i.value.length===0?(k(),B(c,{key:2,color:"primary",variant:"outlined","prepend-icon":"tabler-download",onClick:te},{default:l(()=>e[32]||(e[32]=[m(" Export All ")])),_:1,__:[32]})):z("",!0)])]),a(Pe,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=o=>y.value=o)},{default:l(()=>[a(j,{value:"sales"},{default:l(()=>[a(H,{modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=o=>i.value=o),headers:ie,items:me.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.unitPrice":l(({item:o})=>[r("span",ze,p(Number(o.unitPrice).toFixed(2))+" SAR ",1)]),"item.sale":l(({item:o})=>[r("span",Qe,p(Number(o.sale).toFixed(2))+" SAR ",1)]),"item.actions":l(({item:o})=>[a(c,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:we=>Z(o,"sales")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),a(j,{value:"expense"},{default:l(()=>[a(H,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=o=>i.value=o),headers:ue,items:pe.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.amount":l(({item:o})=>[r("span",Ye,p(Number(o.amount).toFixed(2))+" SAR ",1)]),"item.expenseCategory":l(({item:o})=>[a(Ue,{size:"small",variant:"tonal",color:"primary"},{default:l(()=>[m(p(o.expenseCategory),1)]),_:2},1024)]),"item.actions":l(({item:o})=>[a(c,{icon:"tabler-edit",variant:"text",color:"primary",size:"small",onClick:we=>Z(o,"expense")},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1}),a(j,{value:"profit"},{default:l(()=>[a(H,{modelValue:i.value,"onUpdate:modelValue":e[7]||(e[7]=o=>i.value=o),headers:de,items:ce.value,"items-per-page":10,"show-select":"",class:"text-no-wrap","item-value":"id"},{"item.totalSales":l(({item:o})=>[r("span",je,p(Number(o.totalSales).toFixed(2))+" SAR ",1)]),"item.totalExpenses":l(({item:o})=>[r("span",He,p(Number(o.totalExpenses).toFixed(2))+" SAR ",1)]),"item.profit":l(({item:o})=>[r("span",We,p(Number(o.profit).toFixed(2))+" SAR ",1)]),_:1},8,["modelValue","items"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),a(ae,{modelValue:g.value,"onUpdate:modelValue":e[18]||(e[18]=o=>g.value=o),"max-width":"600"},{default:l(()=>[a(n,{onClick:e[9]||(e[9]=o=>g.value=!1)}),a(_,{title:S.value?"Edit":"Add"+(x.value==="sales"?"Sales":"Expense")+" Data"},{default:l(()=>[a(D,null,{default:l(()=>[a(Re,{onSubmit:Ae(ee,["prevent"])},{default:l(()=>[a(T,null,{default:l(()=>[x.value==="sales"?(k(),L(h,{key:0},[a(v,{cols:"12"},{default:l(()=>[a(M,{modelValue:s.value.product,"onUpdate:modelValue":e[10]||(e[10]=o=>s.value.product=o),items:se.value,label:"Product",variant:"outlined","item-title":"title","item-value":"value",loading:C.value.length===0,disabled:C.value.length===0,hint:C.value.length===0?"No products available in stock":"","persistent-hint":"",required:""},null,8,["modelValue","items","loading","disabled","hint"])]),_:1}),a(v,{cols:"12"},{default:l(()=>[a(U,{modelValue:s.value.date,"onUpdate:modelValue":e[11]||(e[11]=o=>s.value.date=o),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:l(()=>[a(U,{modelValue:s.value.quantitySold,"onUpdate:modelValue":e[12]||(e[12]=o=>s.value.quantitySold=o),modelModifiers:{number:!0},label:"Quantity Sold",type:"number",variant:"outlined",required:"",min:1,max:w.value,error:!!J.value,"error-messages":J.value,hint:w.value>0?`Available stock: ${w.value} units`:"","persistent-hint":"",disabled:!s.value.product},null,8,["modelValue","max","error","error-messages","hint","disabled"])]),_:1})],64)):(k(),L(h,{key:1},[a(v,{cols:"12"},{default:l(()=>[a(M,{modelValue:s.value.expenseCategory,"onUpdate:modelValue":e[13]||(e[13]=o=>s.value.expenseCategory=o),items:ne,label:"Expense Category",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:l(()=>[a(U,{modelValue:s.value.date,"onUpdate:modelValue":e[14]||(e[14]=o=>s.value.date=o),label:"Date",type:"date",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:l(()=>[a(U,{modelValue:s.value.amount,"onUpdate:modelValue":e[15]||(e[15]=o=>s.value.amount=o),modelModifiers:{number:!0},label:"Amount (SAR)",type:"number",step:"0.01",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),a(v,{cols:"12"},{default:l(()=>[a(Te,{modelValue:s.value.description,"onUpdate:modelValue":e[16]||(e[16]=o=>s.value.description=o),label:"Note/Description",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1})],64))]),_:1})]),_:1})]),_:1}),a(oe,{class:"d-flex justify-end gap-2 pa-4"},{default:l(()=>[a(c,{variant:"tonal",color:"secondary",onClick:e[17]||(e[17]=o=>g.value=!1)},{default:l(()=>e[33]||(e[33]=[m(" Cancel ")])),_:1,__:[33]}),a(c,{disabled:x.value==="sales"&&!G.value,loading:V.value,onClick:ee},{default:l(()=>e[34]||(e[34]=[m(" Save ")])),_:1,__:[34]},8,["disabled","loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"]),a(ae,{modelValue:b.value,"onUpdate:modelValue":e[22]||(e[22]=o=>b.value=o),"max-width":"600"},{default:l(()=>[a(n,{onClick:e[19]||(e[19]=o=>b.value=!1)}),a(_,{title:"Import Data"},{default:l(()=>[a(D,null,{default:l(()=>[a(M,{modelValue:O.value,"onUpdate:modelValue":e[20]||(e[20]=o=>O.value=o),items:re,label:"Select Category",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),a(Me,{label:"Choose CSV file",variant:"outlined",accept:".csv","prepend-icon":"tabler-file-upload"})]),_:1}),a(oe,{class:"d-flex justify-end gap-2 pa-4"},{default:l(()=>[a(c,{variant:"tonal",color:"secondary",onClick:e[21]||(e[21]=o=>b.value=!1)},{default:l(()=>e[35]||(e[35]=[m(" Cancel ")])),_:1,__:[35]}),a(c,{onClick:Ce},{default:l(()=>e[36]||(e[36]=[m(" Import ")])),_:1,__:[36]})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});export{Ft as default};
