import{r as a,P as M,b4 as r,b5 as f}from"./main-B8QbR-yS.js";const P=()=>{const v=a(!1),m=a(null),d=a(null),o=a([]),y=a([]),n=a([]),h=a(null),i=a(!0),p=a(!1),w=e=>{if(!e)return"Unknown";const t=new Date(e);if(Number.isNaN(t.getTime()))return console.warn("Invalid date string:",e),"Unknown";const l=new Date().getTime()-t.getTime(),c=Math.floor(l/(1e3*60*60));if(c<1)return"Just now";if(c<24)return`${c} hours ago`;const u=Math.floor(c/24);return u===1?"1 day ago":u<7?`${u} days ago`:u<30?`${Math.floor(u/7)} weeks ago`:t.toLocaleDateString()},k=M(()=>p.value?!0:i.value),g=async()=>{try{v.value=!0,m.value=null;const e=await f("/v1/franchisor/dashboard/stats");if(e.success)d.value=e.data;else throw new Error("Failed to fetch dashboard stats")}catch(e){m.value=e.message||"Failed to fetch dashboard statistics",console.error("Dashboard stats error:",e)}finally{v.value=!1}},b=async()=>{try{const e=await f("/v1/franchisor/sales-associates");e.success&&Array.isArray(e.data)?o.value=e.data:o.value=[]}catch(e){console.error("Sales associates error:",e),o.value=[]}},A=async(e=10)=>{try{const t=await f(`/v1/franchisor/leads?limit=${e}`);t.success&&Array.isArray(t.data)?n.value=t.data:n.value=[]}catch(t){console.error("Leads error:",t),n.value=[]}},D=async()=>{try{const e=await f("/v1/franchisor/profile/completion-status");e.success?(h.value=e.data,i.value=!0):(i.value=!1,h.value=null)}catch(e){e.status===404||e.data&&e.data.success===!1?(i.value=!1,h.value=null):(i.value=!0,console.error("Profile completion error:",e))}},E=()=>{p.value=!0},$=()=>{var t;const e=[];Array.isArray(n.value)&&n.value.length>0&&n.value.slice(0,3).forEach(s=>{const l=`${s.firstName||""} ${s.lastName||""}`.trim()||"Unknown Lead",c=s.created_at||new Date().toISOString();e.push({id:s.id,type:"lead",title:`New lead: ${l}`,time:w(c),icon:"tabler-user-plus",color:"primary"})}),Array.isArray(o.value)&&o.value.length>0&&o.value.slice(0,2).forEach(s=>{if(s.status==="active"){const l=s.created_at||new Date().toISOString();e.push({id:s.id,type:"team",title:`${s.name} is managing ${s.leads_count} leads`,time:w(l),icon:"tabler-user-check",color:"info"})}}),(t=d.value)!=null&&t.currentMonthRevenue&&e.push({id:Date.now(),type:"revenue",title:`Monthly revenue: $${d.value.currentMonthRevenue.toLocaleString()}`,time:"This month",icon:"tabler-currency-riyal",color:"warning"}),y.value=e.filter(s=>s.time!=="Invalid Date").slice(0,5)},S=async()=>{await Promise.all([g(),b(),A(10),D()]),$()},I=async()=>{await S()},L=async()=>{try{return(await f("/v1/franchisor/profile/completion-status")).success===!0}catch(e){return e.status===404?!1:(console.error("Error checking franchise existence:",e),!0)}};return{isLoading:r(v),error:r(m),dashboardStats:r(d),salesAssociates:r(o),recentActivities:r(y),leads:r(n),profileCompletionStatus:r(h),isProfileComplete:r(k),franchiseExists:r(i),fetchDashboardStats:g,fetchSalesAssociates:b,fetchLeads:A,fetchProfileCompletion:D,dismissBanner:E,initializeDashboard:S,refreshDashboard:I,generateRecentActivities:$,checkFranchiseExists:L}};export{P as u};
