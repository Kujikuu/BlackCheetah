import{V as I,_ as P}from"./VDialog-6C-NQXCx.js";import{d as N,r as y,P as c,w as A,g as f,f as n,b as o,l as x,c as M,a9 as _,t as b,v as U,b5 as S,o as p}from"./main-gemCwVks.js";import{f as q}from"./franchisee-dashboard-BybX4VBn.js";import{V as E}from"./VCardText-BD5AHO-w.js";import{V as O}from"./VForm-FUZpY-zG.js";import{V as $,a as v}from"./VRow-DiX7eN30.js";import{V as h}from"./VTextField-BhxF6EAD.js";import{V as X}from"./VTextarea-OEcL0zKK.js";import{V as G}from"./VSelect-C9dxRhag.js";import{V as z}from"./VFileInput-CB0ItP4X.js";import{d as L,V as j}from"./VCard-DJ82mpnW.js";import{V as J}from"./VSpacer-Cpeayo2U.js";const R={key:0,class:"text-caption text-disabled mt-2"},ne=N({__name:"AddDocumentDialog",props:{isDialogVisible:{type:Boolean},franchiseId:{},unitId:{},documentData:{},mode:{}},emits:["update:isDialogVisible","documentSaved","documentAdded"],setup(F,{emit:T}){const i=F,V=T,D=y(!1),e=y({id:null,name:"",title:"",description:"",file:null,type:"other",status:"active",is_confidential:!1,expiry_date:null}),m=c({get:()=>i.isDialogVisible,set:s=>V("update:isDialogVisible",s)}),C=["FDD","Franchise Agreement","Operations Manual","Brand Guidelines","Legal Documents","Sales Report","Financial Statement","Marketing Materials","Training Materials","Quality Standards","Other"];A(()=>[i.isDialogVisible,i.documentData],()=>{i.isDialogVisible&&(i.documentData?e.value={...i.documentData}:e.value={id:null,name:"",title:"",description:"",file:null,type:i.mode==="unit"?"":"other",status:"active",is_confidential:!1,expiry_date:null})},{immediate:!0});const u=c(()=>i.mode==="unit");c(()=>u.value?e.value.title:e.value.name);const w=async()=>{var a,r,l;if(u.value&&!i.unitId){console.error("No unit ID available");return}if(!u.value&&!i.franchiseId){console.error("No franchise ID available");return}if(!(u.value?e.value.title:e.value.name)||!e.value.file){console.error("Document name/title and file are required");return}D.value=!0;try{if(u.value){const t=new FormData;t.append("title",e.value.title||""),t.append("description",e.value.description||""),t.append("type",e.value.type),t.append("status",e.value.status||"pending"),t.append("comment",""),e.value.file&&t.append("file",e.value.file);const d=await q.createDocument(i.unitId,t);d.success?(V("documentAdded",{...d.data,id:((a=d.data)==null?void 0:a.id)||Date.now(),title:e.value.title,description:e.value.description,type:e.value.type,fileName:(r=e.value.file)==null?void 0:r.name,fileSize:k(((l=e.value.file)==null?void 0:l.size)||0),uploadDate:new Date().toISOString().split("T")[0],status:e.value.status||"pending",comment:"",file:e.value.file}),m.value=!1):console.error("Failed to save document:",d.message)}else{const t=new FormData;t.append("name",e.value.name||""),t.append("description",e.value.description||""),t.append("type",e.value.type),t.append("status",e.value.status),t.append("is_confidential",e.value.is_confidential?"1":"0"),e.value.expiry_date&&t.append("expiry_date",e.value.expiry_date),e.value.file&&t.append("file",e.value.file);let d;e.value.id!==null?d=await S(`/v1/franchises/${i.franchiseId}/documents/${e.value.id}`,{method:"PUT",body:t}):d=await S(`/v1/franchises/${i.franchiseId}/documents`,{method:"POST",body:t}),d.success?(V("documentSaved"),m.value=!1):console.error("Failed to save document:",d.message)}}catch(t){console.error("Error saving document:",t)}finally{D.value=!1}},k=s=>{if(s===0)return"0 Bytes";const a=1024,r=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(s)/Math.log(a));return`${Number.parseFloat((s/a**l).toFixed(2))} ${r[l]}`},g=()=>{m.value=!1},B=c(()=>e.value.id!==null?"Edit Document":"Add New Document");return(s,a)=>{const r=P;return p(),f(I,{modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=l=>m.value=l),"max-width":"600"},{default:n(()=>[o(r,{onClick:g}),o(j,{title:B.value},{default:n(()=>[o(E,null,{default:n(()=>[o(O,null,{default:n(()=>[o($,null,{default:n(()=>[o(v,{cols:"12"},{default:n(()=>[u.value?(p(),f(h,{key:0,modelValue:e.value.title,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.title=l),label:"Document Title",placeholder:"Enter document title",variant:"outlined",required:""},null,8,["modelValue"])):(p(),f(h,{key:1,modelValue:e.value.name,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.name=l),label:"Document Name",placeholder:"Enter document name",variant:"outlined",required:""},null,8,["modelValue"]))]),_:1}),o(v,{cols:"12"},{default:n(()=>[o(X,{modelValue:e.value.description,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.description=l),label:"Description",placeholder:"Enter document description",rows:"3",variant:"outlined",required:u.value},null,8,["modelValue","required"])]),_:1}),u.value?(p(),f(v,{key:0,cols:"12"},{default:n(()=>[o(G,{modelValue:e.value.type,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.type=l),label:"Document Type",placeholder:"Select document type",items:C,variant:"outlined",required:""},null,8,["modelValue"])]),_:1})):x("",!0),o(v,{cols:"12"},{default:n(()=>[o(z,{modelValue:e.value.file,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.file=l),label:"Attach File",accept:u.value?".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.jpg,.jpeg,.png":".pdf,.doc,.docx","prepend-icon":"tabler-paperclip",variant:"outlined",required:""},null,8,["modelValue","accept"]),u.value?(p(),M("div",R," Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, JPG, JPEG, PNG ")):x("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),o(L,null,{default:n(()=>[o(J),o(_,{color:"secondary",variant:"outlined",onClick:g},{default:n(()=>a[6]||(a[6]=[b(" Cancel ")])),_:1,__:[6]}),o(_,{color:"primary",loading:D.value,onClick:w},{default:n(()=>[b(U(e.value.id!==null?"Update Document":"Add Document"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});export{ne as _};
