import{V as xe,_ as we}from"./VDataTableServer-CJVGHjAb.js";import{_ as Ve}from"./AppTextField.vue_vue_type_script_setup_true_lang-CS3XUpD5.js";import{_ as be}from"./AppSelect.vue_vue_type_script_setup_true_lang-B8w7sLqh.js";import{_ as Ce}from"./AddEditFranchiseeDrawer.vue_vue_type_script_setup_true_lang-hSsTaNPE.js";import{_ as Fe,a as ke}from"./ResetPasswordDialog.vue_vue_type_script_setup_true_lang-BiSc8xPH.js";import{_ as De}from"./ViewUserDialog.vue_vue_type_script_setup_true_lang-Bi5-RBnY.js";import{d as Ee,r,P as Pe,G as $e,aO as C,c as N,b as s,f as l,m as o,au as v,o as x,e as i,F as Te,i as Ue,g as S,v as d,x as Se,aa as f,l as J,t as p,a3 as $}from"./main-Bx5MqBCc.js";import{V as B,a as z}from"./VRow-BSfsb00B.js";import{V as Q,a as Ae,b as Le}from"./VCard-DXwsm8sH.js";import{V as O}from"./VCardText-881-qsDn.js";import{V as q}from"./VAvatar-Dq0WBzTg.js";import{V as I}from"./VDivider-BD3st0Tt.js";import{V as Ne}from"./VSpacer-iz17AWYx.js";import{V as H}from"./VMenu-BM_tEo9-.js";import{V as K,a as F,b as k}from"./VList-Bj_5rawV.js";import{V as Be}from"./VAlert-BH88qGLz.js";import{V as ze}from"./VChip-bIxYFvin.js";import{V as Oe}from"./VImg-CzTq61uy.js";import"./VPagination-BxAxJSyf.js";import"./VDataTable-D9ezTJkG.js";import"./VSelect-BX1t_AVR.js";import"./VTextField-rRgG8u4K.js";/* empty css                   */import"./VCounter-Bi3axogA.js";import"./VField-De9cGA2E.js";import"./form-Csz4zxvN.js";import"./easing-Bybner-F.js";import"./VInput-BjbhE5dO.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-C2XWOaDF.js";import"./VOverlay-3xscGKag.js";import"./lazy-DJP8iQaQ.js";import"./scopeId-DLFuo6Fo.js";import"./VCheckboxBtn-CxMC97UZ.js";import"./VSelectionControl-C67ZBesC.js";import"./VTable-CiDf8Yyj.js";import"./filter-C6vb6ifu.js";import"./validators-BYiRrju8.js";import"./AppDrawerHeaderSection.vue_vue_type_script_setup_true_lang-Dln60Iu6.js";import"./VNavigationDrawer-BHPvklZy.js";import"./ssrBoot-CXMLMhxv.js";import"./VForm-CcS6fukz.js";import"./VDialog-Da4LCNox.js";import"./VTooltip-DVQAZJkr.js";import"./formatters-WDr9EcLN.js";/* empty css              */import"./VSlideGroup-rdxh0fbF.js";const Ie={class:"d-flex justify-space-between"},Re={class:"d-flex flex-column gap-y-1"},je={class:"text-body-1 text-high-emphasis"},Me={class:"d-flex gap-x-2 align-center"},Ge={class:"text-h4"},We={class:"text-sm"},Je={class:"me-3 d-flex gap-3"},Qe={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},qe={style:{"inline-size":"15.625rem"}},He={class:"text-center pa-8"},Ke={class:"d-flex align-center gap-x-4"},Xe={key:1},Ye={class:"d-flex flex-column"},Ze={class:"text-base font-weight-medium"},et={class:"text-sm text-medium-emphasis"},tt={class:"text-body-1 text-high-emphasis"},st={class:"text-body-1"},at={class:"text-body-1"},lt={class:"d-flex gap-1"},Zt=Ee({__name:"franchisees",setup(ot){const g=r(""),w=r(),_=r(10),h=r(1),R=r([{key:"created_at",order:"desc"}]),j=r("desc"),c=r([]),X=t=>{var e;t.sortBy&&t.sortBy.length>0&&(R.value=t.sortBy,j.value=(e=t.sortBy[0])==null?void 0:e.order)},Y=[{title:"User",key:"user"},{title:"Location",key:"location"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],V=r([]),A=r(!1),u=r(""),L=r(0),T=async()=>{try{A.value=!0,u.value="";const t={search:g.value||void 0,status:w.value||void 0,sortBy:R.value||"created_at",sortOrder:j.value||"desc",perPage:_.value,page:h.value},e=await C("/v1/admin/users/franchisees",{method:"GET",params:t});e.success?(V.value=e.data.data||[],L.value=e.data.total||0):u.value=e.message||"Failed to fetch franchisees"}catch(t){console.error("Error fetching franchisees:",t),u.value="Failed to fetch franchisees"}finally{A.value=!1}},Z=Pe(()=>{let t=V.value;return g.value&&(t=t.filter(e=>e.fullName.toLowerCase().includes(g.value.toLowerCase())||e.email.toLowerCase().includes(g.value.toLowerCase())||e.location.toLowerCase().includes(g.value.toLowerCase()))),w.value&&(t=t.filter(e=>e.status===w.value)),t}),ee=[{title:"Pending",value:"pending"},{title:"Active",value:"active"},{title:"Inactive",value:"inactive"}],te=t=>{const e=t.toLowerCase();return e==="pending"?"warning":e==="active"?"success":e==="inactive"?"secondary":"primary"},y=r(!1),D=r(!1),E=r(!1),U=r(!1),m=r(null),b=r(null),se=t=>t>0?`+${t}`:t,ae=t=>{if(!t||typeof t!="string")return"U";const e=t.split(" ");return e.length>1?`${e[0][0]}${e[1][0]}`:t.slice(0,2)},le=async t=>{try{const e={...t,city:t.location,role:"franchisee"};delete e.location;const n=await C("/v1/admin/users",{method:"POST",body:e});n.success?await T():u.value=n.message||"Failed to create franchisee"}catch(e){console.error("Error creating franchisee:",e),u.value="Failed to create franchisee"}},oe=t=>{m.value={...t},y.value=!0},ie=async t=>{try{const e={...t,city:t.location};delete e.location;const n=await C(`/v1/admin/users/${t.id}`,{method:"PUT",body:e});n.success?(await T(),m.value=null):u.value=n.message||"Failed to update franchisee"}catch(e){console.error("Error updating franchisee:",e),u.value="Failed to update franchisee"}},re=async t=>{t.id?await ie(t):await le(t)},ne=t=>{b.value=t,D.value=!0},ue=async()=>{if(b.value){try{const t=await C(`/v1/admin/users/${b.value.id}`,{method:"DELETE"});if(t.success){await T();const e=c.value.findIndex(n=>n===b.value.id);e!==-1&&c.value.splice(e,1)}else u.value=t.message||"Failed to delete franchisee"}catch(t){console.error("Error deleting franchisee:",t),u.value="Failed to delete franchisee"}D.value=!1,b.value=null}},de=t=>{m.value=t,E.value=!0},ce=async t=>{var e;if(m.value){try{const n=await C(`/v1/admin/users/${m.value.id}/reset-password`,{method:"POST",body:{password:t}});n.success?console.log("Password reset successfully for:",(e=m.value)==null?void 0:e.fullName):u.value=n.message||"Failed to reset password"}catch(n){console.error("Error resetting password:",n),u.value="Failed to reset password"}E.value=!1,m.value=null}},pe=()=>{m.value=null};$e(()=>{T(),_e()});const me=t=>{m.value=t,U.value=!0},fe=()=>{y.value=!0},ve=()=>{const t=c.value.length>0?V.value.filter(e=>c.value.includes(e.id)):V.value;console.log("Exporting to CSV:",t)},ge=()=>{const t=c.value.length>0?V.value.filter(e=>c.value.includes(e.id)):V.value;console.log("Exporting to PDF:",t)},M=r([{title:"Total Franchisees",value:"0",change:0,desc:"All registered franchisees",icon:"tabler-user-check",iconColor:"primary"},{title:"Active Franchisees",value:"0",change:0,desc:"Currently active",icon:"tabler-user-circle",iconColor:"success"},{title:"Pending Approval",value:"0",change:0,desc:"Awaiting verification",icon:"tabler-clock",iconColor:"warning"}]),_e=async()=>{try{const t=await C("/v1/admin/users/franchisees/stats");t.success&&(M.value=t.data)}catch(t){console.error("Error fetching franchisee stats:",t)}};return(t,e)=>{var G,W;const n=be,he=Ve,ye=we;return x(),N("section",null,[s(B,{class:"mb-6"},{default:l(()=>[s(z,{cols:"12"},{default:l(()=>e[14]||(e[14]=[i("div",{class:"d-flex align-center justify-space-between"},[i("div",null,[i("h2",{class:"text-h2 mb-1"}," Franchisee Management "),i("p",{class:"text-body-1 text-medium-emphasis"}," Manage and monitor all franchisee accounts ")])],-1)])),_:1,__:[14]})]),_:1}),s(B,{class:"mb-6"},{default:l(()=>[(x(!0),N(Te,null,Ue(o(M),(a,P)=>(x(),S(z,{key:P,cols:"12",md:"4",sm:"6"},{default:l(()=>[s(Q,null,{default:l(()=>[s(O,null,{default:l(()=>[i("div",Ie,[i("div",Re,[i("div",je,d(a.title),1),i("div",Me,[i("h4",Ge,d(a.value),1),i("div",{class:Se(["text-base",a.change>0?"text-success":"text-error"])}," ("+d(se(a.change))+"%) ",3)]),i("div",We,d(a.desc),1)]),s(q,{color:a.iconColor,variant:"tonal",rounded:"",size:"42"},{default:l(()=>[s(f,{icon:a.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(Q,{class:"mb-6"},{default:l(()=>[s(Ae,{class:"pb-4"},{default:l(()=>[s(Le,null,{default:l(()=>e[15]||(e[15]=[p("Filters")])),_:1,__:[15]})]),_:1}),s(O,null,{default:l(()=>[s(B,null,{default:l(()=>[s(z,{cols:"12",sm:"4"},{default:l(()=>[s(n,{modelValue:o(w),"onUpdate:modelValue":e[0]||(e[0]=a=>v(w)?w.value=a:null),placeholder:"Select Status",items:ee,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(I),s(O,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[i("div",Je,[s(n,{"model-value":o(_),items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[1]||(e[1]=a=>_.value=parseInt(a,10))},null,8,["model-value"]),o(c).length>0?(x(),S($,{key:0,variant:"tonal",color:"error",onClick:t.bulkDelete},{default:l(()=>[s(f,{icon:"tabler-trash",class:"me-2"}),p(" Delete Selected ("+d(o(c).length)+") ",1)]),_:1},8,["onClick"])):J("",!0)]),s(Ne),i("div",Qe,[i("div",qe,[s(he,{modelValue:o(g),"onUpdate:modelValue":e[2]||(e[2]=a=>v(g)?g.value=a:null),placeholder:"Search Franchisee"},null,8,["modelValue"])]),s($,{variant:"tonal",color:"secondary"},{default:l(()=>[s(f,{icon:"tabler-upload",class:"me-2"}),p(" Export "+d(o(c).length>0?`(${o(c).length})`:"All")+" ",1),s(H,{activator:"parent"},{default:l(()=>[s(K,null,{default:l(()=>[s(F,{onClick:ve},{prepend:l(()=>[s(f,{icon:"tabler-file-type-csv"})]),default:l(()=>[s(k,null,{default:l(()=>e[16]||(e[16]=[p("Export to CSV")])),_:1,__:[16]})]),_:1}),s(F,{onClick:ge},{prepend:l(()=>[s(f,{icon:"tabler-file-type-pdf"})]),default:l(()=>[s(k,null,{default:l(()=>e[17]||(e[17]=[p("Export to PDF")])),_:1,__:[17]})]),_:1})]),_:1})]),_:1})]),_:1}),s($,{"prepend-icon":"tabler-plus",onClick:e[3]||(e[3]=a=>y.value=!0)},{default:l(()=>e[18]||(e[18]=[p(" Add New Franchisee ")])),_:1,__:[18]})])]),_:1}),s(I),o(u)?(x(),S(Be,{key:0,type:"error",class:"ma-4",closable:"","onClick:close":e[4]||(e[4]=a=>u.value="")},{default:l(()=>[p(d(o(u)),1)]),_:1})):J("",!0),s(xe,{"items-per-page":o(_),"onUpdate:itemsPerPage":e[7]||(e[7]=a=>v(_)?_.value=a:null),"model-value":o(c),"onUpdate:modelValue":e[8]||(e[8]=a=>v(c)?c.value=a:null),page:o(h),"onUpdate:page":e[9]||(e[9]=a=>v(h)?h.value=a:null),items:o(Z),"item-value":"id","items-length":o(L),headers:Y,loading:o(A),class:"text-no-wrap","show-select":"","onUpdate:options":X},{"no-data":l(()=>[i("div",He,[s(f,{icon:"tabler-users-off",size:"64",class:"mb-4 text-disabled"}),e[20]||(e[20]=i("h3",{class:"text-h5 mb-2"}," No Franchisees Found ",-1)),e[21]||(e[21]=i("p",{class:"text-body-1 text-medium-emphasis mb-4"}," No franchisees match your search criteria. Try adjusting your filters. ",-1)),s($,{color:"primary",onClick:e[5]||(e[5]=a=>y.value=!0)},{default:l(()=>e[19]||(e[19]=[p(" Add First Franchisee ")])),_:1,__:[19]})])]),"item.user":l(({item:a})=>[i("div",Ke,[s(q,{size:"34",variant:a.avatar?void 0:"tonal",color:"info"},{default:l(()=>[a.avatar?(x(),S(Oe,{key:0,src:a.avatar},null,8,["src"])):(x(),N("span",Xe,d(ae(a.fullName)),1))]),_:2},1032,["variant"]),i("div",Ye,[i("h6",Ze,d(a.fullName),1),i("div",et," Joined: "+d(a.joinedDate),1)])])]),"item.location":l(({item:a})=>[i("div",tt,d(a.location),1)]),"item.email":l(({item:a})=>[i("div",st,d(a.email),1)]),"item.phone":l(({item:a})=>[i("div",at,d(a.phone),1)]),"item.status":l(({item:a})=>[s(ze,{color:te(a.status),size:"small",label:"",class:"text-capitalize"},{default:l(()=>[p(d(a.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:a})=>[i("div",lt,[s($,{icon:"",variant:"text",color:"medium-emphasis",size:"small"},{default:l(()=>[s(f,{icon:"tabler-dots-vertical",size:"22"}),s(H,{activator:"parent"},{default:l(()=>[s(K,null,{default:l(()=>[s(F,{onClick:P=>me(a)},{prepend:l(()=>[s(f,{icon:"tabler-eye"})]),default:l(()=>[s(k,null,{default:l(()=>e[22]||(e[22]=[p("View")])),_:1,__:[22]})]),_:2},1032,["onClick"]),s(F,{onClick:P=>oe(a)},{prepend:l(()=>[s(f,{icon:"tabler-pencil"})]),default:l(()=>[s(k,null,{default:l(()=>e[23]||(e[23]=[p("Edit")])),_:1,__:[23]})]),_:2},1032,["onClick"]),s(F,{onClick:P=>de(a)},{prepend:l(()=>[s(f,{icon:"tabler-key"})]),default:l(()=>[s(k,null,{default:l(()=>e[24]||(e[24]=[p("Reset Password")])),_:1,__:[24]})]),_:2},1032,["onClick"]),s(I,{class:"my-2"}),s(F,{onClick:P=>ne(a)},{prepend:l(()=>[s(f,{icon:"tabler-trash",color:"error"})]),default:l(()=>[s(k,{class:"text-error"},{default:l(()=>e[25]||(e[25]=[p(" Delete ")])),_:1,__:[25]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),bottom:l(()=>[s(ye,{page:o(h),"onUpdate:page":e[6]||(e[6]=a=>v(h)?h.value=a:null),"items-per-page":o(_),"total-items":o(L)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length","loading"])]),_:1}),s(Ce,{"is-drawer-open":o(y),"onUpdate:isDrawerOpen":[e[10]||(e[10]=a=>v(y)?y.value=a:null),pe],franchisee:o(m),onFranchiseeData:re},null,8,["is-drawer-open","franchisee"]),s(Fe,{"is-dialog-open":o(D),"onUpdate:isDialogOpen":e[11]||(e[11]=a=>v(D)?D.value=a:null),"user-name":(G=o(b))==null?void 0:G.fullName,"user-type":"Franchisee",onConfirm:ue},null,8,["is-dialog-open","user-name"]),s(ke,{"is-dialog-open":o(E),"onUpdate:isDialogOpen":e[12]||(e[12]=a=>v(E)?E.value=a:null),"user-name":(W=o(m))==null?void 0:W.fullName,onConfirm:ce},null,8,["is-dialog-open","user-name"]),s(De,{"is-dialog-open":o(U),"onUpdate:isDialogOpen":e[13]||(e[13]=a=>v(U)?U.value=a:null),user:o(m),"user-type":"Franchisee",onEdit:fe},null,8,["is-dialog-open","user"])])}}});export{Zt as default};
