import{V as E,_ as Z}from"./VDialog-CEq2jzbd.js";import{b5 as C,b2 as tt,d as st,r as v,P as S,G as et,c as at,b as t,g as P,l as I,f as s,m as o,aR as L,j as lt,o as w,e as a,ax as _,v as u,t as m,a9 as U}from"./main-B8QbR-yS.js";import{V as M,a as p}from"./VRow-LlT6Azsr.js";import{V as ot}from"./VAlert-DpqH6FXl.js";import{V as k,a as it,b as rt,d as N}from"./VCard-D9PhtsJ0.js";import{V as y}from"./VCardText-Cbtr6Qhr.js";import{V as D}from"./VAvatar-87LH5tAk.js";import{V}from"./VDivider-DOfIMbJY.js";import{V as dt}from"./VDataTable-FYAU2aQJ.js";import{V as nt}from"./VMenu-TQcmpCCv.js";import{V as ut,a as G,b as F}from"./VList-BJCgULVd.js";import{V as T}from"./VChip-CgHwmC-k.js";import{V as q}from"./VSpacer-BSXBFFTK.js";import{V as ct}from"./VSelect-GSzN3Qps.js";import"./VOverlay-B3La6Ajr.js";import"./forwardRefs--KQCZfKO.js";import"./scopeId-DyQ6a1uN.js";import"./VImg-Ceu2Mboj.js";import"./dialog-transition-Dy2Gj1XO.js";/* empty css              */import"./VCheckboxBtn-CWPoGbRz.js";import"./VSelectionControl-DDEVNAf7.js";import"./form-Dt-W1fp6.js";import"./VTable-CgkStP3y.js";import"./VSlideGroup-BuNiGLv2.js";import"./VTextField-C7_y5spr.js";import"./VField-Bw51LFql.js";import"./VInput-DB3XZUVb.js";const z=()=>{const c=tt("userData").value,n=c==null?void 0:c.role;return n==="sales"?"/v1/sales/tasks":n==="franchisor"?"/v1/franchisor/tasks":"/v1/tasks"},R={async getMyTasks(l){const c=z(),n=new URLSearchParams;l!=null&&l.status&&n.append("status",l.status),l!=null&&l.priority&&n.append("priority",l.priority),l!=null&&l.category&&n.append("category",l.category),l!=null&&l.page&&n.append("page",l.page.toString()),l!=null&&l.perPage&&n.append("per_page",l.perPage.toString());const i=n.toString(),b=i?`${c}?${i}`:c;return await C(b,{method:"GET"})},async getStatistics(){const l=z();return await C(`${l}/statistics`,{method:"GET"})},async updateTaskStatus(l,c){const n=z();return await C(`${n}/${l}/status`,{method:"PATCH",body:{status:c}})},async getTask(l){const c=z();return await C(`${c}/${l}`,{method:"GET"})}},mt={class:"ms-4"},pt={class:"text-h4"},ft={class:"ms-4"},vt={class:"text-h4"},_t={class:"ms-4"},kt={class:"text-h4"},bt={class:"ms-4"},yt={class:"text-h4"},gt={class:"text-base font-weight-medium"},xt={class:"text-body-2 text-disabled"},Vt={class:"text-h6 mb-2"},Tt={class:"text-body-1 mb-4"},Ct={class:"text-body-1"},St={class:"text-body-1"},wt={class:"text-body-1"},Dt={class:"mb-4"},zt={class:"text-base font-weight-medium mb-2"},ht={class:"text-body-2 text-disabled"},ls=st({__name:"my-tasks",setup(l){lt();const c=v(!1),n=v(!1),i=v(null),b=v([]),g=v({totalTasks:0,completedTasks:0,inProgressTasks:0,dueTasks:0}),h=v(!1),f=v(null),H=S(()=>g.value.totalTasks),j=S(()=>g.value.completedTasks),J=S(()=>g.value.inProgressTasks),K=S(()=>g.value.dueTasks),B=async()=>{try{h.value=!0,f.value=null;const[d,e]=await Promise.all([R.getMyTasks(),R.getStatistics()]);d.success&&(b.value=d.data),e.success&&(g.value=e.data)}catch(d){console.error("Error fetching tasks:",d),f.value=d.message||"Failed to load tasks"}finally{h.value=!1}};et(()=>{B()});const $=d=>d==="completed"?"success":d==="in_progress"?"warning":d==="pending"?"info":"secondary",A=d=>d==="high"?"error":d==="medium"?"warning":d==="low"?"info":"secondary",O=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],Q=d=>{i.value=d,c.value=!0},W=d=>{i.value={...d},n.value=!0},X=async d=>{if(i.value)try{const e=await R.updateTaskStatus(i.value.id,d);if(e.success){const x=b.value.findIndex(r=>r.id===i.value.id);x!==-1&&(b.value[x].status=d),await B(),n.value=!1,i.value=null}else f.value=e.message||"Failed to update task status"}catch(e){console.error("Error updating task status:",e),f.value=e.message||"Failed to update task status"}};return(d,e)=>{const x=Z;return w(),at("section",null,[t(M,{class:"mb-6"},{default:s(()=>[t(p,{cols:"12"},{default:s(()=>e[7]||(e[7]=[a("div",null,[a("h2",{class:"text-h2 mb-1"}," My Tasks "),a("p",{class:"text-body-1 text-medium-emphasis"}," Track and manage tasks assigned to you ")],-1)])),_:1,__:[7]})]),_:1}),t(M,{class:"mb-6"},{default:s(()=>[t(p,{cols:"12",md:"3"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"d-flex align-center"},{default:s(()=>[t(D,{size:"44",rounded:"",color:"primary",variant:"tonal"},{default:s(()=>[t(_,{icon:"tabler-checklist",size:"26"})]),_:1}),a("div",mt,[e[8]||(e[8]=a("div",{class:"text-body-2 text-disabled"}," Total Tasks ",-1)),a("h4",pt,u(o(H)),1)])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"3"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"d-flex align-center"},{default:s(()=>[t(D,{size:"44",rounded:"",color:"success",variant:"tonal"},{default:s(()=>[t(_,{icon:"tabler-check",size:"26"})]),_:1}),a("div",ft,[e[9]||(e[9]=a("div",{class:"text-body-2 text-disabled"}," Completed ",-1)),a("h4",vt,u(o(j)),1)])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"3"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"d-flex align-center"},{default:s(()=>[t(D,{size:"44",rounded:"",color:"warning",variant:"tonal"},{default:s(()=>[t(_,{icon:"tabler-clock",size:"26"})]),_:1}),a("div",_t,[e[10]||(e[10]=a("div",{class:"text-body-2 text-disabled"}," In Progress ",-1)),a("h4",kt,u(o(J)),1)])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"3"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"d-flex align-center"},{default:s(()=>[t(D,{size:"44",rounded:"",color:"error",variant:"tonal"},{default:s(()=>[t(_,{icon:"tabler-alert-circle",size:"26"})]),_:1}),a("div",bt,[e[11]||(e[11]=a("div",{class:"text-body-2 text-disabled"}," Due ",-1)),a("h4",yt,u(o(K)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(f)?(w(),P(ot,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-6","onClick:close":e[0]||(e[0]=r=>f.value=null)},{default:s(()=>[m(u(o(f)),1)]),_:1})):I("",!0),t(k,null,{default:s(()=>[t(it,{class:"pb-4"},{default:s(()=>[t(rt,null,{default:s(()=>e[12]||(e[12]=[m("My Tasks")])),_:1,__:[12]})]),_:1}),t(V),t(dt,{items:o(b),headers:O,loading:o(h),class:"text-no-wrap","item-value":"id"},{"item.taskInfo":s(({item:r})=>[a("div",null,[a("h6",gt,u(r.title),1),a("div",xt,u(r.description),1)])]),"item.priority":s(({item:r})=>[t(T,{color:A(r.priority),size:"small",label:"",class:"text-capitalize"},{default:s(()=>[m(u(r.priority),1)]),_:2},1032,["color"])]),"item.status":s(({item:r})=>[t(T,{color:$(r.status),size:"small",label:"",class:"text-capitalize"},{default:s(()=>[m(u(r.status),1)]),_:2},1032,["color"])]),"item.actions":s(({item:r})=>[t(U,{icon:"",variant:"text",color:"medium-emphasis",size:"small"},{default:s(()=>[t(_,{icon:"tabler-dots-vertical"}),t(nt,{activator:"parent"},{default:s(()=>[t(ut,null,{default:s(()=>[t(G,{onClick:Y=>Q(r)},{prepend:s(()=>[t(_,{icon:"tabler-eye"})]),default:s(()=>[t(F,null,{default:s(()=>e[13]||(e[13]=[m("View")])),_:1,__:[13]})]),_:2},1032,["onClick"]),t(G,{onClick:Y=>W(r)},{prepend:s(()=>[t(_,{icon:"tabler-refresh"})]),default:s(()=>[t(F,null,{default:s(()=>e[14]||(e[14]=[m("Change Status")])),_:1,__:[14]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["items","loading"])]),_:1}),t(E,{modelValue:o(c),"onUpdate:modelValue":e[3]||(e[3]=r=>L(c)?c.value=r:null),"max-width":"600"},{default:s(()=>[t(x,{onClick:e[1]||(e[1]=r=>c.value=!1)}),t(k,{title:"Task Details"},{default:s(()=>[t(V),o(i)?(w(),P(y,{key:0,class:"pa-6"},{default:s(()=>[t(M,null,{default:s(()=>[t(p,{cols:"12"},{default:s(()=>[a("h6",Vt,u(o(i).title),1),a("p",Tt,u(o(i).description),1)]),_:1}),t(p,{cols:"12",md:"6"},{default:s(()=>[e[15]||(e[15]=a("div",{class:"text-body-2 text-disabled mb-1"}," Category ",-1)),a("div",Ct,u(o(i).category),1)]),_:1,__:[15]}),t(p,{cols:"12",md:"6"},{default:s(()=>[e[16]||(e[16]=a("div",{class:"text-body-2 text-disabled mb-1"}," Start Date ",-1)),a("div",St,u(o(i).startDate),1)]),_:1,__:[16]}),t(p,{cols:"12",md:"6"},{default:s(()=>[e[17]||(e[17]=a("div",{class:"text-body-2 text-disabled mb-1"}," Due Date ",-1)),a("div",wt,u(o(i).dueDate),1)]),_:1,__:[17]}),t(p,{cols:"12",md:"6"},{default:s(()=>[e[18]||(e[18]=a("div",{class:"text-body-2 text-disabled mb-1"}," Priority ",-1)),t(T,{color:A(o(i).priority),size:"small",label:"",class:"text-capitalize"},{default:s(()=>[m(u(o(i).priority),1)]),_:1},8,["color"])]),_:1,__:[18]}),t(p,{cols:"12",md:"6"},{default:s(()=>[e[19]||(e[19]=a("div",{class:"text-body-2 text-disabled mb-1"}," Status ",-1)),t(T,{color:$(o(i).status),size:"small",label:"",class:"text-capitalize"},{default:s(()=>[m(u(o(i).status),1)]),_:1},8,["color"])]),_:1,__:[19]})]),_:1})]),_:1})):I("",!0),t(V),t(N,{class:"pa-6"},{default:s(()=>[t(q),t(U,{color:"secondary",variant:"tonal",onClick:e[2]||(e[2]=r=>c.value=!1)},{default:s(()=>e[20]||(e[20]=[m(" Close ")])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(E,{modelValue:o(n),"onUpdate:modelValue":e[6]||(e[6]=r=>L(n)?n.value=r:null),"max-width":"600"},{default:s(()=>[t(x,{onClick:e[4]||(e[4]=r=>n.value=!1)}),t(k,{title:"Change Task Status"},{default:s(()=>[t(V),o(i)?(w(),P(y,{key:0,class:"pa-6"},{default:s(()=>[a("div",Dt,[a("h6",zt,u(o(i).title),1),a("div",ht,[e[21]||(e[21]=m(" Current Status: ")),t(T,{color:$(o(i).status),size:"small",label:"",class:"text-capitalize ml-2"},{default:s(()=>[m(u(o(i).status),1)]),_:1},8,["color"])])]),t(ct,{label:"New Status",items:[{title:"Pending",value:"pending"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],"model-value":o(i).status,required:"","onUpdate:modelValue":X},null,8,["model-value"])]),_:1})):I("",!0),t(V),t(N,{class:"pa-6"},{default:s(()=>[t(q),t(U,{color:"secondary",variant:"tonal",onClick:e[5]||(e[5]=r=>n.value=!1)},{default:s(()=>e[22]||(e[22]=[m(" Cancel ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{ls as default};
