import{V as _,_ as O}from"./VDialog-CEq2jzbd.js";import{r as v,b4 as D,b5 as C,d as P,P as q,w,g as I,f as r,b as a,b3 as x,m as t,aR as R,a9 as A,t as h,o as B}from"./main-B8QbR-yS.js";import{V as E}from"./VCardText-Cbtr6Qhr.js";import{V as N}from"./VForm-C9sxpau4.js";import{V as M,a as c}from"./VRow-LlT6Azsr.js";import{V as b}from"./VTextField-C7_y5spr.js";import{V as $}from"./VTextarea-1ursQqQ2.js";import{V as U}from"./VSelect-GSzN3Qps.js";import{V as z}from"./VDivider-DOfIMbJY.js";import{d as K,V as L}from"./VCard-D9PhtsJ0.js";import{V as G}from"./VSpacer-BSXBFFTK.js";const Y=()=>{const p=v([]),f=v([]),u=v(!1),V=v(null),T=async()=>{var n,o;try{u.value=!0,V.value=null;const s=await C("/v1/franchisor/franchisees");s.success&&((n=s.data)!=null&&n.data)?p.value=s.data.data.map(m=>({id:m.id,name:m.name,email:m.email,role:"franchisee",status:m.status})):p.value=[]}catch(s){console.error("Failed to fetch franchisees:",s),V.value=((o=s==null?void 0:s.data)==null?void 0:o.message)||"Failed to fetch franchisees",p.value=[]}finally{u.value=!1}},y=async()=>{var n;try{u.value=!0,V.value=null;const o=await C("/v1/franchisor/sales-associates");o.success&&o.data?f.value=o.data.map(s=>({id:s.id,name:s.name,email:s.email,role:"sales",status:s.status})):f.value=[]}catch(o){console.error("Failed to fetch sales users:",o),V.value=((n=o==null?void 0:o.data)==null?void 0:n.message)||"Failed to fetch sales users",f.value=[]}finally{u.value=!1}},S=n=>(n==="franchisee"?p.value:f.value).filter(s=>s.status==="active").map(s=>({title:`${s.name} (${s.email})`,value:s.id,subtitle:s.role})),l=(n,o)=>{const m=(o==="franchisee"?p.value:f.value).find(k=>k.id===n);return m?m.name:"Unknown User"},g=async(n="both")=>{(n==="franchisee"||n==="both")&&await T(),(n==="sales"||n==="both")&&await y()};return{franchisees:D(p),salesUsers:D(f),loading:D(u),error:D(V),fetchFranchisees:T,fetchSalesUsers:y,getUsersForSelect:S,getUserNameById:l,initializeUsers:g}},j=["Onboarding","Training","Compliance","Maintenance","Marketing","Operations","Finance","Support","Other"],J=[{title:"Low",value:"low"},{title:"Medium",value:"medium"},{title:"High",value:"high"},{title:"Urgent",value:"urgent"}],Q=[{title:"Pending",value:"pending"},{title:"On Hold",value:"on_hold"},{title:"Cancelled",value:"cancelled"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],ne=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Assigned To",key:"assignedTo"},{title:"Unit",key:"unitName"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],ue=P({__name:"CreateTaskModal",props:{isDialogVisible:{type:Boolean},currentTab:{},defaultAssignedTo:{},unitId:{},disableAssignedTo:{type:Boolean}},emits:["update:isDialogVisible","taskCreated"],setup(p,{emit:f}){const u=p,V=f,{getUsersForSelect:T,initializeUsers:y,loading:S}=Y(),l=v({title:"",description:"",category:"",assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}),g=v(!1),n=q(()=>{const d=u.currentTab||"franchisee";return T(d)}),o=d=>!!d||"This field is required",s=d=>{V("update:isDialogVisible",d)},m=()=>{l.value={title:"",description:"",category:"",assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}},k=()=>{if(g.value){const d={id:Date.now(),...l.value};V("taskCreated",d),m(),s(!1)}},F=()=>{m(),s(!1)};return w(()=>u.isDialogVisible,async d=>{if(d){const e=u.currentTab||"franchisee";await y(e),u.defaultAssignedTo&&(l.value.assignedTo=u.defaultAssignedTo)}else m()}),w(()=>u.currentTab,async d=>{u.isDialogVisible&&d&&(await y(d),l.value.assignedTo="")}),(d,e)=>{const H=O;return B(),I(_,{"model-value":u.isDialogVisible,"max-width":"600",persistent:"","onUpdate:modelValue":s},{default:r(()=>[a(H,{onClick:e[0]||(e[0]=i=>s(!1))}),a(L,{title:"Create New Task"},{default:r(()=>[a(E,{class:"pa-6"},{default:r(()=>[a(N,{modelValue:t(g),"onUpdate:modelValue":e[11]||(e[11]=i=>R(g)?g.value=i:null),onSubmit:x(k,["prevent"])},{default:r(()=>[a(M,null,{default:r(()=>[a(c,{cols:"12"},{default:r(()=>[a(b,{modelValue:t(l).title,"onUpdate:modelValue":e[1]||(e[1]=i=>t(l).title=i),label:"Task Title",placeholder:"Enter task title",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12"},{default:r(()=>[a($,{modelValue:t(l).description,"onUpdate:modelValue":e[2]||(e[2]=i=>t(l).description=i),label:"Description",placeholder:"Enter task description",rows:"3",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"6"},{default:r(()=>[a(U,{modelValue:t(l).category,"onUpdate:modelValue":e[3]||(e[3]=i=>t(l).category=i),label:"Category",placeholder:"Select category",items:t(j),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),a(c,{cols:"12",md:"6"},{default:r(()=>[a(U,{modelValue:t(l).assignedTo,"onUpdate:modelValue":e[4]||(e[4]=i=>t(l).assignedTo=i),label:"Assigned To",placeholder:"Select user",items:t(n),loading:t(S),rules:[o],"item-title":"title","item-value":"value",disabled:u.disableAssignedTo,required:""},null,8,["modelValue","items","loading","rules","disabled"])]),_:1}),a(c,{cols:"12",md:"6"},{default:r(()=>[a(b,{modelValue:t(l).startDate,"onUpdate:modelValue":e[5]||(e[5]=i=>t(l).startDate=i),label:"Start Date",type:"date",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"6"},{default:r(()=>[a(b,{modelValue:t(l).dueDate,"onUpdate:modelValue":e[6]||(e[6]=i=>t(l).dueDate=i),label:"Due Date",type:"date",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"6"},{default:r(()=>[a(U,{modelValue:t(l).priority,"onUpdate:modelValue":e[7]||(e[7]=i=>t(l).priority=i),label:"Priority",placeholder:"Select priority",items:t(J),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),a(c,{cols:"12",md:"6"},{default:r(()=>[a(U,{modelValue:t(l).status,"onUpdate:modelValue":e[8]||(e[8]=i=>t(l).status=i),label:"Status",placeholder:"Select status",items:t(Q),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),a(c,{cols:"12",md:"6"},{default:r(()=>[a(b,{modelValue:t(l).estimatedHours,"onUpdate:modelValue":e[9]||(e[9]=i=>t(l).estimatedHours=i),label:"Estimated Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"6"},{default:r(()=>[a(b,{modelValue:t(l).actualHours,"onUpdate:modelValue":e[10]||(e[10]=i=>t(l).actualHours=i),label:"Actual Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(z),a(K,{class:"pa-6"},{default:r(()=>[a(G),a(A,{color:"error",variant:"text",onClick:F},{default:r(()=>e[12]||(e[12]=[h(" Cancel ")])),_:1,__:[12]}),a(A,{color:"primary",disabled:!t(g),onClick:k},{default:r(()=>e[13]||(e[13]=[h(" Create Task ")])),_:1,__:[13]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{J as P,Q as S,ne as T,ue as _,j as a,Y as u};
