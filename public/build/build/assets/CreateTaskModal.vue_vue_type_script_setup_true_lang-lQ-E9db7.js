import{r as v,aN as D,aO as w,d as P,P as q,w as h,g as x,f as r,b as e,t as C,aM as I,m as t,au as O,a3 as A,o as _}from"./main-BrAmouoN.js";import{V as N}from"./VDialog-D2qVGxKL.js";import{b as R,d as E,V as M}from"./VCard-DApPZHvP.js";import{V as F}from"./VDivider-Ch4oqZye.js";import{V as B}from"./VCardText-CsVBN6BO.js";import{V as $}from"./VForm-CY7eO4cM.js";import{V as z,a as c}from"./VRow-DyPI-5aI.js";import{V as T}from"./VTextField-BffrunyH.js";import{V as K}from"./VTextarea-Bzl0g3zg.js";import{V as S}from"./VSelect-ClEfwI_Z.js";import{V as L}from"./VSpacer-BZy6xYJS.js";const G=()=>{const f=v([]),p=v([]),n=v(!1),V=v(null),b=async()=>{var u,o;try{n.value=!0,V.value=null;const s=await w("/v1/franchisor/franchisees");s.success&&((u=s.data)!=null&&u.data)?f.value=s.data.data.map(m=>({id:m.id,name:m.name,email:m.email,role:"franchisee",status:m.status})):f.value=[]}catch(s){console.error("Failed to fetch franchisees:",s),V.value=((o=s==null?void 0:s.data)==null?void 0:o.message)||"Failed to fetch franchisees",f.value=[]}finally{n.value=!1}},y=async()=>{var u;try{n.value=!0,V.value=null;const o=await w("/v1/franchisor/sales-associates");o.success&&o.data?p.value=o.data.map(s=>({id:s.id,name:s.name,email:s.email,role:"sales",status:s.status})):p.value=[]}catch(o){console.error("Failed to fetch sales users:",o),V.value=((u=o==null?void 0:o.data)==null?void 0:u.message)||"Failed to fetch sales users",p.value=[]}finally{n.value=!1}},U=u=>(u==="franchisee"?f.value:p.value).filter(s=>s.status==="active").map(s=>({title:`${s.name} (${s.email})`,value:s.id,subtitle:s.role})),l=(u,o)=>{const m=(o==="franchisee"?f.value:p.value).find(k=>k.id===u);return m?m.name:"Unknown User"},g=async(u="both")=>{(u==="franchisee"||u==="both")&&await b(),(u==="sales"||u==="both")&&await y()};return{franchisees:D(f),salesUsers:D(p),loading:D(n),error:D(V),fetchFranchisees:b,fetchSalesUsers:y,getUsersForSelect:U,getUserNameById:l,initializeUsers:g}},Q=["Operations","Training","Maintenance","Marketing","Finance","HR","Quality Control","Customer Service"],Y=[{title:"Low",value:"low"},{title:"Medium",value:"medium"},{title:"High",value:"high"}],j=[{title:"Pending",value:"pending"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],re=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Assigned To",key:"assignedTo"},{title:"Unit",key:"unitName"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],ue=P({__name:"CreateTaskModal",props:{isDialogVisible:{type:Boolean},currentTab:{},defaultAssignedTo:{},unitId:{}},emits:["update:isDialogVisible","taskCreated"],setup(f,{emit:p}){const n=f,V=p,{getUsersForSelect:b,initializeUsers:y,loading:U}=G(),l=v({title:"",description:"",category:"",assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}),g=v(!1),u=q(()=>{const d=n.currentTab||"franchisee";return b(d)}),o=d=>!!d||"This field is required",s=d=>{V("update:isDialogVisible",d)},m=()=>{l.value={title:"",description:"",category:"",assignedTo:"",startDate:"",dueDate:"",priority:"medium",status:"pending",estimatedHours:0,actualHours:0,completionPercentage:0}},k=()=>{if(g.value){const d={id:Date.now(),...l.value};V("taskCreated",d),m(),s(!1)}},H=()=>{m(),s(!1)};return h(()=>n.isDialogVisible,async d=>{if(d){const a=n.currentTab||"franchisee";await y(a),n.defaultAssignedTo&&(l.value.assignedTo=n.defaultAssignedTo)}else m()}),h(()=>n.currentTab,async d=>{n.isDialogVisible&&d&&(await y(d),l.value.assignedTo="")}),(d,a)=>(_(),x(N,{"model-value":n.isDialogVisible,"max-width":"600",persistent:"","onUpdate:modelValue":s},{default:r(()=>[e(M,null,{default:r(()=>[e(R,{class:"text-h5 pa-6 pb-4"},{default:r(()=>a[11]||(a[11]=[C(" Create New Task ")])),_:1,__:[11]}),e(F),e(B,{class:"pa-6"},{default:r(()=>[e($,{modelValue:t(g),"onUpdate:modelValue":a[10]||(a[10]=i=>O(g)?g.value=i:null),onSubmit:I(k,["prevent"])},{default:r(()=>[e(z,null,{default:r(()=>[e(c,{cols:"12"},{default:r(()=>[e(T,{modelValue:t(l).title,"onUpdate:modelValue":a[0]||(a[0]=i=>t(l).title=i),label:"Task Title",placeholder:"Enter task title",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12"},{default:r(()=>[e(K,{modelValue:t(l).description,"onUpdate:modelValue":a[1]||(a[1]=i=>t(l).description=i),label:"Description",placeholder:"Enter task description",rows:"3",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(S,{modelValue:t(l).category,"onUpdate:modelValue":a[2]||(a[2]=i=>t(l).category=i),label:"Category",placeholder:"Select category",items:t(Q),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(S,{modelValue:t(l).assignedTo,"onUpdate:modelValue":a[3]||(a[3]=i=>t(l).assignedTo=i),label:"Assigned To",placeholder:"Select user",items:t(u),loading:t(U),rules:[o],"item-title":"title","item-value":"value",required:""},null,8,["modelValue","items","loading","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(T,{modelValue:t(l).startDate,"onUpdate:modelValue":a[4]||(a[4]=i=>t(l).startDate=i),label:"Start Date",type:"date",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(T,{modelValue:t(l).dueDate,"onUpdate:modelValue":a[5]||(a[5]=i=>t(l).dueDate=i),label:"Due Date",type:"date",rules:[o],required:""},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(S,{modelValue:t(l).priority,"onUpdate:modelValue":a[6]||(a[6]=i=>t(l).priority=i),label:"Priority",placeholder:"Select priority",items:t(Y),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(S,{modelValue:t(l).status,"onUpdate:modelValue":a[7]||(a[7]=i=>t(l).status=i),label:"Status",placeholder:"Select status",items:t(j),rules:[o],required:""},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(T,{modelValue:t(l).estimatedHours,"onUpdate:modelValue":a[8]||(a[8]=i=>t(l).estimatedHours=i),label:"Estimated Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:r(()=>[e(T,{modelValue:t(l).actualHours,"onUpdate:modelValue":a[9]||(a[9]=i=>t(l).actualHours=i),label:"Actual Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(F),e(E,{class:"pa-6"},{default:r(()=>[e(L),e(A,{color:"error",variant:"text",onClick:H},{default:r(()=>a[12]||(a[12]=[C(" Cancel ")])),_:1,__:[12]}),e(A,{color:"primary",disabled:!t(g),onClick:k},{default:r(()=>a[13]||(a[13]=[C(" Create Task ")])),_:1,__:[13]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}});export{Y as P,j as S,re as T,ue as _,Q as a,G as u};
