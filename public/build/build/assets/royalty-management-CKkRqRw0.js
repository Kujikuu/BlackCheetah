import{d as dt,r as u,P as Y,G as ut,c as mt,b as e,f as l,o as k,e as a,a3 as c,t as d,aa as m,v as o,g as R,l as h,aM as pt}from"./main-DGm6yV1K.js";import{r as A}from"./royalty-WqtbvwWZ.js";import{V as x,a as n}from"./VRow-Ytj8TpkY.js";import{V as O}from"./VDialog-B-R7Rjej.js";import{V as T}from"./VSelect-DX9fmFnT.js";import{V as y,a as P,b as U,c as L}from"./VCard-Dnm1uaQD.js";import{V as f}from"./VCardText-BVvU-0tD.js";import{V as K}from"./VAvatar-DPtk-yN5.js";import{V as S}from"./VDivider-D1nVP5py.js";import{q as ct}from"./VDataTable-CE-jItTQ.js";import{V as Q}from"./VTooltip-Ej1jjHYo.js";import{V as M}from"./VChip-B-Re4eCv.js";import{V as yt}from"./VAlert-eLtk86Wm.js";import{V as vt}from"./VForm-BoIFETfG.js";import{V as W}from"./VTextField-DBpL81Vm.js";import{V as ft}from"./VFileInput-Bq_mLyhd.js";import{V as _t}from"./VTable-KBEvVoaP.js";/* empty css              */import"./VOverlay-CwBiQuy6.js";import"./easing-Bybner-F.js";import"./lazy-DvPke9wo.js";import"./scopeId-IZ4GITye.js";import"./VImg-C0tMXNU8.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-BdfnzIrf.js";import"./form-TsDzzk6K.js";import"./VList-BB8Xr9_D.js";import"./ssrBoot-DMoVtlfk.js";import"./VMenu-DnTGfH_L.js";import"./VCheckboxBtn-D8E5pKBq.js";import"./VSelectionControl-LnenZ4qZ.js";import"./VPagination-DNsijIIm.js";import"./filter-Dis1VwyC.js";import"./VSlideGroup-ZNVF46oc.js";/* empty css                   */import"./VCounter-CWva7-gb.js";import"./VField-XG09xMlO.js";import"./VInput-CckDb7qY.js";const bt={class:"d-flex justify-space-between align-center flex-wrap gap-4"},xt={class:"d-flex gap-3 align-center flex-wrap"},gt={class:"d-flex align-center justify-space-between"},Vt={class:"text-h4 text-success"},wt={class:"d-flex align-center justify-space-between"},Ct={class:"text-h4 text-warning"},kt={class:"font-weight-medium"},St={class:"text-body-2"},Dt={class:"font-weight-medium text-info"},Rt={class:"font-weight-medium text-success"},ht={class:"d-flex gap-2"},At={class:"text-body-2"},Tt={class:"mb-4"},Pt={class:"font-weight-medium"},Ut={class:"mb-4"},Lt={class:"font-weight-medium"},zt={class:"mb-4"},Ot={class:"font-weight-medium text-primary"},Mt={class:"mb-4"},Et={class:"font-weight-medium"},Ft={class:"text-center"},jt={class:"text-h6 font-weight-bold"},Bt={class:"text-center"},$t={class:"text-h6 font-weight-bold"},It={class:"text-center"},Gt={class:"text-h6 font-weight-bold"},Nt={class:"mb-4"},qt={class:"mb-4"},Ht={class:"font-weight-medium"},Jt={class:"text-end"},Xt={class:"text-end"},Yt={class:"text-end"},Kt={class:"bg-primary-lighten-5"},Qt={class:"text-end font-weight-bold text-primary"},Ee=dt({__name:"royalty-management",setup(Wt){const E=u(!1),F=u(!1),v=u("monthly"),g=u(!1),V=u(!1),w=u(!1),_=u(null),r=u(null),C=u("csv"),D=u("all"),p=u({amount_paid:0,payment_date:"",payment_type:"",attachment:null}),j=u([]),z=u({royalty_collected_till_date:0,upcoming_royalties:0,total_royalties:0,pending_amount:0,paid_amount:0,overdue_amount:0,overdue_count:0}),Z=Y(()=>z.value.royalty_collected_till_date),tt=Y(()=>z.value.upcoming_royalties),et=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],lt=[{title:"CSV",value:"csv"},{title:"Excel",value:"excel"}],B=[{title:"All Royalties",value:"all"},{title:"Paid Only",value:"paid"},{title:"Pending Only",value:"pending"},{title:"Overdue Only",value:"overdue"}],at=[{title:"Bank Transfer",value:"bank_transfer"},{title:"Credit Card",value:"credit_card"},{title:"Mada",value:"mada"},{title:"STC Pay",value:"stc_pay"},{title:"SADAD",value:"sadad"},{title:"Check",value:"check"},{title:"Cash",value:"cash"},{title:"Online Payment",value:"online_payment"}],st=[{title:"Billing Period",key:"billing_period",sortable:!0},{title:"Due Date",key:"due_date",sortable:!0},{title:"Gross Sales (SAR)",key:"gross_sales",sortable:!0},{title:"Royalty %",key:"royalty_percentage",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],$=async()=>{try{E.value=!0;const i=await A.getRoyalties({period:v.value});j.value=i.data.data}catch(i){console.error("Error fetching royalties:",i)}finally{E.value=!1}},I=async()=>{try{F.value=!0;const i=await A.getStatistics({period:v.value});z.value=i.data}catch(i){console.error("Error fetching statistics:",i)}finally{F.value=!1}},ot=()=>{g.value=!0},it=async()=>{try{const i=await A.exportRoyalties({format:C.value,data_type:D.value,period:v.value}),t=window.URL.createObjectURL(i),s=document.createElement("a");s.href=t,s.download=`royalty-data-${v.value}-${new Date().toISOString().split("T")[0]}.${C.value==="csv"?"csv":"xlsx"}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(t),g.value=!1}catch(i){console.error("Error exporting royalties:",i)}},nt=i=>{r.value=i,w.value=!0},G=i=>{_.value=i,p.value={amount_paid:i.amount,payment_date:new Date().toISOString().split("T")[0],payment_type:"",attachment:null},V.value=!0},N=async()=>{if(_.value)try{await A.markAsPaid(_.value.id,p.value),await $(),await I(),V.value=!1,_.value=null,p.value={amount_paid:0,payment_date:"",payment_type:"",attachment:null}}catch(i){console.error("Error marking royalty as paid:",i)}},rt=i=>{const t=i.target;t.files&&t.files[0]&&(p.value.attachment=t.files[0])},q=i=>{switch(i){case"paid":return"success";case"pending":return"warning";case"overdue":return"error";default:return"default"}},H=i=>new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return ut(()=>{$(),I()}),(i,t)=>(k(),mt("section",null,[e(x,{class:"mb-6"},{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[a("div",bt,[t[14]||(t[14]=a("div",null,[a("h4",{class:"text-h4 mb-1"}," Royalty Management "),a("p",{class:"text-body-1 text-medium-emphasis"}," Track and manage royalty payments from all franchise units ")],-1)),a("div",xt,[e(T,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),items:et,"item-title":"title","item-value":"value",density:"comfortable",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"]),e(c,{color:"primary",variant:"elevated",onClick:ot},{default:l(()=>[e(m,{icon:"tabler-download",class:"me-2"}),t[13]||(t[13]=d(" Export "))]),_:1,__:[13]})])])]),_:1})]),_:1}),e(x,{class:"mb-6"},{default:l(()=>[e(n,{cols:"12",md:"6"},{default:l(()=>[e(y,null,{default:l(()=>[e(f,null,{default:l(()=>[a("div",gt,[a("div",null,[t[15]||(t[15]=a("h6",{class:"text-h6 mb-1"}," Royalty Collected Till Date ",-1)),t[16]||(t[16]=a("div",{class:"text-body-2 text-medium-emphasis mb-3"}," Total payments received ",-1)),a("h4",Vt,o((Z.value||0).toLocaleString())+" SAR ",1)]),e(K,{color:"success",variant:"tonal",size:"56"},{default:l(()=>[e(m,{icon:"tabler-currency-riyal",size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[e(y,null,{default:l(()=>[e(f,null,{default:l(()=>[a("div",wt,[a("div",null,[t[17]||(t[17]=a("h6",{class:"text-h6 mb-1"}," Upcoming Royalties ",-1)),t[18]||(t[18]=a("div",{class:"text-body-2 text-medium-emphasis mb-3"}," Pending payments due ",-1)),a("h4",Ct,o((tt.value||0).toLocaleString())+" SAR ",1)]),e(K,{color:"warning",variant:"tonal",size:"56"},{default:l(()=>[e(m,{icon:"tabler-clock",size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[e(y,null,{default:l(()=>[e(P,{class:"pb-4"},{default:l(()=>[e(U,{class:"text-h6"},{default:l(()=>t[19]||(t[19]=[d(" Royalty Records ")])),_:1,__:[19]}),e(L,{class:"text-body-2"},{default:l(()=>t[20]||(t[20]=[d(" Manage royalty payments and track collection status ")])),_:1,__:[20]})]),_:1}),e(S),e(ct,{headers:st,items:j.value,"items-per-page":10,class:"text-no-wrap"},{"item.billing_period":l(({item:s})=>[a("div",kt,o(s.billing_period),1)]),"item.due_date":l(({item:s})=>[a("div",St,o(H(s.due_date)),1)]),"item.gross_sales":l(({item:s})=>[a("div",Dt,o((s.gross_sales||0).toLocaleString()),1)]),"item.royalty_percentage":l(({item:s})=>[e(M,{size:"small",variant:"tonal",color:"primary"},{default:l(()=>[d(o(s.royalty_percentage)+"% ",1)]),_:2},1024)]),"item.amount":l(({item:s})=>[a("div",Rt,o((s.amount||0).toLocaleString()),1)]),"item.status":l(({item:s})=>[e(M,{color:q(s.status),size:"small",variant:"tonal",class:"text-capitalize"},{default:l(()=>[d(o(s.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:s})=>[a("div",ht,[e(c,{icon:"",size:"small",color:"info",variant:"text",onClick:b=>nt(s)},{default:l(()=>[e(m,{icon:"tabler-eye",size:"20"}),e(Q,{activator:"parent",location:"top"},{default:l(()=>t[21]||(t[21]=[d(" View Details ")])),_:1,__:[21]})]),_:2},1032,["onClick"]),s.status!=="paid"?(k(),R(c,{key:0,icon:"",size:"small",color:"success",variant:"text",onClick:b=>G(s)},{default:l(()=>[e(m,{icon:"tabler-check",size:"20"}),e(Q,{activator:"parent",location:"top"},{default:l(()=>t[22]||(t[22]=[d(" Mark as Completed ")])),_:1,__:[22]})]),_:2},1032,["onClick"])):h("",!0)])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),e(O,{modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=s=>g.value=s),"max-width":"500"},{default:l(()=>[e(y,{class:"text-center px-6 py-6"},{default:l(()=>[e(P,{class:"pb-4"},{default:l(()=>[e(U,{class:"text-h6"},{default:l(()=>t[23]||(t[23]=[d(" Export Royalty Data ")])),_:1,__:[23]}),e(L,null,{default:l(()=>t[24]||(t[24]=[d("Choose export format and data type")])),_:1,__:[24]})]),_:1}),e(f,null,{default:l(()=>[e(x,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[e(T,{modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=s=>D.value=s),items:B,"item-title":"title","item-value":"value",label:"Data Type",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(T,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),items:lt,"item-title":"title","item-value":"value",label:"Export Format",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(yt,{type:"info",variant:"tonal",class:"mt-4"},{default:l(()=>{var s;return[a("div",At,[t[25]||(t[25]=a("strong",null,"Current Selection:",-1)),t[26]||(t[26]=a("br",null,null,-1)),d(" Period: "+o(v.value.charAt(0).toUpperCase()+v.value.slice(1)),1),t[27]||(t[27]=a("br",null,null,-1)),d(" Data Type: "+o((s=B.find(b=>b.value===D.value))==null?void 0:s.title),1),t[28]||(t[28]=a("br",null,null,-1)),d(" Format: "+o(C.value.toUpperCase()),1)])]}),_:1})]),_:1}),e(f,{class:"d-flex align-center justify-center gap-4"},{default:l(()=>[e(c,{color:"error",variant:"outlined",onClick:t[3]||(t[3]=s=>g.value=!1)},{default:l(()=>t[29]||(t[29]=[d(" Cancel ")])),_:1,__:[29]}),e(c,{color:"primary",variant:"elevated",onClick:it},{default:l(()=>t[30]||(t[30]=[d(" Export Data ")])),_:1,__:[30]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(O,{modelValue:V.value,"onUpdate:modelValue":t[9]||(t[9]=s=>V.value=s),"max-width":"600"},{default:l(()=>[e(y,{class:"px-6 py-6"},{default:l(()=>[e(P,{class:"pb-4"},{default:l(()=>[e(U,{class:"text-h6"},{default:l(()=>t[31]||(t[31]=[d(" Mark Royalty as Completed ")])),_:1,__:[31]}),_.value?(k(),R(L,{key:0},{default:l(()=>[d(o(_.value.franchisee_name)+" - "+o(_.value.billing_period),1)]),_:1})):h("",!0)]),_:1}),e(f,null,{default:l(()=>[e(vt,{onSubmit:pt(N,["prevent"])},{default:l(()=>[e(x,null,{default:l(()=>[e(n,{cols:"12",md:"6"},{default:l(()=>[e(W,{modelValue:p.value.amount_paid,"onUpdate:modelValue":t[5]||(t[5]=s=>p.value.amount_paid=s),modelModifiers:{number:!0},label:"Amount Paid (SAR)",type:"number",variant:"outlined",density:"compact",rules:[s=>!!s||"Amount is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[e(W,{modelValue:p.value.payment_date,"onUpdate:modelValue":t[6]||(t[6]=s=>p.value.payment_date=s),label:"Payment Date",type:"date",variant:"outlined",density:"compact",rules:[s=>!!s||"Payment date is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(T,{modelValue:p.value.payment_type,"onUpdate:modelValue":t[7]||(t[7]=s=>p.value.payment_type=s),items:at,"item-title":"title","item-value":"value",label:"Payment Type",variant:"outlined",density:"compact",rules:[s=>!!s||"Payment type is required"]},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(ft,{label:"Attachment (Optional)",variant:"outlined",density:"compact",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:rt}),t[32]||(t[32]=a("div",{class:"text-caption text-medium-emphasis mt-1"}," Supported formats: PDF, JPG, PNG, DOC, DOCX ",-1))]),_:1,__:[32]})]),_:1})]),_:1})]),_:1}),e(f,{class:"d-flex align-center justify-end gap-4"},{default:l(()=>[e(c,{color:"error",variant:"outlined",onClick:t[8]||(t[8]=s=>V.value=!1)},{default:l(()=>t[33]||(t[33]=[d(" Cancel ")])),_:1,__:[33]}),e(c,{color:"success",variant:"elevated",onClick:N},{default:l(()=>t[34]||(t[34]=[d(" Mark as Completed ")])),_:1,__:[34]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(O,{modelValue:w.value,"onUpdate:modelValue":t[12]||(t[12]=s=>w.value=s),"max-width":"700"},{default:l(()=>[r.value?(k(),R(y,{key:0,class:"px-6 py-6"},{default:l(()=>[e(P,{class:"pb-4"},{default:l(()=>[e(U,{class:"text-h6 d-flex align-center gap-3"},{default:l(()=>[e(m,{icon:"tabler-eye",color:"primary"}),t[35]||(t[35]=d(" Royalty Details "))]),_:1,__:[35]}),e(L,null,{default:l(()=>[d(o(r.value.franchisee_name)+" - "+o(r.value.billing_period),1)]),_:1})]),_:1}),e(S,{class:"mb-4"}),e(f,null,{default:l(()=>[e(x,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>t[36]||(t[36]=[a("h6",{class:"text-h6 mb-4 text-primary"}," Basic Information ",-1)])),_:1,__:[36]}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",Tt,[t[37]||(t[37]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Billing Period ",-1)),a("div",Pt,o(r.value.billing_period),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",Ut,[t[38]||(t[38]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Due Date ",-1)),a("div",Lt,o(H(r.value.due_date)),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",zt,[t[39]||(t[39]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Franchisee Name ",-1)),a("div",Ot,o(r.value.franchisee_name),1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",Mt,[t[40]||(t[40]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Store Location ",-1)),a("div",Et,o(r.value.store_location),1)])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(S,{class:"my-4"}),t[41]||(t[41]=a("h6",{class:"text-h6 mb-4 text-primary"}," Financial Details ",-1))]),_:1,__:[41]}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(y,{variant:"tonal",color:"info",class:"pa-4"},{default:l(()=>{var s;return[a("div",Ft,[e(m,{icon:"tabler-chart-line",size:"32",class:"mb-2"}),t[42]||(t[42]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Gross Sales ",-1)),a("div",jt,o((((s=r.value)==null?void 0:s.gross_sales)||0).toLocaleString())+" SAR ",1)])]}),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(y,{variant:"tonal",color:"primary",class:"pa-4"},{default:l(()=>[a("div",Bt,[e(m,{icon:"tabler-percentage",size:"32",class:"mb-2"}),t[43]||(t[43]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Rate ",-1)),a("div",$t,o(r.value.royalty_percentage)+"% ",1)])]),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:l(()=>[e(y,{variant:"tonal",color:"success",class:"pa-4"},{default:l(()=>{var s;return[a("div",It,[e(m,{icon:"tabler-coins",size:"32",class:"mb-2"}),t[44]||(t[44]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Royalty Amount ",-1)),a("div",Gt,o((((s=r.value)==null?void 0:s.amount)||0).toLocaleString())+" SAR ",1)])]}),_:1})]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(S,{class:"my-4"}),t[45]||(t[45]=a("h6",{class:"text-h6 mb-4 text-primary"}," Status Information ",-1))]),_:1,__:[45]}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",Nt,[t[46]||(t[46]=a("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Payment Status ",-1)),e(M,{color:q(r.value.status),size:"large",variant:"tonal",class:"text-capitalize"},{default:l(()=>[e(m,{icon:r.value.status==="paid"?"tabler-check":r.value.status==="pending"?"tabler-clock":"tabler-alert-triangle",class:"me-2"},null,8,["icon"]),d(" "+o(r.value.status),1)]),_:1},8,["color"])])]),_:1}),e(n,{cols:"12",md:"6"},{default:l(()=>[a("div",qt,[t[47]||(t[47]=a("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Days Until Due ",-1)),a("div",Ht,o(Math.ceil((new Date(r.value.due_date).getTime()-new Date().getTime())/(1e3*60*60*24)))+" days ",1)])]),_:1}),e(n,{cols:"12"},{default:l(()=>[e(S,{class:"my-4"}),t[48]||(t[48]=a("h6",{class:"text-h6 mb-4 text-primary"}," Calculation Breakdown ",-1))]),_:1,__:[48]}),e(n,{cols:"12"},{default:l(()=>[e(_t,{density:"compact"},{default:l(()=>{var s,b,J,X;return[a("tbody",null,[a("tr",null,[t[49]||(t[49]=a("td",{class:"font-weight-medium"}," Gross Sales: ",-1)),a("td",Jt,o((((s=r.value)==null?void 0:s.gross_sales)||0).toLocaleString())+" SAR ",1)]),a("tr",null,[t[50]||(t[50]=a("td",{class:"font-weight-medium"}," Royalty Rate: ",-1)),a("td",Xt,o(r.value.royalty_percentage)+"% ",1)]),a("tr",null,[t[51]||(t[51]=a("td",{class:"font-weight-medium"}," Calculation: ",-1)),a("td",Yt,o((((b=r.value)==null?void 0:b.gross_sales)||0).toLocaleString())+" × "+o(((J=r.value)==null?void 0:J.royalty_percentage)||0)+"% ",1)]),a("tr",Kt,[t[52]||(t[52]=a("td",{class:"font-weight-bold text-primary"}," Total Royalty Amount: ",-1)),a("td",Qt,o((((X=r.value)==null?void 0:X.amount)||0).toLocaleString())+" SAR ",1)])])]}),_:1})]),_:1})]),_:1})]),_:1}),e(f,{class:"d-flex align-center justify-end gap-4 pt-4"},{default:l(()=>[e(c,{color:"primary",variant:"outlined",onClick:t[10]||(t[10]=s=>w.value=!1)},{default:l(()=>t[53]||(t[53]=[d(" Close ")])),_:1,__:[53]}),r.value.status!=="paid"?(k(),R(c,{key:0,color:"success",variant:"elevated",onClick:t[11]||(t[11]=s=>{G(r.value),w.value=!1})},{default:l(()=>[e(m,{icon:"tabler-check",class:"me-2"}),t[54]||(t[54]=d(" Mark as Completed "))]),_:1,__:[54]})):h("",!0)]),_:1})]),_:1})):h("",!0)]),_:1},8,["modelValue"])]))}});export{Ee as default};
