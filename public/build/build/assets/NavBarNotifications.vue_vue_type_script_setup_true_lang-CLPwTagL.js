import{d as z,P,a as U,g as V,o as u,f as i,b as o,q as L,ax as x,t as b,J as S,v as g,m as C,K as A,c as T,F as R,i as M,l as N,e as y,b3 as H,x as G,r as E,b4 as $,b5 as f,G as J}from"./main-B8QbR-yS.js";import{C as I}from"./vue3-perfect-scrollbar-C4JFlt82.js";import{V as O}from"./VBadge-Blm7T21k.js";import{V as j}from"./VMenu-TQcmpCCv.js";import{V as q,a as K,b as Y}from"./VCard-D9PhtsJ0.js";import{V as Q}from"./VChip-CgHwmC-k.js";import{V as W}from"./VTooltip-D-apmXOm.js";import{V as D}from"./VDivider-DOfIMbJY.js";import{V as X,a as F,b as Z}from"./VList-BJCgULVd.js";import{V as ee}from"./VAvatar-87LH5tAk.js";import{V as te}from"./VImg-Ceu2Mboj.js";import{V as ae}from"./VSpacer-BSXBFFTK.js";const oe={class:"d-flex align-start gap-3"},re={key:0},ie={class:"text-sm font-weight-medium mb-1"},se={class:"text-body-2 mb-2",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},ne={class:"text-sm text-disabled mb-0",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},le={class:"d-flex flex-column align-end"},ce=z({__name:"Notifications",props:{notifications:{},badgeProps:{default:void 0},location:{default:"bottom end"}},emits:["read","unread","remove","click:notification"],setup(l,{emit:p}){const s=l,m=p;function k(r){return r?r.split(" ").map(n=>n[0]).join("").toUpperCase():""}const h=P(()=>s.notifications.some(r=>r.isSeen===!1)),c=()=>{const r=s.notifications.map(n=>n.id);h.value?m("read",r):m("unread",r)},v=P(()=>s.notifications.filter(r=>r.isSeen===!1).length),w=(r,n)=>{r?m("unread",[n]):m("read",[n])};return(r,n)=>{const _=U("IconBtn");return u(),V(_,{id:"notification-btn"},{default:i(()=>[o(O,L(s.badgeProps,{"model-value":s.notifications.some(e=>!e.isSeen),color:"error",dot:"","offset-x":"2","offset-y":"3"}),{default:i(()=>[o(x,{icon:"tabler-bell"})]),_:1},16,["model-value"]),o(j,{activator:"parent",width:"380px",location:s.location,offset:"12px","close-on-content-click":!1},{default:i(()=>[o(q,{class:"d-flex flex-column"},{default:i(()=>[o(K,{class:"notification-section"},{append:i(()=>[S(o(Q,{size:"small",color:"primary",class:"me-2"},{default:i(()=>[b(g(C(v))+" New ",1)]),_:1},512),[[A,s.notifications.some(e=>!e.isSeen)]]),S(o(_,{size:"34",onClick:c},{default:i(()=>[o(x,{size:"20",color:"high-emphasis",icon:C(h)?"tabler-mail-opened":"tabler-mail"},null,8,["icon"]),o(W,{activator:"parent",location:"start"},{default:i(()=>[b(g(C(h)?"Mark all as read":"Mark all as unread"),1)]),_:1})]),_:1},512),[[A,s.notifications.length]])]),default:i(()=>[o(Y,{class:"text-h6"},{default:i(()=>n[0]||(n[0]=[b(" Notifications ")])),_:1,__:[0]})]),_:1}),o(D),o(C(I),{options:{wheelPropagation:!1},style:{"max-block-size":"23.75rem"}},{default:i(()=>[o(X,{class:"notification-list rounded-0 py-0"},{default:i(()=>[(u(!0),T(R,null,M(s.notifications,(e,t)=>(u(),T(R,{key:e.id},[t>0?(u(),V(D,{key:0})):N("",!0),o(F,{link:"",lines:"one","min-height":"66px",class:"list-item-hover-class",onClick:a=>r.$emit("click:notification",e)},{default:i(()=>{var a,d;return[y("div",oe,[o(ee,{color:e.color&&!e.img?e.color:void 0,variant:e.img?void 0:"tonal"},{default:i(()=>[e.text?(u(),T("span",re,g(k(e.text)),1)):N("",!0),e.img?(u(),V(te,{key:1,src:e.img},null,8,["src"])):N("",!0),e.icon?(u(),V(x,{key:2,icon:e.icon},null,8,["icon"])):N("",!0)]),_:2},1032,["color","variant"]),y("div",null,[y("p",ie,g((a=e.data)==null?void 0:a.title),1),y("p",se,g((d=e.data)==null?void 0:d.message),1),y("p",ne,g(e.created_at?new Date(e.created_at).toLocaleString():""),1)]),o(ae),y("div",le,[o(x,{size:"10",icon:"tabler-circle-filled",color:e.isSeen?"#a8aaae":"primary",class:G([`${e.isSeen?"visible-in-hover":""}`,"mb-2"]),onClick:H(B=>w(e.isSeen,e.id),["stop"])},null,8,["color","class","onClick"]),o(x,{size:"20",icon:"tabler-x",class:"visible-in-hover",onClick:B=>r.$emit("remove",e.id)},null,8,["onClick"])])])]}),_:2},1032,["onClick"])],64))),128)),S(o(F,{class:"text-center text-medium-emphasis",style:{"block-size":"56px"}},{default:i(()=>[o(Z,null,{default:i(()=>n[1]||(n[1]=[b("No Notification Found!")])),_:1,__:[1]})]),_:1},512),[[A,!s.notifications.length]])]),_:1})]),_:1})]),_:1})]),_:1},8,["location"])]),_:1})}}}),de=()=>{const l=E([]),p=E(!1),s=E({total:0,unread:0,read:0}),m=e=>{const t=new Date(e),d=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60));return d<1?"Just now":d<24?`${d}h ago`:d<48?"Yesterday":t.toLocaleDateString()},k=e=>{let t=e.data;if(typeof t=="string")try{t=JSON.parse(t)}catch(d){console.error("Failed to parse notification data:",d),t={}}const a=t||{};return{id:e.id,title:a.title||"Notification",subtitle:a.message||a.subtitle||"",time:m(e.created_at),color:a.color||"primary",isSeen:!!e.read_at,icon:a.icon||"tabler-bell",img:a.img,text:a.text,data:a,created_at:e.created_at,read_at:e.read_at}},h=async(e=!1)=>{try{p.value=!0;const a=await f("/v1/notifications",{method:"GET",params:e?{unread_only:!0}:{}});return l.value=a.data.data.map(k),a.data}catch(t){throw console.error("Error fetching notifications:",t),t}finally{p.value=!1}},c=async()=>{try{const e=await f("/v1/notifications/stats",{method:"GET"});return s.value=e.data,e.data}catch(e){throw console.error("Error fetching notification stats:",e),e}},v=async e=>{try{e.length===1?await f(`/v1/notifications/${e[0]}/read`,{method:"PATCH"}):await f("/v1/notifications/mark-multiple-read",{method:"PATCH",body:{notification_ids:e}}),l.value.forEach(t=>{e.includes(t.id)&&(t.isSeen=!0)}),await c()}catch(t){throw console.error("Error marking notifications as read:",t),t}},w=async e=>{try{e.length===1?await f(`/v1/notifications/${e[0]}/unread`,{method:"PATCH"}):await f("/v1/notifications/mark-multiple-unread",{method:"PATCH",body:{notification_ids:e}}),l.value.forEach(t=>{e.includes(t.id)&&(t.isSeen=!1)}),await c()}catch(t){throw console.error("Error marking notifications as unread:",t),t}},r=async()=>{try{await f("/v1/notifications/mark-all-read",{method:"PATCH"}),l.value.forEach(e=>{e.isSeen=!0}),await c()}catch(e){throw console.error("Error marking all notifications as read:",e),e}},n=async e=>{try{await f(`/v1/notifications/${e}`,{method:"DELETE"});const t=l.value.findIndex(a=>a.id===e);t>-1&&l.value.splice(t,1),await c()}catch(t){throw console.error("Error removing notification:",t),t}},_=async e=>{e.isSeen||await v([e.id])};return{notifications:$(l),loading:$(p),stats:$(s),fetchNotifications:h,fetchStats:c,markAsRead:v,markAsUnread:w,markAllAsRead:r,removeNotification:n,handleNotificationClick:_}},Ve=z({__name:"NavBarNotifications",setup(l){const{notifications:p,fetchNotifications:s,fetchStats:m,markAsRead:k,markAsUnread:h,removeNotification:c,handleNotificationClick:v}=de();J(async()=>{try{await s(),await m()}catch(e){console.error("Failed to load notifications:",e)}});const w=async e=>{try{await c(e)}catch(t){console.error("Failed to remove notification:",t)}},r=async e=>{try{await k(e)}catch(t){console.error("Failed to mark notifications as read:",t)}},n=async e=>{try{await h(e)}catch(t){console.error("Failed to mark notifications as unread:",t)}},_=async e=>{try{await v(e)}catch(t){console.error("Failed to handle notification click:",t)}};return(e,t)=>{const a=ce;return u(),V(a,{notifications:C(p),onRemove:w,onRead:r,onUnread:n,"onClick:notification":_},null,8,["notifications"])}}});export{Ve as _};
