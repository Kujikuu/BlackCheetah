import{d as D,P,a as M,g as V,o as f,f as r,b as a,q as U,aa as x,t as b,J as S,v as g,m as C,K as A,c as T,F as R,i as L,l as N,e as y,aM as H,x as G,r as E,aN as $,aO as m,G as I}from"./main-Dhlv_lYh.js";import{C as J}from"./vue3-perfect-scrollbar-D_uxNatm.js";import{V as O}from"./VBadge--fA0OmhN.js";import{V as j}from"./VMenu-C7unrazO.js";import{V as q,a as K,b as Y}from"./VCard-DneUGeMs.js";import{V as Q}from"./VChip-6fHDyEWx.js";import{V as W}from"./VTooltip-Dix-fcv3.js";import{V as z}from"./VDivider-DmcXD_UB.js";import{V as X,a as B,b as Z}from"./VList-CQSw0LK2.js";import{V as ee}from"./VAvatar-BiIl4hu9.js";import{V as te}from"./VImg-w3Zg-hsq.js";import{V as ae}from"./VSpacer-C8jeatBp.js";const oe={class:"d-flex align-start gap-3"},re={key:0},se={class:"text-sm font-weight-medium mb-1"},ie={class:"text-body-2 mb-2",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},ne={class:"text-sm text-disabled mb-0",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},le={class:"d-flex flex-column align-end"},ce=D({__name:"Notifications",props:{notifications:{},badgeProps:{default:void 0},location:{default:"bottom end"}},emits:["read","unread","remove","click:notification"],setup(l,{emit:u}){const s=l,d=u;function k(o){return o?o.split(" ").map(i=>i[0]).join("").toUpperCase():""}const p=P(()=>s.notifications.some(o=>o.isSeen===!1)),c=()=>{const o=s.notifications.map(i=>i.id);p.value?d("read",o):d("unread",o)},v=P(()=>s.notifications.filter(o=>o.isSeen===!1).length),w=(o,i)=>{o?d("unread",[i]):d("read",[i])};return(o,i)=>{const _=M("IconBtn");return f(),V(_,{id:"notification-btn"},{default:r(()=>[a(O,U(s.badgeProps,{"model-value":s.notifications.some(e=>!e.isSeen),color:"error",dot:"","offset-x":"2","offset-y":"3"}),{default:r(()=>[a(x,{icon:"tabler-bell"})]),_:1},16,["model-value"]),a(j,{activator:"parent",width:"380px",location:s.location,offset:"12px","close-on-content-click":!1},{default:r(()=>[a(q,{class:"d-flex flex-column"},{default:r(()=>[a(K,{class:"notification-section"},{append:r(()=>[S(a(Q,{size:"small",color:"primary",class:"me-2"},{default:r(()=>[b(g(C(v))+" New ",1)]),_:1},512),[[A,s.notifications.some(e=>!e.isSeen)]]),S(a(_,{size:"34",onClick:c},{default:r(()=>[a(x,{size:"20",color:"high-emphasis",icon:C(p)?"tabler-mail-opened":"tabler-mail"},null,8,["icon"]),a(W,{activator:"parent",location:"start"},{default:r(()=>[b(g(C(p)?"Mark all as read":"Mark all as unread"),1)]),_:1})]),_:1},512),[[A,s.notifications.length]])]),default:r(()=>[a(Y,{class:"text-h6"},{default:r(()=>i[0]||(i[0]=[b(" Notifications ")])),_:1,__:[0]})]),_:1}),a(z),a(C(J),{options:{wheelPropagation:!1},style:{"max-block-size":"23.75rem"}},{default:r(()=>[a(X,{class:"notification-list rounded-0 py-0"},{default:r(()=>[(f(!0),T(R,null,L(s.notifications,(e,t)=>(f(),T(R,{key:e.id},[t>0?(f(),V(z,{key:0})):N("",!0),a(B,{link:"",lines:"one","min-height":"66px",class:"list-item-hover-class",onClick:n=>o.$emit("click:notification",e)},{default:r(()=>{var n,h;return[y("div",oe,[a(ee,{color:e.color&&!e.img?e.color:void 0,variant:e.img?void 0:"tonal"},{default:r(()=>[e.text?(f(),T("span",re,g(k(e.text)),1)):N("",!0),e.img?(f(),V(te,{key:1,src:e.img},null,8,["src"])):N("",!0),e.icon?(f(),V(x,{key:2,icon:e.icon},null,8,["icon"])):N("",!0)]),_:2},1032,["color","variant"]),y("div",null,[y("p",se,g(((n=e.data)==null?void 0:n.title)||e.title),1),y("p",ie,g(((h=e.data)==null?void 0:h.message)||e.subtitle),1),y("p",ne,g(e.created_at?new Date(e.created_at).toLocaleString():""),1)]),a(ae),y("div",le,[a(x,{size:"10",icon:"tabler-circle-filled",color:e.isSeen?"#a8aaae":"primary",class:G([`${e.isSeen?"visible-in-hover":""}`,"mb-2"]),onClick:H(F=>w(e.isSeen,e.id),["stop"])},null,8,["color","class","onClick"]),a(x,{size:"20",icon:"tabler-x",class:"visible-in-hover",onClick:F=>o.$emit("remove",e.id)},null,8,["onClick"])])])]}),_:2},1032,["onClick"])],64))),128)),S(a(B,{class:"text-center text-medium-emphasis",style:{"block-size":"56px"}},{default:r(()=>[a(Z,null,{default:r(()=>i[1]||(i[1]=[b("No Notification Found!")])),_:1,__:[1]})]),_:1},512),[[A,!s.notifications.length]])]),_:1})]),_:1})]),_:1})]),_:1},8,["location"])]),_:1})}}}),de=()=>{const l=E([]),u=E(!1),s=E({total:0,unread:0,read:0}),d=e=>{const t=e.data||{};return{id:e.id,title:t.title||"Notification",subtitle:t.message||t.subtitle||"",time:k(e.created_at),color:t.color||"primary",isSeen:!!e.read_at,icon:t.icon||"tabler-bell",img:t.img,text:t.text,data:e.data,created_at:e.created_at,read_at:e.read_at}},k=e=>{const t=new Date(e),h=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60));return h<1?"Just now":h<24?`${h}h ago`:h<48?"Yesterday":t.toLocaleDateString()},p=async(e=!1)=>{try{u.value=!0;const n=await m("/v1/notifications",{method:"GET",params:e?{unread_only:!0}:{}});return l.value=n.data.data.map(d),n.data}catch(t){throw console.error("Error fetching notifications:",t),t}finally{u.value=!1}},c=async()=>{try{const e=await m("/v1/notifications/stats",{method:"GET"});return s.value=e.data,e.data}catch(e){throw console.error("Error fetching notification stats:",e),e}},v=async e=>{try{e.length===1?await m(`/v1/notifications/${e[0]}/read`,{method:"PATCH"}):await m("/v1/notifications/mark-multiple-read",{method:"PATCH",body:{notification_ids:e}}),l.value.forEach(t=>{e.includes(t.id)&&(t.isSeen=!0)}),await c()}catch(t){throw console.error("Error marking notifications as read:",t),t}},w=async e=>{try{e.length===1?await m(`/v1/notifications/${e[0]}/unread`,{method:"PATCH"}):await m("/v1/notifications/mark-multiple-unread",{method:"PATCH",body:{notification_ids:e}}),l.value.forEach(t=>{e.includes(t.id)&&(t.isSeen=!1)}),await c()}catch(t){throw console.error("Error marking notifications as unread:",t),t}},o=async()=>{try{await m("/v1/notifications/mark-all-read",{method:"PATCH"}),l.value.forEach(e=>{e.isSeen=!0}),await c()}catch(e){throw console.error("Error marking all notifications as read:",e),e}},i=async e=>{try{await m(`/v1/notifications/${e}`,{method:"DELETE"});const t=l.value.findIndex(n=>n.id===e);t>-1&&l.value.splice(t,1),await c()}catch(t){throw console.error("Error removing notification:",t),t}},_=async e=>{e.isSeen||await v([e.id])};return{notifications:$(l),loading:$(u),stats:$(s),fetchNotifications:p,fetchStats:c,markAsRead:v,markAsUnread:w,markAllAsRead:o,removeNotification:i,handleNotificationClick:_}},Ve=D({__name:"NavBarNotifications",setup(l){const{notifications:u,fetchNotifications:s,fetchStats:d,markAsRead:k,markAsUnread:p,removeNotification:c,handleNotificationClick:v}=de();I(async()=>{try{await s(),await d()}catch(e){console.error("Failed to load notifications:",e)}});const w=async e=>{try{await c(e)}catch(t){console.error("Failed to remove notification:",t)}},o=async e=>{try{await k(e)}catch(t){console.error("Failed to mark notifications as read:",t)}},i=async e=>{try{await p(e)}catch(t){console.error("Failed to mark notifications as unread:",t)}},_=async e=>{try{await v(e)}catch(t){console.error("Failed to handle notification click:",t)}};return(e,t)=>{const n=ce;return f(),V(n,{notifications:C(u),onRemove:w,onRead:o,onUnread:i,"onClick:notification":_},null,8,["notifications"])}}});export{Ve as _};
