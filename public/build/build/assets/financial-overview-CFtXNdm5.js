import{m as He}from"./vue3-apexcharts-soVH-Ma5.js";import{V as Qe,_ as Ge}from"./VDataTableServer-CCw8wB-D.js";import{_ as We}from"./AppTextField.vue_vue_type_script_setup_true_lang-DSmTBduk.js";import{_ as Xe}from"./AppSelect.vue_vue_type_script_setup_true_lang-B5FICR3b.js";import{b5 as k,d as H,P as A,g as N,f as t,b as e,l as q,t as y,v as c,e as a,ax as $,a9 as T,o as F,r as d,c as ge,aH as Ye,w as ve,G as Je,bb as Ke,m as L}from"./main-gemCwVks.js";import{f as M}from"./formatters--UtN2sCw.js";import{V as Z,_ as ee}from"./VDialog-6C-NQXCx.js";import{V as E,d as te}from"./VCard-DJ82mpnW.js";import{V as j}from"./VChip-DlNApjyg.js";import{V as P}from"./VCardText-BD5AHO-w.js";import{V as B}from"./VDivider-B4ry9pxl.js";import{V as K,a as _}from"./VRow-DiX7eN30.js";import{V as Ze}from"./VTable-0Z68chLt.js";import{V as Q}from"./VSpacer-Cpeayo2U.js";import{V as _e}from"./VSelect-C9dxRhag.js";import{V as z}from"./VTextField-BhxF6EAD.js";import{V as et}from"./VFileInput-CB0ItP4X.js";import{a as tt,V as fe}from"./VTabs-CeX-zYGq.js";import{V as ye}from"./VTooltip-CVtgTmoh.js";import{V as be}from"./VAvatar-12xz6mHy.js";import{S as at}from"./saudi-riyal-DZyktURw.js";import{V as lt}from"./VDataTable-C-SlKz4P.js";import"./_commonjsHelpers-CqkleIqs.js";import"./form-DjHlhIbZ.js";import"./VOverlay-p8m6-W96.js";import"./forwardRefs--KQCZfKO.js";import"./scopeId-BgtgI3QF.js";import"./VImg-DSB6m92Q.js";import"./dialog-transition-C9rYmnXC.js";import"./VSlideGroup-CEWgOBQJ.js";/* empty css              */import"./VList-MyW-iB3v.js";import"./VMenu-CeaiRCNz.js";import"./VCheckboxBtn-ZAK0D-Rf.js";import"./VSelectionControl-COVpGwiX.js";import"./VField-CsHfcJSz.js";import"./VInput-B3GinL-f.js";import"./VWindowItem-CPQ2k3dD.js";const C="/v1/franchisor/financial",U={async getCharts(m){return await k(`${C}/charts`,{params:m})},async getStatistics(m){return await k(`${C}/statistics`,{params:m})},async getSales(m){return await k(`${C}/sales`,{params:m})},async createSale(m){return await k(`${C}/sales`,{method:"POST",body:m})},async updateSale(m,w){return await k(`${C}/sales/${m}`,{method:"PUT",body:w})},async deleteSale(m){await k(`${C}/sales/${m}`,{method:"DELETE"})},async getExpenses(m){return await k(`${C}/expenses`,{params:m})},async createExpense(m){return await k(`${C}/expenses`,{method:"POST",body:m})},async updateExpense(m,w){return await k(`${C}/expenses/${m}`,{method:"PUT",body:w})},async deleteExpense(m){await k(`${C}/expenses/${m}`,{method:"DELETE"})},async getProfit(m){return await k(`${C}/profit`,{params:m})},async getUnitPerformance(m){return await k(`${C}/unit-performance`,{params:m})},async importData(m,w){const i=new FormData;i.append("file",m),i.append("category",w),await k(`${C}/import`,{method:"POST",body:i})},async exportData(m,w){return await k(`${C}/export`,{params:{...w,category:m},parseResponse:i=>i})}},st={class:"text-h6 mb-4 text-primary"},ot={class:"mb-4"},it={class:"font-weight-medium text-h6"},nt={class:"mb-4"},rt={class:"font-weight-medium"},dt={class:"text-h6 mb-4 text-primary"},ut={class:"text-center"},mt={class:"text-h6 font-weight-bold"},pt={class:"text-center"},ct={class:"text-h6 font-weight-bold"},vt={class:"text-center"},ft={class:"text-h6 font-weight-bold"},yt={class:"text-h6 mb-4 text-primary"},bt={class:"text-end"},xt={class:"text-end"},gt={class:"bg-success-lighten-5"},_t={class:"text-end font-weight-bold text-success"},Vt=H({__name:"ViewSaleDetailsDialog",props:{isDialogVisible:{type:Boolean},saleData:{}},emits:["update:isDialogVisible"],setup(m,{emit:w}){const i=m,S=w,g=A({get:()=>i.isDialogVisible,set:n=>S("update:isDialogVisible",n)}),b=n=>Number(n).toFixed(2)+" SAR",u=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return(n,s)=>{const p=ee;return F(),N(Z,{modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=x=>g.value=x),"max-width":"600"},{default:t(()=>[e(p,{onClick:s[0]||(s[0]=x=>g.value=!1)}),i.saleData?(F(),N(E,{key:0,title:"Sale Details"},{default:t(()=>[e(P,null,{default:t(()=>[e(j,{color:"success",size:"small",variant:"tonal"},{default:t(()=>[y(c(i.saleData.referenceNumber||`REV-${String(i.saleData.id).padStart(6,"0")}`),1)]),_:1})]),_:1}),e(B,{class:"mb-4"}),e(P,null,{default:t(()=>[e(K,null,{default:t(()=>[e(_,{cols:"12"},{default:t(()=>[a("h6",st,[e($,{icon:"tabler-shopping-cart",class:"me-2"}),s[3]||(s[3]=y(" Product Information "))])]),_:1}),e(_,{cols:"12",md:"6"},{default:t(()=>[a("div",ot,[s[4]||(s[4]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Product Name ",-1)),a("div",it,c(i.saleData.product),1)])]),_:1}),e(_,{cols:"12",md:"6"},{default:t(()=>[a("div",nt,[s[5]||(s[5]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Sale Date ",-1)),a("div",rt,c(u(i.saleData.date)),1)])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(B,{class:"my-4"}),a("h6",dt,[e($,{icon:"tabler-report-money",class:"me-2"}),s[6]||(s[6]=y(" Financial Details "))])]),_:1}),e(_,{cols:"12",md:"4"},{default:t(()=>[e(E,{variant:"tonal",color:"info",class:"pa-4"},{default:t(()=>[a("div",ut,[e($,{icon:"tabler-tag",size:"32",class:"mb-2"}),s[7]||(s[7]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Unit Price ",-1)),a("div",mt,c(b(i.saleData.unitPrice)),1)])]),_:1})]),_:1}),e(_,{cols:"12",md:"4"},{default:t(()=>[e(E,{variant:"tonal",color:"warning",class:"pa-4"},{default:t(()=>[a("div",pt,[e($,{icon:"tabler-stack",size:"32",class:"mb-2"}),s[8]||(s[8]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Quantity ",-1)),a("div",ct,c(i.saleData.quantity),1)])]),_:1})]),_:1}),e(_,{cols:"12",md:"4"},{default:t(()=>[e(E,{variant:"tonal",color:"success",class:"pa-4"},{default:t(()=>[a("div",vt,[e($,{icon:"tabler-coins",size:"32",class:"mb-2"}),s[9]||(s[9]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Total Sale ",-1)),a("div",ft,c(b(i.saleData.sale)),1)])]),_:1})]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(B,{class:"my-4"}),a("h6",yt,[e($,{icon:"tabler-calculator",class:"me-2"}),s[10]||(s[10]=y(" Calculation "))])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(Ze,{density:"compact"},{default:t(()=>[a("tbody",null,[a("tr",null,[s[11]||(s[11]=a("td",{class:"font-weight-medium"}," Unit Price: ",-1)),a("td",bt,c(b(i.saleData.unitPrice)),1)]),a("tr",null,[s[12]||(s[12]=a("td",{class:"font-weight-medium"}," Quantity: ",-1)),a("td",xt," Ã— "+c(i.saleData.quantity),1)]),a("tr",gt,[s[13]||(s[13]=a("td",{class:"font-weight-bold text-success"}," Total Amount: ",-1)),a("td",_t,c(b(i.saleData.sale)),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(te,null,{default:t(()=>[e(Q),e(T,{color:"secondary",variant:"tonal",onClick:s[1]||(s[1]=x=>g.value=!1)},{default:t(()=>s[14]||(s[14]=[y(" Close ")])),_:1,__:[14]})]),_:1})]),_:1})):q("",!0)]),_:1},8,["modelValue"])}}}),Dt={class:"text-h6 mb-4 text-primary"},wt={class:"mb-4"},St={class:"mb-4"},ht={class:"font-weight-medium"},kt={class:"mb-4"},Ct={class:"font-weight-medium"},$t={class:"mb-4"},Et={class:"font-weight-medium"},At={class:"text-h6 mb-4 text-primary"},Pt={class:"text-center"},Rt={class:"text-h4 font-weight-bold"},Ut=H({__name:"ViewExpenseDetailsDialog",props:{isDialogVisible:{type:Boolean},expenseData:{}},emits:["update:isDialogVisible"],setup(m,{emit:w}){const i=m,S=w,g=A({get:()=>i.isDialogVisible,set:n=>S("update:isDialogVisible",n)}),b=n=>Number(n).toFixed(2)+" SAR",u=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return(n,s)=>{const p=ee;return F(),N(Z,{modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=x=>g.value=x),"max-width":"600"},{default:t(()=>[e(p,{onClick:s[0]||(s[0]=x=>g.value=!1)}),i.expenseData?(F(),N(E,{key:0,title:"Expense Details"},{default:t(()=>[e(P,null,{default:t(()=>[e(j,{color:"error",size:"small",variant:"tonal"},{default:t(()=>[y(c(i.expenseData.referenceNumber||`EXP-${String(i.expenseData.id).padStart(6,"0")}`),1)]),_:1})]),_:1}),e(B,{class:"mb-4"}),e(P,null,{default:t(()=>[e(K,null,{default:t(()=>[e(_,{cols:"12"},{default:t(()=>[a("h6",Dt,[e($,{icon:"tabler-receipt",class:"me-2"}),s[3]||(s[3]=y(" Expense Information "))])]),_:1}),e(_,{cols:"12",md:"6"},{default:t(()=>[a("div",wt,[s[4]||(s[4]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Category ",-1)),e(j,{color:"error",size:"small",variant:"tonal",class:"text-capitalize"},{default:t(()=>[y(c(i.expenseData.expenseCategory),1)]),_:1})])]),_:1}),e(_,{cols:"12",md:"6"},{default:t(()=>[a("div",St,[s[5]||(s[5]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Expense Date ",-1)),a("div",ht,c(u(i.expenseData.date)),1)])]),_:1}),i.expenseData.vendorName?(F(),N(_,{key:0,cols:"12"},{default:t(()=>[a("div",kt,[s[6]||(s[6]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Vendor ",-1)),a("div",Ct,c(i.expenseData.vendorName),1)])]),_:1})):q("",!0),e(_,{cols:"12"},{default:t(()=>[a("div",$t,[s[7]||(s[7]=a("div",{class:"text-body-2 text-medium-emphasis mb-1"}," Description ",-1)),a("div",Et,c(i.expenseData.description||"No description provided"),1)])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(B,{class:"my-4"}),a("h6",At,[e($,{icon:"tabler-report-money",class:"me-2"}),s[8]||(s[8]=y(" Amount "))])]),_:1}),e(_,{cols:"12"},{default:t(()=>[e(E,{variant:"tonal",color:"error",class:"pa-6"},{default:t(()=>[a("div",Pt,[e($,{icon:"tabler-currency-dollar",size:"48",class:"mb-3"}),s[9]||(s[9]=a("div",{class:"text-body-1 text-medium-emphasis mb-2"}," Expense Amount ",-1)),a("div",Rt,c(b(i.expenseData.amount)),1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(te,null,{default:t(()=>[e(Q),e(T,{color:"secondary",variant:"tonal",onClick:s[1]||(s[1]=x=>g.value=!1)},{default:t(()=>s[10]||(s[10]=[y(" Close ")])),_:1,__:[10]})]),_:1})]),_:1})):q("",!0)]),_:1},8,["modelValue"])}}}),Tt={key:0},Ft={key:1},zt=H({__name:"AddDataDialog",props:{isDialogVisible:{type:Boolean}},emits:["update:isDialogVisible","dataAdded"],setup(m,{emit:w}){const i=m,S=w,g=d(!1),b=d("sales"),u=d({product:"",dateOfSale:"",unitPrice:0,quantitySold:0,expenseCategory:"",dateOfExpense:"",amount:0,description:""}),n=A({get:()=>i.isDialogVisible,set:x=>S("update:isDialogVisible",x)}),s=async()=>{g.value=!0;try{b.value==="sales"?await U.createSale({product:u.value.product,unit_price:u.value.unitPrice,quantity:u.value.quantitySold,date:u.value.dateOfSale,customer_name:"Walk-in Customer",customer_email:"customer@example.com",franchise_id:1,unit_id:1}):await U.createExpense({expense_category:u.value.expenseCategory,amount:u.value.amount,description:u.value.description,date:u.value.dateOfExpense}),u.value={product:"",dateOfSale:"",unitPrice:0,quantitySold:0,expenseCategory:"",dateOfExpense:"",amount:0,description:""},b.value="sales",S("dataAdded"),n.value=!1}catch(x){console.error("Error adding data:",x)}finally{g.value=!1}},p=()=>{n.value=!1};return(x,r)=>{const O=ee;return F(),N(Z,{modelValue:n.value,"onUpdate:modelValue":r[9]||(r[9]=f=>n.value=f),"max-width":"600"},{default:t(()=>[e(O,{onClick:p}),e(E,{title:"Add New Data"},{default:t(()=>[e(P,null,{default:t(()=>[e(_e,{modelValue:b.value,"onUpdate:modelValue":r[0]||(r[0]=f=>b.value=f),items:[{title:"Sales",value:"sales"},{title:"Expense",value:"expense"}],label:"Category",class:"mb-4"},null,8,["modelValue"]),b.value==="sales"?(F(),ge("div",Tt,[e(z,{modelValue:u.value.product,"onUpdate:modelValue":r[1]||(r[1]=f=>u.value.product=f),label:"Product",class:"mb-4"},null,8,["modelValue"]),e(z,{modelValue:u.value.dateOfSale,"onUpdate:modelValue":r[2]||(r[2]=f=>u.value.dateOfSale=f),label:"Date of Sale",type:"date",class:"mb-4"},null,8,["modelValue"]),e(z,{modelValue:u.value.unitPrice,"onUpdate:modelValue":r[3]||(r[3]=f=>u.value.unitPrice=f),label:"Unit Price",type:"number",prefix:"SAR",class:"mb-4"},null,8,["modelValue"]),e(z,{modelValue:u.value.quantitySold,"onUpdate:modelValue":r[4]||(r[4]=f=>u.value.quantitySold=f),label:"Quantity Sold",type:"number",class:"mb-4"},null,8,["modelValue"])])):q("",!0),b.value==="expense"?(F(),ge("div",Ft,[e(z,{modelValue:u.value.expenseCategory,"onUpdate:modelValue":r[5]||(r[5]=f=>u.value.expenseCategory=f),label:"Expense Category",class:"mb-4"},null,8,["modelValue"]),e(z,{modelValue:u.value.dateOfExpense,"onUpdate:modelValue":r[6]||(r[6]=f=>u.value.dateOfExpense=f),label:"Date of Expense",type:"date",class:"mb-4"},null,8,["modelValue"]),e(z,{modelValue:u.value.amount,"onUpdate:modelValue":r[7]||(r[7]=f=>u.value.amount=f),label:"Amount",type:"number",prefix:"SAR",class:"mb-4"},null,8,["modelValue"]),e(z,{modelValue:u.value.description,"onUpdate:modelValue":r[8]||(r[8]=f=>u.value.description=f),label:"Description",class:"mb-4"},null,8,["modelValue"])])):q("",!0)]),_:1}),e(te,null,{default:t(()=>[e(Q),e(T,{variant:"outlined",onClick:p},{default:t(()=>r[10]||(r[10]=[y(" Cancel ")])),_:1,__:[10]}),e(T,{color:"primary",loading:g.value,onClick:s},{default:t(()=>r[11]||(r[11]=[y(" Add Data ")])),_:1,__:[11]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Ot=H({__name:"ImportFinancialDialog",props:{isDialogVisible:{type:Boolean}},emits:["update:isDialogVisible","dataImported"],setup(m,{emit:w}){const i=m,S=w,g=d(!1),b=d("sales"),u=d(null),n=A({get:()=>i.isDialogVisible,set:x=>S("update:isDialogVisible",x)}),s=async()=>{if(u.value){g.value=!0;try{await U.importData(u.value,b.value),u.value=null,b.value="sales",S("dataImported"),n.value=!1}catch(x){console.error("Error importing data:",x)}finally{g.value=!1}}},p=()=>{n.value=!1};return(x,r)=>{const O=ee;return F(),N(Z,{modelValue:n.value,"onUpdate:modelValue":r[2]||(r[2]=f=>n.value=f),"max-width":"600"},{default:t(()=>[e(O,{onClick:p}),e(E,{title:"Import Data"},{default:t(()=>[e(P,null,{default:t(()=>[e(_e,{modelValue:b.value,"onUpdate:modelValue":r[0]||(r[0]=f=>b.value=f),items:[{value:"sales",title:"Sales"},{value:"expenses",title:"Expense"}],label:"Category",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),e(et,{modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=f=>u.value=f),label:"Choose file",accept:".csv,.xlsx",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(te,null,{default:t(()=>[e(Q),e(T,{variant:"outlined",onClick:p},{default:t(()=>r[3]||(r[3]=[y(" Cancel ")])),_:1,__:[3]}),e(T,{color:"primary",loading:g.value,disabled:!u.value,onClick:s},{default:t(()=>r[4]||(r[4]=[y(" Import ")])),_:1,__:[4]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Nt={class:"me-3 d-flex gap-3 align-center"},Lt={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Bt={style:{"inline-size":"15.625rem"}},It={class:"font-weight-medium"},Mt={class:"text-success font-weight-medium"},qt={class:"text-error font-weight-medium"},jt={class:"font-weight-medium"},Ht={class:"text-error"},Qt={class:"text-success font-weight-medium"},Gt={class:"d-flex justify-space-between align-center flex-wrap gap-4"},Wt={class:"d-flex gap-3 align-center flex-wrap"},Xt={class:"d-flex align-center justify-space-between"},Yt={class:"text-body-2 text-medium-emphasis mb-3"},Jt={class:"text-h4 text-success"},Kt={class:"d-flex align-center justify-space-between"},Zt={class:"text-body-2 text-medium-emphasis mb-3"},ea={class:"text-h4 text-error"},ta={class:"d-flex align-center justify-space-between"},aa={class:"text-body-2 text-medium-emphasis mb-3"},la={class:"text-h4 text-primary"},sa={class:"text-body-1 text-high-emphasis"},oa={class:"text-body-1 text-high-emphasis"},ia={class:"text-body-1 text-high-emphasis"},na={class:"text-body-1 text-high-emphasis"},ra={class:"text-body-1 text-high-emphasis"},xe="rgba(var(--v-theme-on-background), var(--v-medium-emphasis-opacity))",da="rgba(var(--v-border-color), var(--v-border-opacity))",Wa=H({__name:"financial-overview",setup(m){const w=Ye(),i=d(10),S=d(1),g=d(),b=d(),u=async v=>{var l,V;g.value=(l=v.sortBy[0])==null?void 0:l.key,b.value=(V=v.sortBy[0])==null?void 0:V.order,await pe()},n=d("monthly"),s=d("all"),p=d("sales"),x=d([]),r=d([]),O=d([]);A(()=>p.value==="sales"?x.value:p.value==="expense"?r.value:p.value==="profit"?O.value:[]);const f=d(!1),ae=d(!1),Ve=d(!1),le=d(!1),se=d(!1),oe=d(!1),ie=d(!1),De=d(null),we=d(null),ne=d({categories:[],series:[]}),G=d({totalSales:0,totalExpenses:0,totalProfit:0,totalRoyalties:0,salesGrowth:0,profitMargin:0}),re=d([]),de=d([]),ue=d([]),me=d([]),W=d(0),X=d(""),Se=A(()=>{switch(p.value){case"sales":return x.value;case"expense":return r.value;case"profit":return O.value;default:return[]}}),Y={primary:"#9155FD",warning:"#FFB400",success:"#56CA00",error:"#FF4C51"},$e=A(()=>(w.current.value.colors,{chart:{type:"line",height:400,toolbar:{show:!1},zoom:{enabled:!1},parentHeightOffset:0},stroke:{curve:"smooth",width:3},xaxis:{categories:ne.value.categories,labels:{style:{colors:xe,fontSize:"13px"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:xe,fontSize:"13px"},formatter:v=>`${(v/1e3).toFixed(0)}k SAR`}},legend:{show:!0,position:"top",horizontalAlign:"left",labels:{colors:xe}},colors:[Y.success,Y.error,Y.warning,Y.primary],grid:{borderColor:da,strokeDashArray:5,padding:{top:-20,bottom:-10,left:0,right:0}},tooltip:{theme:w.current.value.dark?"dark":"light",y:{formatter:v=>`${v.toLocaleString()} SAR`}}})),Ee=A(()=>G.value.totalSales),Ae=A(()=>G.value.totalExpenses),Pe=A(()=>G.value.totalProfit),Re=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}],Ue=[{title:"Franchisee Name",key:"name",sortable:!0},{title:"Location",key:"location",sortable:!0},{title:"Sales (SAR)",key:"sales",sortable:!0},{title:"Expenses (SAR)",key:"expenses",sortable:!0},{title:"Royalties (SAR)",key:"royalties",sortable:!0},{title:"Net Sales (SAR)",key:"netSales",sortable:!0},{title:"Profit (SAR)",key:"profit",sortable:!0},{title:"Profit Margin (%)",key:"profitMargin",sortable:!0}],Te=[{title:"Product",key:"product",sortable:!0},{title:"Date of Sale",key:"date",sortable:!0},{title:"Unit Price (SAR)",key:"unitPrice",sortable:!0},{title:"Quantity Sold",key:"quantity",sortable:!0},{title:"Sale (SAR)",key:"sale",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],Fe=[{title:"Expense Category",key:"expenseCategory",sortable:!0},{title:"Date of Expense",key:"date",sortable:!0},{title:"Amount (SAR)",key:"amount",sortable:!0},{title:"Description",key:"description",sortable:!0},{title:"Actions",key:"actions",sortable:!1}],ze=[{title:"Date",key:"date",sortable:!0},{title:"Total Sales (SAR)",key:"totalSales",sortable:!0},{title:"Total Expenses (SAR)",key:"totalExpenses",sortable:!0},{title:"Profit (SAR)",key:"profit",sortable:!0}],Oe=A(()=>{switch(p.value){case"sales":return re.value;case"expense":return de.value;case"profit":return ue.value;default:return[]}}),Ne=A(()=>{switch(p.value){case"sales":return Te;case"expense":return Fe;case"profit":return ze;default:return[]}}),he=A(()=>W.value),ke=d(!1),Ce=d(!1);d("sales"),d("sales"),d(null),d({product:"",dateOfSale:"",unitPrice:0,quantitySold:0,expenseCategory:"",dateOfExpense:"",amount:0,description:""});const Le=async()=>{ae.value=!0;try{const v={period:n.value,unit:s.value==="all"?void 0:s.value},l=await U.getCharts(v);ne.value=l.data||{categories:[],series:[]}}catch(v){console.error("Error loading chart data:",v)}finally{ae.value=!1}},Be=async()=>{Ve.value=!0;try{const v={period:n.value,unit:s.value==="all"?void 0:s.value},l=await U.getStatistics(v);G.value=l.data||{totalSales:0,totalExpenses:0,totalProfit:0,totalRoyalties:0,salesGrowth:0,profitMargin:0}}catch(v){console.error("Error loading statistics:",v)}finally{Ve.value=!1}},I=async()=>{var v,l,V,D,h,J;le.value=!0;try{const o={search:X.value||void 0,page:S.value,per_page:i.value,sortBy:g.value,sortOrder:b.value,period:n.value,unit_id:s.value==="all"?void 0:s.value};switch(p.value){case"sales":{const R=await U.getSales(o);re.value=((v=R.data)==null?void 0:v.data)||[],W.value=((l=R.data)==null?void 0:l.total)||0;break}case"expense":{const R=await U.getExpenses(o);de.value=((V=R.data)==null?void 0:V.data)||[],W.value=((D=R.data)==null?void 0:D.total)||0;break}case"profit":{const R=await U.getProfit(o);ue.value=((h=R.data)==null?void 0:h.data)||[],W.value=((J=R.data)==null?void 0:J.total)||0;break}}}catch(o){console.error("Error loading table data:",o)}finally{le.value=!1}},Ie=async()=>{var v;se.value=!0;try{const l={period:n.value,unit:s.value==="all"?void 0:s.value},D=((v=(await U.getUnitPerformance(l)).data)==null?void 0:v.data)||[];Array.isArray(D)?me.value=D.map(h=>({id:h.id,name:h.name,location:h.location,sales:h.sales||0,expenses:h.expenses||0,royalties:h.royalties||0,netSales:(h.sales||0)-(h.royalties||0),profit:h.profit||0,profitMargin:h.profitMargin||0})):me.value=[]}catch(l){console.error("Error loading units data:",l)}finally{se.value=!1}},pe=async()=>{f.value=!0;try{await Promise.all([Le(),Be(),I(),Ie()])}finally{f.value=!1}},Me=async()=>{try{const v={period:n.value,unit:s.value==="all"?void 0:s.value},l=await U.exportData(p.value,v),V=window.URL.createObjectURL(l),D=document.createElement("a");D.href=V,D.download=`${p.value}-data-${n.value}.csv`,document.body.appendChild(D),D.click(),document.body.removeChild(D),window.URL.revokeObjectURL(V)}catch(v){console.error("Error exporting data:",v)}},qe=async()=>{await I()},je=async()=>{await I()},ce=v=>{const l=typeof v=="string"?Number.parseInt(v,10):v;let V;switch(p.value){case"sales":V=re.value.find(D=>D.id===l);break;case"expense":V=de.value.find(D=>D.id===l);break;case"profit":V=ue.value.find(D=>D.id===l);break}if(V)switch(p.value){case"sales":De.value=V,oe.value=!0;break;case"expense":we.value=V,ie.value=!0;break;case"profit":console.log("Viewing profit item:",V);break}};return ve([n,s],()=>{pe()}),ve(p,()=>{I()}),ve(X,()=>{S.value=1,I()}),Je(()=>{pe()}),(v,l)=>{const V=Xe,D=We,h=Ge,J=He;return F(),ge("section",null,[l[26]||(l[26]=a("div",{class:"d-flex justify-space-between align-center mb-6"},[a("div",null,[a("h4",{class:"text-h4 mb-1"}," Financial Overview "),a("p",{class:"text-body-1 mb-0"}," Manage your financial data across sales, expenses, and profit ")])],-1)),e(tt,{modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=o=>p.value=o),class:"mb-6"},{default:t(()=>[e(fe,{value:"sales"},{default:t(()=>l[12]||(l[12]=[y(" Sales ")])),_:1,__:[12]}),e(fe,{value:"expense"},{default:t(()=>l[13]||(l[13]=[y(" Expense ")])),_:1,__:[13]}),e(fe,{value:"profit"},{default:t(()=>l[14]||(l[14]=[y(" Profit ")])),_:1,__:[14]})]),_:1},8,["modelValue"]),e(E,{class:"mb-6"},{default:t(()=>[e(P,{class:"d-flex flex-wrap gap-4"},{default:t(()=>[a("div",Nt,[l[15]||(l[15]=a("span",{class:"text-body-2 text-disabled"},"Show:",-1)),e(V,{"model-value":i.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":l[1]||(l[1]=o=>i.value=parseInt(o,10))},null,8,["model-value"])]),e(Q),a("div",Lt,[a("div",Bt,[e(D,{modelValue:X.value,"onUpdate:modelValue":l[2]||(l[2]=o=>X.value=o),placeholder:`Search ${p.value}...`,"prepend-inner-icon":"tabler-search"},null,8,["modelValue","placeholder"])]),e(T,{variant:"tonal",color:"secondary","prepend-icon":"tabler-download",disabled:!Se.value.length,onClick:Me},{default:t(()=>l[16]||(l[16]=[y(" Export Selected ")])),_:1,__:[16]},8,["disabled"])])]),_:1}),e(B),e(Qe,{"items-per-page":i.value,"onUpdate:itemsPerPage":l[4]||(l[4]=o=>i.value=o),page:S.value,"onUpdate:page":l[5]||(l[5]=o=>S.value=o),"model-value":Se.value,items:Oe.value,"item-value":"id","items-length":he.value,headers:Ne.value,class:"text-no-wrap","show-select":"",loading:le.value,"onUpdate:options":u,"onUpdate:modelValue":l[6]||(l[6]=o=>{switch(p.value){case"sales":x.value=o;break;case"expense":r.value=o;break;case"profit":O.value=o;break}})},Ke({bottom:t(()=>[e(h,{page:S.value,"onUpdate:page":l[3]||(l[3]=o=>S.value=o),"items-per-page":i.value,"total-items":he.value},null,8,["page","items-per-page","total-items"])]),_:2},[p.value==="sales"?{name:"item.unitPrice",fn:t(({item:o})=>[a("span",It,c(Number(o.unitPrice).toFixed(2))+" SAR ",1)]),key:"0"}:void 0,p.value==="sales"?{name:"item.sale",fn:t(({item:o})=>[a("span",Mt,c(Number(o.sale).toFixed(2))+" SAR ",1)]),key:"1"}:void 0,p.value==="expense"?{name:"item.amount",fn:t(({item:o})=>[a("span",qt,c(Number(o.amount).toFixed(2))+" SAR ",1)]),key:"2"}:void 0,p.value==="expense"?{name:"item.expenseCategory",fn:t(({item:o})=>[e(j,{size:"small",variant:"tonal",color:"primary"},{default:t(()=>[y(c(o.expenseCategory),1)]),_:2},1024)]),key:"3"}:void 0,p.value==="profit"?{name:"item.totalSales",fn:t(({item:o})=>[a("span",jt,c(Number(o.totalSales).toFixed(2))+" SAR ",1)]),key:"4"}:void 0,p.value==="profit"?{name:"item.totalExpenses",fn:t(({item:o})=>[a("span",Ht,c(Number(o.totalExpenses).toFixed(2))+" SAR ",1)]),key:"5"}:void 0,p.value==="profit"?{name:"item.profit",fn:t(({item:o})=>[a("span",Qt,c(Number(o.profit).toFixed(2))+" SAR ",1)]),key:"6"}:void 0,p.value==="sales"?{name:"item.actions",fn:t(({item:o})=>[e(T,{icon:"",variant:"text",color:"primary",size:"small",onClick:R=>ce(o.id)},{default:t(()=>[e($,{icon:"tabler-eye"}),e(ye,{activator:"parent",location:"top"},{default:t(()=>l[17]||(l[17]=[y(" View Sale Details ")])),_:1,__:[17]})]),_:2},1032,["onClick"])]),key:"7"}:void 0,p.value==="expense"?{name:"item.actions",fn:t(({item:o})=>[e(T,{icon:"",variant:"text",color:"primary",size:"small",onClick:R=>ce(o.id)},{default:t(()=>[e($,{icon:"tabler-eye"}),e(ye,{activator:"parent",location:"top"},{default:t(()=>l[18]||(l[18]=[y(" View Expense Details ")])),_:1,__:[18]})]),_:2},1032,["onClick"])]),key:"8"}:void 0,p.value==="profit"?{name:"item.actions",fn:t(({item:o})=>[e(T,{icon:"",variant:"text",color:"primary",size:"small",onClick:R=>ce(o.id)},{default:t(()=>[e($,{icon:"tabler-eye"}),e(ye,{activator:"parent",location:"top"},{default:t(()=>l[19]||(l[19]=[y(" View Profit Details ")])),_:1,__:[19]})]),_:2},1032,["onClick"])]),key:"9"}:void 0]),1032,["items-per-page","page","model-value","items","items-length","headers","loading"])]),_:1}),e(K,{class:"mb-6"},{default:t(()=>[e(_,{cols:"12"},{default:t(()=>[a("div",Gt,[l[20]||(l[20]=a("div",null,[a("h4",{class:"text-h4 mb-1"}," Financial Overview "),a("p",{class:"text-body-1 text-medium-emphasis"}," Comprehensive financial analysis and performance tracking across all franchise units ")],-1)),a("div",Wt,[e(_e,{modelValue:n.value,"onUpdate:modelValue":l[7]||(l[7]=o=>n.value=o),items:Re,"item-title":"title","item-value":"value",density:"compact",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"])])])]),_:1})]),_:1}),e(K,{class:"mb-6"},{default:t(()=>[e(_,{cols:"12",md:"4"},{default:t(()=>[e(E,null,{default:t(()=>[e(P,null,{default:t(()=>[a("div",Xt,[a("div",null,[l[21]||(l[21]=a("h6",{class:"text-h6 mb-1"}," Total Sales ",-1)),a("div",Yt,c(n.value==="yearly"?"Annual":n.value==="monthly"?"Monthly":"Daily")+" Revenue ",1),a("h4",Jt,c((Ee.value||0).toLocaleString())+" SAR ",1)]),e(be,{color:"success",variant:"tonal",size:"56"},{default:t(()=>[e($,{icon:"tabler-trending-up",size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",md:"4"},{default:t(()=>[e(E,null,{default:t(()=>[e(P,null,{default:t(()=>[a("div",Kt,[a("div",null,[l[22]||(l[22]=a("h6",{class:"text-h6 mb-1"}," Total Expenses ",-1)),a("div",Zt,c(n.value==="yearly"?"Annual":n.value==="monthly"?"Monthly":"Daily")+" Costs ",1),a("h4",ea,c((Ae.value||0).toLocaleString())+" SAR ",1)]),e(be,{color:"error",variant:"tonal",size:"56"},{default:t(()=>[e($,{icon:"tabler-trending-down",size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",md:"4"},{default:t(()=>[e(E,null,{default:t(()=>[e(P,null,{default:t(()=>[a("div",ta,[a("div",null,[l[23]||(l[23]=a("h6",{class:"text-h6 mb-1"}," Total Profit ",-1)),a("div",aa,c(n.value==="yearly"?"Annual":n.value==="monthly"?"Monthly":"Daily")+" Earnings ",1),a("h4",la,c((Pe.value||0).toLocaleString())+" SAR ",1)]),e(be,{color:"primary",variant:"tonal",size:"56"},{default:t(()=>[e(L(at),{size:"28"})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(E,{class:"mb-6"},{default:t(()=>[e(P,null,{default:t(()=>{var o;return[l[24]||(l[24]=a("h6",{class:"text-h6 mb-4"}," Financial Performance ",-1)),e(J,{type:"line",height:"400",options:$e.value,series:((o=ne.value)==null?void 0:o.series)||[],loading:ae.value},null,8,["options","series","loading"])]}),_:1,__:[24]})]),_:1}),e(E,null,{default:t(()=>[e(P,null,{default:t(()=>[l[25]||(l[25]=a("h6",{class:"text-h6 mb-4"}," Units Performance ",-1)),e(lt,{headers:Ue,items:me.value,loading:se.value,class:"text-no-wrap"},{"item.sales":t(({item:o})=>[a("div",sa,c(L(M)(o.sales||0)),1)]),"item.expenses":t(({item:o})=>[a("div",oa,c(L(M)(o.expenses||0)),1)]),"item.royalties":t(({item:o})=>[a("div",ia,c(L(M)(o.royalties||0)),1)]),"item.netSales":t(({item:o})=>[a("div",na,c(L(M)(o.netSales||0)),1)]),"item.profit":t(({item:o})=>[a("div",ra,c(L(M)(o.profit||0)),1)]),"item.profitMargin":t(({item:o})=>[e(j,{color:(o.profitMargin||0)>0?"success":"error",size:"small",label:""},{default:t(()=>[y(c((o.profitMargin||0).toFixed(1))+"% ",1)]),_:2},1032,["color"])]),_:1},8,["items","loading"])]),_:1,__:[25]})]),_:1}),e(zt,{"is-dialog-visible":ke.value,"onUpdate:isDialogVisible":l[8]||(l[8]=o=>ke.value=o),onDataAdded:qe},null,8,["is-dialog-visible"]),e(Ot,{"is-dialog-visible":Ce.value,"onUpdate:isDialogVisible":l[9]||(l[9]=o=>Ce.value=o),onDataImported:je},null,8,["is-dialog-visible"]),e(Vt,{"is-dialog-visible":oe.value,"onUpdate:isDialogVisible":l[10]||(l[10]=o=>oe.value=o),"sale-data":De.value},null,8,["is-dialog-visible","sale-data"]),e(Ut,{"is-dialog-visible":ie.value,"onUpdate:isDialogVisible":l[11]||(l[11]=o=>ie.value=o),"expense-data":we.value},null,8,["is-dialog-visible","expense-data"])])}}});export{Wa as default};
