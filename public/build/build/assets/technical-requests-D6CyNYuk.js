import{_ as de}from"./AppTextField.vue_vue_type_script_setup_true_lang-Dp8jGCw7.js";import{_ as me}from"./AppSelect.vue_vue_type_script_setup_true_lang-DOrgpFkU.js";import{_ as ve,a as pe,b as fe,c as ge,d as be,t as h,e as ye}from"./TechnicalRequestsTable.vue_vue_type_script_setup_true_lang-Djbjp46L.js";import{d as we,r as a,P as z,G as Ve,b2 as ke,w as qe,c as xe,b as s,f as o,o as N,e as u,a9 as S,t as p,ax as O,g as Ce,l as _e,m as he,v as F}from"./main-B8QbR-yS.js";import{V as M,a as D}from"./VRow-LlT6Azsr.js";import{V as Se,a as De,b as Ue}from"./VCard-D9PhtsJ0.js";import{V as Re}from"./VSnackbar-NyFIQu1q.js";import{V as G}from"./VCardText-Cbtr6Qhr.js";import{V as H}from"./VDivider-DOfIMbJY.js";import{V as Pe}from"./VSpacer-BSXBFFTK.js";import"./form-Dt-W1fp6.js";import"./VTextField-C7_y5spr.js";import"./VImg-Ceu2Mboj.js";import"./VField-Bw51LFql.js";import"./forwardRefs--KQCZfKO.js";import"./VInput-DB3XZUVb.js";import"./VSelect-GSzN3Qps.js";import"./VList-BJCgULVd.js";import"./VAvatar-87LH5tAk.js";import"./dialog-transition-Dy2Gj1XO.js";import"./VMenu-TQcmpCCv.js";import"./VOverlay-B3La6Ajr.js";import"./scopeId-DyQ6a1uN.js";import"./VCheckboxBtn-CWPoGbRz.js";import"./VSelectionControl-DDEVNAf7.js";import"./VChip-CgHwmC-k.js";import"./VSlideGroup-BuNiGLv2.js";import"./AppTextarea.vue_vue_type_script_setup_true_lang-yoNOmpMf.js";import"./VTextarea-1ursQqQ2.js";import"./VDialog-CEq2jzbd.js";import"./VForm-C9sxpau4.js";import"./VFileInput-Ip2n4ssl.js";import"./VTooltip-D-apmXOm.js";import"./VDataTableServer-2Q8oqYfo.js";import"./VDataTable-FYAU2aQJ.js";import"./VTable-CgkStP3y.js";/* empty css              */const Te={class:"d-flex align-center justify-space-between"},Be={class:"me-3 d-flex gap-3"},Ie={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Ee={style:{"inline-size":"15.625rem"}},Vt=we({__name:"technical-requests",setup($e){const n=a(!1),c=a({show:!1,message:"",color:"success"}),U=(t,e="success")=>{c.value={show:!0,message:t,color:e}},f=a(""),g=a(),b=a(),v=a(10),x=a(1),Q=a(),J=a(),i=a([]),C=a(!1),y=a(!1),R=a(null),_=a(!1),P=a(null),w=a(!1),d=a(null),V=a(!1),T=a(""),k=z(()=>T.value==="admin"),K=t=>{var e,r;Q.value=(e=t.sortBy[0])==null?void 0:e.key,J.value=(r=t.sortBy[0])==null?void 0:r.order},B=t=>{var r;const e=(r=t.split(".").pop())==null?void 0:r.toLowerCase();return["jpg","jpeg","png","gif","svg","webp"].includes(e||"")?"tabler-photo":["pdf"].includes(e||"")?"tabler-file-type-pdf":["doc","docx"].includes(e||"")?"tabler-file-type-doc":["xls","xlsx"].includes(e||"")?"tabler-file-type-xls":["txt","log"].includes(e||"")?"tabler-file-text":["zip","rar","7z"].includes(e||"")?"tabler-file-zip":"tabler-file"},I=t=>{const e=t.toLowerCase().replace("_","-");return e==="open"?"info":e==="in-progress"||e==="pending-info"?"warning":e==="resolved"?"success":e==="closed"?"secondary":e==="cancelled"?"error":"primary"},E=t=>{const e=t.toLowerCase();return e==="low"?{color:"info",icon:"tabler-arrow-down"}:e==="medium"?{color:"warning",icon:"tabler-minus"}:e==="high"?{color:"error",icon:"tabler-arrow-up"}:e==="urgent"?{color:"error",icon:"tabler-alert-triangle"}:{color:"primary",icon:"tabler-minus"}},$=t=>t?t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "):"",W=[{title:"Request ID",key:"requestId"},{title:"Subject",key:"subject"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Date",key:"date"},{title:"Actions",key:"actions",sortable:!1}],A=a([]),L=a(0),X=t=>{var r,q;let e=[];return t.attachments&&Array.isArray(t.attachments)&&(e=t.attachments.map((l,ce)=>({name:l.split("/").pop()||`attachment-${ce}`,size:"Unknown",url:l}))),{id:t.id,requestId:t.ticket_number,userName:((r=t.requester)==null?void 0:r.name)||"Unknown",userEmail:((q=t.requester)==null?void 0:q.email)||"",userAvatar:"",subject:t.title,description:t.description,priority:t.priority,status:t.status,date:new Date(t.created_at).toISOString().split("T")[0],category:t.category,attachments:e}},m=async()=>{try{n.value=!0;const t=await h.getTechnicalRequests({status:g.value,priority:b.value,search:f.value,per_page:v.value,page:x.value});A.value=t.data.data.map(X),L.value=t.data.total}catch(t){console.error("Error fetching technical requests:",t)}finally{n.value=!1}},Y=z(()=>A.value),Z=[{title:"Open",value:"open"},{title:"In Progress",value:"in_progress"},{title:"Pending Info",value:"pending_info"},{title:"Resolved",value:"resolved"},{title:"Closed",value:"closed"},{title:"Cancelled",value:"cancelled"}],ee=[{title:"Low",value:"low"},{title:"Medium",value:"medium"},{title:"High",value:"high"},{title:"Urgent",value:"urgent"}],te=t=>{R.value=t,y.value=!0},j=t=>{P.value=t,_.value=!0,y.value=!1},le=t=>{j(t)},se=t=>{d.value=t,w.value=!0},ae=async()=>{if(d.value)try{n.value=!0,await h.deleteTechnicalRequest(d.value.id),await m();const t=i.value.findIndex(e=>e===d.value.id);t!==-1&&i.value.splice(t,1),d.value=null,w.value=!1}catch(t){console.error("Error deleting technical request:",t)}finally{n.value=!1}},oe=()=>{i.value.length!==0&&(V.value=!0)},re=async()=>{try{n.value=!0,await h.bulkDelete(i.value),await m(),i.value=[],V.value=!1}catch(t){console.error("Error bulk deleting requests:",t)}finally{n.value=!1}},ie=oe,ne=async()=>{U("Technical request created successfully!","success"),await m()},ue=async()=>{U("Technical request updated successfully!","success"),await m()};return Ve(()=>{var e;const t=ke("userData");T.value=((e=t.value)==null?void 0:e.role)||"",m()}),qe([g,b,f],()=>{m()}),(t,e)=>{const r=me,q=de;return N(),xe("section",null,[s(M,{class:"mb-6"},{default:o(()=>[s(D,{cols:"12"},{default:o(()=>[u("div",Te,[e[16]||(e[16]=u("div",null,[u("h2",{class:"text-h2 mb-1"}," Technical Requests "),u("p",{class:"text-body-1 text-medium-emphasis"}," Manage and track all technical support requests ")],-1)),u("div",null,[s(S,{color:"primary",onClick:e[0]||(e[0]=l=>C.value=!0)},{default:o(()=>[s(O,{icon:"tabler-plus",class:"me-2"}),e[15]||(e[15]=p(" Submit Request "))]),_:1,__:[15]})])])]),_:1})]),_:1}),s(Se,{class:"mb-6"},{default:o(()=>[s(De,{class:"pb-4"},{default:o(()=>[s(Ue,null,{default:o(()=>e[17]||(e[17]=[p("Filters")])),_:1,__:[17]})]),_:1}),s(G,null,{default:o(()=>[s(M,null,{default:o(()=>[s(D,{cols:"12",sm:"4"},{default:o(()=>[s(r,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),placeholder:"Select Status",items:Z,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1}),s(D,{cols:"12",sm:"4"},{default:o(()=>[s(r,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=l=>b.value=l),placeholder:"Select Priority",items:ee,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(H),s(G,{class:"d-flex flex-wrap gap-4"},{default:o(()=>[u("div",Be,[s(r,{"model-value":v.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[3]||(e[3]=l=>v.value=parseInt(l,10))},null,8,["model-value"]),i.value.length>0?(N(),Ce(S,{key:0,variant:"tonal",color:"error",onClick:he(ie)},{default:o(()=>[s(O,{icon:"tabler-trash",class:"me-2"}),p(" Delete Selected ("+F(i.value.length)+") ",1)]),_:1},8,["onClick"])):_e("",!0)]),s(Pe),u("div",Ie,[u("div",Ee,[s(q,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=l=>f.value=l),placeholder:"Search Requests"},null,8,["modelValue"])])])]),_:1}),s(H),s(ye,{items:Y.value,"items-length":L.value,loading:n.value,selectedRows:i.value,"onUpdate:selectedRows":e[5]||(e[5]=l=>i.value=l),headers:W,"is-admin":k.value,itemsPerPage:v.value,"onUpdate:itemsPerPage":e[6]||(e[6]=l=>v.value=l),page:x.value,"onUpdate:page":e[7]||(e[7]=l=>x.value=l),"resolve-priority-variant":E,"resolve-status-variant":I,"format-status":$,"get-file-icon":B,onViewRequest:te,onEditRequest:j,onDeleteRequest:se,"onUpdate:options":K},null,8,["items","items-length","loading","selectedRows","is-admin","itemsPerPage","page"])]),_:1}),s(ve,{visible:y.value,"onUpdate:visible":e[8]||(e[8]=l=>y.value=l),request:R.value,"show-edit-button":k.value,"is-admin":k.value,"resolve-priority-variant":E,"resolve-status-variant":I,"format-status":$,"get-file-icon":B,onEdit:le},null,8,["visible","request","show-edit-button","is-admin"]),s(pe,{visible:_.value,"onUpdate:visible":e[9]||(e[9]=l=>_.value=l),request:P.value,"is-admin":k.value,onSuccess:ue},null,8,["visible","request","is-admin"]),s(fe,{visible:C.value,"onUpdate:visible":e[10]||(e[10]=l=>C.value=l),onSuccess:ne},null,8,["visible"]),s(ge,{visible:w.value,"onUpdate:visible":e[11]||(e[11]=l=>w.value=l),request:d.value,loading:n.value,onConfirm:ae},null,8,["visible","request","loading"]),s(be,{visible:V.value,"onUpdate:visible":e[12]||(e[12]=l=>V.value=l),"selected-count":i.value.length,loading:n.value,onConfirm:re},null,8,["visible","selected-count","loading"]),s(Re,{modelValue:c.value.show,"onUpdate:modelValue":e[14]||(e[14]=l=>c.value.show=l),timeout:"3000"},{actions:o(()=>[s(S,{color:c.value.color,onClick:e[13]||(e[13]=l=>c.value.show=!1)},{default:o(()=>e[18]||(e[18]=[p(" Close ")])),_:1,__:[18]},8,["color"])]),default:o(()=>[p(F(c.value.message)+" ",1)]),_:1},8,["modelValue"])])}}});export{Vt as default};
