import{m as pe}from"./vue3-apexcharts-smiyFtih.js";import{d as fe,ak as he,r as h,P as L,w as ye,G as xe,c as x,b as t,g as B,l as ge,f as s,aO as k,o as u,e as a,a$ as be,t as y,v as n,a3 as j,F as Q,i as W,aa as m,x as _e}from"./main-C3-SOPYs.js";import{a as we}from"./VOverlay-BUy4HRci.js";import{V as X}from"./VAlert-DhNog1PA.js";import{V as N,a as b}from"./VRow-B0gP2GFy.js";import{V as Ve}from"./VDialog-BCAw06ZB.js";import{V as M}from"./VSelect-C8HOAYKp.js";import{V as S,a as Z,b as ee,c as Ce,d as Re}from"./VCard-CoFtOtzl.js";import{a as ke,V as Se}from"./VTabs-B_qmBq2O.js";import{V as te}from"./VDivider-UG-1iRGQ.js";import{V as z}from"./VCardText-gJE2FZ-X.js";import{V as w}from"./VAvatar-DaCLSk-0.js";import{V as G}from"./VRating-DFMBzvCT.js";import{V as ze}from"./VChip-B1b-jhkP.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-CqkleIqs.js";import"./easing-Bybner-F.js";import"./lazy-Dg4IFEOh.js";import"./scopeId-DlDW9TaM.js";import"./VImg-DGmz0H4K.js";/* empty css              */import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition--yy6PSnQ.js";import"./VTextField-Dh9Jn9l4.js";/* empty css                   */import"./VCounter-DSzXIg7-.js";import"./VField-C57WoLXE.js";import"./form-Byy7mIuz.js";import"./VInput-CuHkYGdD.js";import"./VList-aiwrjFdO.js";import"./ssrBoot-BIjc9Qlg.js";import"./VMenu-C67K7Qaw.js";import"./VCheckboxBtn-D7mH8e-9.js";import"./VSelectionControl-BNnDiK64.js";import"./VWindowItem-BJYBdumP.js";import"./VSlideGroup-DuXa1Bxs.js";const $e={class:"d-flex justify-space-between align-center flex-wrap gap-4"},Ae={class:"d-flex gap-3 align-center flex-wrap"},De={style:{height:"400px",position:"relative"}},Pe={key:1,class:"d-flex align-center justify-center h-100"},Te={class:"text-center"},Ee={class:"d-flex align-center justify-space-between mb-4"},Le={class:"text-body-2 text-medium-emphasis"},je={class:"mt-4"},Ne={key:0},Ue={class:"d-flex align-center"},Oe={class:"text-caption font-weight-bold"},Be={class:"text-body-2 font-weight-medium"},Me={class:"text-caption text-medium-emphasis"},Ge={class:"text-end"},Ie={class:"text-body-2 font-weight-medium"},qe={class:"text-caption text-success"},He={key:1,class:"text-center py-4"},Ke={class:"d-flex align-center justify-space-between mb-4"},Ye={class:"mt-4 text-center"},Je={class:"d-flex align-center justify-center mb-3"},Qe={class:"text-h3 me-2 text-success"},We={class:"text-body-2 text-medium-emphasis"},Xe={class:"text-body-2 text-medium-emphasis mb-2"},Ze={class:"d-flex align-center justify-space-between mb-4"},et={key:0,class:"mt-4 text-center"},tt={class:"text-h6 font-weight-medium mb-1"},at={class:"text-body-2 text-medium-emphasis mb-3"},st={class:"d-flex align-center justify-center mb-2"},ot={class:"text-h4 me-2 text-warning"},lt={class:"text-caption text-medium-emphasis"},it={key:1,class:"mt-4 text-center"},rt={class:"d-flex align-center justify-space-between mb-4"},nt={key:0,class:"mt-4 text-center"},dt={class:"text-h6 font-weight-medium mb-1"},ct={class:"text-body-2 text-medium-emphasis mb-3"},ut={class:"d-flex align-center justify-center mb-2"},mt={class:"text-h4 me-2 text-error"},vt={class:"text-caption text-medium-emphasis mb-3"},pt={key:1,class:"mt-4 text-center"},ft={class:"text-body-2"},F="/api/v1/franchisor/performance",ht="rgba(var(--v-theme-on-background), var(--v-high-emphasis-opacity))",ae="rgba(var(--v-theme-on-background), var(--v-medium-emphasis-opacity))",yt="rgba(var(--v-border-color), var(--v-border-opacity))",xt=fe({__name:"performance-management",setup(gt){const se=he(),v=h("monthly"),d=h("all"),V=h(!1),C=h(null),D=h([]),U=h({periods:[],datasets:{}}),$=h([]),g=h({score:0,max_score:5,total_reviews:0,trend:"0"}),O=h({top_rated:null,lowest_rated:null}),p=L(()=>O.value.top_rated),f=L(()=>O.value.lowest_rated),P={primary:"#9155FD",warning:"#FFB400",success:"#56CA00",error:"#FF4C51"},oe=L(()=>{const o=se.current.value.colors;return{chart:{type:"line",height:400,toolbar:{show:!1},zoom:{enabled:!1},parentHeightOffset:0},stroke:{curve:"smooth",width:3},xaxis:{categories:U.value.periods,labels:{style:{colors:ae,fontSize:"13px"}},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{style:{colors:ae,fontSize:"13px"},formatter:e=>`${(e/1e3).toFixed(0)}k SAR`}},legend:{show:!0,position:"top",horizontalAlign:"left",labels:{colors:ht}},colors:[P.primary,P.error,P.warning,P.success],grid:{borderColor:yt,strokeDashArray:5,padding:{top:-20,bottom:-10,left:0,right:0}},tooltip:{theme:o.dark?"dark":"light",y:{formatter:e=>`${e.toLocaleString()} SAR`}}}}),I=L(()=>{const o=d.value==="all"?"all":d.value.toString(),e=U.value.datasets[o];return e?[{name:"Revenue",data:e.revenue},{name:"Expenses",data:e.expenses},{name:"Royalties",data:e.royalties},{name:"Profit",data:e.profit}]:[]}),le=async()=>{try{const o=await k(`${F}/units`);o.success&&(D.value=o.data,(!d.value||!o.data.find(e=>e.id===d.value))&&(d.value="all"))}catch(o){console.error("Error fetching units:",o),C.value="Failed to fetch units"}},q=async()=>{try{V.value=!0;const o=d.value==="all"?null:d.value,e=await k(`${F}/chart-data`,{query:{period_type:v.value,unit_id:o}});e.success&&(U.value=e.data)}catch(o){console.error("Error fetching chart data:",o),C.value="Failed to fetch chart data"}finally{V.value=!1}},H=async()=>{try{const o=await k(`${F}/top-performers`,{query:{period_type:v.value,limit:3}});o.success&&($.value=o.data)}catch(o){console.error("Error fetching top performers:",o)}},K=async()=>{try{const o=await k(`${F}/customer-satisfaction`,{query:{period_type:v.value}});o.success&&(g.value=o.data)}catch(o){console.error("Error fetching customer satisfaction:",o)}},Y=async()=>{try{const o=await k(`${F}/ratings`,{query:{period_type:v.value}});o.success&&(O.value=o.data)}catch(o){console.error("Error fetching ratings:",o)}},ie=async()=>{await Promise.all([le(),q(),H(),K(),Y()])};ye([v,d],()=>{q(),H(),K(),Y()}),xe(()=>{ie()});const A=h(!1),R=h("csv"),_=h("performance"),re=[{title:"CSV Format",value:"csv"},{title:"Excel Format",value:"xlsx"}],ne=[{title:"Performance Data",value:"performance"},{title:"Statistics Summary",value:"stats"},{title:"All Data",value:"all"}],T=(o,e)=>[e.join(","),...o.map(c=>e.map(l=>{const i=c[l]||"";return typeof i=="string"&&i.includes(",")?`"${i}"`:i}).join(","))].join(`
`),E=(o,e,c)=>{const l=new Blob([o],{type:c}),i=window.URL.createObjectURL(l),r=document.createElement("a");r.href=i,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(i)},de=()=>{A.value=!0},ce=async()=>{var o;try{const e=d.value==="all"?null:d.value,c=await k(`${F}/export`,{query:{period_type:v.value,unit_id:e,export_type:_.value}});if(c.success){const l=new Date().toISOString().split("T")[0],i=((o=D.value.find(r=>r.id===d.value))==null?void 0:o.name)||"All Units";(_.value==="performance"||_.value==="all")&&ue(c.data.performance,l,i),(_.value==="stats"||_.value==="all")&&me(c.data.stats,l)}}catch(e){console.error("Error exporting data:",e),C.value="Failed to export data"}A.value=!1},ue=(o,e,c)=>{if(!o||o.length===0)return;const l=["Period Date","Branch Name","Revenue","Expenses","Royalties","Profit","Profit Margin","Customer Rating","Reviews","Growth Rate"],i=`performance-data-${c.replace(/\s+/g,"-").toLowerCase()}-${v.value}-${e}.${R.value}`;if(R.value==="csv"){const r=T(o,l);E(r,i,"text/csv")}else{const r=T(o,l);E(r,i,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")}},me=(o,e)=>{if(!o)return;const c=[...$.value.map((r,ve)=>({Category:"Top Performing Locations",Rank:ve+1,Name:r.name,Location:r.location,"Revenue (SAR)":r.revenue,"Growth (%)":r.growth,Rating:"",Reviews:"",Manager:""})),{Category:"Customer Satisfaction",Rank:"",Name:"Overall Score",Location:"","Revenue (SAR)":"","Growth (%)":"",Rating:`${g.value.score}/5.0`,Reviews:g.value.total_reviews.toString(),Manager:""},...p.value?[{Category:"Top Rated Franchise",Rank:1,Name:p.value.name,Location:p.value.location,"Revenue (SAR)":"","Growth (%)":"",Rating:`${p.value.rating}/5.0`,Reviews:p.value.reviews.toString(),Manager:p.value.manager}]:[],...f.value?[{Category:"Needs Attention",Rank:"",Name:f.value.name,Location:f.value.location,"Revenue (SAR)":"","Growth (%)":"",Rating:`${f.value.rating}/5.0`,Reviews:f.value.reviews.toString(),Manager:f.value.manager}]:[]],l=["Category","Rank","Name","Location","Revenue (SAR)","Growth (%)","Rating","Reviews","Manager"],i=`stats-summary-${e}.${R.value}`;if(R.value==="csv"){const r=T(c,l);E(r,i,"text/csv")}else{const r=T(c,l);E(r,i,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")}},J=[{title:"Daily",value:"daily"},{title:"Monthly",value:"monthly"},{title:"Yearly",value:"yearly"}];return(o,e)=>{const c=pe;return u(),x("section",null,[t(we,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),class:"align-center justify-center"},{default:s(()=>[t(be,{indeterminate:"",color:"primary",size:"64"}),e[8]||(e[8]=a("div",{class:"text-center mt-4"},[a("h4",{class:"text-h4"}," Loading Performance Data... "),a("p",{class:"text-body-1 text-medium-emphasis"}," Please wait while we fetch the latest metrics ")],-1))]),_:1,__:[8]},8,["modelValue"]),C.value?(u(),B(X,{key:0,type:"error",class:"mb-4",dismissible:"","onClick:dismiss":e[1]||(e[1]=l=>C.value=null)},{default:s(()=>[y(n(C.value),1)]),_:1})):ge("",!0),t(N,{class:"mb-6"},{default:s(()=>[t(b,{cols:"12"},{default:s(()=>[a("div",$e,[e[10]||(e[10]=a("div",null,[a("h4",{class:"text-h4 mb-1"}," Performance Management "),a("p",{class:"text-body-1 text-medium-emphasis"}," Monitor and analyze franchise performance across all locations ")],-1)),a("div",Ae,[t(M,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value=l),items:J,"item-title":"title","item-value":"value",density:"compact",style:{"min-width":"120px"},variant:"outlined"},null,8,["modelValue"]),t(j,{color:"primary","prepend-icon":"tabler-download",disabled:V.value,onClick:de},{default:s(()=>e[9]||(e[9]=[y(" Export ")])),_:1,__:[9]},8,["disabled"])])])]),_:1})]),_:1}),t(N,null,{default:s(()=>[t(b,{cols:"12"},{default:s(()=>[t(S,null,{default:s(()=>[t(Z,{class:"pb-4"},{append:s(()=>[t(ke,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=l=>d.value=l),density:"compact",color:"primary"},{default:s(()=>[(u(!0),x(Q,null,W(D.value,l=>(u(),B(Se,{key:l.id,value:l.id,size:"small"},{default:s(()=>[y(n(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),default:s(()=>[t(ee,{class:"text-h6"},{default:s(()=>e[11]||(e[11]=[y(" Franchise Performance Overview ")])),_:1,__:[11]})]),_:1}),t(te),t(z,null,{default:s(()=>[a("div",De,[I.value.length>0?(u(),B(c,{key:0,type:"line",height:"400",options:oe.value,series:I.value},null,8,["options","series"])):(u(),x("div",Pe,[a("div",Te,[t(m,{icon:"tabler-chart-line",size:"64",class:"text-medium-emphasis mb-4"}),e[12]||(e[12]=a("p",{class:"text-body-1 text-medium-emphasis"}," No data available for the selected period and unit ",-1))])]))])]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{class:"mt-6"},{default:s(()=>[t(b,{cols:"12",md:"3"},{default:s(()=>[t(S,{class:"h-100"},{default:s(()=>[t(z,null,{default:s(()=>[a("div",Ee,[a("div",null,[e[13]||(e[13]=a("h6",{class:"text-h6 mb-1"}," Top 3 Performing Location ",-1)),a("div",Le," This "+n(v.value==="monthly"?"month":v.value==="yearly"?"year":"period"),1)]),t(w,{color:"primary",variant:"tonal",size:"40"},{default:s(()=>[t(m,{icon:"tabler-trophy"})]),_:1})]),a("div",je,[$.value.length>0?(u(),x("div",Ne,[(u(!0),x(Q,null,W($.value,(l,i)=>(u(),x("div",{key:i,class:_e(["d-flex align-center justify-space-between py-3",{"border-b":i<$.value.length-1}])},[a("div",Ue,[t(w,{color:i===0?"warning":i===1?"info":"success",size:"24",class:"me-3"},{default:s(()=>[a("span",Oe,n(i+1),1)]),_:2},1032,["color"]),a("div",null,[a("div",Be,n(l.name),1),a("div",Me,n(l.location),1)])]),a("div",Ge,[a("div",Ie,n(l.revenue),1),a("div",qe,n(l.growth),1)])],2))),128))])):(u(),x("div",He,[t(m,{icon:"tabler-chart-bar",size:"48",class:"text-medium-emphasis mb-2"}),e[14]||(e[14]=a("p",{class:"text-body-2 text-medium-emphasis"}," No performance data available ",-1))]))])]),_:1})]),_:1})]),_:1}),t(b,{cols:"12",md:"3"},{default:s(()=>[t(S,{class:"h-100"},{default:s(()=>[t(z,null,{default:s(()=>[a("div",Ke,[e[15]||(e[15]=a("div",null,[a("h6",{class:"text-h6 mb-1"}," Customer Satisfaction Score "),a("div",{class:"text-body-2 text-medium-emphasis"}," Average rating ")],-1)),t(w,{color:"success",variant:"tonal",size:"40"},{default:s(()=>[t(m,{icon:"tabler-star"})]),_:1})]),a("div",Ye,[a("div",Je,[a("h3",Qe,n(g.value.score),1),a("div",We," / "+n(g.value.max_score),1)]),t(G,{"model-value":g.value.score,readonly:"",size:"small",color:"warning",class:"mb-3"},null,8,["model-value"]),a("div",Xe," Based on "+n(g.value.total_reviews.toLocaleString())+" reviews ",1),t(ze,{color:"success",size:"small",variant:"tonal"},{default:s(()=>[t(m,{start:"",icon:"tabler-trending-up",size:"16"}),y(" "+n(g.value.trend)+" this month ",1)]),_:1})])]),_:1})]),_:1})]),_:1}),t(b,{cols:"12",md:"3"},{default:s(()=>[t(S,{class:"h-100"},{default:s(()=>[t(z,null,{default:s(()=>[a("div",Ze,[e[16]||(e[16]=a("div",null,[a("h6",{class:"text-h6 mb-1"}," Top-Rated Franchise "),a("div",{class:"text-body-2 text-medium-emphasis"}," Highest customer rating ")],-1)),t(w,{color:"warning",variant:"tonal",size:"40"},{default:s(()=>[t(m,{icon:"tabler-award"})]),_:1})]),p.value?(u(),x("div",et,[t(w,{color:"warning",size:"60",class:"mb-3"},{default:s(()=>[t(m,{icon:"tabler-building-store",size:"30"})]),_:1}),a("div",tt,n(p.value.name),1),a("div",at,n(p.value.location),1),a("div",st,[a("h4",ot,n(p.value.rating),1),t(G,{"model-value":p.value.rating,readonly:"",size:"small",color:"warning"},null,8,["model-value"])]),a("div",lt,n(p.value.reviews)+" reviews ",1)])):(u(),x("div",it,[t(m,{icon:"tabler-star-off",size:"48",class:"text-medium-emphasis mb-2"}),e[17]||(e[17]=a("p",{class:"text-body-2 text-medium-emphasis"}," No rating data available ",-1))]))]),_:1})]),_:1})]),_:1}),t(b,{cols:"12",md:"3"},{default:s(()=>[t(S,{class:"h-100"},{default:s(()=>[t(z,null,{default:s(()=>[a("div",rt,[e[18]||(e[18]=a("div",null,[a("h6",{class:"text-h6 mb-1"}," Lowest-Rated Franchise "),a("div",{class:"text-body-2 text-medium-emphasis"}," Needs attention ")],-1)),t(w,{color:"error",variant:"tonal",size:"40"},{default:s(()=>[t(m,{icon:"tabler-alert-triangle"})]),_:1})]),f.value?(u(),x("div",nt,[t(w,{color:"error",size:"60",class:"mb-3"},{default:s(()=>[t(m,{icon:"tabler-building-store",size:"30"})]),_:1}),a("div",dt,n(f.value.name),1),a("div",ct,n(f.value.location),1),a("div",ut,[a("h4",mt,n(f.value.rating),1),t(G,{"model-value":f.value.rating,readonly:"",size:"small",color:"warning"},null,8,["model-value"])]),a("div",vt,n(f.value.reviews)+" reviews ",1),t(j,{color:"error",variant:"tonal",size:"small",block:""},{default:s(()=>[t(m,{start:"",icon:"tabler-message",size:"16"}),e[19]||(e[19]=y(" Contact Unit "))]),_:1,__:[19]})])):(u(),x("div",pt,[t(m,{icon:"tabler-star",size:"48",class:"text-medium-emphasis mb-2"}),e[20]||(e[20]=a("p",{class:"text-body-2 text-medium-emphasis"}," No rating data available ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),t(Ve,{modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=l=>A.value=l),"max-width":"500"},{default:s(()=>[t(S,{class:"text-center px-6 py-8"},{default:s(()=>[t(Z,{class:"pb-4"},{default:s(()=>[t(ee,{class:"text-h5 mb-2"},{default:s(()=>[t(m,{icon:"tabler-download",class:"me-2"}),e[21]||(e[21]=y(" Export Data "))]),_:1,__:[21]}),t(Ce,{class:"text-body-1"},{default:s(()=>e[22]||(e[22]=[y(" Choose export format and data type ")])),_:1,__:[22]})]),_:1}),t(te,{class:"mb-6"}),t(z,{class:"text-start"},{default:s(()=>[t(N,null,{default:s(()=>[t(b,{cols:"12"},{default:s(()=>[t(M,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=l=>_.value=l),items:ne,"item-title":"title","item-value":"value",label:"Data Type",variant:"outlined",density:"comfortable","prepend-inner-icon":"tabler-database"},null,8,["modelValue"])]),_:1}),t(b,{cols:"12"},{default:s(()=>[t(M,{modelValue:R.value,"onUpdate:modelValue":e[5]||(e[5]=l=>R.value=l),items:re,"item-title":"title","item-value":"value",label:"Export Format",variant:"outlined",density:"comfortable","prepend-inner-icon":"tabler-file-type-csv"},null,8,["modelValue"])]),_:1})]),_:1}),t(X,{type:"info",variant:"tonal",class:"mt-4",density:"compact"},{prepend:s(()=>[t(m,{icon:"tabler-info-circle"})]),default:s(()=>{var l,i;return[a("div",ft,[e[23]||(e[23]=a("strong",null,"Current Selection:",-1)),e[24]||(e[24]=a("br",null,null,-1)),y(" Period: "+n((l=J.find(r=>r.value===v.value))==null?void 0:l.title),1),e[25]||(e[25]=a("br",null,null,-1)),y(" Unit: "+n((i=D.value.find(r=>r.id===d.value))==null?void 0:i.name),1)])]}),_:1})]),_:1}),t(Re,{class:"d-flex align-center justify-center gap-3 pt-4"},{default:s(()=>[t(j,{variant:"outlined",color:"secondary",onClick:e[6]||(e[6]=l=>A.value=!1)},{default:s(()=>e[26]||(e[26]=[y(" Cancel ")])),_:1,__:[26]}),t(j,{color:"primary","prepend-icon":"tabler-download",disabled:V.value,onClick:ce},{default:s(()=>e[27]||(e[27]=[y(" Export Data ")])),_:1,__:[27]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),aa=Fe(xt,[["__scopeId","data-v-f8b71f29"]]);export{aa as default};
