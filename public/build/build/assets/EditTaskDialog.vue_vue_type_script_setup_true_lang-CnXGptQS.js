import{r as V,b4 as y,b5 as T,d as w,w as H,g as b,f as i,b as l,l as O,m as s,a9 as S,t as U,o as h}from"./main-gemCwVks.js";import{V as I,_ as A}from"./VDialog-6C-NQXCx.js";import{V as C}from"./VDivider-B4ry9pxl.js";import{V as E}from"./VCardText-BD5AHO-w.js";import{V as F,a as u}from"./VRow-DiX7eN30.js";import{V as v}from"./VTextField-BhxF6EAD.js";import{V as P}from"./VTextarea-OEcL0zKK.js";import{V as k}from"./VSelect-C9dxRhag.js";import{d as q,V as B}from"./VCard-DJ82mpnW.js";import{V as N}from"./VSpacer-Cpeayo2U.js";const X=()=>{const n=V([]),m=V([]),c=V(!1),d=V(null),t=async()=>{var e,o;try{c.value=!0,d.value=null;const a=await T("/v1/franchisor/franchisees");a.success&&((e=a.data)!=null&&e.data)?n.value=a.data.data.map(p=>({id:p.id,name:p.name,email:p.email,role:"franchisee",status:p.status})):n.value=[]}catch(a){console.error("Failed to fetch franchisees:",a),d.value=((o=a==null?void 0:a.data)==null?void 0:o.message)||"Failed to fetch franchisees",n.value=[]}finally{c.value=!1}},f=async()=>{var e;try{c.value=!0,d.value=null;const o=await T("/v1/franchisor/sales-associates");o.success&&o.data?m.value=o.data.map(a=>({id:a.id,name:a.name,email:a.email,role:"sales",status:a.status})):m.value=[]}catch(o){console.error("Failed to fetch sales users:",o),d.value=((e=o==null?void 0:o.data)==null?void 0:e.message)||"Failed to fetch sales users",m.value=[]}finally{c.value=!1}},D=e=>(e==="franchisee"?n.value:m.value).filter(a=>a.status==="active").map(a=>({title:`${a.name} (${a.email})`,value:a.id,subtitle:a.role})),g=(e,o)=>{const p=(o==="franchisee"?n.value:m.value).find(_=>_.id===e);return p?p.name:"Unknown User"},r=async(e="both")=>{(e==="franchisee"||e==="both")&&await t(),(e==="sales"||e==="both")&&await f()};return{franchisees:y(n),salesUsers:y(m),loading:y(c),error:y(d),fetchFranchisees:t,fetchSalesUsers:f,getUsersForSelect:D,getUserNameById:g,initializeUsers:r}},x=["Onboarding","Training","Compliance","Maintenance","Marketing","Operations","Finance","Support","Other"],R=[{title:"Low",value:"low"},{title:"Medium",value:"medium"},{title:"High",value:"high"},{title:"Urgent",value:"urgent"}],$=[{title:"Pending",value:"pending"},{title:"On Hold",value:"on_hold"},{title:"Cancelled",value:"cancelled"},{title:"In Progress",value:"in_progress"},{title:"Completed",value:"completed"}],Z=[{title:"Task Info",key:"taskInfo"},{title:"Category",key:"category"},{title:"Assigned To",key:"assignedTo"},{title:"Unit",key:"unitName"},{title:"Start Date",key:"startDate"},{title:"Due Date",key:"dueDate"},{title:"Priority",key:"priority"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],ee=w({__name:"EditTaskDialog",props:{isDialogVisible:{type:Boolean},task:{},userOptions:{},usersLoading:{type:Boolean,default:!1}},emits:["update:isDialogVisible","task-updated"],setup(n,{emit:m}){const c=n,d=m,t=V(null),f=V(!1);H(()=>c.task,r=>{r&&(t.value={...r})},{immediate:!0});const D=async()=>{var r;if(t.value)try{f.value=!0;const e=await T(`/v1/franchisor/tasks/${t.value.id}`,{method:"PUT",body:{title:t.value.title,description:t.value.description,category:t.value.category,priority:t.value.priority,status:t.value.status,due_date:t.value.dueDate,estimated_hours:t.value.estimatedHours,actual_hours:t.value.actualHours}});if(e.success){const o={id:e.data.id,title:e.data.title,description:e.data.description,category:e.data.type||"other",assignedTo:((r=e.data.assigned_to)==null?void 0:r.name)||t.value.assignedTo,startDate:e.data.started_at?new Date(e.data.started_at).toISOString().split("T")[0]:t.value.startDate,dueDate:e.data.due_date?new Date(e.data.due_date).toISOString().split("T")[0]:t.value.dueDate,priority:e.data.priority||t.value.priority,status:e.data.status||t.value.status,estimatedHours:e.data.estimated_hours||t.value.estimatedHours,actualHours:e.data.actual_hours||t.value.actualHours};d("task-updated",o),d("update:isDialogVisible",!1)}else console.error("Failed to update task:",e)}catch(e){console.error("Error updating task:",e)}finally{f.value=!1}},g=()=>{d("update:isDialogVisible",!1)};return(r,e)=>{const o=A;return h(),b(I,{"model-value":r.isDialogVisible,"max-width":"600",persistent:"","onUpdate:modelValue":e[10]||(e[10]=a=>d("update:isDialogVisible",a))},{default:i(()=>[l(o,{onClick:g}),l(B,{title:"Edit Task"},{default:i(()=>[l(C),s(t)?(h(),b(E,{key:0,class:"pa-6"},{default:i(()=>[l(F,null,{default:i(()=>[l(u,{cols:"12"},{default:i(()=>[l(v,{modelValue:s(t).title,"onUpdate:modelValue":e[0]||(e[0]=a=>s(t).title=a),label:"Task Title",placeholder:"Enter task title",required:""},null,8,["modelValue"])]),_:1}),l(u,{cols:"12"},{default:i(()=>[l(P,{modelValue:s(t).description,"onUpdate:modelValue":e[1]||(e[1]=a=>s(t).description=a),label:"Description",placeholder:"Enter task description",rows:"3",required:""},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:i(()=>[l(k,{modelValue:s(t).category,"onUpdate:modelValue":e[2]||(e[2]=a=>s(t).category=a),label:"Category",placeholder:"Select category",items:s(x),required:""},null,8,["modelValue","items"])]),_:1}),l(u,{cols:"12",md:"6"},{default:i(()=>[l(k,{modelValue:s(t).assignedTo,"onUpdate:modelValue":e[3]||(e[3]=a=>s(t).assignedTo=a),label:"Assigned To",placeholder:"Select user",items:r.userOptions,loading:r.usersLoading,"item-title":"title","item-value":"value",required:""},null,8,["modelValue","items","loading"])]),_:1}),l(u,{cols:"12",md:"6"},{default:i(()=>[l(v,{modelValue:s(t).startDate,"onUpdate:modelValue":e[4]||(e[4]=a=>s(t).startDate=a),label:"Start Date",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:i(()=>[l(v,{modelValue:s(t).dueDate,"onUpdate:modelValue":e[5]||(e[5]=a=>s(t).dueDate=a),label:"Due Date",type:"date",required:""},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:i(()=>[l(k,{modelValue:s(t).priority,"onUpdate:modelValue":e[6]||(e[6]=a=>s(t).priority=a),label:"Priority",items:s(R),required:""},null,8,["modelValue","items"])]),_:1}),l(u,{cols:"12",md:"6"},{default:i(()=>[l(k,{modelValue:s(t).status,"onUpdate:modelValue":e[7]||(e[7]=a=>s(t).status=a),label:"Status",items:s($),required:""},null,8,["modelValue","items"])]),_:1}),l(u,{cols:"12",md:"6"},{default:i(()=>[l(v,{modelValue:s(t).estimatedHours,"onUpdate:modelValue":e[8]||(e[8]=a=>s(t).estimatedHours=a),label:"Estimated Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"6"},{default:i(()=>[l(v,{modelValue:s(t).actualHours,"onUpdate:modelValue":e[9]||(e[9]=a=>s(t).actualHours=a),label:"Actual Hours",type:"number",min:"0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):O("",!0),l(C),l(q,{class:"pa-6"},{default:i(()=>[l(N),l(S,{color:"secondary",variant:"tonal",onClick:g},{default:i(()=>e[11]||(e[11]=[U(" Cancel ")])),_:1,__:[11]}),l(S,{color:"primary",loading:s(f),onClick:D},{default:i(()=>e[12]||(e[12]=[U(" Save Changes ")])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{R as P,$ as S,x as T,ee as _,Z as a,X as u};
